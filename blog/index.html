
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Topic%201/Note%202/">
      
      
        <link rel="next" href="archive/2024/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../feed_rss_updated.xml">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>Blog - Atoni Brain Washed</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#blog" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Atoni Brain Washed" class="md-header__button md-logo" aria-label="Atoni Brain Washed" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Atoni Brain Washed
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Blog
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Atoni Brain Washed" class="md-nav__button md-logo" aria-label="Atoni Brain Washed" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Atoni Brain Washed
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Obsidian Notes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Features/LaTeX%20Math%20Support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LaTeX Math Support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Features/Mermaid%20Diagrams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mermaid diagrams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Features/Text%20Formatting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text Formatting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Topic 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Topic 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Topic%201/Note%201/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Note 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Topic%201/Note%202/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Note 2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="blog">Blog<a class="headerlink" href="#blog" title="Permanent link">&para;</a></h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-11-14 00:00:00">November 14, 2024</time></li>
        
        
          
          <li class="md-meta__item">
            
              134 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="configure-virtual-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/">Configure virtual networks</a></h2>
<h2 id="introduction"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction">Introduction</a></h2>
<p>Azure virtual networks are an essential component for creating private networks in Azure. They allow different Azure resources to securely communicate with each other, the internet, and on-premises networks.</p>
<p>Suppose you work for a company in the healthcare industry. Your company is looking to migrate their on-premises infrastructure to Azure. They want to ensure secure communication between their resources in Azure and their on-premises network. The company is also concerned about scalability and availability. By using Azure virtual networks, they can create a private network in Azure and securely connect their resources.</p>
<p>The topics covered in this module include subnetting, creating virtual networks, and using private and public IP addresses. You also learn about the different scenarios where virtual networks can be used, such as creating a dedicated private cloud-only network or extending a data center securely. The module provides a detailed explanation of subnets and their benefits, and how to plan IP addressing for Azure resources.</p>
<p>By the end of this module, you have a clear understanding of how to create and configure virtual networks in Azure. You're able to effectively use subnets, assign IP addresses, and ensure secure communication between your Azure resources and on-premises network.</p>
<h3 id="learning-objectives"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learning-objectives">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Describe Azure virtual network features and components.</li>
<li>Identify features and usage cases for subnets and subnetting.</li>
<li>Identify usage cases for private and public IP addresses.</li>
<li>Create a virtual network and assign an IP address.</li>
</ul>
<h3 id="skills-measured"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#skills-measured">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#prerequisites">Prerequisites</a></h3>
<ul>
<li>Basic knowledge of virtual networking in cloud environments.</li>
<li>Familiarity with IP address formats and subnetting.</li>
</ul>
<h2 id="plan-virtual-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#plan-virtual-networks">Plan virtual networks</a></h2>
<p>A major incentive for adopting cloud solutions like Azure is to enable information technology departments to transition server resources to the cloud. Moving resources to the cloud can save money and simplify administrative operations. Relocating resources removes the need to maintain expensive datacenters with uninterruptible power supplies, generators, multiple fail-safes, or clustered database servers. For small and medium-sized companies, which might not have the expertise to maintain their own robust infrastructure, moving to the cloud is particularly appealing.</p>
<p>After resources are moved to Azure, they require the same networking functionality as an on-premises deployment. In specific scenarios, the resources require some level of network isolation. Azure network services offer a range of components with functionalities and capabilities, as shown in the following image:</p>
<p><img alt="Screenshot that shows the main components of Azure network services." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-networks/media/network-components-66dff480.png" /></p>
<h4 id="things-to-know-about-azure-virtual-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-azure-virtual-networks">Things to know about Azure virtual networks</a></h4>
<p>You can implement Azure Virtual Network to create a virtual representation of your network in the cloud. Let's examine some characteristics of virtual networks in Azure.</p>
<ul>
<li>
<p>An Azure virtual network is a logical isolation of the Azure cloud resources.</p>
</li>
<li>
<p>You can use virtual networks to provision and manage virtual private networks (VPNs) in Azure.</p>
</li>
<li>
<p>Each virtual network has its own Classless Inter-Domain Routing (CIDR) block and can be linked to other virtual networks and on-premises networks.</p>
</li>
<li>
<p>You can link virtual networks with an on-premises IT infrastructure to create hybrid or cross-premises solutions, when the CIDR blocks of the connecting networks don't overlap.</p>
</li>
<li>
<p>You control the DNS server settings for virtual networks, and segmentation of the virtual network into subnets.</p>
</li>
</ul>
<p>The following illustration depicts a virtual network that has a subnet containing two virtual machines. The virtual network has connections to an on-premises infrastructure and a separate virtual network.</p>
<p><img alt="Diagram of a virtual network with a subnet of two virtual machines. The network connects to an on-premises infrastructure and separate virtual network." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-networks/media/virtual-networks-c016972b.png" /></p>
<h4 id="things-to-consider-when-using-virtual-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-using-virtual-networks">Things to consider when using virtual networks</a></h4>
<p>Virtual networks can be used in many ways. As you think about the configuration plan for your virtual networks and subnets, consider the following scenarios.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>Create a dedicated private cloud-only virtual network</em></td>
<td>Sometimes you don't require a cross-premises configuration for your solution. When you create a virtual network, your services and virtual machines within your virtual network can communicate directly and securely with each other in the cloud. You can still configure endpoint connections for the virtual machines and services that require internet communication, as part of your solution.</td>
</tr>
<tr>
<td><em>Securely extend your data center with virtual networks</em></td>
<td>You can build traditional site-to-site VPNs to securely scale your datacenter capacity. Site-to-site VPNs use IPSEC to provide a secure connection between your corporate VPN gateway and Azure.</td>
</tr>
<tr>
<td><em>Enable hybrid cloud scenarios</em></td>
<td>Virtual networks give you the flexibility to support a range of hybrid cloud scenarios. You can securely connect cloud-based applications to any type of on-premises system, such as mainframes and Unix systems.</td>
</tr>
</tbody>
</table>
<h2 id="create-subnets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-subnets">Create subnets</a></h2>
<p>Subnets provide a way for you to implement logical divisions within your virtual network. Your network can be segmented into subnets to help improve security, increase performance, and make it easier to manage.</p>
<h4 id="things-to-know-about-subnets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-subnets">Things to know about subnets</a></h4>
<p>There are certain conditions for the IP addresses in a virtual network when you apply segmentation with subnets.</p>
<ul>
<li>
<p>Each subnet contains a range of IP addresses that fall within the virtual network address space.</p>
</li>
<li>
<p>The address range for a subnet must be unique within the address space for the virtual network.</p>
</li>
<li>
<p>The range for one subnet can't overlap with other subnet IP address ranges in the same virtual network.</p>
</li>
<li>
<p>The IP address space for a subnet must be specified by using CIDR notation.</p>
</li>
<li>
<p>You can segment a virtual network into one or more subnets in the Azure portal. Characteristics about the IP addresses for the subnets are listed.</p>
<p><img alt="Screenshot that shows multiple subnets for a virtual network in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-networks/media/azure-subnets-a5c893d5.png" /></p>
</li>
</ul>
<h5 id="reserved-addresses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#reserved-addresses">Reserved addresses</a></h5>
<p>For each subnet, Azure reserves five IP addresses. The first four addresses and the last address are reserved.</p>
<p>Let's examine the reserved addresses in an IP address range of <code>192.168.1.0/24</code>.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Reserved address</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>192.168.1.0</code></td>
<td>This value identifies the virtual network address.</td>
</tr>
<tr>
<td><code>192.168.1.1</code></td>
<td>Azure configures this address as the default gateway.</td>
</tr>
<tr>
<td><code>192.168.1.2</code> <em>and</em> <code>192.168.1.3</code></td>
<td>Azure maps these Azure DNS IP addresses to the virtual network space.</td>
</tr>
<tr>
<td><code>192.168.1.255</code></td>
<td>This value supplies the virtual network broadcast address.</td>
</tr>
</tbody>
</table>
<h4 id="things-to-consider-when-using-subnets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-using-subnets">Things to consider when using subnets</a></h4>
<p>When you plan for adding subnet segments within your virtual network, there are several factors to consider. Review the following scenarios.</p>
<ul>
<li>
<p><strong>Consider service requirements</strong>. Each service directly deployed into a virtual network has specific requirements for routing and the types of traffic that must be allowed into and out of associated subnets. A service might require or create their own subnet. There must be enough unallocated space to meet the service requirements. Suppose you connect a virtual network to an on-premises network by using Azure VPN Gateway. The virtual network must have a dedicated subnet for the gateway.</p>
</li>
<li>
<p><strong>Consider network virtual appliances</strong>. Azure routes network traffic between all subnets in a virtual network, by default. You can override Azure's default routing to prevent Azure routing between subnets. You can also override the default to route traffic between subnets through a network virtual appliance. If you require traffic between resources in the same virtual network to flow through a network virtual appliance, deploy the resources to different subnets.</p>
</li>
<li>
<p><strong>Consider service endpoints</strong>. You can limit access to Azure resources like an Azure storage account or Azure SQL database to specific subnets with a virtual network service endpoint. You can also deny access to the resources from the internet. You might create multiple subnets, and then enable a service endpoint for some subnets, but not others.</p>
</li>
<li>
<p><strong>Consider network security groups</strong>. You can associate zero or one network security group to each subnet in a virtual network. You can associate the same or a different network security group to each subnet. Each network security group contains rules that allow or deny traffic to and from sources and destinations.</p>
</li>
<li>
<p><strong>Consider private links</strong>. Azure Private Link provides private connectivity from a virtual network to Azure platform as a service (PaaS), customer-owned, or Microsoft partner services. Private Link simplifies the network architecture and secures the connection between endpoints in Azure. The service eliminates data exposure to the public internet.</p>
</li>
</ul>
<h2 id="create-virtual-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-virtual-networks">Create virtual networks</a></h2>
<p>You can create new virtual networks at any time. You can also add virtual networks when you create a virtual machine.</p>
<h4 id="things-to-know-about-creating-virtual-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-creating-virtual-networks">Things to know about creating virtual networks</a></h4>
<p>Review the following requirements for creating a virtual network.</p>
<ul>
<li>
<p>When you create a virtual network, you need to define the IP address space for the network.</p>
</li>
<li>
<p>Plan to use an IP address space that's not already in use in your organization.</p>
<ul>
<li>
<p>The address space for the network can be either on-premises or in the cloud, but not both.</p>
</li>
<li>
<p>Once you create the IP address space, it can't be changed. If you plan your address space for cloud-only virtual networks, you might later decide to connect an on-premises site.</p>
</li>
</ul>
</li>
<li>
<p>To create a virtual network, you need to define at least one subnet.</p>
<ul>
<li>
<p>Each subnet contains a range of IP addresses that fall within the virtual network address space.</p>
</li>
<li>
<p>The address range for each subnet must be unique within the address space for the virtual network.</p>
</li>
<li>
<p>The range for one subnet can't overlap with other subnet IP address ranges in the same virtual network.</p>
</li>
</ul>
</li>
<li>
<p>You can create a virtual network in the Azure portal. Provide the Azure subscription, resource group, virtual network name, and service region for the network.</p>
<p><img alt="Screenshot that shows how to create a virtual network in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-networks/media/create-virtual-networks-b4f1fd40.png" /></p>
</li>
</ul>
<p>Note</p>
<p>Default limits on Azure networking resources can change periodically. Be sure to consult the <a href="https://learn.microsoft.com/en-us/azure/networking/">Azure networking documentation</a> for the latest information.</p>
<h2 id="plan-ip-addressing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#plan-ip-addressing">Plan IP addressing</a></h2>
<p>You can assign IP addresses to Azure resources to communicate with other Azure resources, your on-premises network, and the internet. There are two types of Azure IP addresses: <em>private</em> and <em>public</em>.</p>
<p><strong>Private IP addresses</strong> enable communication within an Azure virtual network and your on-premises network. You create a private IP address for your resource when you use a VPN gateway or Azure ExpressRoute circuit to extend your network to Azure.</p>
<p><strong>Public IP addresses</strong> allow your resource to communicate with the internet. You can create a public IP address to connect with Azure public-facing services.</p>
<p>The following illustration shows a virtual machine resource that has a private IP address and a public IP address.</p>
<p><img alt="Illustration of a resource with a private IP address and a public IP address." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-networks/media/ip-addressing-54476e47.png" /></p>
<h4 id="things-to-know-about-ip-addresses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-ip-addresses">Things to know about IP addresses</a></h4>
<p>Let's take a closer look at the characteristics of IP addresses.</p>
<ul>
<li>
<p>IP addresses can be statically assigned or dynamically assigned.</p>
</li>
<li>
<p>You can separate dynamically and statically assigned IP resources into different subnets.</p>
</li>
<li>
<p>Static IP addresses don't change and are best for certain situations, such as:</p>
<ul>
<li>DNS name resolution, where a change in the IP address requires updating host records.</li>
<li>IP address-based security models that require apps or services to have a static IP address.</li>
<li>TLS/SSL certificates linked to an IP address.</li>
<li>Firewall rules that allow or deny traffic by using IP address ranges.</li>
<li>Role-based virtual machines such as Domain Controllers and DNS servers.</li>
</ul>
</li>
</ul>
<h2 id="create-public-ip-addressing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-public-ip-addressing">Create public IP addressing</a></h2>
<p>You can create a public IP address for your resource in the Azure portal.</p>
<p><img alt="Screenshot that shows how to create a public IP address in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-networks/media/create-public-ip-address-f07bd67d.png" /></p>
<h4 id="things-to-consider-when-creating-a-public-ip-address"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-creating-a-public-ip-address">Things to consider when creating a public IP address</a></h4>
<p>To create a public IP address, configure the following settings:</p>
<ul>
<li>
<p><strong>IP Version</strong>: Select to create an <strong>IPv4</strong> or <strong>IPv6</strong> address, or <strong>Both</strong> addresses.</p>
</li>
<li>
<p><strong>SKU</strong>: Select the SKU for the public IP address, including <strong>Basic</strong> or <strong>Standard</strong>. The value must match the SKU of the Azure load balancer with which the address is used.</p>
</li>
<li>
<p><strong>Name</strong>: Enter a name to identify the IP address. The name must be unique within the resource group you select.</p>
</li>
<li>
<p><strong>IP address assignment</strong>: Identify the type of IP address assignment to use.</p>
<ul>
<li>
<p><strong>Dynamic</strong> addresses are assigned after a public IP address is associated to an Azure resource and is started for the first time. Dynamic addresses can change if a resource such as a virtual machine is stopped (deallocated) and then restarted through Azure. The address remains the same if a virtual machine is rebooted or stopped from within the guest OS. When a public IP address resource is removed from a resource, the dynamic address is released.</p>
</li>
<li>
<p><strong>Static</strong> addresses are assigned when a public IP address is created. Static addresses aren't released until a public IP address resource is deleted. If the address isn't associated to a resource, you can change the assignment method after the address is created. If the address is associated to a resource, you might not be able to change the assignment method.</p>
</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>If you select <strong>IPv6</strong> for the IP version, the assignment method must be <strong>Dynamic</strong> for the Basic SKU. Standard SKU addresses are <strong>Static</strong> for both IPv4 and IPv6 addresses.</p>
<h2 id="associate-public-ip-addresses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#associate-public-ip-addresses">Associate public IP addresses</a></h2>
<p>A public IP address resource can be associated with virtual machine network interfaces, internet-facing load balancers, VPN gateways, and application gateways. You can associate your resource with both dynamic and static public IP addresses.</p>
<h4 id="things-to-consider-when-associating-public-ip-addresses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-associating-public-ip-addresses">Things to consider when associating public IP addresses</a></h4>
<p>The following table summarizes how you can associate public IP addresses for different types of resources.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Public IP address association</th>
<th>Dynamic IP address</th>
<th>Static IP address</th>
</tr>
</thead>
<tbody>
<tr>
<td>Virtual machine</td>
<td>NIC</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Load balancer</td>
<td>Front-end configuration</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>VPN gateway</td>
<td>VPN gateway IP configuration</td>
<td>Yes</td>
<td>Yes <strong>*</strong></td>
</tr>
<tr>
<td>Application gateway</td>
<td>Front-end configuration</td>
<td>Yes</td>
<td>Yes <strong>*</strong></td>
</tr>
</tbody>
</table>
<p><strong>*</strong> Static IP addresses are available on certain SKUs only.</p>
<h5 id="public-ip-address-skus"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#public-ip-address-skus">Public IP address SKUs</a></h5>
<p>When you create a public IP address, you select the Basic or Standard SKU. Your SKU choice affects the IP assignment method, security, available resources, and redundancy options.</p>
<p>The following table summarizes the differences between the SKU types for public IP addresses.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Basic SKU</th>
<th>Standard SKU</th>
</tr>
</thead>
<tbody>
<tr>
<td>IP assignment</td>
<td>Static or Dynamic</td>
<td>Static</td>
</tr>
<tr>
<td>Security</td>
<td>Open by default</td>
<td>Secure by default, closed to inbound traffic</td>
</tr>
<tr>
<td>Resources</td>
<td>Network interfaces, VPN gateways, Application gateways, and internet-facing load balancers</td>
<td>Network interfaces or public standard load balancers</td>
</tr>
<tr>
<td>Redundancy</td>
<td>Not zone redundant</td>
<td>Zone redundant by default</td>
</tr>
</tbody>
</table>
<h2 id="allocate-or-assign-private-ip-addresses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#allocate-or-assign-private-ip-addresses">Allocate or assign private IP addresses</a></h2>
<p>A private IP address resource can be associated with virtual machine network interfaces, internal load balancers, and application gateways. Azure can provide an IP address (dynamic assignment) or you can assign the IP address (static assignment).</p>
<h4 id="things-to-consider-when-associating-private-ip-addresses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-associating-private-ip-addresses">Things to consider when associating private IP addresses</a></h4>
<p>The following table summarizes how you can associate private IP addresses for different types of resources.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Private IP address association</th>
<th>Dynamic IP address</th>
<th>Static IP address</th>
</tr>
</thead>
<tbody>
<tr>
<td>Virtual machine</td>
<td>NIC</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Internal load balancer</td>
<td>Front-end configuration</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Application gateway</td>
<td>Front-end configuration</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h5 id="private-ip-address-assignment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#private-ip-address-assignment">Private IP address assignment</a></h5>
<p>A private IP address is allocated from the address range of the virtual network subnet that a resource is deployed in. There are two options: dynamic and static.</p>
<ul>
<li>
<p><strong>Dynamic</strong>: Azure assigns the next available unassigned or unreserved IP address in the subnet's address range. Dynamic assignment is the default allocation method.</p>
<p>Suppose addresses 10.0.0.4 through 10.0.0.9 are already assigned to other resources. In this case, Azure assigns the address 10.0.0.10 to a new resource.</p>
</li>
<li>
<p><strong>Static</strong>: You select and assign any unassigned or unreserved IP address in the subnet's address range.</p>
<p>Suppose a subnet's address range is 10.0.0.0/16, and addresses 10.0.0.4 through 10.0.0.9 are already assigned to other resources. In this scenario, you can assign any address between 10.0.0.10 and 10.0.255.254.</p>
</li>
</ul>
<h2 id="interactive-lab-simulation"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#interactive-lab-simulation">Interactive lab simulation</a></h2>
<h3 id="lab-scenario"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#lab-scenario">Lab scenario</a></h3>
<p>Your organization is migrating network infrastructure and virtual machines to Azure. As the Azure Administrator you need to:</p>
<ul>
<li>Configure Azure virtual networks and subnets.</li>
<li>Connect remotely to Azure virtual machines by using RDP.</li>
<li>Verify virtual machines in the same virtual network can communicate.</li>
</ul>
<h3 id="architecture-diagram"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#architecture-diagram">Architecture diagram</a></h3>
<p><img alt="Diagram of the architecture as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-networks/media/create-network-architecture.png" /></p>
<h3 id="objectives"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#objectives">Objectives</a></h3>
<ul>
<li><strong>Task 1</strong>: Create a virtual network.<ul>
<li>Create a virtual network, <strong>vnet1</strong>, with an IP address space of 10.1.0.0/16.</li>
<li>Create a subnet, <strong>default</strong>, with an IP address space of 10.1.0.0/24.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Create two virtual machines.<ul>
<li>Create a virtual machine, <strong>vm1</strong>, in <strong>vnet1</strong> and allow inbound RDP.</li>
<li>Create a second virtual machine, <strong>vm2</strong>, in <strong>vnet1</strong> and allow inbound RDP.</li>
<li>Ensure both virtual machines are deployed and running before continuing.</li>
</ul>
</li>
<li><strong>Task 3</strong>: Test the virtual machine connections.<ul>
<li>Connect to <strong>vm1</strong> with RDP.</li>
<li>Connect to <strong>vm2</strong> with RDP.</li>
<li>Disable the public and private Windows Firewall on both virtual machines.</li>
<li>Use Azure PowerShell to confirm <strong>vm1</strong> can ping <strong>vm2</strong>.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Select the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%204"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-networks/media/simulation-create-networks.png" /></a></p>
<h2 id="summary-and-resources"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#summary-and-resources">Summary and resources</a></h2>
<p>In this module, you learned about Azure virtual networks and their importance in creating private networks in Azure. You explored the benefits of using virtual networks, such as scalability, availability, and isolation. You learned how to create virtual networks with subnetting and how to determine which resources require public or private IP addresses.</p>
<p>The main takeaways from this module are:</p>
<ul>
<li>
<p>Azure virtual networks allow different Azure resources to securely communicate with each other, the internet, and on-premises networks.</p>
</li>
<li>
<p>Subnets within virtual networks provide logical divisions, improving security, performance, and management.</p>
</li>
<li>
<p>When creating virtual networks, ensure that the IP address space is unique and doesn't overlap with other subnets.</p>
</li>
<li>
<p>IP addresses can provide public or private access to resources.</p>
</li>
</ul>
<h3 id="learn-more-with-documentation"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more-with-documentation">Learn more with documentation</a></h3>
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview">What is Azure Virtual Network?</a>. This article is your starting point to learn about virtual networks.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/virtual-network/ip-services/public-ip-addresses">Public IP addresses</a>. This article reviews the basics of when to use public IP addresses.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/virtual-network/private-ip-addresses">Private IP addresses</a>. This article reviews the basics of when to use private IP addresses.</p>
</li>
</ul>
<h3 id="learn-more-with-self-paced-training"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more-with-self-paced-training">Learn more with self-paced training</a></h3>
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/training/modules/introduction-to-azure-virtual-networks/">Introduction to Azure Virtual Networks</a>. Learn how to design and implement core Azure Networking infrastructure.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/training/modules/design-ip-addressing-for-azure/">Design an IP addressing schema for your Azure deployment (sandbox)</a>. Learn about network IP addressing and integration.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/training/modules/implement-windows-server-iaas-virtual-machine-ip-addressing-routing/">Implement Windows Server IaaS virtual machine IP addressing and routing</a>. Learn about IP addressing and virtual networks for virtual machines.</p>
</li>
</ul>
<hr />
<h2 id="configure-network-security-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-network-security-groups">Configure network security groups</a></h2>
<h2 id="introduction_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction_1">Introduction</a></h2>
<p>Network security groups are a way to limit network traffic to resources in your virtual network. Network security groups contain a list of security rules that allow or deny inbound or outbound network traffic.</p>
<p>Suppose your company has several locations and wants to migrate to a cloud based solution. The company only considers moving key systems onto the cloud platform if stringent security requirements can be met. These requirements include tight control over which computers have network access to the app servers. You need to secure both virtual machine networking and Azure services networking. Your goal is to prevent unwanted or unsecured network traffic from being able to reach key systems.</p>
<p>In this module, you learn how to create a network security group, configure inbound and outbound port rules, and verify secure connectivity.</p>
<p>The goal of this module is to teach you how to control network traffic with network security groups.</p>
<h2 id="implement-network-security-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#implement-network-security-groups">Implement network security groups</a></h2>
<p>You can limit network traffic to resources in your virtual network by using a network security group. You can assign a network security group to a subnet or a network interface, and define security rules in the group to control network traffic.</p>
<h4 id="things-to-know-about-network-security-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-network-security-groups">Things to know about network security groups</a></h4>
<p>Let's look at the characteristics of network security groups.</p>
<ul>
<li>
<p>A network security group contains a list of security rules that allow or deny inbound or outbound network traffic.</p>
</li>
<li>
<p>A network security group can be associated to a subnet or a network interface.</p>
</li>
<li>
<p>A network security group can be associated multiple times.</p>
</li>
<li>
<p>You create a network security group and define security rules in the Azure portal.</p>
</li>
</ul>
<p>Network security groups are defined for your virtual machines in the Azure portal. The <strong>Overview</strong> page for a virtual machine provides information about the associated network security groups. You can see details such as the assigned subnets, assigned network interfaces, and the defined security rules.</p>
<p><img alt="Screenshot that shows details for a network security group for a virtual machine in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/network-security-groups-1ebf7bed.png" /></p>
<h5 id="network-security-groups-and-subnets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#network-security-groups-and-subnets">Network security groups and subnets</a></h5>
<p>You can assign network security groups to a subnet and create a protected screened subnet (also referred to as a demilitarized zone or <em>DMZ</em>). A DMZ acts as a buffer between resources within your virtual network and the internet.</p>
<ul>
<li>
<p>Use the network security group to restrict traffic flow to all machines that reside within the subnet.</p>
</li>
<li>
<p>Each subnet can have a maximum of one associated network security group.</p>
</li>
</ul>
<h5 id="network-security-groups-and-network-interfaces"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#network-security-groups-and-network-interfaces">Network security groups and network interfaces</a></h5>
<p>You can assign network security groups to a network interface card (NIC).</p>
<ul>
<li>
<p>Define network security group rules to control all traffic that flows through a NIC.</p>
</li>
<li>
<p>Each network interface that exists in a subnet can have zero, or one, associated network security groups.</p>
</li>
</ul>
<h2 id="determine-network-security-group-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#determine-network-security-group-rules">Determine network security group rules</a></h2>
<p>Security rules in network security groups enable you to filter network traffic. You can define rules to control the traffic flow in and out of virtual network subnets and network interfaces.</p>
<h4 id="things-to-know-about-security-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-security-rules">Things to know about security rules</a></h4>
<p>Let's review the characteristics of security rules in network security groups.</p>
<ul>
<li>
<p>Azure creates several default security rules within each network security group, including inbound traffic and outbound traffic. Examples of default rules include <code>DenyAllInbound</code> traffic and <code>AllowInternetOutbound</code> traffic.</p>
</li>
<li>
<p>Azure creates the default security rules in each network security group that you create.</p>
</li>
<li>
<p>You can add more security rules to a network security group by specifying conditions for any of the following settings:</p>
<ul>
<li><strong>Name</strong></li>
<li><strong>Priority</strong></li>
<li><strong>Port</strong></li>
<li><strong>Protocol</strong> (Any, TCP, UDP)</li>
<li><strong>Source</strong> (Any, IP addresses, Service tag)</li>
<li><strong>Destination</strong> (Any, IP addresses, Virtual network)</li>
<li><strong>Action</strong> (Allow or Deny)</li>
<li>Each security rule is assigned a Priority value. All security rules for a network security group are processed in priority order. When a rule has a low Priority value, the rule has a higher priority or precedence in terms of order processing.</li>
</ul>
</li>
<li>
<p>You can't remove the default security rules.</p>
</li>
<li>
<p>You can override a default security rule by creating another security rule that has a higher Priority setting for your network security group.</p>
</li>
</ul>
<h5 id="inbound-traffic-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#inbound-traffic-rules">Inbound traffic rules</a></h5>
<p>Azure defines three default inbound security rules for your network security group. These rules <strong>deny all inbound traffic</strong> except traffic from your virtual network and Azure load balancers. The following image shows the default inbound security rules for a network security group in the Azure portal.</p>
<p><img alt="Screenshot that shows default inbound security rules for a network security group in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/inbound-rules-a554314b.png" /></p>
<h5 id="outbound-traffic-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#outbound-traffic-rules">Outbound traffic rules</a></h5>
<p>Azure defines three default outbound security rules for your network security group. These rules <strong>only allow outbound traffic</strong> to the internet and your virtual network. The following image shows the default outbound security rules for a network security group in the Azure portal.</p>
<p><img alt="Screenshot that shows default outbound security rules for a network security group in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/outbound-rules-ff90d802.png" /></p>
<h2 id="determine-network-security-group-effective-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#determine-network-security-group-effective-rules">Determine network security group effective rules</a></h2>
<p>Each network security group and its defined security rules are evaluated independently. Azure processes the conditions in each rule defined for each virtual machine in your configuration.</p>
<ul>
<li>For inbound traffic, Azure first processes network security group security rules for any associated subnets and then any associated network interfaces.</li>
<li>For outbound traffic, the process is reversed. Azure first evaluates network security group security rules for any associated network interfaces followed by any associated subnets.</li>
<li>For both the inbound and outbound evaluation process, Azure also checks how to apply the rules for intra-subnet traffic.</li>
</ul>
<p>How Azure ends up applying your defined security rules for a virtual machine determines the overall <em>effectiveness</em> of your rules.</p>
<h4 id="things-to-know-about-effective-security-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-effective-security-rules">Things to know about effective security rules</a></h4>
<p>Let's explore how network security group rules are defined and processed within a virtual network to yield the effective rules.</p>
<p>Consider the following virtual network configuration that shows network security groups (NSGs) controlling traffic to virtual machines (VMs). The configuration requires security rules to manage network traffic to and from the internet over TCP port 80 via the network interface.</p>
<p><img alt="Diagram that shows how network security group security rules control traffic to virtual machines." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/security-groups-7a9d5c84.png" /></p>
<p>In this virtual network configuration, there are three subnets. Subnet 1 contains two virtual machines: VM 1 and VM 2. Subnet 2 and Subnet 3 each contain one virtual machine: VM 3 and VM 4, respectively. Each VM has a network interface card (NIC).</p>
<p>Azure evaluates each NSG configuration to determine the effective security rules:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Evaluation</th>
<th>Subnet <em>NSG</em></th>
<th>NIC <em>NSG</em></th>
<th>Inbound rules</th>
<th>Outbound rules</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>VM 1</strong></td>
<td>Subnet 1  <br><em>NSG 1</em></td>
<td>NIC  <br><em>NSG 2</em></td>
<td><em>NSG 1</em> subnet rules have precedence over <em>NSG 2</em> NIC rules</td>
<td><em>NSG 2</em> NIC rules have precedence over <em>NSG 1</em> subnet rules</td>
</tr>
<tr>
<td><strong>VM 2</strong></td>
<td>Subnet 1  <br><em>NSG 1</em></td>
<td>NIC  <br><em>none</em></td>
<td><em>NSG 1</em> subnet rules apply to both subnet and NIC</td>
<td>Azure default rules apply to NIC  <br>and <em>NSG 1</em> subnet rules apply to subnet only</td>
</tr>
<tr>
<td><strong>VM 3</strong></td>
<td>Subnet 2  <br><em>none</em></td>
<td>NIC  <br><em>NSG 2</em></td>
<td>Azure default rules apply to subnet  <br>and <em>NSG 2</em> rules apply to NIC</td>
<td><em>NSG 2</em> NIC rules apply to NIC and subnet</td>
</tr>
<tr>
<td><strong>VM 4</strong></td>
<td>Subnet 3  <br><em>none</em></td>
<td>NIC  <br><em>none</em></td>
<td>Azure default rules apply to both subnet and NIC  <br>and all inbound traffic is allowed</td>
<td>Azure default rules apply to both subnet and NIC  <br>and all outbound traffic is allowed</td>
</tr>
</tbody>
</table>
<h5 id="inbound-traffic-effective-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#inbound-traffic-effective-rules">Inbound traffic effective rules</a></h5>
<p>Azure processes rules for inbound traffic for all VMs in the configuration. Azure identifies if the VMs are members of an NSG, and if they have an associated subnet or NIC.</p>
<ul>
<li>
<p>When an NSG is created, Azure creates the default security rule <code>DenyAllInbound</code> for the group. The default behavior is to deny all inbound traffic from the internet. If an NSG has a subnet or NIC, the rules for the subnet or NIC can override the default Azure security rules.</p>
</li>
<li>
<p>NSG inbound rules for a subnet in a VM take precedence over NSG inbound rules for a NIC in the same VM.</p>
</li>
</ul>
<h5 id="outbound-traffic-effective-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#outbound-traffic-effective-rules">Outbound traffic effective rules</a></h5>
<p>Azure processes rules for outbound traffic by first examining NSG associations for NICs in all VMs.</p>
<ul>
<li>
<p>When an NSG is created, Azure creates the default security rule <code>AllowInternetOutbound</code> for the group. The default behavior is to allow all outbound traffic to the internet. If an NSG has a subnet or NIC, the rules for the subnet or NIC can override the default Azure security rules.</p>
</li>
<li>
<p>NSG outbound rules for a NIC in a VM take precedence over NSG outbound rules for a subnet in the same VM.</p>
</li>
</ul>
<h4 id="things-to-consider-when-creating-effective-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-creating-effective-rules">Things to consider when creating effective rules</a></h4>
<p>Review the following considerations regarding creating effective security rules for machines in your virtual network.</p>
<ul>
<li>
<p><strong>Consider allowing all traffic</strong>. If you place your virtual machine within a subnet or utilize a network interface, you don't have to associate the subnet or NIC with a network security group. This approach allows all network traffic through the subnet or NIC according to the default Azure security rules. If you're not concerned about controlling traffic to your resource at a specific level, then don't associate your resource at that level to a network security group.</p>
</li>
<li>
<p><strong>Consider importance of allow rules</strong>. When you create a network security group, you must define an <strong>allow</strong> rule for both the subnet and network interface in the group to ensure traffic can get through. If you have a subnet or NIC in your network security group, you must define an allow rule at each level. Otherwise, the traffic is denied for any level that doesn't provide an allow rule definition.</p>
</li>
<li>
<p><strong>Consider intra-subnet traffic</strong>. The security rules for a network security group that's associated to a subnet can affect traffic between all virtual machines in the subnet. By default, Azure allows virtual machines in the same subnet to send traffic to each other (referred to as <em>intra-subnet traffic</em>). You can prohibit intra-subnet traffic by defining a rule in the network security group to deny all inbound and outbound traffic. This rule prevents all virtual machines in your subnet from communicating with each other.</p>
</li>
<li>
<p><strong>Consider rule priority</strong>. The security rules for a network security group are processed in priority order. To ensure a particular security rule is always processed, assign the lowest possible priority value to the rule. It's a good practice to leave gaps in your priority numbering, such as 100, 200, 300, and so. The gaps in the numbering allow you to add new rules without having to edit existing rules.</p>
</li>
</ul>
<h4 id="view-effective-security-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#view-effective-security-rules">View effective security rules</a></h4>
<p>If you have several network security groups and aren't sure which security rules are being applied, you can use the <strong>Effective security rules</strong> link in the Azure portal. You can use the link to verify which security rules are applied to your machines, subnets, and network interfaces.</p>
<p><img alt="Screenshot of the Networking page in the Azure portal showing the Effective security rules link highlighted." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/effective-security-rules-d93ab464.png" /></p>
<h2 id="create-network-security-group-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-network-security-group-rules">Create network security group rules</a></h2>
<p>It's easy to add security rules to control inbound and outbound traffic in the Azure portal. You can configure your virtual network security group rule settings, and select from a large variety of communication services, including HTTPS, RDP, FTP, and DNS.</p>
<h4 id="things-to-know-about-configuring-security-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-configuring-security-rules">Things to know about configuring security rules</a></h4>
<p>Let's look at some of the properties you need to specify to create your security rules. As you review these settings, think about the traffic rules you need to create and what services can fulfill your network requirements.</p>
<p><img alt="Screenshot that shows how to configure source and destination settings to create a security rule in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/add-network-security-rule-2f306d23.png" /></p>
<ul>
<li>
<p><strong>Source</strong>: Identifies how the security rule controls <strong>inbound</strong> traffic. The value specifies a specific source IP address range that's allowed or denied. The source filter can be any resource, an IP address range, an application security group, or a default tag.</p>
</li>
<li>
<p><strong>Destination</strong>: Identifies how the security rule controls <strong>outbound</strong> traffic. The value specifies a specific destination IP address range that's allowed or denied. The destination filter value is similar to the source filter. The value can be any resource, an IP address range, an application security group, or a default tag.</p>
</li>
<li>
<p><strong>Service</strong>: Specifies the destination protocol and port range for the security rule. You can choose a predefined service like RDP or SSH or provide a custom port range. There are a large number of services to select from.</p>
<p><img alt="Screenshot that shows service rule options for a security rule in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/security-services.png" /></p>
</li>
<li>
<p><strong>Priority</strong>: Assigns the priority order value for the security rule. Rules are processed according to the priority order of all rules for a network security group, including a subnet and network interface. The lower the priority value, the higher priority for the rule.</p>
<p><img alt="Screenshot that shows how to set the priority value for a security rule in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/security-priority.png" /></p>
</li>
</ul>
<h2 id="implement-application-security-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#implement-application-security-groups">Implement application security groups</a></h2>
<p>You can implement <a href="https://learn.microsoft.com/en-us/azure/virtual-network/application-security-groups">application security groups</a> in your Azure virtual network to logically group your virtual machines by workload. You can then define your network security group rules based on your application security groups.</p>
<h4 id="things-to-know-about-using-application-security-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-using-application-security-groups">Things to know about using application security groups</a></h4>
<p>Application security groups work in the same way as network security groups, but they provide an application-centric way of looking at your infrastructure. You join your virtual machines to an application security group. Then you use the application security group as a source or destination in the network security group rules.</p>
<p>Let's examine how to implement application security groups by creating a configuration for an online retailer. In our example scenario, we need to control network traffic to virtual machines in application security groups.</p>
<p><img alt="Diagram that shows how application security groups combine with network security groups to protect applications." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/application-security-groups.png" /></p>
<h5 id="scenario-requirements"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#scenario-requirements">Scenario requirements</a></h5>
<p>Here are the scenario requirements for our example configuration:</p>
<ul>
<li>We have six virtual machines in our configuration with two web servers and two database servers.</li>
<li>Customers access the online catalog hosted on our web servers.</li>
<li>The web servers must be accessible from the internet over HTTP port 80 and HTTPS port 443.</li>
<li>Inventory information is stored on our database servers.</li>
<li>The database servers must be accessible over HTTPS port 1433.</li>
<li>Only our web servers should have access to our database servers.</li>
</ul>
<h5 id="solution"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#solution">Solution</a></h5>
<p>For our scenario, we need to build the following configuration:</p>
<ol>
<li>
<p>Create application security groups for the virtual machines.</p>
<ol>
<li>
<p>Create an application security group named <code>WebASG</code> to group our web server machines.</p>
</li>
<li>
<p>Create an application security group named <code>DBASG</code> to group our database server machines.</p>
</li>
</ol>
</li>
<li>
<p>Assign the network interfaces for the virtual machines.</p>
<ul>
<li>For each virtual machine server, assign its NIC to the appropriate application security group.</li>
<li>
<p>Create the network security group and security rules.</p>
</li>
<li>
<p><strong>Rule 1</strong>: Set <strong>Priority</strong> to 100. Allow access from the internet to machines in the <code>WebASG</code> group from HTTP port 80 and HTTPS port 443.</p>
<p>Rule 1 has the lowest priority value, so it has precedence over the other rules in the group. Customer access to our online catalog is paramount in our design.</p>
</li>
<li>
<p><strong>Rule 2</strong>: Set <strong>Priority</strong> to 110. Allow access from machines in the <code>WebASG</code> group to machines in the <code>DBASG</code> group over HTTPS port 1433.</p>
</li>
<li>
<p><strong>Rule 3</strong>: Set <strong>Priority</strong> to 120. <strong>Deny</strong> (X) access from anywhere to machines in the <code>DBASG</code> group over HTTPS port 1433.</p>
<p>The combination of Rule 2 and Rule 3 ensures that only our web servers can access our database servers. This security configuration protects our inventory databases from outside attack.</p>
</li>
</ul>
</li>
</ol>
<h4 id="things-to-consider-when-using-application-security-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-using-application-security-groups">Things to consider when using application security groups</a></h4>
<p>There are several advantages to implementing application security groups in your virtual networks.</p>
<ul>
<li>
<p><strong>Consider IP address maintenance</strong>. When you control network traffic by using application security groups, you don't need to configure inbound and outbound traffic for specific IP addresses. If you have many virtual machines in your configuration, it can be difficult to specify all of the affected IP addresses. As you maintain your configuration, the number of your servers can change. These changes can require you to modify how you support different IP addresses in your security rules.</p>
</li>
<li>
<p><strong>Consider no subnets</strong>. By organizing your virtual machines into application security groups, you don't need to also distribute your servers across specific subnets. You can arrange your servers by application and purpose to achieve logical groupings.</p>
</li>
<li>
<p><strong>Consider simplified rules</strong>. Application security groups help to eliminate the need for multiple rule sets. You don't need to create a separate rule for each virtual machine. You can dynamically apply new rules to designated application security groups. New security rules are automatically applied to all the virtual machines in the specified application security group.</p>
</li>
<li>
<p><strong>Consider workload support</strong>. A configuration that implements application security groups is easy to maintain and understand because the organization is based on workload usage. Application security groups provide logical arrangements for your applications, services, data storage, and workloads.</p>
</li>
</ul>
<h2 id="interactive-lab-simulation_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#interactive-lab-simulation_1">Interactive lab simulation</a></h2>
<h3 id="lab-scenario_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#lab-scenario_1">Lab scenario</a></h3>
<p>Your organization wants to ensure that access to virtual machines is restricted. As the Azure Administrator, you need to:</p>
<ul>
<li>Create and configure network security groups.</li>
<li>Associate network security groups to virtual machines.</li>
<li>Deny and allow access to the virtual machines by using network security groups.</li>
</ul>
<h3 id="architecture-diagram_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#architecture-diagram_1">Architecture diagram</a></h3>
<p><img alt="Diagram showing the architecture as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/architecture-create-networks.png" /></p>
<h3 id="objectives_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#objectives_1">Objectives</a></h3>
<ul>
<li><strong>Task 1</strong>: Create a virtual machine to test network security.<ul>
<li>Create a Windows Server virtual machine.</li>
<li>Don't configure any inbound port rules or NIC network security groups.</li>
<li>Verify the virtual machine is created.</li>
<li>Review the <strong>Inbound port rules</strong> tab, and note there are no network security groups associated with the virtual machine.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Create a network security group, and associate the group with the virtual machine.<ul>
<li>Create a network security group.</li>
<li>Associate the network security group with the virtual machine network interface (NIC).</li>
</ul>
</li>
<li><strong>Task 3</strong>: Configure an inbound security port rule to allow RDP.<ul>
<li>Verify you can't connect to the virtual machine by using RDP.</li>
<li>Add an <strong>inbound port rule</strong> to allow RDP to the virtual machine on port 3389.</li>
<li>Verify you can now connect to the virtual machine with RDP.</li>
</ul>
</li>
<li><strong>Task 4</strong>: Configure an outbound security port rule to deny internet access<ul>
<li>Verify you can access the internet from the virtual machine.</li>
<li>Add an <strong>outbound port rule</strong> to deny internet access from the virtual machine.</li>
<li>Verify you can no longer access the internet from the virtual machine.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Select the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%2013"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-security-groups/media/simulation-create-networks.png" /></a></p>
<hr />
<h2 id="configure-azure-virtual-network-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-azure-virtual-network-peering">Configure Azure Virtual Network peering</a></h2>
<h2 id="introduction_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction_2">Introduction</a></h2>
<p>Azure Virtual Network peering lets you connect virtual networks in the same or different regions. Azure Virtual Network peering provides secure communication between resources in the peered networks.</p>
<p>Suppose your engineering company is migrating services to Azure. The company is deploying services into separate Azure virtual networks. Private connectivity between the virtual networks isn't yet configured. Several business units identified services in the virtual networks that need to communicate with each other.</p>
<p>You're responsible for implementing an Azure Virtual Network peering solution and enabling connectivity between the virtual networks. Two of your strategy goals include preventing exposure of the services to the internet, and keeping the integration as simple as possible. Your solution should address transit and connectivity concerns.</p>
<p>The goal of this module is to successfully implement Azure Virtual Network peering.</p>
<h3 id="learning-objectives_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learning-objectives_1">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify usage cases and product features of Azure Virtual Network peering.</li>
<li>Configure your network to implement Azure VPN Gateway for transit connectivity.</li>
<li>Extend peering by using a hub and spoke network with user-defined routes and service chaining.</li>
</ul>
<h3 id="skills-measured_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#skills-measured_1">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#prerequisites_1">Prerequisites</a></h3>
<ul>
<li>
<p>Basic understanding of cloud networking including virtual networks and virtual machines.</p>
</li>
<li>
<p>Familiarity with the command line connectivity testing tools.</p>
</li>
</ul>
<h2 id="determine-azure-virtual-network-peering-uses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#determine-azure-virtual-network-peering-uses">Determine Azure Virtual Network peering uses</a></h2>
<p>Perhaps the simplest and quickest way to connect your virtual networks is to use Azure Virtual Network peering. Virtual Network peering enables you to seamlessly connect two Azure virtual networks. After the networks are peered, the two virtual networks operate as a single network, for connectivity purposes.</p>
<h4 id="things-to-know-about-azure-virtual-network-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-azure-virtual-network-peering">Things to know about Azure Virtual Network peering</a></h4>
<p>Let's examine some prominent characteristics of Azure Virtual Network peering.</p>
<ul>
<li>
<p>There are two types of Azure Virtual Network peering: <em>regional</em> and <em>global</em>.</p>
<p><img alt="Diagram that demonstrates the two types of Azure Virtual Network peering: global and regional." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-vnet-peering/media/network-peering-5beae28a.png" /></p>
</li>
<li>
<p><strong>Regional virtual network peering</strong> connects Azure virtual networks that exist in the same region.</p>
</li>
<li>
<p><strong>Global virtual network peering</strong> connects Azure virtual networks that exist in different regions.</p>
</li>
<li>
<p>You can create a regional peering of virtual networks in the same Azure public cloud region, or in the same China cloud region, or in the same Microsoft Azure Government cloud region.</p>
</li>
<li>
<p>You can create a global peering of virtual networks in any Azure public cloud region, or in any China cloud region.</p>
</li>
<li>
<p>Global peering of virtual networks in different Azure Government cloud regions isn't permitted.</p>
</li>
<li>
<p>After you create a peering between virtual networks, the individual virtual networks are still managed as separate resources.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-azure-virtual-network-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-using-azure-virtual-network-peering">Things to consider when using Azure Virtual Network peering</a></h4>
<p>Consider the following benefits of using Azure Virtual Network peering.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Benefit</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Private network connections</strong></td>
<td>When you implement Azure Virtual Network peering, network traffic between peered virtual networks is private. Traffic between the virtual networks is kept on the Microsoft Azure backbone network. No public internet, gateways, or encryption is required in the communication between the virtual networks.</td>
</tr>
<tr>
<td><strong>Strong performance</strong></td>
<td>Because Azure Virtual Network peering utilizes the Azure infrastructure, you gain a low-latency, high-bandwidth connection between resources in different virtual networks.</td>
</tr>
<tr>
<td><strong>Simplified communication</strong></td>
<td>Azure Virtual Network peering lets resources in one virtual network communicate with resources in a different virtual network, after the virtual networks are peered.</td>
</tr>
<tr>
<td><strong>Seamless data transfer</strong></td>
<td>You can create an Azure Virtual Network peering configuration to transfer data across Azure subscriptions, deployment models, and across Azure regions.</td>
</tr>
<tr>
<td><strong>No resource disruptions</strong></td>
<td>Azure Virtual Network peering doesn't require downtime for resources in either virtual network when creating the peering, or after the peering is created.</td>
</tr>
</tbody>
</table>
<h2 id="determine-gateway-transit-and-connectivity"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#determine-gateway-transit-and-connectivity">Determine gateway transit and connectivity</a></h2>
<p>When virtual networks are peered, you can configure Azure VPN Gateway in the peered virtual network as a <em>transit point</em>. In this scenario, a peered virtual network uses the remote VPN gateway to gain access to other resources.</p>
<p>Consider a scenario where three virtual networks in the same region are connected by virtual network peering. Virtual network A and virtual network B are each peered with a hub virtual network. The hub virtual network contains several resources, including a gateway subnet and an Azure VPN gateway. The VPN gateway is configured to allow VPN gateway transit. Virtual network B accesses resources in the hub, including the gateway subnet, by using a remote VPN gateway.</p>
<p><img alt="Diagram of a regional virtual network peering. One network allows VPN gateway transit and uses a remote VPN gateway to access resources in a hub virtual network." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-vnet-peering/media/gateway-transit-173a51a0.png" /></p>
<h4 id="things-to-know-about-azure-vpn-gateway"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-azure-vpn-gateway">Things to know about Azure VPN Gateway</a></h4>
<p>Let's take a closer look at how Azure VPN Gateway is implemented with Azure Virtual Network peering.</p>
<ul>
<li>
<p>A virtual network can have only one VPN gateway.</p>
</li>
<li>
<p>Gateway transit is supported for both regional and global virtual network peering.</p>
</li>
<li>
<p>When you allow VPN gateway transit, the virtual network can communicate to resources outside the peering. In our sample illustration, the gateway subnet gateway within the hub virtual network can complete tasks such as:</p>
<ul>
<li>Use a site-to-site VPN to connect to an on-premises network.</li>
<li>Use a vnet-to-vnet connection to another virtual network.</li>
<li>Use a point-to-site VPN to connect to a client.</li>
<li>Gateway transit allows peered virtual networks to share the gateway and get access to resources. With this implementation, you don't need to deploy a VPN gateway in the peer virtual network.</li>
</ul>
</li>
<li>
<p>You can apply network security groups in a virtual network to block or allow access to other virtual networks or subnets. When you configure virtual network peering, you can choose to open or close the network security group rules between the virtual networks.</p>
</li>
</ul>
<h2 id="create-virtual-network-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-virtual-network-peering">Create virtual network peering</a></h2>
<p>Azure Virtual Network peering can be configured for virtual networks by using PowerShell, the Azure CLI, and in the Azure portal. In this module, we review the steps to create the peering in the Azure portal for virtual networks deployed through Azure Resource Manager.</p>
<h4 id="things-to-know-about-creating-virtual-network-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-creating-virtual-network-peering">Things to know about creating virtual network peering</a></h4>
<p>There are a few points to review before we look at how to create the peering in the Azure portal.</p>
<ul>
<li>
<p>To implement virtual network peering, your Azure account must be assigned to the <code>Network Contributor</code> or <code>Classic Network Contributor</code> role. Alternatively, your Azure account can be assigned to a custom role that can complete the necessary peering actions. For details, see <a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-manage-peering?tabs=peering-portal#permissions">Permissions</a>.</p>
</li>
<li>
<p>To create a peering, you need two virtual networks.</p>
</li>
<li>
<p>The second virtual network in the peering is referred to as the <em>remote network</em>.</p>
</li>
<li>
<p>Initially, the virtual machines in your virtual networks can't communicate with each other. After the peering is established, the machines can communicate within the peered network based on your configuration settings.</p>
</li>
</ul>
<p><img alt="" src="https://youtu.be/pSqDlQlcsLo" /></p>
<h3 id="how-to-connect-virtual-networks-across-azure-regions-with-azure-global-vnet-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#how-to-connect-virtual-networks-across-azure-regions-with-azure-global-vnet-peering">How to connect virtual networks across Azure regions with Azure Global VNet peering</a></h3>
<h3 id="how-to-check-your-peering-status"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#how-to-check-your-peering-status">How to check your peering status</a></h3>
<p>In the Azure portal, you can check the connectivity status of the virtual networks in your virtual network peering. The status conditions depend on how your virtual networks are deployed.</p>
<p>Important</p>
<p>Your peering isn't successfully established until both virtual networks in the peering have a status of <strong>Connected</strong>.</p>
<ul>
<li>
<p>For deployment with the Azure Resource Manager, the two primary status conditions are <strong>Initiated</strong> and <strong>Connected</strong>. For the classic deployment model, the <strong>Updating</strong> status condition is also used.</p>
</li>
<li>
<p>When you create the initial peering <em>to</em> the second (remote) virtual network from the first virtual network, the peering status for the first virtual network is <strong>Initiated</strong>.</p>
</li>
<li>
<p>When you create the subsequent peering <em>from</em> the second virtual network to the first virtual network, the peering status for both the first and remote virtual networks is <strong>Connected</strong>. In the Azure portal, you can see the status for the first virtual network change from <strong>Initiated</strong> to <strong>Connected</strong>.</p>
</li>
</ul>
<h2 id="extend-peering-with-user-defined-routes-and-service-chaining"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#extend-peering-with-user-defined-routes-and-service-chaining">Extend peering with user-defined routes and service chaining</a></h2>
<p>Virtual network peering is nontransitive. The communication capabilities in a peering are available to only the virtual networks and resources in the peering. Other mechanisms have to be used to enable traffic to and from resources and networks outside the private peering network.</p>
<p>Suppose you have three virtual networks: A, B, and C. You establish virtual network peering between networks A and B, and also between networks B and C. You don't set up peering between networks A and C. The virtual network peering capabilities that you set up between networks B and C don't automatically enable peering communication capabilities between networks A and C.</p>
<h4 id="things-to-know-about-extending-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-extending-peering">Things to know about extending peering</a></h4>
<p>There are a few ways to extend the capabilities of your peering for resources and virtual networks outside your peering network:</p>
<ul>
<li>Hub and spoke networks</li>
<li>User-defined routes</li>
<li>Service chaining</li>
</ul>
<p>You can implement these mechanisms and create a multi-level hub and spoke architecture. These options can help overcome the limit on the number of virtual network peerings per virtual network.</p>
<p>The following diagram shows a hub and spoke virtual network with an NVA and VPN gateway. The hub and spoke network is accessible to other virtual networks via user-defined routes and service chaining.</p>
<p><img alt="Diagram that shows a hub virtual network with an NVA and VPN gateway that are accessible to other virtual networks." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-vnet-peering/media/service-chains-5c9286d1.png" /></p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Mechanism</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Hub and spoke network</strong></td>
<td>When you deploy a hub-and-spoke network, the hub virtual network can host infrastructure components like a network virtual appliance (NVA) or Azure VPN gateway. All the spoke virtual networks can then peer with the hub virtual network. Traffic can flow through NVAs or VPN gateways in the hub virtual network.</td>
</tr>
<tr>
<td><strong>User-defined route (UDR)</strong></td>
<td>Virtual network peering enables the next hop in a user-defined route to be the IP address of a virtual machine in the peered virtual network, or a VPN gateway.</td>
</tr>
<tr>
<td><strong>Service chaining</strong></td>
<td>Service chaining is used to direct traffic from one virtual network to a virtual appliance or gateway. A user-defined route defines the peered networks.</td>
</tr>
</tbody>
</table>
<h2 id="interactive-lab-simulation_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#interactive-lab-simulation_2">Interactive lab simulation</a></h2>
<h3 id="lab-scenario_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#lab-scenario_2">Lab scenario</a></h3>
<p>Your organization has three datacenters connected with a mesh wide-area network. As the Azure Administrator, you need to implement the on-premises infrastructure in Azure.</p>
<ul>
<li>There are two offices, New York and Boston, in one region.</li>
<li>There's one office, Seattle, in another region.</li>
<li>All the offices need to be networked together so they can share information.</li>
<li>This simulation focuses on the connectivity of the offices, and not creating the individual Azure resources.</li>
</ul>
<h3 id="architecture-diagram_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#architecture-diagram_2">Architecture diagram</a></h3>
<p><img alt="Architecture diagram as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-vnet-peering/media/lab-05.png" /></p>
<h3 id="objectives_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#objectives_2">Objectives</a></h3>
<p>Note</p>
<p>You may find slight differences between the interactive simulation and the Azure environment, but the core concepts and ideas being demonstrated are the same.</p>
<ul>
<li><strong>Task 1</strong>: Create the infrastructure environment. In this task, you deploy three virtual machines. Virtual machines are deployed in different regions and virtual networks.<ul>
<li>Use a template to create the virtual networks and virtual machines in the different regions. You can review the <a href="https://github.com/MicrosoftLearning/AZ-104-MicrosoftAzureAdministrator/tree/master/Allfiles/Interactive%20Lab%20Simulation%20Files/05">lab templates</a>.</li>
<li>Use Azure PowerShell to deploy the template.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Configure local and global virtual network peering.<ul>
<li>Create a local virtual network peering between the two virtual networks in the same region.</li>
<li>Create a global virtual network peering between virtual networks in different regions.</li>
</ul>
</li>
<li><strong>Task 3</strong>: Test intersite connectivity between virtual machines on the three virtual networks.<ul>
<li>Test the virtual machine connections in the same region.</li>
<li>Test the virtual machine connections in different regions.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>select the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%209"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-vnet-peering/media/simulation-intersite-thumbnail.jpg" /></a></p>
<h2 id="summary-and-resources_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#summary-and-resources_1">Summary and resources</a></h2>
<p>In this module, you learned Azure Virtual Network peering lets you connect virtual networks in a hub and spoke topology. You learned how to configure your virtual networks with Azure VPN Gateway for transit connectivity. You explored how to extend peering with user-defined routes and service chaining.</p>
<p>The main takeaways from this module are:</p>
<ul>
<li>
<p>Azure Virtual Network peering allows for the connection of virtual networks in a hub and spoke topology.</p>
</li>
<li>
<p>There are two types of peering: regional and global. Regional peering connects virtual networks in the same region. Global peering connects virtual networks in different regions.</p>
</li>
<li>
<p>Network traffic between peered virtual networks is private and kept on the Azure backbone network.</p>
</li>
<li>
<p>You can configure Azure VPN Gateway in the peered virtual network as a transit point to access resources in another network.</p>
</li>
<li>
<p>Network security groups can be applied to block or allow access between virtual networks when configuring virtual network peering.</p>
</li>
</ul>
<hr />
<h2 id="configure-network-routing-and-endpoints"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-network-routing-and-endpoints">Configure network routing and endpoints</a></h2>
<h2 id="introduction_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction_3">Introduction</a></h2>
<p>Administrators use network routes to control the flow of traffic through a network. Azure virtual networking provides capabilities to help you customize your network routes, establish service endpoints, and access private links.</p>
<p>In this module, suppose your company recently suffered a security incident that exposed customer personal information. This security incident has resulted in the loss of customers' confidential data and confidence. To address this scenario, the IT team has recommended implementing network virtual appliances (NVAs). You need to ensure traffic is properly routed through the virtual appliances. You're exploring other security options like service endpoints and private links.</p>
<h3 id="learning-objectives_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learning-objectives_2">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Implement system routes and user-defined routes.</li>
<li>Configure a custom route.</li>
<li>Implement service endpoints.</li>
<li>Identify features and usage cases for Azure Private Link and endpoint services.</li>
</ul>
<h3 id="skills-measured_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#skills-measured_2">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>. The module concepts are covered in:</p>
<p>Configure and manage virtual networking (25–30%)</p>
<ul>
<li>Implement and manage virtual networking.<ul>
<li>Configure user-defined network routes.</li>
<li>Configure endpoints on subnets.</li>
<li>Configure private endpoints.</li>
</ul>
</li>
</ul>
<h3 id="prerequisites_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#prerequisites_2">Prerequisites</a></h3>
<ul>
<li>Familiarity with network routing.</li>
</ul>
<h2 id="review-system-routes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#review-system-routes">Review system routes</a></h2>
<p>Azure uses <em>system routes</em> to direct network traffic between virtual machines, on-premises networks, and the internet. Information about the system routes is recorded in a <em>route table</em>.</p>
<h4 id="things-to-know-about-system-routes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-system-routes">Things to know about system routes</a></h4>
<p>Let's take a closer look at how Azure implements system routes.</p>
<ul>
<li>
<p>Azure uses system routes to control traffic for virtual machines in several scenarios:</p>
<ul>
<li>Traffic between virtual machines in the same subnet</li>
<li>Traffic between virtual machines in different subnets in the same virtual network</li>
<li>Traffic from virtual machines to the internet</li>
<li>A route table contains a set of rules (called <em>routes</em>) that specifies how packets should be routed in a virtual network.</li>
</ul>
</li>
<li>
<p>Route tables record information about the system routes, where the tables are associated to subnets.</p>
</li>
<li>
<p>Each packet leaving a subnet is handled based on the associated route table.</p>
</li>
<li>
<p>Packets are matched to routes by using the destination. The destination can be an IP address, a virtual network gateway, a virtual appliance, or the internet.</p>
</li>
<li>
<p>When a matching route can't be found, the packet is dropped.</p>
</li>
</ul>
<h5 id="business-scenario"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#business-scenario">Business scenario</a></h5>
<p>Suppose you have a virtual network with two subnets. In this configuration, you can use Azure system routes to control communication between the subnets and between subnets and the internet. A front-end subnet can use a system route to access the internet. A back-end subnet can use a system route to access the front-end subnet. Both subnets access a route table. The following illustration highlights this scenario:</p>
<p><img alt="Diagram that shows two subnets that use system routes as described in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-routing-endpoints/media/system-routes-08992506.png" /></p>
<h2 id="identify-user-defined-routes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#identify-user-defined-routes">Identify user-defined routes</a></h2>
<p>Azure automatically handles all network traffic routing, but in some cases, a custom configuration is preferable. In these situations, you can configure <em>user-defined routes</em> (UDRs) and <em>next hop</em> targets.</p>
<h4 id="things-to-know-about-user-defined-routes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-user-defined-routes">Things to know about user-defined routes</a></h4>
<p>Let's examine the characteristics of user-defined routes.</p>
<ul>
<li>
<p>UDRs control network traffic by defining routes that specify the <em>next hop</em> of the traffic flow.</p>
</li>
<li>
<p>The next hop can be one of the following targets:</p>
<ul>
<li>Virtual network gateway</li>
<li>Virtual network</li>
<li>Internet</li>
<li>Network virtual appliance (NVA)</li>
<li>Similar to system routes, UDRs also access route tables.</li>
</ul>
</li>
<li>
<p>Each route table can be associated to multiple subnets.</p>
</li>
<li>
<p>Each subnet can be associated to one route table only.</p>
</li>
<li>
<p>There are no charges for creating route tables in Microsoft Azure.</p>
</li>
</ul>
<h5 id="business-scenario_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#business-scenario_1">Business scenario</a></h5>
<p>Suppose you have a virtual machine that performs a network function like routing, firewalling, or WAN optimization. You want to direct certain subnet traffic to the NVA. To accomplish this configuration, you can place an NVA between subnets or between one subnet and the internet. The subnet can use a UDR to access the NVA and then the internet. The subnet can use another UDR and NVA to access the back-end subnet. The following illustration highlights this scenario:</p>
<p><img alt="Diagram that shows two subnets that use a UDR to access an NVA as described in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-routing-endpoints/media/user-defined-routes-2417e693.png" /></p>
<h2 id="determine-service-endpoint-uses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#determine-service-endpoint-uses">Determine service endpoint uses</a></h2>
<p>A virtual network <em>service endpoint</em> provides the identity of your virtual network to the Azure service. After service endpoints are enabled in your virtual network, you can secure Azure service resources to your virtual network by adding a <em>virtual network rule</em> to the resources.</p>
<p>Today, Azure service traffic from a virtual network uses public IP addresses as source IP addresses. With service endpoints, service traffic switches to use virtual network private addresses as the source IP addresses when accessing the Azure service from a virtual network. This switch allows you to access the services without the need for reserved public IP addresses that are typically used in IP firewalls.</p>
<h4 id="things-to-know-about-service-endpoints"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-service-endpoints">Things to know about service endpoints</a></h4>
<p>Review the following characteristics of service endpoints.</p>
<ul>
<li>
<p>Service endpoints can extend your virtual network identity to your Azure services to secure your service resources.</p>
</li>
<li>
<p>You secure your Azure service resources to your virtual network by using virtual network rules.</p>
</li>
<li>
<p>Virtual network rules can remove public internet access to resources, and allow traffic only from your virtual network.</p>
</li>
<li>
<p>Service endpoints always take service traffic directly from your virtual network to the service on the Microsoft Azure backbone network.</p>
</li>
<li>
<p>Service endpoints are configured through the subnet. No extra overhead is required to maintain the endpoints.</p>
</li>
</ul>
<p>The following illustration shows a virtual machine connecting to the Azure service through a service endpoint. A virtual machine in a subnet accesses an Azure Storage account through a service endpoint. Virtual network rules allow the virtual machine to access the Azure service resource, but not communicate with the internet.</p>
<p><img alt="Diagram of a virtual machine in a subnet connecting to an Azure service through a service endpoint." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-routing-endpoints/media/service-endpoint-addresses-a027197f.png" /></p>
<h4 id="things-to-consider-when-using-service-endpoints"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-using-service-endpoints">Things to consider when using service endpoints</a></h4>
<p>There are several scenarios where using service endpoints can be advantageous. Review the following points and think about how you can implement service endpoints in your configuration.</p>
<ul>
<li>
<p><strong>Consider improved security for resources</strong>. Implement service endpoints to improve the security of your Azure service resources. When service endpoints are enabled in your virtual network, you secure Azure service resources to your virtual network with virtual network rules. The rule improves security by fully removing public internet access to resources, and allowing traffic only from your virtual network.</p>
</li>
<li>
<p><strong>Consider optimal routing for service traffic</strong>. Routes in your virtual network that force internet traffic to your on-premises or network virtual appliances also typically force Azure service traffic to take the same route as the internet traffic. This traffic control process is known as <em>forced-tunneling</em>. Service endpoints provide optimal routing for Azure service traffic to allow you to circumvent forced tunneling.</p>
</li>
<li>
<p><strong>Consider direct traffic to the Microsoft network</strong>. Use service endpoints to keep traffic on the Azure backbone network. This approach allows you to continue auditing and monitoring outbound internet traffic from your virtual networks, through forced-tunneling, without impacting service traffic. Learn more about <a href="https://learn.microsoft.com/en-us/azure/firewall/forced-tunneling">user-defined routes and forced-tunneling</a>.</p>
</li>
<li>
<p><strong>Consider easy configuration and maintenance</strong>. Configure service endpoints in your subnets for simple setup and low maintenance. You no longer need reserved public IP addresses in your virtual networks to secure Azure resources through an IP firewall. There are no NAT or gateway devices required to set up the service endpoints.</p>
</li>
</ul>
<blockquote>
<p>Note</p>
<p>With service endpoints, the virtual machine IP addresses switch from public to private IPv4 addresses. Existing Azure service firewall rules that use Azure public IP addresses stop working after the switch. Ensure Azure service firewall rules allow for this switch before you set up service endpoints. You might also experience temporary interruption to service traffic from this subnet while configuring service endpoints.</p>
</blockquote>
<h2 id="determine-service-endpoint-services"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#determine-service-endpoint-services">Determine service endpoint services</a></h2>
<p>It's easy to add a service endpoint to the virtual network. In the Azure portal, you select the Azure service for which to create the endpoint. In this unit, we examine several services, including Azure Cosmos DB, Event Hubs, Key Vault, and SQL Database.</p>
<p><img alt="Screenshot of the Service endpoints page in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-routing-endpoints/media/add-service-endpoints-5df9ecfc.png" /></p>
<p>Note</p>
<p>Adding service endpoints can take up to 15 minutes to complete. Each service endpoint integration has its own Azure documentation page.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Availability</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Azure Storage</strong></td>
<td>Generally available in all Azure regions</td>
<td>This endpoint gives traffic an optimal route to the Azure Storage service. Each Storage account supports up to 100 virtual network rules.</td>
</tr>
<tr>
<td><strong>Azure SQL Database and Azure SQL Data Warehouse</strong></td>
<td>Generally available in all Azure regions</td>
<td>A firewall security feature controls whether your database accepts communication from particular subnets in virtual networks. This feature applies to the database server for your single databases and elastic pool in SQL Database or your databases in SQL Data Warehouse.</td>
</tr>
<tr>
<td><strong>Azure Database for PostgreSQL and Azure Database for MySQL</strong></td>
<td>Generally available in Azure regions where database service is available</td>
<td>Virtual network service endpoints and rules extend the private address space of a virtual network to your Azure Database for PostgreSQL server and Azure Database for MySQL server.</td>
</tr>
<tr>
<td><strong>Azure Cosmos DB</strong></td>
<td>Generally available in all Azure regions</td>
<td>You can configure the Azure Cosmos DB account to allow access only from a specific subnet of virtual network. Enable service endpoints to access Azure Cosmos DB on the subnet within a virtual network. Traffic from the subnet is sent to Azure Cosmos DB with the identity of the subnet and virtual network. After the Azure Cosmos DB service endpoint is enabled, you can limit access to the subnet by adding it to your Azure Cosmos DB account.</td>
</tr>
<tr>
<td><strong>Azure Key Vault</strong></td>
<td>Generally available in all Azure regions</td>
<td>The virtual network service endpoints for Key Vault allow you to restrict access to a specified virtual network. The endpoints also allow you to restrict access to a list of IPv4 (internet protocol version 4) address ranges. Any user connecting to your key vault from outside those sources is denied access.</td>
</tr>
<tr>
<td><strong>Azure Service Bus and Azure Event Hubs</strong></td>
<td>Generally available in all Azure regions</td>
<td>The integration of Service Bus with virtual network service endpoints enables secure access to messaging capabilities from workloads like virtual machines that are bound to virtual networks. The network traffic path is secured on both ends.</td>
</tr>
</tbody>
</table>
<h2 id="identify-private-link-uses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#identify-private-link-uses">Identify private link uses</a></h2>
<p>Azure Private Link provides private connectivity from a virtual network to Azure platform as a service (PaaS), customer-owned, or Microsoft partner services. It simplifies the network architecture and secures the connection between endpoints in Azure by eliminating data exposure to the public internet.</p>
<h4 id="things-to-know-about-azure-private-link"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-azure-private-link">Things to know about Azure Private Link</a></h4>
<p>Let's examine the characteristics of Azure Private Link and network routing configurations.</p>
<ul>
<li>
<p>Azure Private Link keeps all traffic on the Microsoft global network. There's no public internet access.</p>
</li>
<li>
<p>Private Link is global and there are no regional restrictions. You can connect privately to services running in other Azure regions.</p>
</li>
<li>
<p>Services delivered on Azure can be brought into your private virtual network by mapping your network to a private endpoint.</p>
</li>
<li>
<p>Private Link can privately deliver your own services in your customer's virtual networks.</p>
</li>
<li>
<p>All traffic to the service can be routed through the private endpoint. No gateways, NAT devices, Azure ExpressRoute or VPN connections, or public IP addresses are required.</p>
</li>
</ul>
<p>The following Illustration demonstrates a network routing configuration with Azure Private Link. The service connects to a network security group (NSG) private endpoint by using Azure SQL Database. This configuration prevents a direct connection.</p>
<p><img alt="Diagram that shows a network routing configuration with Azure Private Link as described in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-routing-endpoints/media/private-links-602b4a62.png" /></p>
<h4 id="things-to-consider-when-using-azure-private-link"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-using-azure-private-link">Things to consider when using Azure Private Link</a></h4>
<p>There are many benefits to working with Azure Private Link. Review the following points and consider how you can implement the service for your scenarios.</p>
<ul>
<li>
<p><strong>Consider private connectivity to services on Azure</strong>. Connect privately to services running in other Azure regions. Traffic remains on the Microsoft network with no public internet access.</p>
</li>
<li>
<p><strong>Consider integration with on-premises and peered networks</strong>. Access private endpoints over private peering or VPN tunnels from on-premises or peered virtual networks. Microsoft hosts the traffic, so you don't need to set up public peering or use the internet to migrate your workloads to the cloud.</p>
</li>
<li>
<p><strong>Consider protection against data exfiltration for Azure resources</strong>. Map private endpoints to Azure PaaS resources. When there's a security incident within your network, only the mapped resources are accessible. This implementation eliminates the threat of data exfiltration.</p>
</li>
<li>
<p><strong>Consider services delivered directly to customer virtual networks</strong>. Privately consume Azure PaaS, Microsoft partner, and your own services in your virtual networks on Azure. Private Link works across tenants to help unify your experience across services. Send, approve, or reject requests directly without permissions or role-based access controls.</p>
</li>
</ul>
<h2 id="interactive-lab-simulation_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#interactive-lab-simulation_3">Interactive lab simulation</a></h2>
<h3 id="lab-scenario_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#lab-scenario_3">Lab scenario</a></h3>
<p>Your organization is exploring Azure virtual networking capabilities. As the Azure Administrator you've been tasked to implement the following requirements:</p>
<ul>
<li>Create and configure a virtual network in Azure.</li>
<li>Deploy two virtual machines into different subnets of the virtual network.</li>
<li>Ensure the virtual machines have public IP addresses that won't change over time.</li>
<li>Protect the virtual machine public endpoints from being accessible from the internet.</li>
<li>Ensure internal Azure virtual machines names and IP addresses can be resolved.</li>
<li>Ensure a publicly available domain name can be resolved by external queries.</li>
</ul>
<h3 id="architecture-diagram_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#architecture-diagram_3">Architecture diagram</a></h3>
<p><img alt="Architecture diagram as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-routing-endpoints/media/lab-04.png" /></p>
<p>Note</p>
<p>Tasks 1 - 4 focus on IP addresses and access.</p>
<h3 id="objectives_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#objectives_3">Objectives</a></h3>
<p>Note</p>
<p>You may find slight differences between the interactive simulation and the Azure environment, but the core concepts and ideas being demonstrated are the same.</p>
<ul>
<li><strong>Task 1</strong>: Create and configure a virtual network in Azure.<ul>
<li>Create a virtual network, <strong>az104-04-vnet1</strong>.</li>
<li>Add two subnets, <strong>Subnet0</strong> and <strong>Subnet1</strong>, to the virtual network.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Deploy virtual machines into different subnets of the virtual network.<ul>
<li>Review a JSON template that will deploy two virtual machines, <strong>VM0</strong> and <strong>VM1</strong>.</li>
<li>Use Azure PowerShell to deploy the template.</li>
</ul>
</li>
<li><strong>Task 3</strong>: Configure private and public IP addresses of Azure virtual machines. Ensure the IP addresses don't change over time.<ul>
<li>Associate the VM0 NIC with a static public IP address, <strong>az104-04-pip0</strong>.</li>
<li>Associate the VM1 NIC with a static public IP address, <strong>az104-04-pip1</strong>.</li>
</ul>
</li>
<li><strong>Task 4</strong>: Configure network security groups. Protect the virtual machine public endpoints from being accessible from the internet.<ul>
<li>Verify you can't use RDP to connect to a virtual machine.</li>
<li>Create a network security group.</li>
<li>Configure inbound security rules to allow RDP.</li>
<li>Associate the network security group with the virtual machine NICs.</li>
<li>Confirm that you can now use RDP to connect to a virtual machine.</li>
</ul>
</li>
<li><strong>Task 5</strong>: Configure Azure DNS for internal name resolution. Ensure internal Azure virtual machines names and IP addresses can be resolved.<ul>
<li>Create a private DNS zone for your organization.</li>
<li>Add a virtual network link to the virtual network.</li>
<li>Verify the virtual machines DNS records are registered.</li>
<li>Verify internal DNS name resolution is working.</li>
</ul>
</li>
<li><strong>Task 6</strong>: Configure Azure DNS for external name resolution. Ensure a publicly available domain name can be resolved by external queries.<ul>
<li>Create a DNS zone for a publicly available domain name.</li>
<li>Add a DNS record for each virtual machine.</li>
<li>Verify external DNS name resolution is working.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Select the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%208"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-routing-endpoints/media/simulation-networks-thumbnail.jpg" /></a></p>
<h2 id="summary-and-resources_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#summary-and-resources_2">Summary and resources</a></h2>
<p>Network routes control the flow of traffic through your network. You can customize these routes, implement service endpoints, and work with private links.</p>
<p>In this module, you learned how to implement system routes and user-defined routes. You identified features and usage cases for Azure Private Link and endpoint services. You explored how to configure a custom route, and discovered how to work with service endpoints.</p>
<h3 id="learn-more"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more">Learn more</a></h3>
<ul>
<li>
<p>Peruse <a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview">virtual network traffic routing documentation</a>.</p>
</li>
<li>
<p>Read about <a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview">Virtual network traffic routing</a>.</p>
</li>
<li>
<p>Route <a href="https://learn.microsoft.com/en-us/azure/virtual-network/tutorial-create-route-table-portal">network traffic with a route table by using the Azure portal</a>.</p>
</li>
<li>
<p>Configure <a href="https://learn.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-bgp-resource-manager-ps">BGP for Azure VPN Gateway by using PowerShell</a>.</p>
</li>
<li>
<p>Create <a href="https://learn.microsoft.com/en-us/azure/virtual-network/manage-route-table#create-a-route">custom routes</a>.</p>
</li>
<li>
<p>View <a href="https://learn.microsoft.com/en-us/azure/virtual-network/diagnose-network-routing-problem">all routes for a subnet and diagnose virtual machine routing problems</a>.</p>
</li>
<li>
<p>Determine <a href="https://learn.microsoft.com/en-us/azure/network-watcher/diagnose-vm-network-routing-problem#use-next-hop">the next hop type between a virtual machine and a destination IP address</a>.</p>
</li>
<li>
<p>Explore <a href="https://learn.microsoft.com/en-us/azure/firewall/forced-tunneling">user-defined routes and forced-tunneling in Azure Firewall</a>.</p>
</li>
</ul>
<h3 id="learn-more-with-self-paced-training_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more-with-self-paced-training_1">Learn more with self-paced training</a></h3>
<ul>
<li>Complete an <a href="https://learn.microsoft.com/en-us/training/modules/introduction-azure-private-link/">introduction to Azure Private Link</a>.</li>
</ul>
<h3 id="learn-more-with-optional-hands-on-exercises"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more-with-optional-hands-on-exercises">Learn more with optional hands-on exercises</a></h3>
<ul>
<li>Manage and control <a href="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/">traffic flow in your Azure deployment with routes (sandbox)</a>.</li>
</ul>
<hr />
<h2 id="configure-azure-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-azure-load-balancer">Configure Azure Load Balancer</a></h2>
<h2 id="introduction_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction_4">Introduction</a></h2>
<p>Many applications need to be resilient to failure and scale easily when demand increases. Administrators can address these requirements by using Azure Load Balancer.</p>
<p>Suppose your healthcare organization is launching a new portal application for patients to schedule appointments. The application has a patient portal, web application frontend, and business tier database. The database is used by the frontend to retrieve and save patient information.</p>
<p>The new portal needs to be available around the clock to handle failures. The portal must adjust to fluctuations in load by adding and removing resources to match the load. You need a solution to distribute work to virtual machines across the system as virtual machines are added. The solution should detect failures and reroute jobs to virtual machines as needed. Improved resiliency and scalability are required to help ensure patients can schedule appointments from any location.</p>
<p>You're responsible for configuring the load balancers to distribute incoming network traffic across a group of back-end servers. You need to scale your applications while maintaining throughput and keeping response times low.</p>
<p>The goal of this module is to equip you to implement an Azure load balancer.</p>
<h3 id="learning-objectives_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learning-objectives_3">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify features and usage cases for Azure Load Balancer.</li>
<li>Implement public and internal Azure load balancers.</li>
<li>Compare features of load balancer SKUs and configuration differences.</li>
<li>Configure back-end pools, load-balancing rules, session persistence, and health probes.</li>
</ul>
<h3 id="skills-measured_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#skills-measured_3">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#prerequisites_3">Prerequisites</a></h3>
<ul>
<li>Basic knowledge of virtual networks and routing.</li>
<li>Familiarity with the Azure portal so you can configure the load balancer.</li>
</ul>
<h2 id="determine-azure-load-balancer-uses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#determine-azure-load-balancer-uses">Determine Azure Load Balancer uses</a></h2>
<p>Azure Load Balancer delivers high availability and network performance to your applications. Administrators use load balancing to efficiently distribute incoming network traffic across back-end servers and resources. A load balancer is implemented by using load-balancing rules and health probes.</p>
<p>The following diagram shows how Azure Load Balancer works. The frontend exchanges information with a load balancer. The load balancer uses rules and health probes to communicate with the backend.</p>
<p><img alt="Diagram that shows how a load balancer works as described in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-load-balancer/media/load-balancer-4caf947b.png" /></p>
<h4 id="things-to-know-about-azure-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-azure-load-balancer">Things to know about Azure Load Balancer</a></h4>
<p>Let's take a closer look at how Azure Load Balancer operates.</p>
<ul>
<li>
<p>Azure Load Balancer can be used for inbound and outbound scenarios.</p>
</li>
<li>
<p>You can implement a <strong>public</strong> or <strong>internal</strong> load balancer, or use both types in a combination configuration.</p>
</li>
<li>
<p>To implement a load balancer, you configure four components:</p>
<ul>
<li>Front-end IP configuration</li>
<li>Back-end pools</li>
<li>Health probes</li>
<li>Load-balancing rules</li>
<li>The front-end configuration specifies the public IP or internal IP that your load balancer responds to.</li>
</ul>
</li>
<li>
<p>The back-end pools are your services and resources, including Azure Virtual Machines or instances in Azure Virtual Machine Scale Sets.</p>
</li>
<li>
<p>Load-balancing rules determine how traffic is distributed to back-end resources.</p>
</li>
<li>
<p>Health probes ensure the resources in the backend are healthy.</p>
</li>
<li>
<p>Load Balancer scales up to millions of TCP and UDP application flows.</p>
</li>
</ul>
<h2 id="implement-a-public-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#implement-a-public-load-balancer">Implement a public load balancer</a></h2>
<p>Administrators use public load balancers to map the public IP addresses and port numbers of incoming traffic to the private IP addresses and port numbers of virtual machines. The mapping can also be configured for response traffic from the virtual machines.</p>
<p>Load-balancing rules are used to specify how to distribute specific types of traffic across multiple virtual machines or services. You can use this approach to share the load of incoming web request traffic across multiple web servers.</p>
<h5 id="business-scenario_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#business-scenario_2">Business scenario</a></h5>
<p>Consider a scenario where internet traffic attempts to reach virtual machines in a web tier subnet that implements a public load balancer. Internet clients send webpage requests to the public IP address of a web app on TCP port 80. Azure Load Balancer intercepts the traffic and distributes the requests across the virtual machines in the load-balanced set according to the defined load-balancing rules. The following illustration highlights this scenario:</p>
<p><img alt="Diagram showing how a public load balancer works as described in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-load-balancer/media/public-load-balancer-46d5d9fe.png" /></p>
<h2 id="implement-an-internal-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#implement-an-internal-load-balancer">Implement an internal load balancer</a></h2>
<p>Administrators use internal load balancers to direct traffic to resources that reside in a virtual network, or to resources that use a VPN to access Azure infrastructure. In this configuration, front-end IP addresses and virtual networks are never directly exposed to an internet endpoint. Internal line-of-business applications run in Azure and are accessed from within Azure or from on-premises resources.</p>
<h5 id="business-scenario_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#business-scenario_3">Business scenario</a></h5>
<p>Suppose you have an Azure SQL Database tier subnet with several virtual machines, and you implement an internal load balancer. Database requests need to be distributed to the backend. The internal load balancer receives the database requests and uses the load-balancing rules to determine how to distribute the requests to the back-end SQL servers. The SQL servers respond on port 1433. The following illustration highlights this scenario:</p>
<p><img alt="Diagram showing how an internal load balancer works as described in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-load-balancer/media/internal-load-balancer-5ae85589.png" /></p>
<h4 id="things-to-consider-when-using-an-internal-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-consider-when-using-an-internal-load-balancer">Things to consider when using an internal load balancer</a></h4>
<p>You can implement an internal load balancer to achieve several types of load balancing.</p>
<ul>
<li>
<p><strong>Within virtual network</strong>: Establish load balancing from your virtual machines in the virtual network to a set of virtual machines that reside within the same virtual network.</p>
</li>
<li>
<p><strong>For cross-premises virtual network</strong>: Apply load balancing from your on-premises computers to a set of virtual machines that reside within the same virtual network.</p>
</li>
<li>
<p><strong>For multi-tier applications</strong>: Implement load balancing for your internet-facing multi-tier applications when the back-end tiers aren't internet-facing. The back-end tiers require traffic load-balancing from the internet-facing tier.</p>
</li>
<li>
<p><strong>For line-of-business applications</strong>: Add load balancing for your line-of-business applications hosted in Azure without having to add other load balancer hardware or software. This scenario includes on-premises servers that are in the set of computers whose traffic is load-balanced.</p>
</li>
<li>
<p><strong>With public load balancer</strong>: Configure a public load balancer in front of your internal load balancer to create a multi-tier application.</p>
</li>
</ul>
<h2 id="determine-load-balancer-skus"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#determine-load-balancer-skus">Determine load balancer SKUs</a></h2>
<p>When you create an Azure load balancer in the Azure portal, you select the type of load balancer to create (internal or public) and the Stock Keeping Unit (SKU). Azure Load Balancer supports three SKU options: Basic, Standard, and Gateway. Each SKU provides different features, scenario scaling, and pricing.</p>
<p><img alt="Screenshot that shows how to create an Azure load balancer in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-load-balancer/media/load-balancer-types-a4c0eceb.png" /></p>
<h4 id="things-to-know-about-azure-load-balancer-skus"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-azure-load-balancer-skus">Things to know about Azure Load Balancer SKUs</a></h4>
<p>Let's review some points to consider when choosing the SKU type for your load balancer.</p>
<ul>
<li>
<p>Standard Load Balancer is the newest product. It's essentially a superset of Basic Load Balancer.</p>
</li>
<li>
<p>The Standard SKU offers an expanded and more granular feature set than the Basic SKU.</p>
</li>
<li>
<p>The Basic SKU can be upgraded to the Standard SKU. But, new designs and architectures should use the Standard SKU.</p>
</li>
<li>
<p>The Gateway SKU supports high performance and high availability scenarios with third-party network virtual appliances (NVAs).</p>
</li>
</ul>
<h3 id="compare-basic-and-standard-sku-features"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#compare-basic-and-standard-sku-features">Compare Basic and Standard SKU features</a></h3>
<p>The following table provides a brief comparison of how features are implemented in the Standard and Basic SKUs.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Basic SKU</th>
<th>Standard SKU</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Health probes</strong></td>
<td>HTTP, TCP</td>
<td>HTTPS, HTTP, TCP</td>
</tr>
<tr>
<td><strong>Availability zones</strong></td>
<td>Not available</td>
<td>Zone-redundant and zonal frontends for inbound and outbound traffic</td>
</tr>
<tr>
<td><strong>Multiple frontends</strong></td>
<td>Inbound only</td>
<td>Inbound and outbound</td>
</tr>
<tr>
<td><strong>Security</strong></td>
<td>- Open by default  <br>- (Optional) Control through network security groups (NSGs)</td>
<td>- Closed to inbound flows unless allowed by an NSG  <br>- Internal traffic from the virtual network to the internal load balancer is allowed</td>
</tr>
</tbody>
</table>
<h2 id="create-back-end-pools"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-back-end-pools">Create back-end pools</a></h2>
<p>Each load balancer has one or more back-end pools that are used for distributing traffic. The back-end pools contain the IP addresses of the virtual NICs that are connected to your load balancer. You configure these pool settings in the Azure portal.</p>
<p><img alt="Screenshot that shows how to configure back-end pools in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-load-balancer/media/backend-pools-1984adb4.png" /></p>
<h4 id="things-to-know-about-back-end-pools"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-back-end-pools">Things to know about back-end pools</a></h4>
<p>The SKU type that you select determines which endpoint configurations are supported for the pool along with the number of pool instances allowed.</p>
<ul>
<li>
<p>The Basic SKU allows up to 300 pools, and the Standard SKU allows up to 1,000 pools.</p>
</li>
<li>
<p>When you configure the back-end pools, you can connect to availability sets, virtual machines, or Azure Virtual Machine Scale Sets.</p>
</li>
<li>
<p>For the Basic SKU, you can select virtual machines in a single availability set or virtual machines in an instance of Azure Virtual Machine Scale Sets.</p>
</li>
<li>
<p>For the Standard SKU, you can select virtual machines or Virtual Machine Scale Sets in a single virtual network. Your configuration can include a combination of virtual machines, availability sets, and Virtual Machine Scale Sets.</p>
</li>
</ul>
<h2 id="create-health-probes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-health-probes">Create health probes</a></h2>
<p>A health probe allows your load balancer to monitor the status of your application. The probe dynamically adds or removes virtual machines from your load balancer rotation based on the machine response to health checks. When a probe fails to respond, the load balancer stops sending new connections to the unhealthy instance.</p>
<p>The following image shows how to create a health probe in the Azure portal. A custom HTTP health probe is configured to run on TCP port 80. The probe is defined to check the health of the virtual machine instances at 5-second intervals.</p>
<p><img alt="Screenshot that shows how to create a health probe in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-load-balancer/media/add-health-probe-1d86fb2b.png" /></p>
<h4 id="things-to-know-about-health-probes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-health-probes">Things to know about health probes</a></h4>
<p>There are two main ways to configure a custom health probe: <strong>HTTP</strong> and <strong>TCP</strong>.</p>
<ul>
<li>
<p>In an <strong>HTTP probe</strong>, the load balancer probes your back-end pool endpoints every 15 seconds. A virtual machine instance is considered <em>healthy</em> if it responds with an HTTP 200 message within the specified timeout period (default is 31 seconds). If any status other than HTTP 200 is returned, the instance is considered <em>unhealthy</em>, and the probe fails.</p>
</li>
<li>
<p>A <strong>TCP probe</strong> relies on establishing a successful TCP session to a defined probe port. If the specified listener on the virtual machine exists, the probe succeeds. If the connection is refused, the probe fails.</p>
</li>
<li>
<p>To configure a probe, you specify values for the following settings:</p>
<ul>
<li><strong>Port</strong>: Back-end port</li>
<li><strong>URI</strong>: URI for requesting the health status from the backend</li>
<li><strong>Interval</strong>: Amount of time between probe attempts (default is 15 seconds)</li>
<li><strong>Unhealthy threshold</strong>: Number of failures that must occur for the instance to be considered unhealthy</li>
<li>A <strong>Guest agent probe</strong> is a third option that uses the guest agent inside the virtual machine. This option isn't recommended when an HTTP or TCP custom probe configuration is possible.</li>
</ul>
</li>
</ul>
<h2 id="create-load-balancer-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-load-balancer-rules">Create load balancer rules</a></h2>
<p>You can define load-balancing rules to specify how traffic is distributed to your back-end pools. Each rule maps a front-end IP address and port combination to a set of back-end IP address and port combinations.</p>
<p><img alt="Screenshot that shows how to create load-balancing rules in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-load-balancer/media/add-load-balancer-rules-f4d9b188.png" /></p>
<h4 id="things-to-know-about-load-balancing-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-load-balancing-rules">Things to know about load-balancing rules</a></h4>
<p>Let's take a closer look at how to configure load-balancing rules for your back-end pools.</p>
<ul>
<li>
<p>To configure a load-balancing rule, you need to have a frontend, backend, and health probe for your load balancer.</p>
</li>
<li>
<p>To define a rule in the Azure portal, you configure several settings:</p>
<ul>
<li><strong>IP version</strong> (IPv4 or IPv6)</li>
<li><strong>Front-end IP address</strong>, <em><em>Port</em>, and </em><em>Protocol</em>* (TCP or UDP)</li>
<li><strong>Back-end pool</strong> and <strong>Back-end port</strong></li>
<li><strong>Health probe</strong></li>
<li><strong>Session persistence</strong></li>
<li>By default, Azure Load Balancer distributes network traffic equally among multiple virtual machines.</li>
</ul>
<p>Azure Load Balancer uses a five-tuple hash to map traffic to available servers. The tuple consists of the source IP address, source port, destination IP address, destination port, and protocol type. The load balancer provides stickiness only within a transport session.</p>
</li>
<li>
<p><strong>Session persistence</strong> specifies how to handle traffic from a client. By default, successive requests from a client go to any virtual machine in your pool.</p>
<p>You can modify the session persistence behavior as follows:</p>
<ul>
<li><strong>None (default)</strong>: Any virtual machine can handle the request.</li>
<li><strong>Client IP</strong>: Successive requests from the same client IP address go to the same virtual machine.</li>
<li><strong>Client IP and protocol</strong>: Successive requests from the same client IP address and protocol combination go to the same virtual machine.</li>
</ul>
<p>Note</p>
<p>Maintaining session persistence information is important for applications that implement a shopping cart. Can you think of other applications that might benefit from session persistence?</p>
</li>
<li>
<p>Load-balancing rules can be used in combination with NAT rules.</p>
<p>Consider a scenario where you use NAT from a load balancer's public address to TCP port 3389 on a specific virtual machine. By combining your NAT rule with load-balancing rules, you can enable remote desktop access from outside of Azure.</p>
</li>
</ul>
<h2 id="interactive-lab-simulation_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#interactive-lab-simulation_4">Interactive lab simulation</a></h2>
<h3 id="lab-scenario_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#lab-scenario_4">Lab scenario</a></h3>
<p>Your organization is migrating hub and spoke network topologies to Azure. As the Azure Administrator you need to:</p>
<ul>
<li>Replicate the on-premises functionality in Azure.</li>
<li>Configure virtual network peering and traffic routing.</li>
<li>Implement load balancer and application gateway functionality.</li>
<li>Test to ensure traffic management is flowing as intended.</li>
</ul>
<h3 id="architecture-diagram_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#architecture-diagram_4">Architecture diagram</a></h3>
<p><img alt="Architecture diagram as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-load-balancer/media/lab-06.png" /></p>
<h3 id="objectives_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#objectives_4">Objectives</a></h3>
<ul>
<li><strong>Task 1: Provision the lab environment.</strong> In this task, you deploy four virtual machines into the same Azure region. The first two reside in a hub virtual network, while the remaining two reside in a separate spoke virtual network.<ul>
<li>Review an <a href="https://github.com/MicrosoftLearning/AZ-104-MicrosoftAzureAdministrator/tree/master/Allfiles/Interactive%20Lab%20Simulation%20Files/06">Azure Resource Manager template</a>.</li>
<li>This template includes the virtual machines and virtual networks in the underlying architecture.</li>
<li>Use Azure PowerShell to install the Network Watcher extension on the Azure virtual machines.</li>
</ul>
</li>
<li><strong>Task 2: Configure the hub and spoke network topology.</strong> In this task, you configure local peering between the virtual networks you deployed in the previous tasks in order to create a hub and spoke network topology.<ul>
<li>Configure virtual network peering between the virtual networks.</li>
<li>Ensure forwarded traffic is allowed to facilitate routing between spoke virtual networks.</li>
</ul>
</li>
<li><strong>Task 3: Test transitivity of virtual network peering.</strong> In this task, you test transitivity of virtual network peering by using Network Watcher.<ul>
<li>Use Network Watcher to verify peered networks are reachable.</li>
<li>Use Network Watcher to verify unpeered networks are unreachable.</li>
</ul>
</li>
<li><strong>Task 4: Configure routing in the hub and spoke topology</strong>. In this task, you configure and test routing between the two spoke virtual networks.<ul>
<li>Enable IP forwarding on a virtual machine.</li>
<li>Install the remote access Windows feature with associated tools.</li>
<li>Create routing tables and associate them with the appropriate subnets.</li>
<li>Use Network Watcher to verify traffic routed through the virtual machine.</li>
</ul>
</li>
<li><strong>Task 5: Implement Azure Load Balancer</strong>. In this task, you implement an Azure load balancer in front of the two Azure virtual machines in the hub virtual network.<ul>
<li>Create a load balancer with a public IP address.</li>
<li>Create a back-end pool that includes the virtual machines.</li>
<li>Add a load balancing rule to alternate between virtual machines in the back-end pool.</li>
<li>Test to confirm that the load balancer is working correctly.</li>
</ul>
</li>
<li><strong>Task 6: Implement Azure Application Gateway</strong>. In this task, you implement an Azure application gateway in front of the two Azure virtual machines in the spoke virtual networks.<ul>
<li>Create a dedicated subnet for the application gateway.</li>
<li>Create an application gateway with a public IP address.</li>
<li>Configure the application gateway back-end pool to include the virtual machines.</li>
<li>Test to ensure traffic is balanced across the back-end virtual machines.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Select the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2010"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-load-balancer/media/simulation-traffic-thumbnail.jpg" /></a></p>
<h2 id="summary-and-resources_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#summary-and-resources_3">Summary and resources</a></h2>
<p>In this module, you learned about Azure Load Balancer and its features. Azure Load Balancer distributed workloads and network traffic across virtual machines, making applications more resilient and scalable. You learned about load balancer SKUs, back-end pools, load-balancing rules, session persistence, and health probes.</p>
<p>The main takeaways from this module are:</p>
<ul>
<li>
<p>Azure Load Balancer helps distribute network traffic across servers and resources.</p>
</li>
<li>
<p>Load balancing can be used for inbound and outbound scenarios.</p>
</li>
<li>
<p>There are public and internal load balancers.</p>
</li>
<li>
<p>Load-balancing rules specify how traffic is distributed to your back-end pools.</p>
</li>
<li>
<p>Back-end pools contain the IP addresses of the virtual NICs that are connected to your load balancer.</p>
</li>
<li>
<p>Health probes dynamically add or remove virtual machines based on virtual machine health checks.</p>
</li>
</ul>
<h3 id="learn-more-with-documentation_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more-with-documentation_1">Learn more with documentation</a></h3>
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/load-balancer/">Azure Load Balancer documentation</a>. This collection of articles is your starting point for all things load balancer.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/load-balancer/quickstart-load-balancer-standard-public-portal">Create a public load balancer for virtual machines in the Azure portal</a>. This article reviews creating a public load balancer for a backend pool with two virtual machines.</p>
</li>
</ul>
<h3 id="learn-more-with-self-paced-training_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more-with-self-paced-training_2">Learn more with self-paced training</a></h3>
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-load-balancer/">Introduction to Azure Load Balancer</a>. Learn what Azure Load Balancer does, how it works, and when you should choose to use Load Balancer as a solution</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/training/modules/improve-app-scalability-resiliency-with-load-balancer/">Improve application scalability and resiliency by using Azure Load Balancer (sandbox)</a>. Learn about the different load balancers in Azure and how to choose the right Azure load balancer solution.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/training/modules/load-balancing-non-https-traffic-azure/">Load balance non-HTTP(S) traffic in Azure</a>. Learn the different load balancer options in Azure and how to choose and implement the right Azure solution for non-HTTP(S) traffic.</p>
</li>
</ul>
<hr />
<h2 id="configure-azure-application-gateway"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-azure-application-gateway">Configure Azure Application Gateway</a></h2>
<h2 id="introduction_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction_5">Introduction</a></h2>
<p>Azure Application Gateway is a load balancer for web traffic. Administrators implement an application gateway to manage traffic to their web apps.</p>
<p>Suppose you work for the motor vehicle department of a governmental organization. The department runs several public websites that enable drivers to register their vehicles, and renew their licenses online. The vehicle registration website has been running on a single server, and has suffered multiple outages because of server failures. The outages have resulted in frustrated drivers trying to register their vehicles before their registrations expire.</p>
<p>You're responsible for improving the resiliency of the site by adding multiple web servers to distribute the load. You want to centralize the site on a single load-balancing service, and simplify the URLs for site visitors. You're researching how to implement Azure Application Gateway.</p>
<h3 id="learning-objectives_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learning-objectives_4">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify features and usage cases for Azure Application Gateway.</li>
<li>Implement an Azure application gateway, including selecting a routing method.</li>
<li>Configure gateway components, such as listeners, health probes, and routing rules.</li>
</ul>
<h3 id="skills-measured_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#skills-measured_4">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>. The module concepts are covered in:</p>
<p>Configure and manage virtual networking (25–30%)</p>
<ul>
<li>Configure load balancing.<ul>
<li>Configure Azure Application Gateway.</li>
</ul>
</li>
</ul>
<h2 id="implement-azure-application-gateway"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#implement-azure-application-gateway">Implement Azure Application Gateway</a></h2>
<p>Administrators use Azure Application Gateway to manage requests from client applications to their web apps. An application gateway listens for incoming traffic to web apps and checks for messages sent via protocols like HTTP. Gateway rules direct the traffic to resources in a back-end pool.</p>
<h5 id="business-scenario_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#business-scenario_4">Business scenario</a></h5>
<p>Consider a scenario where internet client applications request access to resources in a load-balanced back-end pool. The requests can be managed by implementing Azure Application Gateway to listen for HTTP(S) messages. Messages can be handled by load-balancing rules to direct client request traffic to the appropriate resources in the pool. The following diagram illustrates this scenario:</p>
<p><img alt="Diagram that illustrates how Azure Application Gateway manages requests from client applications to resources in a back-end pool, as described in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-application-gateway/media/application-gateway-cb3392f4.png" /></p>
<h4 id="things-to-know-about-azure-application-gateway"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-azure-application-gateway">Things to know about Azure Application Gateway</a></h4>
<p>Let's examine some of the benefits of using Azure Application Gateway to manage internet traffic to your web applications.</p>
<table>
<thead>
<tr>
<th>Benefit</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Application layer routing</strong></td>
<td>Use application layer routing to direct traffic to a back-end pool of web servers based on the URL of a request. The back-end pool can include Azure virtual machines, Azure Virtual Machine Scale Sets, Azure App Service, and even on-premises servers.</td>
</tr>
<tr>
<td><strong>Round-robin load balancing</strong></td>
<td>Employ round-robin load balancing to distribute incoming traffic across multiple servers. Send load-balance requests to the servers in each back-end pool. Client requests are forwarded in a cycle through a group of servers to create an effective balance for the server load.</td>
</tr>
<tr>
<td><strong>Session stickiness</strong></td>
<td>Apply session stickiness to your application gateway to ensure client requests in the same session are routed to the same back-end server.</td>
</tr>
<tr>
<td><strong>Supported protocols</strong></td>
<td>Build an application gateway to support the HTTP, HTTPS, HTTP/2, or WebSocket protocols.</td>
</tr>
<tr>
<td><strong>Firewall protection</strong></td>
<td>Implement a web application firewall to protect against web application vulnerabilities.</td>
</tr>
<tr>
<td><strong>Encryption</strong></td>
<td>Support end-to-end request encryption for your web applications.</td>
</tr>
<tr>
<td><strong>Load autoscaling</strong></td>
<td>Dynamically adjust capacity as your web traffic load changes.</td>
</tr>
</tbody>
</table>
<h2 id="determine-azure-application-gateway-routing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#determine-azure-application-gateway-routing">Determine Azure Application Gateway routing</a></h2>
<p>Clients send requests to your web apps by specifying the IP address or DNS name of your application gateway. Your gateway directs the requests to a selected web server in your back-end pool according to a set of rules. You define the rules for your gateway to identify the allowable routes for the request traffic.</p>
<h4 id="things-to-know-about-traffic-routing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-traffic-routing">Things to know about traffic routing</a></h4>
<p>Let's take a closer look at your routing options for Azure Application Gateway.</p>
<ul>
<li>
<p>Azure Application Gateway offers two primary methods for routing traffic:</p>
<ul>
<li>
<p><strong>Path-based routing</strong> sends requests with different URL paths to different pools of back-end servers.</p>
</li>
<li>
<p><strong>Multi-site routing</strong> configures more than one web application on the same application gateway instance.</p>
</li>
</ul>
</li>
<li>
<p>You can configure your application gateway to <strong>redirect</strong> traffic.</p>
<p>Application Gateway can redirect traffic received at one listener to another listener, or to an external site. This approach is commonly used by web apps to automatically redirect HTTP requests to communicate via HTTPS. The redirection ensures all communication between your web app and clients occurs over an encrypted path.</p>
</li>
<li>
<p>You can implement Application Gateway to <strong>rewrite HTTP headers</strong>.</p>
<p>HTTP headers allow the client and server to pass parameter information with the request or the response. In this scenario, you can translate URLs or query string parameters, and modify request and response headers. Add conditions to ensure URLs or headers are rewritten only for certain conditions.</p>
</li>
<li>
<p>Application Gateway allows you to create custom error pages instead of displaying default error pages. You can use your own branding and layout by using a custom error page.</p>
</li>
</ul>
<h5 id="path-based-routing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#path-based-routing">Path-based routing</a></h5>
<p>You can implement path-based routing to direct requests for specific URL paths to the appropriate back-end pool. Consider a scenario where your web app receives requests for videos or images. You can use path-based routing to direct requests for the <code>/video/\*</code> path to a back-end pool of servers that are optimized to handle video streaming. Image requests for the <code>/images/\*</code> path can be directed to a pool of servers that handle image retrieval. The following illustration demonstrates this routing method:</p>
<p><img alt="Diagram that shows a path-based routing approach." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-application-gateway/media/path-based-routing-15bcef5f.png" /></p>
<h5 id="multi-site-routing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#multi-site-routing">Multi-site routing</a></h5>
<p>When you need to support multiple web apps on the same application gateway instance, multi-site routing is the best option. Multi-site configurations are useful for supporting multi-tenant applications, where each tenant has its own set of virtual machines or other resources hosting a web application.</p>
<p>In this configuration, you register multiple DNS names (CNAMEs) for the IP address of your application gateway and specify the name of each site. Application Gateway uses separate listeners to wait for requests for each site. Each listener passes the request to a different rule, which can route the requests to servers in a different back-end pool.</p>
<p>Consider a scenario where you need to support traffic to two sites on the same gateway. You can direct all requests for the <code>http://contoso.com</code> site to servers in one back-end pool, and requests for the <code>http://fabrikam.com</code> site to another back-end pool. The following illustration demonstrates this routing method.</p>
<p><img alt="Diagram that shows a multiple site routing approach." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-application-gateway/media/site-based-routing-e686b605.png" /></p>
<h2 id="configure-azure-application-gateway-components"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-azure-application-gateway-components">Configure Azure Application Gateway components</a></h2>
<p>Azure Application Gateway has a series of components that combine to route requests to a pool of web servers and to check the health of these web servers. These components include the frontend IP address, back-end pools, routing rules, health probes, and listeners. As an option, the gateway can also implement a firewall.</p>
<h4 id="things-to-know-about-application-gateway-components"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#things-to-know-about-application-gateway-components">Things to know about Application Gateway components</a></h4>
<p>Let's explore how the components of an application gateway work together.</p>
<ul>
<li>
<p>The <strong>front-end IP address</strong> receives the client requests.</p>
</li>
<li>
<p>An optional <strong>Web Application Firewall</strong> checks incoming traffic for common threats before the requests reach the listeners.</p>
</li>
<li>
<p>One or more <strong>listeners</strong> receive the traffic and route the requests to the back-end pool.</p>
</li>
<li>
<p><strong>Routing rules</strong> define how to analyze the request to direct the request to the appropriate back-end pool.</p>
</li>
<li>
<p>A <strong>back-end pool</strong> contains web servers for resources like virtual machines or Virtual Machine Scale Sets. Each pool has a load balancer to distribute the workload across the resources.</p>
</li>
<li>
<p><strong>Health probes</strong> determine which back-end pool servers are available for load-balancing.</p>
</li>
</ul>
<p>The following flowchart demonstrates how the Application Gateway components work together to direct traffic requests between the frontend and back-end pools in your configuration.</p>
<p><img alt="Flowchart that demonstrates how Application Gateway components direct traffic requests between the frontend and back-end pools." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-application-gateway/media/configure-app-gateway-0193dbd6.png" /></p>
<h5 id="front-end-ip-address"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#front-end-ip-address">Front-end IP address</a></h5>
<p>Client requests are received through your front-end IP address. Your application gateway can have a public or private IP address, or both. You can have only one public IP address and only one private IP address.</p>
<h5 id="web-application-firewall-optional"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#web-application-firewall-optional">Web Application Firewall (optional)</a></h5>
<p>You can enable Azure Web Application Firewall for Azure Application Gateway to handle incoming requests before they reach your listener. The firewall checks each request for threats based on the Open Web Application Security Project (OWASP). Common threats include SQL-injection, cross-site scripting, command injection, HTTP request smuggling and response splitting, and remote file inclusion. Other threats can come from bots, crawlers, scanners, and HTTP protocol violations and anomalies.</p>
<p>OWASP defines a set of generic rules for detecting attacks. These rules are referred to as the Core Rule Set (CRS). The rule sets are under continuous review as attacks evolve in sophistication. Azure Web Application Firewall supports two rule sets: CRS 2.2.9 and CRS 3.0. CRS 3.0 is the default and more recent of these rule sets. If necessary, you can opt to select only specific rules in a rule set to target certain threats. Additionally, you can customize the firewall to specify which elements in a request to examine, and limit the size of messages to prevent massive uploads from overwhelming your servers.</p>
<h5 id="listeners"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#listeners">Listeners</a></h5>
<p>Listeners accept traffic arriving on a specified combination of protocol, port, host, and IP address. Each listener routes requests to a back-end pool of servers according to your routing rules. A listener can be <em>Basic</em> or <em>Multi-site</em>. A Basic listener only routes a request based on the path in the URL. A Multi-site listener can also route requests by using the hostname element of the URL. Listeners also handle TLS/SSL certificates for securing your application between the user and Application Gateway.</p>
<h5 id="routing-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#routing-rules">Routing rules</a></h5>
<p>A routing rule binds your listeners to the back-end pools. A rule specifies how to interpret the hostname and path elements in the URL of a request, and then direct the request to the appropriate back-end pool. A routing rule also has an associated set of HTTP settings. These HTTP settings indicate whether (and how) traffic is encrypted between Application Gateway and the back-end servers. Other configuration information includes protocol, session stickiness, connection draining, request timeout period, and health probes.</p>
<h5 id="back-end-pools"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#back-end-pools">Back-end pools</a></h5>
<p>A back-end pool references a collection of web servers. You provide the IP address of each web server and the port on which it listens for requests when configuring the pool. Each pool can specify a fixed set of virtual machines, Virtual Machine Scale Sets, an app hosted by Azure App Services, or a collection of on-premises servers. Each back-end pool has an associated load balancer that distributes work across the pool.</p>
<h5 id="health-probes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#health-probes">Health probes</a></h5>
<p>Health probes determine which servers in your back-end pool are available for load-balancing. Application Gateway uses a health probe to send a request to a server. When the server returns an HTTP response with a status code between 200 and 399, the server is considered healthy. If you don't configure a health probe, Application Gateway creates a default probe that waits for 30 seconds before identifying a server as unavailable (unhealthy).</p>
<h2 id="summary-and-resources_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#summary-and-resources_4">Summary and resources</a></h2>
<p>Azure Application Gateway provides load balancing and application routing capabilities across multiple web sites. Several routing methods are available, including multi-site and path-based. Application Gateway also provides Azure Web Application Firewall to supply built-in security features.</p>
<p>In this module, you identified features and usage cases for Azure Application Gateway. You explored Application Gateway components, including listeners, firewalls, health probes, and routing rules. You learned how to implement an application gateway, including selecting the appropriate routing method.</p>
<h3 id="learn-more_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more_1">Learn more</a></h3>
<ul>
<li>
<p>Read about <a href="https://learn.microsoft.com/en-us/azure/application-gateway/overview">Azure Application Gateway</a>.</p>
</li>
<li>
<p>Examine <a href="https://learn.microsoft.com/en-us/azure/application-gateway/application-gateway-components">Application Gateway components</a>.</p>
</li>
<li>
<p>Discover <a href="https://learn.microsoft.com/en-us/azure/application-gateway/features">Application Gateway features</a>.</p>
</li>
<li>
<p>Read about <a href="https://learn.microsoft.com/en-us/azure/web-application-firewall/ag/ag-overview">Azure Web Application Firewall on Application Gateway</a>.</p>
</li>
<li>
<p>Explore <a href="https://learn.microsoft.com/en-us/azure/application-gateway/redirect-overview">Application Gateway redirection routing</a>.</p>
</li>
<li>
<p>Configure an <a href="https://learn.microsoft.com/en-us/azure/application-gateway/create-multiple-sites-portal">application gateway to host multiple web sites</a>.</p>
</li>
<li>
<p>Rewrite <a href="https://learn.microsoft.com/en-us/azure/application-gateway/rewrite-http-headers-url">HTTP headers and URL with Application Gateway</a>.</p>
</li>
</ul>
<h3 id="learn-more-with-self-paced-training_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more-with-self-paced-training_3">Learn more with self-paced training</a></h3>
<ul>
<li>Complete an <a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-application-gateway/">introduction to Azure Application Gateway</a>.</li>
</ul>
<h3 id="learn-more-with-optional-hands-on-exercises_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more-with-optional-hands-on-exercises_1">Learn more with optional hands-on exercises</a></h3>
<ul>
<li>
<p>Load balance <a href="https://learn.microsoft.com/en-us/training/modules/load-balancing-https-traffic-azure/">HTTP(S) traffic in Azure</a>. <em>Azure subscription required</em>.</p>
</li>
<li>
<p>Load balance your <a href="https://learn.microsoft.com/en-us/training/modules/load-balance-web-traffic-with-application-gateway/">web service traffic with Azure Application Gateway</a>. <em>Azure subscription required</em>.</p>
</li>
<li>
<p>Encrypt <a href="https://learn.microsoft.com/en-us/training/modules/end-to-end-encryption-with-app-gateway/">network traffic end-to-end with Azure Application Gateway</a>. <em>Azure subscription required</em>.</p>
</li>
</ul>
<hr />
<h2 id="design-an-ip-addressing-schema-for-your-azure-deployment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#design-an-ip-addressing-schema-for-your-azure-deployment">Design an IP addressing schema for your Azure deployment</a></h2>
<h2 id="introduction_6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction_6">Introduction</a></h2>
<p>Imagine you're the solution architect for a manufacturing company. Your company is beginning a project to move many services out of its existing datacenter and into the Azure cloud. The company wants to integrate the existing network with Azure. You need to plan the public and private IP addresses for the network carefully so you don’t run out of addresses and have capacity for future growth. A good IP addressing scheme provides flexibility, room for growth, and integration with on-premises networks.</p>
<p>In this module, you learn about the public and private IP addressing capabilities of Azure virtual networks. Also, you learn how to gather the necessary requirements for planning an IP address scheme. This module covers the on-premises integration methods of point-to-site and site-to-site, and also virtual network-to-virtual network peering. You also design and implement virtual networks and configure and verify virtual network peering. By the end of this module, you understand how to plan IP addressing for an Azure network and how to integrate Azure with an on-premises network.</p>
<h3 id="learning-objectives_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learning-objectives_5">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Identify the private IP addressing capabilities of Azure virtual networks.</li>
<li>Identify the public IP addressing capabilities of Azure.</li>
<li>Identify the requirements for IP addressing when integrating with on-premises networks.</li>
</ul>
<h3 id="prerequisites_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#prerequisites_4">Prerequisites</a></h3>
<ul>
<li>Knowledge of basic networking concepts, network subnets, and IP addressing</li>
<li>Familiarity with Azure virtual networking</li>
</ul>
<h2 id="network-ip-addressing-and-integration"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#network-ip-addressing-and-integration">Network IP addressing and integration</a></h2>
<p>To integrate resources in an Azure virtual network with resources in your on-premises network, you must understand how you can connect those resources and how to configure IP addresses.</p>
<p>Your manufacturing company wants to migrate a business-critical database to Azure. Client applications on desktop computers, laptops, and mobile devices need constant access to the database as if the database remained in the on-premises network. You want to move the database server without affecting users.</p>
<p>In this unit, you look at a typical on-premises network design and compare it to a typical Azure network design. You learn about requirements for IP addressing when integrating an Azure network with on-premises networks.</p>
<h3 id="on-premises-ip-addressing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#on-premises-ip-addressing">On-premises IP addressing</a></h3>
<p>A typical on-premises network design includes these components:</p>
<ul>
<li>Routers</li>
<li>Firewalls</li>
<li>Switches</li>
<li>Network segmentation</li>
</ul>
<p><img alt="Diagram of a typical on-premises network design." src="https://learn.microsoft.com/en-us/training/modules/design-ip-addressing-for-azure/media/2-on-premises-network.png" /></p>
<p>The preceding diagram shows a simplified version of a typical on-premises network. On the routers facing the Internet Service Provider (ISP), you have public IP addresses that your outbound internet traffic uses as their source. These addresses also are used for inbound traffic across the internet. The internet service provider might issue you a block of IP addresses to assign to your devices. Or, you might have your own block of public IP addresses that your organization owns and controls. You can assign these addresses to systems that you would like to make accessible from the internet, such as web servers.</p>
<p>The perimeter network and internal zone have private IP addresses. In the perimeter network and internal zone, the IP addresses that are assigned to these devices aren't accessible over the internet. The administrator has full control over the IP address assignment, name resolution, security settings, and security rules. There are three ranges of nonroutable IP addresses that are designed for internal networks that won't be sent over internet routers:</p>
<ul>
<li>10.0.0.0 to 10.255.255.255</li>
<li>172.16.0.0 to 172.31.255.255</li>
<li>192.168.0.0 to 192.168.255.255</li>
</ul>
<p>The administrator can add or remove on-premises subnets to accommodate network devices and services. The number of subnets and IP addresses you can have in your on-premises network depends on the Classless Inter-Domain Routing (CIDR) for the IP address block.</p>
<h3 id="cidr"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#cidr">CIDR</a></h3>
<p>Classless Inter-Domain Routing (CIDR) is a method for allocating IP addresses and routing Internet Protocol packets. CIDR allows for more efficient use of IP address space by enabling the creation of variable-length subnet masks (VLSMs), which can allocate IP addresses in a more granular and flexible manner. This method helps to reduce the wastage of IP addresses and improves the scalability of the network. CIDR notation represents an IP address followed by a slash and a number; 192.168.0.0/24. The number indicates the length of the subnet mask.</p>
<h3 id="azure-ip-addressing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#azure-ip-addressing">Azure IP addressing</a></h3>
<p>Azure virtual networks use private IP addresses. The ranges of private IP addresses are the same as for on-premises IP addressing. Like on-premises networks, the administrator has full control over the IP address assignment, name resolution, security settings, and security rules in an Azure virtual network. The administrator can add or remove subnets depending on the CIDR for the IP address block.</p>
<p>A typical Azure network design usually has these components:</p>
<ul>
<li>Virtual networks</li>
<li>Subnets</li>
<li>Network security groups</li>
<li>Firewalls</li>
<li>Load balancers</li>
</ul>
<p><img alt="Diagram of a typical Azure network design." src="https://learn.microsoft.com/en-us/training/modules/design-ip-addressing-for-azure/media/2-azure-network.png" /></p>
<p>In Azure, the network design has features and functions that are similar to an on-premises network, but the network's structure is different. The Azure network doesn't follow the typical on-premises hierarchical network design. The Azure network allows you to scale up and scale down infrastructure based on demand. Provisioning in the Azure network happens in a matter of seconds. There are no hardware devices like routers or switches. The entire infrastructure is virtual, and you can slice it into chunks that suit your requirements.</p>
<p>In Azure, you typically implement a network security group and a firewall. You use subnets to isolate front-end services, including web servers and Domain Name Systems (DNS), and back-end services like databases and storage systems. Network security groups filter internal and external traffic at the network layer. A firewall has more extensive capabilities for network-layer filtering and application-layer filtering. By deploying both network security groups and a firewall, you get improved isolation of resources for a secure network architecture.</p>
<h3 id="basic-properties-of-azure-virtual-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#basic-properties-of-azure-virtual-networks">Basic properties of Azure virtual networks</a></h3>
<p>A virtual network is your network in the cloud. You can divide your virtual network into multiple subnets. Each subnet contains a portion of the IP-address space assigned to your virtual network. You can add, remove, expand, or shrink a subnet if there are no VMs or services deployed in it.</p>
<p>By default, all subnets in an Azure virtual network can communicate with each other. However, you can use a network security group to deny communication between subnets. Regarding sizing, the smallest supported subnet uses a /29 subnet mask, and the largest supported subnet uses a /2 subnet mask. The smallest subnet has eight IP addresses, and the largest subnet has 1,073,741,824 IP addresses.</p>
<h3 id="integrate-azure-with-on-premises-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#integrate-azure-with-on-premises-networks">Integrate Azure with on-premises networks</a></h3>
<p>Before you start integrating Azure with on-premises networks, it's important to identify the current private IP address scheme the on-premises network uses. There can be no IP address overlap for interconnected networks.</p>
<p>For example, you can't use 192.168.0.0/16 on your on-premises network and use 192.168.10.0/24 on your Azure virtual network. These ranges both contain the same IP addresses so traffic can't be routed between them.</p>
<p>You can, however, have the same class range for multiple networks. For example, you can use the 10.10.0.0/16 address space for your on-premises network and the 10.20.0.0/16 address space for your Azure network because they don't overlap.</p>
<p>It's vital to check for overlaps when you're planning an IP address scheme. If there's an overlap of IP addresses, you can't integrate your on-premises network with your Azure network.</p>
<h2 id="public-and-private-ip-addressing-in-azure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#public-and-private-ip-addressing-in-azure">Public and private IP addressing in Azure</a></h2>
<p>You work for a manufacturing company, and you're moving resources into Azure. The database server must be accessible for clients in your on-premises network. Public resources—like web servers—must be accessible from the internet. You want to ensure that you plan IP addresses that support both these requirements.</p>
<p>In this unit, you explore the constraints and limitations for public and private IP addresses in Azure. Also, you look at the capabilities that are available in Azure to reassign IP addresses in your network.</p>
<h3 id="ip-address-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#ip-address-types">IP address types</a></h3>
<p>In Azure, you can use two types of IP addresses:</p>
<ul>
<li><strong>Public IP addresses</strong></li>
<li><strong>Private IP addresses</strong></li>
</ul>
<p>You can allocate both types of IP addresses in one of two ways:</p>
<ul>
<li><strong>Dynamic</strong></li>
<li><strong>Static</strong></li>
</ul>
<p>Let's take a closer look at how the IP address types work together.</p>
<h3 id="public-ip-addresses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#public-ip-addresses">Public IP addresses</a></h3>
<p>Use a public IP address for public-facing services. A public address can be either static or dynamic. A public IP address can be assigned to a virtual machine (VM), an internet-facing load balancer, a VPN gateway, or an application gateway.</p>
<ul>
<li>
<p><strong>Dynamic public IP addresses</strong> are assigned addresses that can change over the lifespan of the Azure resource. The dynamic IP address is allocated when you create or start a VM. The IP address is released when you stop or delete the VM. In each Azure region, public IP addresses are assigned from a unique pool of addresses. The default allocation method is dynamic.</p>
</li>
<li>
<p><strong>Static public IP addresses</strong> are assigned addresses that don't change over the lifespan of the Azure resource. To ensure that the IP address for the resource remains the same, you can set the allocation method to static. In this case, an IP address is assigned immediately, and is released only when you delete the resource or change the IP allocation method to dynamic.</p>
</li>
</ul>
<h4 id="skus-for-public-ip-addresses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#skus-for-public-ip-addresses">SKUs for public IP addresses</a></h4>
<p>For public IP addresses, there are two SKUs from which to choose: <strong>Basic</strong> and <strong>Standard</strong>. All public IP addresses created before the introduction of SKUs are Basic SKU public IP addresses. With the introduction of SKUs, you can choose the scale, features, and pricing for load balancing internet traffic.</p>
<p>Both Basic and Standard SKUs have by default:</p>
<ul>
<li>An inbound originated flow idle timeout of four minutes, which is adjustable to up to 30 minutes.</li>
<li>A fixed outbound originated flow idle timeout of four minutes.</li>
</ul>
<h5 id="basic-sku"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#basic-sku">Basic SKU</a></h5>
<p>You can assign Basic public IPs by using static or dynamic allocation methods. You can assign Basic public IPs to any Azure resource that can be assigned a public IP address. Including network interfaces, VPN gateways, application gateways, and internet-facing load balancers.</p>
<p>By default, Basic SKU IP addresses:</p>
<ul>
<li>Are open. Network security groups are recommended, but optional, for restricting inbound or outbound traffic.</li>
<li>Are available for inbound only traffic.</li>
<li>Are available when using instance meta data service (IMDS).</li>
<li>Don't support Availability Zones.</li>
<li>Don't support routing preferences.</li>
</ul>
<h5 id="standard-sku"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#standard-sku">Standard SKU</a></h5>
<p>By default, Standard SKU IP addresses:</p>
<ul>
<li>Always use static allocation.</li>
<li>Are secure, and thus closed to inbound traffic. You must enable inbound traffic by using a network security group.</li>
<li>Are zone-redundant and optionally zonal (they can be created as zonal and guaranteed in a specific availability zone).</li>
<li>Can be assigned to network interfaces, Standard public load balancers, application gateways, or VPN gateways.</li>
<li>Can be utilized with the routing preference to enable more granular control of how traffic is routed between Azure and the Internet.</li>
<li>Can be used as anycast frontend IPs for cross-region load balancers.</li>
</ul>
<p>For more information, see <a href="https://learn.microsoft.com/en-us/azure/load-balancer/skus">SKU comparison</a>, Load Balancer <a href="https://learn.microsoft.com/en-us/azure/load-balancer/load-balancer-overview">overview</a>, and <a href="https://learn.microsoft.com/en-us/azure/load-balancer/components">components</a>.</p>
<h4 id="public-ip-address-prefix"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#public-ip-address-prefix">Public IP address prefix</a></h4>
<p>In Azure, a <em>public IP address prefix</em> is a reserved, static range of public IP addresses. Azure assigns an IP address from a pool of available addresses that's unique to each region in each Azure cloud. When you define a Public IP address prefix, associated public IP addresses are assigned from a pool for an Azure region.</p>
<p>In a region with Availability Zones, Public IP address prefixes can be created as zone-redundant or associated with a specific availability zone.</p>
<p>The benefit of a public IP address prefix is that you can specify firewall rules for a known range of IP addresses. If your business needs to have datacenters in different regions, you need a different public IP address range for each region. You can assign the addresses from a public IP address prefix to any Azure resource that supports public IP addresses.</p>
<p>You can create a public IP address prefix by specifying a name and prefix size. The prefix size is the number of reserved addresses available for use.</p>
<ul>
<li>Public IP address prefixes consist of IPv4 or IPv6 addresses.</li>
<li>You can use technology like Azure Traffic Manager to balance region-specific instances.</li>
<li>You can only bring your own public IP addresses from on-premises networks into Azure by using a <a href="https://learn.microsoft.com/en-us/azure/virtual-network/ip-services/custom-ip-address-prefix">Custom IP address prefix</a>.</li>
<li>You can't specify addresses when you create a prefix; Azure assigns them. After a prefix is created, the IP addresses are fixed in a contiguous range.</li>
<li>Public IP addresses can't be moved between regions; all IP addresses are region-specific.</li>
</ul>
<h3 id="private-ip-addresses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#private-ip-addresses">Private IP addresses</a></h3>
<p>Private IP addresses are used for communication within an Azure Virtual Network, including virtual networks and your on-premises networks. You can set private IP addresses to dynamic (DHCP lease) or static (DHCP reservation).</p>
<p><strong>Dynamic private IP addresses</strong> are assigned through a DHCP lease and can change over the lifespan of the Azure resource.</p>
<p><strong>Static private IP addresses</strong> are assigned through a DHCP reservation and don't change throughout the lifespan of the Azure resource. Static private IP addresses persist if a resource is stopped or deallocated.</p>
<h3 id="ip-addressing-for-azure-virtual-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#ip-addressing-for-azure-virtual-networks">IP addressing for Azure virtual networks</a></h3>
<p>In Azure, a virtual network is a fundamental component that acts as an organization's network. The administrator has full control over IP address assignment, security settings, and security rules. When you create a virtual network, you define a scope of IP addresses. Private IP addressing works the same way as it does in an on-premises network. You choose the private IP addresses that the Internet Assigned Numbers Authority (IANA) reserves based on your network requirements:</p>
<ul>
<li>10.0.0.0/8</li>
<li>172.16.0.0/12</li>
<li>192.168.0.0/16</li>
</ul>
<p>A subnet is a range of IP address within the virtual network. You can divide a virtual network into multiple subnets. Each subnet must have a unique address range, which is specified in classless interdomain routing (CIDR) format. CIDR is a way to represent a block of network IP addresses. An IPv4 CIDR, specified as part of the IP address, shows the length of the network prefix.</p>
<p>Consider, for example, CIDR 192.168.10.0/24. "192.168.10.0" is the network address, and "24" indicates that the first 24 bits are part of the network address, leaving the last 8 bits for specific host addresses. A subnet's address range can't overlap with other subnets in the virtual network or with the on-premises network.</p>
<p>For all subnets in Azure, the first three IP addresses are reserved by default. For protocol conformance, the first and last IP addresses of all subnets also are reserved. In Azure, an internal DHCP service assigns and maintains the lease of IP addresses. The <code>.1</code>, <code>.2</code>, <code>.3</code>, and last IP addresses aren't visible or configurable by the Azure customer. These addresses are reserved and used by internal Azure services.</p>
<p>In Azure virtual networks, IP addresses can be allocated to the following types of resources:</p>
<ul>
<li>Virtual machine network interfaces</li>
<li>Load balancers</li>
<li>Application gateways</li>
</ul>
<h2 id="plan-ip-addressing-for-your-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#plan-ip-addressing-for-your-networks">Plan IP addressing for your networks</a></h2>
<p>In your manufacturing company, you asked the operations and engineering teams about their requirements for the number of virtual machines in Azure. Also, you asked them about their plans for expansion. Based on the results of this survey, you want to plan an IP addressing scheme that you won't have to change in the foreseeable future.</p>
<p>In this unit, you explore the requirements for a network IP address scheme. You learn about classless inter-domain routing (CIDR) and how you can use it to slice an IP block to meet your addressing needs. In the next unit, there's an exercise that shows how to plan IP addressing for Azure virtual networks.</p>
<h3 id="gather-your-requirements"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#gather-your-requirements">Gather your requirements</a></h3>
<p>Before planning your network IP address scheme, you must gather the requirements for your infrastructure. These requirements also help you prepare for future growth by reserving extra IP addresses and subnets.</p>
<p>Here are two of the questions you might ask to discover the requirements:</p>
<ul>
<li>How many devices do you have on the network?</li>
<li>How many devices are you planning to add to the network in the future?</li>
</ul>
<p>When your network expands, you don't want to redesign the IP address scheme. Here are some other questions you could ask:</p>
<ul>
<li>Based on the services running on the infrastructure, what devices do you need to separate?</li>
<li>How many subnets do you need?</li>
<li>How many devices per subnet do you have?</li>
<li>How many devices are you planning to add to the subnets in future?</li>
<li>Are all subnets going to be the same size?</li>
<li>How many subnets do you want or plan to add in future?</li>
</ul>
<p>You need to isolate some services. Isolating services provides another layer of security, but also requires good planning. For example, public devices can access your front-end servers, but the back-end servers need to be isolated. Subnets help isolate the network in Azure. However, all subnets within a virtual network can communicate with each other in Azure by default. To provide further isolation, you can use a network security group. You might isolate services depending on the data and its security requirements. For example, you might choose to isolate HR data and the company's financial data from customer databases.</p>
<p>When you know the requirements, you have a greater understanding of the total number of devices on the network per subnet and how many subnets you need. CIDR allows more flexible allocation of IP addresses than was possible with the original system of IP address classes. Depending on your requirements, you determine the required subnets and hosts out of the block of IP Addresses.</p>
<p>Remember that Azure uses the first three addresses on each subnet. The subnets' first and last IP addresses also are reserved for protocol conformance. Therefore, the number of possible addresses on an Azure subnet is <strong>(2^n)-5</strong>, where <strong>n</strong> represents the number of host bits.</p>
<h2 id="summary"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#summary">Summary</a></h2>
<p>In this module, you have:</p>
<ul>
<li>Identified the private and public IP addressing capabilities of Azure virtual networks.</li>
<li>Identified how to integrate on-premises networks with Azure.</li>
<li>Planned an IP address scheme for your Azure infrastructure and created virtual networks.</li>
</ul>
<p>Now that you understand how to plan IP addressing for Azure networks, you understand the private and public IP addressing capabilities of Azure virtual networks. You can use this information to plan out the IP addressing for your own Azure infrastructure.</p>
<h3 id="learn-more_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learn-more_2">Learn more</a></h3>
<p>For more information about IP addressing in Azure, see the following articles:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/virtual-network/ip-services/public-ip-addresses">Public IP addresses</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/virtual-network/public-ip-address-prefix">Public IP address prefix</a></li>
</ul>
<hr />
<h2 id="distribute-your-services-across-azure-virtual-networks-and-integrate-them-by-using-virtual-network-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#distribute-your-services-across-azure-virtual-networks-and-integrate-them-by-using-virtual-network-peering">Distribute your services across Azure virtual networks and integrate them by using virtual network peering</a></h2>
<h2 id="introduction_7"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction_7">Introduction</a></h2>
<p>Imagine you're the solution architect for an engineering company that has been migrating services into Azure. The company deployed services into separate virtual networks, but has yet to configure private connectivity between them.</p>
<p>Several business units identified services in these virtual networks that need to communicate with each other. You need to enable this connectivity, but you don't want to expose these services to the internet. You also want to keep the integration as simple as possible.</p>
<p>In this module, you learn about virtual network connection options and why virtual network peering is suited for this scenario. You create three virtual networks and configure virtual network peering between them. You then test your configuration to make sure it meets your connectivity goals.</p>
<h3 id="learning-objectives_6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learning-objectives_6">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Identify use cases for virtual network peering.</li>
<li>Identify the features and limitations of virtual network peering.</li>
<li>Configure peering connections between virtual networks.</li>
</ul>
<h2 id="connect-services-by-using-virtual-network-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#connect-services-by-using-virtual-network-peering">Connect services by using virtual network peering</a></h2>
<p>You can use virtual network peering to directly connect Azure virtual networks together. When you use peering to connect virtual networks, virtual machines (VMs) in these networks can communicate with each other as if they're in the same network.</p>
<p>With peered virtual networks, traffic between virtual machines is routed through the Azure network. The traffic uses only private IP addresses. It doesn't rely on internet connectivity, gateways, or encrypted connections. The traffic is always private, and it takes advantage of the high bandwidth and low latency of the Azure backbone network.</p>
<p><img alt="A basic diagram of two virtual networks that are connected by virtual network peering." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/2-vnet-peering.svg" /></p>
<p>The two types of peering connections are created in the same way:</p>
<ul>
<li><strong>Virtual network peering</strong> connects virtual networks in the same Azure region, such as two virtual networks in North Europe.</li>
<li><strong>Global virtual network peering</strong> connects virtual networks that are in different Azure regions, such as a virtual network in North Europe and a virtual network in West Europe.</li>
</ul>
<p>Virtual network peering doesn't affect or disrupt any resources that are already deployed to your virtual networks. When you use virtual network peering, consider the key features defined in the following sections.</p>
<h3 id="reciprocal-connections"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#reciprocal-connections">Reciprocal connections</a></h3>
<p>When you create a virtual network peering connection with Azure PowerShell or Azure CLI, only one side of the peering gets created. To complete the virtual network peering configuration, you need to configure the peering in the reverse direction to establish connectivity. When you create the virtual network peering connection through the Azure portal, the configuration for both sides is completed at the same time.</p>
<p>Think of how you connect two network switches together. You might connect a cable to each switch and maybe configure some settings so that the switches can communicate. Virtual network peering requires similar connections in each virtual network. Reciprocal connections provide this functionality.</p>
<h3 id="cross-subscription-virtual-network-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#cross-subscription-virtual-network-peering">Cross-subscription virtual network peering</a></h3>
<p>You can use virtual network peering even when both virtual networks are in different subscriptions. This setup might be necessary for mergers and acquisitions, or to connect virtual networks in subscriptions that different departments manage. Virtual networks can be in different subscriptions, and the subscriptions can use the same or different Microsoft Entra tenants.</p>
<p>When you use virtual network peering across subscriptions, you might find that an administrator of one subscription doesn't administer the peer network's subscription. The administrator might not be able to configure both ends of the connection. To peer the virtual networks when both subscriptions are in different Microsoft Entra tenants, the administrators of each subscription must grant the peer subscription's administrator the <code>Network Contributor</code> role on their virtual network.</p>
<h3 id="transitivity"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#transitivity">Transitivity</a></h3>
<p>Virtual network peering is nontransitive. Only virtual networks that are directly peered can communicate with each other. Virtual networks can't communicate with peers of their peers.</p>
<p>Suppose, for example, that your three virtual networks (A, B, C) are peered like this: A &lt;-&gt; B &lt;-&gt; C. Resources in A can't communicate with resources in C because that traffic can't transit through virtual network B. If you need communication between virtual network A and virtual network C, you must explicitly peer these two virtual networks.</p>
<h3 id="gateway-transit"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#gateway-transit">Gateway transit</a></h3>
<p>You can connect to your on-premises network from a peered virtual network if you enable gateway transit from a virtual network that has a VPN gateway. Using gateway transit, you can enable on-premises connectivity without deploying virtual network gateways to all your virtual networks. This method can reduce the overall cost and complexity of your network. By using virtual network peering with gateway transit, you can configure a single virtual network as a hub network. Connect this hub network to your on-premises datacenter and share its virtual network gateway with peers.</p>
<p>To enable gateway transit, configure the <strong>Allow gateway transit</strong> option in the hub virtual network where the gateway connection to your on-premises network is deployed. Also configure the <strong>Use remote gateways</strong> option in any spoke virtual networks.</p>
<p>Note</p>
<p>If you want to enable the <strong>Use remote gateways</strong> option in a spoke network peering, you can't deploy a virtual network gateway in the spoke virtual network.</p>
<h3 id="overlapping-address-spaces"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#overlapping-address-spaces">Overlapping address spaces</a></h3>
<p>IP address spaces of connected networks within Azure and between Azure and your on-premises network, can't overlap. This rule is also true for peered virtual networks. Keep this rule in mind when you're planning your network design. In any networks you connect through virtual network peering, VPN, or ExpressRoute, assign different address spaces that don't overlap.</p>
<p><img alt="Diagram of a comparison of overlapping and nonoverlapping network addressing." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/2-non-overlapping-networks.svg" /></p>
<h3 id="alternative-connectivity-methods"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#alternative-connectivity-methods">Alternative connectivity methods</a></h3>
<p>Virtual network peering is the least complex way to connect virtual networks together. Other methods focus primarily on connectivity between on-premises and Azure networks rather than connections between virtual networks.</p>
<p>You can also connect virtual networks together through an ExpressRoute circuit. ExpressRoute is a dedicated, private connection between an on-premises datacenter and the Azure backbone network. The virtual networks that connect to an ExpressRoute circuit are part of the same routing domain and can communicate with each other. ExpressRoute connections don't go over the public internet, so your communications with Azure services are as secure as possible.</p>
<p>VPNs use the internet to connect your on-premises datacenter to the Azure backbone through an encrypted tunnel. You can use a site-to-site configuration to connect virtual networks together through VPN gateways. VPN gateways have higher latency than virtual network peering setups. They're more complex and can cost more to manage.</p>
<p>When virtual networks are connected through both a gateway and virtual network peering, traffic flows through the peering configuration.</p>
<h3 id="when-to-choose-virtual-network-peering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#when-to-choose-virtual-network-peering">When to choose virtual network peering</a></h3>
<p>Virtual network peering can be a great way to enable network connectivity between services that are in different virtual networks. Virtual network peering should be your first choice when you need to integrate Azure virtual networks. It's easy to implement and deploy, and it works well across regions and subscriptions.</p>
<p>Peering might not be your best option if you have <a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview#service-chaining">existing VPN or ExpressRoute</a> connections or services behind Azure Basic Load Balancers that would be accessed from a peered virtual network. In these cases, you should research alternatives.</p>
<h2 id="exercise-prepare-virtual-networks-for-peering-by-using-azure-cli-commands"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#exercise-prepare-virtual-networks-for-peering-by-using-azure-cli-commands">Exercise - Prepare virtual networks for peering by using Azure CLI commands</a></h2>
<p>Let's say your company is now ready to implement virtual network peering. You want to connect systems that are deployed in different virtual networks. To test this plan, you start by creating virtual networks to support the services your company is already running in Azure. You need three virtual networks:</p>
<ul>
<li>The <strong>Sales</strong> virtual network is deployed in <strong>North Europe</strong>. Sales systems use this virtual network to process the data added after a customer is engaged. The Sales team wants access to Marketing data.</li>
<li>The <strong>Marketing</strong> virtual network is deployed in <strong>North Europe</strong>. Marketing systems use this virtual network. Members of the Marketing team regularly chat with the Sales team. To share their data with the Sales team, they must download it because the Sales and Marketing systems aren't connected.</li>
<li>The <strong>Research</strong> virtual network is deployed in <strong>West Europe</strong>. Research systems use this virtual network. Members of the Research team have a logical working relationship with Marketing, but they don't want the Sales team to have direct access to their data.</li>
</ul>
<p><img alt="A diagram of virtual networks you need to create." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/3-prepare-vnets.svg" /></p>
<p>You're going to create the following resources:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Virtual network</th>
<th>Region</th>
<th>Virtual network address space</th>
<th>Subnet</th>
<th>Subnet address space</th>
</tr>
</thead>
<tbody>
<tr>
<td>SalesVNet</td>
<td>North Europe</td>
<td>10.1.0.0/16</td>
<td>Apps</td>
<td>10.1.1.0/24</td>
</tr>
<tr>
<td>MarketingVNet</td>
<td>North Europe</td>
<td>10.2.0.0/16</td>
<td>Apps</td>
<td>10.2.1.0/24</td>
</tr>
<tr>
<td>ResearchVNet</td>
<td>West Europe</td>
<td>10.3.0.0/16</td>
<td>Data</td>
<td>10.3.1.0/24</td>
</tr>
</tbody>
</table>
<h3 id="create-the-virtual-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-the-virtual-networks">Create the virtual networks</a></h3>
<ol>
<li>
<p>In Cloud Shell, run the following command to create the virtual network and subnet for the <strong>Sales</strong> systems:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name SalesVNet \
    --address-prefixes 10.1.0.0/16 \
    --subnet-name Apps \
    --subnet-prefixes 10.1.1.0/24 \
    --location northeurope
</code></pre></div>
</li>
<li>
<p>Run the following command to create the virtual network and subnet for the <strong>Marketing</strong> systems:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name MarketingVNet \
    --address-prefixes 10.2.0.0/16 \
    --subnet-name Apps \
    --subnet-prefixes 10.2.1.0/24 \
    --location northeurope
</code></pre></div>
</li>
<li>
<p>Run the following command to create the virtual network and subnet for the <strong>Research</strong> systems:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name ResearchVNet \
    --address-prefixes 10.3.0.0/16 \
    --subnet-name Data \
    --subnet-prefixes 10.3.1.0/24 \
    --location westeurope
</code></pre></div>
</li>
</ol>
<h3 id="confirm-the-virtual-network-configuration"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#confirm-the-virtual-network-configuration">Confirm the virtual network configuration</a></h3>
<p>Let's take a quick look at what you created.</p>
<ol>
<li>
<p>View the virtual networks you've created by running the following command in Cloud Shell:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet list --query &quot;[?contains(provisioningState, &#39;Succeeded&#39;)]&quot; --output table
</code></pre></div>
</li>
<li>
<p>Your output should look like this example:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Location     Name           EnableDdosProtection    ProvisioningState    ResourceGuid                          ResourceGroup
-----------  -------------  ----------------------  -------------------  ------------------------------------  ------------------------------------------
westeurope   ResearchVNet   False                   Succeeded            9fe09fe0-d6cd-4043-aba8-b5e850a91251  learn-cb081b92-bc67-49cf-a965-1aeb40a2e25c
northeurope  SalesVNet      False                   Succeeded            8f030706-cce4-4a7b-8da2-a9f738887ffd  learn-cb081b92-bc67-49cf-a965-1aeb40a2e25c
northeurope  MarketingVNet  False                   Succeeded            ffbf8430-b0eb-4c3d-aa94-3b3156b90bed  learn-cb081b92-bc67-49cf-a965-1aeb40a2e25c
</code></pre></div>
</li>
</ol>
<h3 id="create-virtual-machines-in-each-virtual-network"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-virtual-machines-in-each-virtual-network">Create virtual machines in each virtual network</a></h3>
<p>Now, you deploy some Ubuntu virtual machines (VMs) in each of the virtual networks. These VMs simulate the services in each virtual network. In the final unit of this module, you use these VMs to test connectivity between the virtual networks.</p>
<ol>
<li>
<p>In Cloud Shell, run the following command, replacing <code>&lt;password&gt;</code> with a password that meets the <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/linux/faq#what-are-the-password-requirements-when-creating-a-vm">requirements for Linux VMs</a>, to create an Ubuntu virtual machine (VM) in the <strong>Apps</strong> subnet of <strong>SalesVNet</strong>. Note this password for later use.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --no-wait \
    --name SalesVM \
    --location northeurope \
    --vnet-name SalesVNet \
    --subnet Apps \
    --image Ubuntu2204 \
    --admin-username azureuser \
    --admin-password &lt;password&gt;
</code></pre></div>
<p>Note</p>
<p>The <code>--no-wait</code> parameter in this command lets you continue working in Cloud Shell while the VM is building.</p>
</li>
<li>
<p>Run the following command, replacing <code>&lt;password&gt;</code> with a password that meets the <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/linux/faq#what-are-the-password-requirements-when-creating-a-vm">requirements for Linux VMs</a>, to create another Ubuntu VM in the <strong>Apps</strong> subnet of <strong>MarketingVNet</strong>. Note this password for later use. The VM might take a minute or two to be created.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --no-wait \
    --name MarketingVM \
    --location northeurope \
    --vnet-name MarketingVNet \
    --subnet Apps \
    --image Ubuntu2204 \
    --admin-username azureuser \
    --admin-password &lt;password&gt;
</code></pre></div>
</li>
<li>
<p>Run the following command, replacing <code>&lt;password&gt;</code> with a password that meets the <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/linux/faq#what-are-the-password-requirements-when-creating-a-vm">requirements for Linux VMs</a>, to create an Ubuntu VM in the <strong>Data</strong> subnet of <strong>ResearchVNet</strong>. Note this password for later use.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --no-wait \
    --name ResearchVM \
    --location westeurope \
    --vnet-name ResearchVNet \
    --subnet Data \
    --image Ubuntu2204 \
    --admin-username azureuser \
    --admin-password &lt;password&gt;
</code></pre></div>
<p>The VMs might take several minutes to reach a running state.</p>
</li>
<li>
<p>To confirm that the VMs are running, run the following command. The Linux <code>watch</code> command is configured to refresh every five seconds.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>watch -d -n 5 &quot;az vm list \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --show-details \
    --query &#39;[*].{Name:name, ProvisioningState:provisioningState, PowerState:powerState}&#39; \
    --output table&quot;
</code></pre></div>
<p>A <strong>ProvisioningState</strong> of <strong>Succeeded</strong> and a <strong>PowerState</strong> of <strong>VM running</strong> indicates a successful deployment for the VM.</p>
</li>
<li>
<p>When your VMs are running, you're ready to move on. Press <code>Ctrl-c</code> to stop the command and continue on with the exercise.</p>
</li>
</ol>
<h2 id="exercise-configure-virtual-network-peering-connections-by-using-azure-cli-commands"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#exercise-configure-virtual-network-peering-connections-by-using-azure-cli-commands">Exercise - Configure virtual network peering connections by using Azure CLI commands</a></h2>
<p>You created virtual networks and ran virtual machines (VMs) within them. However, the virtual networks have no connectivity, and none of these systems can communicate with each other.</p>
<p>To enable communication, you need to create peering connections for the virtual networks. To satisfy your company's requirements, you configure a hub and spoke topology and permit virtual network access when you create the peering connections.</p>
<h3 id="create-virtual-network-peering-connections"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-virtual-network-peering-connections">Create virtual network peering connections</a></h3>
<p>Follow these steps to create connections between the virtual networks and to configure the behavior of each connection.</p>
<ol>
<li>
<p>In Cloud Shell, run the following command to create the peering connection between the <strong>SalesVNet</strong> and <strong>MarketingVNet</strong> virtual networks. This command also permits virtual network access across this peering connection.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet peering create \
    --name SalesVNet-To-MarketingVNet \
    --remote-vnet MarketingVNet \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --vnet-name SalesVNet \
    --allow-vnet-access
</code></pre></div>
</li>
<li>
<p>Run the following command to create a reciprocal connection from <strong>MarketingVNet</strong> to <strong>SalesVNet</strong>. This step completes the connection between these virtual networks.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet peering create \
    --name MarketingVNet-To-SalesVNet \
    --remote-vnet SalesVNet \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --vnet-name MarketingVNet \
    --allow-vnet-access
</code></pre></div>
</li>
</ol>
<p>Now that you have connections between Sales and Marketing, create connections between Marketing and Research.</p>
<ol>
<li>
<p>In Cloud Shell, run the following command to create the peering connection between the <strong>MarketingVNet</strong> and <strong>ResearchVNet</strong> virtual networks:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet peering create \
    --name MarketingVNet-To-ResearchVNet \
    --remote-vnet ResearchVNet \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --vnet-name MarketingVNet \
    --allow-vnet-access
</code></pre></div>
</li>
<li>
<p>Run the following command to create the reciprocal connection between <strong>ResearchVNet</strong> and <strong>MarketingVNet</strong>:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet peering create \
    --name ResearchVNet-To-MarketingVNet \
    --remote-vnet MarketingVNet \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --vnet-name ResearchVNet \
    --allow-vnet-access
</code></pre></div>
</li>
</ol>
<h3 id="check-the-virtual-network-peering-connections"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#check-the-virtual-network-peering-connections">Check the virtual network peering connections</a></h3>
<p>Now that the peering connections between the virtual networks are created, make sure the connections work.</p>
<ol>
<li>
<p>In Cloud Shell, run the following command to check the connection between <strong>SalesVNet</strong> and <strong>MarketingVNet</strong>:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet peering list \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --vnet-name SalesVNet \
    --query &quot;[].{Name:name, Resource:resourceGroup, PeeringState:peeringState, AllowVnetAccess:allowVirtualNetworkAccess}&quot;\
    --output table
</code></pre></div>
</li>
<li>
<p>You created only one connection from <strong>SalesVNet</strong>, so you get only one result. In the <strong>PeeringState</strong> column, make sure the status is <strong>Connected</strong>.</p>
</li>
<li>
<p>Run the following command to check the peering connection between the <strong>ResearchVNet</strong> and <strong>MarketingVNet</strong> virtual networks:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet peering list \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --vnet-name ResearchVNet \
    --query &quot;[].{Name:name, Resource:resourceGroup, PeeringState:peeringState, AllowVnetAccess:allowVirtualNetworkAccess}&quot;\
    --output table
</code></pre></div>
</li>
<li>
<p>Again, you created only one connection from <strong>ResearchVNet</strong>, so you get only one result. In the <strong>PeeringState</strong> column, make sure the status is <strong>Connected</strong>.</p>
</li>
<li>
<p>Run the following command to check the peering connections for the <strong>MarketingVNet</strong> virtual network.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network vnet peering list \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --vnet-name MarketingVNet \
    --query &quot;[].{Name:name, Resource:resourceGroup, PeeringState:peeringState, AllowVnetAccess:allowVirtualNetworkAccess}&quot;\
    --output table
</code></pre></div>
<p>Remember that you created connections from Marketing to Sales and from Marketing to Research, so you should get two connections. In the <strong>PeeringState</strong> column, make sure the status of both connections is <strong>Connected</strong>.</p>
</li>
</ol>
<p>Your peering connections between the virtual networks should now look like this diagram:</p>
<p><img alt="Diagram of the resulting virtual network peering connections." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/4-vnet-peering-configure-connections-result.svg" /></p>
<h3 id="check-effective-routes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#check-effective-routes">Check effective routes</a></h3>
<p>You can further check the peering connection by looking at the routes that apply to the network interfaces of the VMs.</p>
<ol>
<li>
<p>Run the following command to look at the routes that apply to the <strong>SalesVM</strong> network interface:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network nic show-effective-route-table \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name SalesVMVMNic \
    --output table
</code></pre></div>
<p>The output table shows the effective routes for the virtual machine's network interface. For <strong>SalesVMVMNic</strong>, you should have a route to <strong>10.2.0.0/16</strong> with <em>Next Hop Type</em> of <strong>VNetPeering</strong>. This network route is for the peering connection from <strong>SalesVNet</strong> to <strong>MarketingVNet</strong>.</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Source    State    Address Prefix    Next Hop Type    Next Hop IP
--------  -------  ----------------  ---------------  -------------
Default   Active   10.1.0.0/16       VnetLocal
Default   Active   10.2.0.0/16       VNetPeering
Default   Active   0.0.0.0/0         Internet
Default   Active   10.0.0.0/8        None
Default   Active   100.64.0.0/10     None
Default   Active   192.168.0.0/16    None
</code></pre></div>
</li>
<li>
<p>Run the following command to look at the routes for <strong>MarketingVM</strong>:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network nic show-effective-route-table \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name MarketingVMVMNic \
    --output table
</code></pre></div>
<p>The output table shows the effective routes for the virtual machine's network interface. For <strong>MarketingVMVMNic</strong>, you should have a route to <strong>10.1.0.0/16</strong> with a next hop type of <strong>VNetPeering</strong> and a route to <strong>10.3.0.0/16</strong> with a next hop type of <strong>VNetGlobalPeering</strong>. These network routes are for the peering connection from <strong>MarketingVNet</strong> to <strong>SalesVNet</strong> and from <strong>MarketingVNet</strong> to <strong>ResearchVNet</strong>.</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Source    State    Address Prefix    Next Hop Type      Next Hop IP
--------  -------  ----------------  -----------------  -------------
Default   Active   10.2.0.0/16       VnetLocal
Default   Active   10.1.0.0/16       VNetPeering
Default   Active   0.0.0.0/0         Internet
Default   Active   10.0.0.0/8        None
Default   Active   100.64.0.0/10     None
Default   Active   192.168.0.0/16    None
Default   Active   10.3.0.0/16       VNetGlobalPeering
</code></pre></div>
</li>
<li>
<p>Run the following command to look at the routes for <strong>ResearchVM</strong>:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network nic show-effective-route-table \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name ResearchVMVMNic \
    --output table
</code></pre></div>
<p>The output table shows the effective routes for the virtual machine's network interface. For <strong>ResearchVMVMNic</strong>, you should have a route to <strong>10.2.0.0/16</strong> with a next hop type of <strong>VNetGlobalPeering</strong>. This network route is for the peering connection from <strong>ResearchVNet</strong> to <strong>MarketingVNet</strong>.</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Source    State    Address Prefix    Next Hop Type      Next Hop IP
--------  -------  ----------------  -----------------  -------------
Default   Active   10.3.0.0/16       VnetLocal
Default   Active   0.0.0.0/0         Internet
Default   Active   10.0.0.0/8        None
Default   Active   100.64.0.0/10     None
Default   Active   192.168.0.0/16    None
Default   Active   10.2.0.0/16       VNetGlobalPeering
</code></pre></div>
</li>
</ol>
<p>Now that your peering connections are configured, let's take a look at how these connections affect the communication between VMs.</p>
<h2 id="exercise-verify-virtual-network-peering-by-using-ssh-between-azure-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#exercise-verify-virtual-network-peering-by-using-ssh-between-azure-virtual-machines">Exercise - Verify virtual network peering by using SSH between Azure virtual machines</a></h2>
<p>In the previous unit, you configured peering connections between the virtual networks to enable resources to communicate with each other. Your configuration used a hub and spoke topology. <strong>MarketingVNet</strong> was the hub, and <strong>SalesVNet</strong> and <strong>ResearchVNet</strong> were spokes.</p>
<p><img alt="Diagram of a hub and spoke topology for virtual networks." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/5-hub-spoke-network.svg" /></p>
<p>Remember, peering connections are nontransitive. Intermediate virtual networks don't allow connectivity to flow through them to connected virtual networks. <strong>SalesVNet</strong> can communicate with <strong>MarketingVNet</strong>. <strong>ResearchVNet</strong> can communicate with <strong>MarketingVNet</strong>. <strong>MarketingVNet</strong> can communicate with both <strong>SalesVNet</strong> and <strong>ResearchVNet</strong>. The only communication that isn't permitted is between <strong>SalesVNet</strong> and <strong>ResearchVNet</strong>. Even though <strong>SalesVNet</strong> and <strong>ResearchVNet</strong> are both connected to <strong>MarketingVNet</strong>, they can't communicate with each other because they're not directly peered to each other.</p>
<p>Let's confirm the connectivity across the peering connections. First, you create a connection from Azure Cloud Shell to the <em>public</em> IP address of a target virtual machine (VM). Then you connect from the target VM to the destination VM by using the destination VM's <em>private</em> IP address.</p>
<p>Important</p>
<p>To test the virtual network peering connection, connect to the private IP address assigned to each VM.</p>
<ol>
<li>
<p>Connect to your VMs by using SSH (Secure Shell) directly from Cloud Shell. When using SSH, you first find the public IP addresses that are assigned to your test VMs.</p>
</li>
<li>
<p>Run the following command in Cloud Shell to list the IP addresses you use to connect to the VMs:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm list \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --query &quot;[*].{Name:name, PrivateIP:privateIps, PublicIP:publicIps}&quot; \
    --show-details \
    --output table
</code></pre></div>
</li>
<li>
<p>Record the output. You need the IP addresses for the exercises in this unit.</p>
</li>
</ol>
<p>Before you start the tests, think about what you learned in this module. What results do you expect? Which VMs are able to communicate with each other, and which ones aren't?</p>
<h3 id="test-connections-from-salesvm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#test-connections-from-salesvm">Test connections from SalesVM</a></h3>
<p>In the first test, you use SSH in Cloud Shell to connect to the public IP address of <strong>SalesVM</strong>. You then attempt to connect from <strong>SalesVM</strong> to <strong>MarketingVM</strong> and <strong>ResearchVM</strong>.</p>
<ol>
<li>
<p>In Cloud Shell, run the following command, using SSH to connect to the public IP address of <strong>SalesVM</strong>. In the command, replace <code>&lt;SalesVM public IP&gt;</code> with the VM's <em>public</em> IP address.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -o StrictHostKeyChecking=no azureuser@&lt;SalesVM public IP&gt;
</code></pre></div>
<p><img alt="A diagram showing connection to the public IP address of SalesVM." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/5-sales-step-1.svg" /></p>
</li>
<li>
<p>Sign in with the password that you used to create the VM. The prompt now shows that you're signed in to <strong>SalesVM</strong>.</p>
</li>
<li>
<p>In Cloud Shell, run the following command, using SSH to connect to the private IP address of <strong>MarketingVM</strong>. In the command, replace <code>&lt;MarketingVM private IP&gt;</code> with this VM's <em>private</em> IP address.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -o StrictHostKeyChecking=no azureuser@&lt;MarketingVM private IP&gt;
</code></pre></div>
<p><img alt="Diagram showing connection from SalesVM to the private IP address of MarketingVM." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/5-sales-step-5.svg" /></p>
<p>The connection attempt should succeed because of the peering connection between the <strong>SalesVNet</strong> and <strong>MarketingVNet</strong> virtual networks.</p>
</li>
<li>
<p>Sign in by using the password you used to create the VM.</p>
</li>
<li>
<p>Enter <code>exit</code> to close this SSH session and return to the <strong>SalesVM</strong> prompt.</p>
</li>
<li>
<p>In Cloud Shell, run the following command, using SSH to connect to the private IP address of <strong>ResearchVM</strong>. In the command, replace <code>&lt;ResearchVM private IP&gt;</code> with this VM's <em>private</em> IP address.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -o StrictHostKeyChecking=no azureuser@&lt;ResearchVM private IP&gt;
</code></pre></div>
</li>
<li>
<p>The connection attempt should fail because there's no peering connection between the <strong>SalesVNet</strong> and <strong>ResearchVNet</strong> virtual networks. Up to 60 seconds might pass before the connection attempt times out. To force the attempt to stop, use Ctrl+C.</p>
<p><img alt="Diagram showing the attempt failing to connect from SalesVM to the private IP address of ResearchVM." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/5-sales-step-9.svg" /></p>
</li>
<li>
<p>Enter <code>exit</code> to close the SSH session and return to Cloud Shell.</p>
</li>
</ol>
<h3 id="test-connections-from-researchvm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#test-connections-from-researchvm">Test connections from ResearchVM</a></h3>
<p>In the second test, you use SSH in Cloud Shell to connect to the public IP address of <strong>ResearchVM</strong>. Then, you attempt to connect from <strong>ResearchVM</strong> to <strong>MarketingVM</strong> and <strong>SalesVM</strong>.</p>
<ol>
<li>
<p>In Cloud Shell, run the following command, using SSH to connect to the public IP address of <strong>ResearchVM</strong>. In the command, replace <code>&lt;ResearchVM public IP&gt;</code> with this VM's <em>public</em> IP address.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -o StrictHostKeyChecking=no azureuser@&lt;ResearchVM public IP&gt;
</code></pre></div>
<p><img alt="Diagram showing connection to the public IP address of ResearchVM." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/5-research-step-1.svg" /></p>
</li>
<li>
<p>Sign in by using the password that you used to create the VM. The prompt now shows that you're signed in to <strong>ResearchVM</strong>.</p>
</li>
<li>
<p>In Cloud Shell, run the following command, using SSH to connect to the private IP address of <strong>MarketingVM</strong>. In the command, replace <code>&lt;MarketingVM private IP&gt;</code> with this VM's <em>private</em> IP address.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -o StrictHostKeyChecking=no azureuser@&lt;MarketingVM private IP&gt;
</code></pre></div>
<p><img alt="Diagram showing connection to the private IP address of MarketingVM." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/5-research-step-5.svg" /></p>
<p>The connection attempt should succeed because of the peering connection between the <strong>ResearchVNet</strong> and <strong>MarketingVNet</strong> virtual networks.</p>
</li>
<li>
<p>Sign in by using the password you used to create the VM.</p>
</li>
<li>
<p>Enter <code>exit</code> to close this SSH session and return to the <strong>ResearchVM</strong> prompt.</p>
</li>
<li>
<p>In Cloud Shell, run the following command, using SSH to connect to the private IP address of <strong>SalesVM</strong>. In the command, replace <code>&lt;SalesVM private IP&gt;</code> with this VM's <em>private</em> IP address.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -o StrictHostKeyChecking=no azureuser@&lt;SalesVM private IP&gt;
</code></pre></div>
</li>
<li>
<p>The connection attempt should fail because there's no peering connection between the <strong>ResearchVNet</strong> and <strong>SalesVNet</strong> virtual networks. Up to 60 seconds might pass before the connection attempt times out. To force the attempt to stop, use Ctrl+C.</p>
<p><img alt="Diagram showing the attempt failing to connect ResearchVM to the private IP address of SalesVM." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/5-research-step-9.svg" /></p>
</li>
<li>
<p>Enter <code>exit</code> to close the SSH session and return to Cloud Shell.</p>
</li>
</ol>
<h3 id="test-connections-from-marketing-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#test-connections-from-marketing-vm">Test connections from Marketing VM</a></h3>
<p>In the final test, you use SSH in Cloud Shell to connect to the public IP address of <strong>MarketingVM</strong>. You then attempt to connect from <strong>MarketingVM</strong> to <strong>ResearchVM</strong> and <strong>SalesVM</strong>.</p>
<ol>
<li>
<p>In Cloud Shell, run the following command, using SSH to connect to the public IP address of <strong>MarketingVM</strong>. In the command, replace <code>&lt;MarketingVM public IP&gt;</code> with this VM's <em>public</em> IP address.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -o StrictHostKeyChecking=no azureuser@&lt;MarketingVM public IP&gt;
</code></pre></div>
<p><img alt="Diagram that shows connection to the public IP address of MarketingVM." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/5-marketing-step-1.svg" /></p>
</li>
<li>
<p>Sign in by using the password that you used to create the VM. The prompt shows that you're signed in to <strong>MarketingVM</strong>.</p>
</li>
<li>
<p>In Cloud Shell, run the following command, using SSH to connect to the private IP address of <strong>ResearchVM</strong>. In the command, replace <code>&lt;ResearchVM private IP&gt;</code> with this VM's <em>private</em> IP address.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -o StrictHostKeyChecking=no azureuser@&lt;ResearchVM private IP&gt;
</code></pre></div>
<p><img alt="Diagram that shows Azure Cloud Shell connecting to the MarketingVNet and the ResearchVNet virtual networks, using a peering connection." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/5-marketing-step-5.svg" /></p>
<p>The connection attempt should succeed because of the peering connection between the <strong>MarketingVNet</strong> and <strong>ResearchVNet</strong> virtual networks.</p>
</li>
<li>
<p>Sign in by using the password you used to create the VM.</p>
</li>
<li>
<p>Enter <code>exit</code> to close this SSH session, and return to the <strong>MarketingVM</strong> prompt.</p>
</li>
<li>
<p>In Cloud Shell, run the following command, using SSH to connect to the private IP address of <strong>SalesVM</strong>. In the command, replace <code>&lt;SalesVM private IP&gt;</code> with this VM's <em>private</em> IP address.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -o StrictHostKeyChecking=no azureuser@&lt;SalesVM private IP&gt;
</code></pre></div>
<p>This connection attempt should also succeed because of the peering connection between the <strong>MarketingVNet</strong> and <strong>SalesVNet</strong> virtual networks.</p>
<p><img alt="Diagram that shows Azure Cloud Shell connecting to the MarketingVNet and the SalesVNet virtual machines, using a peering connection." src="https://learn.microsoft.com/en-us/training/modules/integrate-vnets-with-vnet-peering/media/5-marketing-step-9.svg" /></p>
</li>
<li>
<p>Sign in by using the password you used to create the VM.</p>
</li>
<li>
<p>Enter <code>exit</code> to close this SSH session, and return to the <strong>MarketingVM</strong> prompt.</p>
</li>
<li>
<p>Enter <code>exit</code> to close the SSH session, and return to Cloud Shell.</p>
</li>
</ol>
<p>This simple test using SSH demonstrates network connectivity between peered virtual networks. It also demonstrates lack of network connectivity for transitive connections.</p>
<p>If these servers were running application services, the server connectivity would allow communication between the services running on the VMs. The connectivity would allow the business to share data across departments as required.</p>
<h2 id="summary_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#summary_1">Summary</a></h2>
<p>In this module, you learned how to use peering to connect virtual networks in a hub and spoke topology. You used VMs and SSH to verify connectivity between virtual networks. The peering connections enable communication for services that run on the VMs.</p>
<p>Now that you understand how to peer virtual networks together, you can use this secure and cost-effective method in your Azure network infrastructure. The method enables low-latency communication between resources in virtual networks. It supports scenarios where resources are in different regions or subscriptions. Virtual network peering should be your first choice when you need to connect virtual networks.</p>
<hr />
<h2 id="host-your-domain-on-azure-dns"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#host-your-domain-on-azure-dns">Host your domain on Azure DNS</a></h2>
<h2 id="introduction_8"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction_8">Introduction</a></h2>
<p>Azure DNS lets you host your Domain Name System (DNS) records for your domains on Azure infrastructure. With Azure DNS, you can use the same credentials, APIs, tools, and billing as your other Azure services.</p>
<p>Let's say that your company recently bought the custom domain name wideworldimporters.com from a third-party domain-name registrar. The domain name is for a new website that your organization plans to launch. You need a hosting service for DNS domains. This hosting service would resolve the wideworldimporters.com domain to your web server's IP address.</p>
<p>You're already using Azure to build your website, so you decide to use Azure DNS to manage your domain.</p>
<p>This module shows you how to configure Azure DNS to host your domain. You also see how to add an alias and other DNS records to resolve your domain name to a website.</p>
<h3 id="learning-objectives_7"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learning-objectives_7">Learning objectives</a></h3>
<p>In this module, you will:</p>
<ul>
<li>Configure Azure DNS to host your domain.</li>
</ul>
<h3 id="prerequisites_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#prerequisites_5">Prerequisites</a></h3>
<ul>
<li>Knowledge of networking concepts like name resolution and IP addresses.</li>
</ul>
<h2 id="what-is-azure-dns"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#what-is-azure-dns">What is Azure DNS?</a></h2>
<p>Azure DNS is a hosting service for Domain Name System (DNS) domains that provides name resolution by using Microsoft Azure infrastructure.</p>
<p>In this unit, you learn what DNS is and how it works. You also learn about Azure DNS and why you'd use it.</p>
<h3 id="what-is-dns"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#what-is-dns">What is DNS?</a></h3>
<p>DNS, or the Domain Name System, is a protocol within the TCP/IP standard. DNS serves an essential role of translating the human-readable domain names—for example: <code>www.wideworldimports.com</code>—into a known IP address. IP addresses enable computers and network devices to identify and route requests among themselves.</p>
<p>DNS uses a global directory hosted on servers around the world. Microsoft is part of the network that provides a DNS service through Azure DNS.</p>
<p>A DNS server is also known as a DNS name server, or just a name server.</p>
<h3 id="how-does-dns-work"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#how-does-dns-work">How does DNS work?</a></h3>
<p>A DNS server carries out one of two primary functions:</p>
<ul>
<li>Maintains a local cache of recently accessed or used domain names and their IP addresses. This cache provides a faster response to a local domain lookup request. If the DNS server can't find the requested domain, it passes the request to another DNS server. This process repeats at each DNS server until either a match is made or the search times out.</li>
<li>Maintains the key-value pair database of IP addresses and any host or subdomain over which the DNS server has authority. This function is often associated with mail, web, and other internet domain services.</li>
</ul>
<h4 id="dns-server-assignment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#dns-server-assignment">DNS server assignment</a></h4>
<p>In order for a computer, server, or other network-enabled device to access web-based resources, it must reference a DNS server.</p>
<p>When you connect by using your on-premises network, the DNS settings come from your server. When you connect by using an external location like a hotel, the DNS settings come from the internet service provider (ISP).</p>
<h4 id="domain-lookup-requests"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#domain-lookup-requests">Domain lookup requests</a></h4>
<p>Here's a simplified overview of the process a DNS server uses when it resolves a domain-name lookup request:</p>
<ul>
<li>If the domain name is stored in the short-term cache, the DNS server resolves the domain request.</li>
<li>If the domain isn't in the cache, it contacts one or more DNS servers on the web to see if they have a match. When a match is found, the DNS server updates the local cache and resolves the request.</li>
<li>If the domain isn't found after a reasonable number of DNS checks, the DNS server responds with a <em>domain cannot be found</em> error.</li>
</ul>
<h4 id="ipv4-and-ipv6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#ipv4-and-ipv6">IPv4 and IPv6</a></h4>
<p>Every computer, server, or network-enabled device on your network has an IP address. An IP address is unique within your domain. There are two standards of IP address: IPv4 and IPv6.</p>
<ul>
<li>
<p><strong>IPv4</strong> is composed of four sets of numbers, in the range 0 to 255, each separated by a dot; for example: 127.0.0.1. Today, IPv4 is the most commonly used standard. Yet, with the increase in IoT devices, the IPv4 standard will eventually be unable to keep up.</p>
</li>
<li>
<p><strong>IPv6</strong> is a relatively new standard and is intended to eventually replace IPv4. It consists of eight groups of hexadecimal numbers, each separated by a colon; for example: fe80:11a1:ac15:e9gf:e884:edb0:ddee:fea3.</p>
</li>
</ul>
<p>Many network devices are now provisioned with both an IPv4 and an IPv6 address. The DNS name server can resolve domain names to both IPv4 and IPv6 addresses.</p>
<h4 id="dns-settings-for-your-domain"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#dns-settings-for-your-domain">DNS settings for your domain</a></h4>
<p>Whether a third-party host your DNS server or you manage it in-house, you need to configure it for each host type you're using. Host types include web, email, or other services you're using.</p>
<p>As the administrator for your company, you want to set up a DNS server by using Azure DNS. In this instance, the DNS server acts as a start of authority (SOA) for your domain.</p>
<h4 id="dns-record-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#dns-record-types">DNS record types</a></h4>
<p>Configuration information for your DNS server is stored as a file within a zone on your DNS server. Each file is called a record. The following record types are the most commonly created and used:</p>
<ul>
<li><strong>A</strong> is the host record, and is the most common type of DNS record. It maps the domain or host name to the IP address.</li>
<li><strong>CNAME</strong> is a Canonical Name record that's used to create an alias from one domain name to another domain name. If you had different domain names that all accessed the same website, you'd use CNAME.</li>
<li><strong>MX</strong> is the mail exchange record. It maps mail requests to your mail server, whether hosted on-premises or in the cloud.</li>
<li><strong>TXT</strong> is the text record. It's used to associate text strings with a domain name. Azure and Microsoft 365 use TXT records to verify domain ownership.</li>
</ul>
<p>Additionally, there are the following record types:</p>
<ul>
<li>Wildcards</li>
<li>CAA (certificate authority)</li>
<li>NS (name server)</li>
<li>SOA (start of authority)</li>
<li>SPF (sender policy framework)</li>
<li>SRV (server locations)</li>
</ul>
<p>The SOA and NS records are created automatically when you create a DNS zone by using Azure DNS.</p>
<h4 id="record-sets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#record-sets">Record sets</a></h4>
<p>Some record types support the concept of record sets, or resource record sets. A record set allows for multiple resources to be defined in a single record. For example, here's an A record that has one domain with two IP addresses:</p>
<p>Copy</p>
<div class="highlight"><pre><span></span><code>www.wideworldimports.com.     3600    IN    A    127.0.0.1
www.wideworldimports.com.     3600    IN    A    127.0.0.2
</code></pre></div>
<p>SOA and CNAME records can't contain record sets.</p>
<h3 id="what-is-azure-dns_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#what-is-azure-dns_1">What is Azure DNS?</a></h3>
<p>Azure DNS allows you to host and manage your domains by using a globally distributed name-server infrastructure. It allows you to manage all of your domains by using your existing Azure credentials.</p>
<p>Azure DNS acts as the SOA for the domain.</p>
<p>You can't use Azure DNS to register a domain name; you need to register it by using a third-party domain registrar.</p>
<h3 id="why-use-azure-dns-to-host-your-domain"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#why-use-azure-dns-to-host-your-domain">Why use Azure DNS to host your domain?</a></h3>
<p>Azure DNS is built on the Azure Resource Manager service, which offers the following benefits:</p>
<ul>
<li>Improved security</li>
<li>Ease of use</li>
<li>Private DNS domains</li>
<li>Alias record sets</li>
</ul>
<p>At this time, Azure DNS doesn't support Domain Name System Security Extensions. If you require this security extension, you should host those portions of your domain with a third-party provider.</p>
<h4 id="security-features"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#security-features">Security features</a></h4>
<p>Azure DNS provides the following security features:</p>
<ul>
<li><strong>Role-based access control</strong>, which gives you fine-grained control over users' access to Azure resources. You can monitor their usage and control the resources and services to which they have access.</li>
<li><strong>Activity logs</strong>, which let you track changes to a resource and pinpoint where faults occurred.</li>
<li><strong>Resource locking</strong>, which gives you a greater level of control to restrict or remove access to resource groups, subscriptions, or any Azure resources.</li>
</ul>
<h4 id="ease-of-use"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#ease-of-use">Ease of use</a></h4>
<p>Azure DNS can manage DNS records for your Azure services and provide DNS for your external resources. Azure DNS uses the same Azure credentials, support contract, and billing as your other Azure services.</p>
<p>You can manage your domains and records by using the Azure portal, Azure PowerShell cmdlets, or the Azure CLI. Applications that require automated DNS management can integrate with the service by using the REST API and software development kit (SDKs).</p>
<h4 id="private-domains"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#private-domains">Private domains</a></h4>
<p>Azure DNS handles translating external domain names to IP addresses. Azure DNS lets you create private zones. These zones provide name resolution for virtual machines (VMs) within a virtual network and between virtual networks without having to create a custom DNS solution. Private zones allow you to use your own custom domain names rather than the Azure-provided names.</p>
<p>To publish a private DNS zone to your virtual network, you specify the list of virtual networks that are allowed to resolve records within the zone.</p>
<p>Private DNS zones have the following benefits:</p>
<ul>
<li>DNS zones are supported as part of the Azure infrastructure, so there's no need to invest in a DNS solution.</li>
<li>All DNS record types are supported: A, CNAME, TXT, MX, SOA, AAAA, PTR, and SRV.</li>
<li>Host names for VMs in your virtual network are automatically maintained.</li>
<li>Split-horizon DNS support allows the same domain name to exist in both private and public zones. It resolves to the correct one based on the originating request location.</li>
</ul>
<h4 id="alias-record-sets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#alias-record-sets">Alias record sets</a></h4>
<p>Alias records sets can point to an Azure resource. For example, you can set up an alias record to direct traffic to an Azure public IP address, an Azure Traffic Manager profile, or an Azure Content Delivery Network endpoint.</p>
<p>The alias record set is supported in the following DNS record types:</p>
<ul>
<li>A</li>
<li>AAAA</li>
<li>CNAME</li>
</ul>
<h2 id="configure-azure-dns-to-host-your-domain"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-azure-dns-to-host-your-domain">Configure Azure DNS to host your domain</a></h2>
<p>The new company website is in final testing. You're working on the plan to deploy the wideworldimports.com domain by using Azure DNS. You need to understand what steps are involved.</p>
<p>In this unit, you learn how to:</p>
<ul>
<li>Create and configure a DNS zone for your domain by using Azure DNS.</li>
<li>Understand how to link your domain to an Azure DNS zone.</li>
<li>Create and configure a private DNS zone.</li>
</ul>
<h3 id="configure-a-public-dns-zone"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-a-public-dns-zone">Configure a public DNS zone</a></h3>
<p>You use a DNS zone to host the DNS records for a domain, such as wideworldimports.com.</p>
<h4 id="step-1-create-a-dns-zone-in-azure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#step-1-create-a-dns-zone-in-azure">Step 1: Create a DNS zone in Azure</a></h4>
<p>You used a third-party domain-name registrar to register the wideworldimports.com domain. The domain doesn't point to your organization's website yet.</p>
<p>To host the domain name with Azure DNS, you first need to create a DNS zone for that domain. A DNS zone holds all the DNS entries for your domain.</p>
<p>When creating a DNS zone, you need to supply the following details:</p>
<ul>
<li>
<p><strong>Subscription</strong>: The subscription to be used.</p>
</li>
<li>
<p><strong>Resource group</strong>: The name of the resource group to hold your domains. If one doesn't exist, create one to allow for better control and management.</p>
</li>
<li>
<p><strong>Name</strong>: Your domain name, which in this case is wideworldimports.com.</p>
</li>
<li>
<p><strong>Resource group location</strong>: The location defaults to the location of the resource group.</p>
<p><img alt="Screenshot of Create DNS zone page." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/3-create-dns-zone.png" /></p>
</li>
</ul>
<h4 id="step-2-get-your-azure-dns-name-servers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#step-2-get-your-azure-dns-name-servers">Step 2: Get your Azure DNS name servers</a></h4>
<p>After you create a DNS zone for the domain, you need to get the name server details from the name servers (NS) record. You use these details to update your domain registrar's information and point to the Azure DNS zone.</p>
<p><img alt="Screenshot of the name server details on the DNS zone page." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/3-name-server.png" /></p>
<h4 id="step-3-update-the-domain-registrar-setting"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#step-3-update-the-domain-registrar-setting">Step 3: Update the domain registrar setting</a></h4>
<p>As the domain owner, you need to sign in to the domain-management application provided by your domain registrar. In the management application, edit the NS record and change the NS details to match your Azure DNS name server details.</p>
<p>Changing the NS details is called <em>domain delegation</em>. When you delegate the domain, you must use all four name servers provided by Azure DNS.</p>
<h4 id="step-4-verify-delegation-of-domain-name-services"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#step-4-verify-delegation-of-domain-name-services">Step 4: Verify delegation of domain name services</a></h4>
<p>The next step is to verify that the delegated domain now points to the Azure DNS zone you created for the domain. This process can take as few as 10 minutes, but might take longer.</p>
<p>To verify the success of the domain delegation, query the start of authority (SOA) record. The SOA record is automatically created when the Azure DNS zone is set up. You can verify the SOA record using a tool like nslookup.</p>
<p>The SOA record represents your domain and becomes the reference point when other DNS servers are searching for your domain on the internet.</p>
<p>To verify the delegation, use nslookup like this:</p>
<p>dosCopy</p>
<div class="highlight"><pre><span></span><code>nslookup -type=SOA wideworldimports.com
</code></pre></div>
<h4 id="step-5-configure-your-custom-dns-settings"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#step-5-configure-your-custom-dns-settings">Step 5: Configure your custom DNS settings</a></h4>
<p>The domain name is wideworldimports.com. When it's used in a browser, the domain resolves to your website. But what if you want to add in web servers or load balancers? These resources need to have their own custom settings in the DNS zone, either as an A record or a CNAME.</p>
<h5 id="a-record"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#a-record">A record</a></h5>
<p>Each A record requires the following details:</p>
<ul>
<li><strong>Name</strong>: The name of the custom domain, for example <em>webserver1</em>.</li>
<li><strong>Type</strong>: In this instance, it's A.</li>
<li><strong>TTL</strong>: Represents the "time-to-live" as a whole unit, where 1 is one second. This value indicates how long the A record lives in a DNS cache before it expires.</li>
<li><strong>IP address</strong>: The IP address of the server to which this A record should resolve.</li>
</ul>
<h5 id="cname-record"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#cname-record">CNAME record</a></h5>
<p>The CNAME is the canonical name, or the alias for an A record. Use CNAME when you have different domain names that all access the same website. For example, you might need a CNAME in the <em>wideworldimports</em> zone if you want both www.wideworldimports.com and wideworldimports.com to resolve to the same IP address.</p>
<p>You'd create the CNAME record in the <em>wideworldimports</em> zone with the following information:</p>
<ul>
<li>NAME: www</li>
<li>TTL: 600 seconds</li>
<li>Record type: CNAME</li>
</ul>
<p>If you exposed a web function, you'd create a CNAME record that resolves to the Azure function.</p>
<h3 id="configure-a-private-dns-zone"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-a-private-dns-zone">Configure a private DNS zone</a></h3>
<p>Another type of DNS zone that you can configure and host in Azure is a private DNS zone. Private DNS zones aren't visible on the Internet, and don't require that you use a domain registrar. You can use private DNS zones to assign DNS names to virtual machines (VMs) in your Azure virtual networks.</p>
<h4 id="step-1-create-a-private-dns-zone"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#step-1-create-a-private-dns-zone">Step 1: Create a private DNS zone</a></h4>
<p>In the Azure portal, search for <em>private DNS zones</em>. To create the private zone, you need enter a resource group and the name of the zone. For example, the name might be something like private.wideworldimports.com.</p>
<p><img alt="Screenshot of the Create Private DNS zone page." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/3-create-private-dns-zone.png" /></p>
<h4 id="step-2-identify-virtual-networks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#step-2-identify-virtual-networks">Step 2: Identify virtual networks</a></h4>
<p>Let's assume that your organization already created your VMs and virtual networks in a production environment. Identify the virtual networks associated with VMs that need name-resolution support. To link the virtual networks to the private zone, you need the virtual network names.</p>
<h4 id="step-3-link-your-virtual-network-to-a-private-dns-zone"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#step-3-link-your-virtual-network-to-a-private-dns-zone">Step 3: Link your virtual network to a private DNS zone</a></h4>
<p>To link the private DNS zone to a virtual network, you create a virtual network link. In the Azure portal, go to the private zone, and select <strong>Virtual network links</strong>.</p>
<p><img alt="Screenshot of the Virtual Network Links page in a private DNS zone." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/3-virtual-network-link-option.png" /></p>
<p>Select <strong>Add</strong> to pick the virtual network you want to link to the private zone.</p>
<p><img alt="Screenshot of Add virtual network link page." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/3-add-virtual-network-link.png" /></p>
<p>You add a virtual network link record for each virtual network that needs private name-resolution support.</p>
<p>In the next unit, you learn how to create a public DNS zone.</p>
<h2 id="exercise-create-a-dns-zone-and-an-a-record-by-using-azure-dns"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#exercise-create-a-dns-zone-and-an-a-record-by-using-azure-dns">Exercise - Create a DNS zone and an A record by using Azure DNS</a></h2>
<p>In the previous unit, we described setting up and configuring the wideworldimports.com domain to point to your Azure hosting on Azure DNS.</p>
<p>In this unit, you'll:</p>
<ul>
<li>Set up an Azure DNS and create a public DNS zone.</li>
<li>Create an A record.</li>
<li>Verify that the A record resolves to an IP address.</li>
</ul>
<h3 id="create-a-dns-zone-in-azure-dns"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-a-dns-zone-in-azure-dns">Create a DNS zone in Azure DNS</a></h3>
<p>Before you can host the wideworldimports.com domain on your servers, you need to create a DNS zone. The DNS zone holds all the configuration records associated with your domain.</p>
<p>To create your DNS zone:</p>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> with the account you used to activate the sandbox.</p>
</li>
<li>
<p>On the Azure <strong>home</strong> page, under <strong>Azure services</strong>, select <strong>Create a resource</strong>. The <strong>Create a resource</strong> pane appears.</p>
</li>
<li>
<p>In the <em>Search services and marketplace</em> search box, search for and select <strong>DNS zone</strong> by Microsoft. The <strong>DNS zone</strong> pane appears.</p>
</li>
<li>
<p>Select <strong>Create</strong> &gt; <strong>DNS zone</strong>.</p>
<p><img alt="Screenshot of DNS zone, with Create highlighted." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/4-dnszonecreate.png" /></p>
<p>The <strong>Create DNS zone</strong> pane appears.</p>
</li>
<li>
<p>On the <strong>Basics</strong> tab, enter the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Project details</strong></td>
<td></td>
</tr>
<tr>
<td>Subscription</td>
<td>Concierge subscription</td>
</tr>
<tr>
<td>Resource group</td>
<td>From the dropdown list, select [sandbox resource group]</td>
</tr>
<tr>
<td><strong>Instance details</strong></td>
<td></td>
</tr>
<tr>
<td>Name</td>
<td>The name needs to be unique in the sandbox. Use <code>wideworldimportsXXXX.com</code>, and replace the "Xs" with letters or numbers.</td>
</tr>
</tbody>
</table>
<pre><code>![Screenshot of Create DNS zone page.](https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/4-creatednszone.png)
</code></pre>
<ol>
<li>
<p>Select <strong>Review + create</strong>.</p>
</li>
<li>
<p>After validation passes, select <strong>Create</strong>. It takes a few minutes to create the DNS zone.</p>
</li>
<li>
<p>When deployment is complete, select <strong>Go to resource</strong>. The <strong>Overview</strong> pane for your <strong>DNS zone</strong> appears.</p>
</li>
<li>
<p>Select <strong>Record Sets</strong> from the top menu bar.</p>
<p>By default, the NS, and SOA record sets are automatically created and automatically deleted whenever a DNS zone is created or deleted. The NS record set defines the Azure DNS namespaces and contains the four Azure DNS records. You use all four records when you update the registrar.</p>
<p>The SOA record represents your domain, and is used when other DNS servers are searching for your domain.</p>
</li>
<li>
<p>Make a note of the NS record values. You need them in the next section.</p>
</li>
</ol>
<h3 id="create-a-dns-record"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-a-dns-record">Create a DNS record</a></h3>
<p>Now that the DNS zone exists, you need to create the necessary records to support the domain.</p>
<p>The primary record set to create is the A record. The A record set is used to point traffic from a logical domain name to the hosting server's IP address. An A record set can have multiple records. In a record set, the domain name remains constant, while the IP addresses differ.</p>
<ol>
<li>
<p>If you're not already on the <strong>Record Sets</strong> screen, then open the <strong>DNS zone</strong> pane for <em>wideworldimportsXXXX.com</em>. In the top menu bar, select <strong>Record sets</strong>.</p>
</li>
<li>
<p>On the <strong>Record Sets</strong> pane, select <strong>+ Add</strong> in the top menu bar.</p>
</li>
<li>
<p>Select <strong>Add</strong> at the top of the Record sets page.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/4-arecord.png#lightbox"><img alt="Screenshot of adding a record set." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/4-add-a-record.png" /></a></p>
<p>The <strong>Add record set</strong> pane appears.</p>
</li>
<li>
<p>Enter the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>www</td>
<td>The host name that you want to resolve to an IP address.</td>
</tr>
<tr>
<td>Type</td>
<td>A</td>
<td>The <strong>A</strong> record is the most commonly used. If you're using IPv6, select the <strong>AAAA</strong> type.</td>
</tr>
<tr>
<td>Alias record set</td>
<td>No</td>
<td>This setting can only be applied to A, AAAA, and CNAME record types.</td>
</tr>
<tr>
<td>TTL</td>
<td>1</td>
<td>The time to live, which specifies the period of time each DNS server caches the resolution before being purged.</td>
</tr>
<tr>
<td>TTL unit</td>
<td>Hours</td>
<td>This value can be seconds, minutes, hours, days, or weeks. Here, you're selecting hours.</td>
</tr>
<tr>
<td>IP Address</td>
<td>10.10.10.10</td>
<td>The IP address the record name resolves to. In a real-world scenario, you'd enter the public IP address for your web server.</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>Select <strong>Add</strong> to add the record to your zone.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/4-arecord.png#lightbox"><img alt="Screenshot of A record set." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/4-arecord.png" /></a></p>
</li>
</ol>
<p>It's possible to have more than one IP address set up for your web server. In that case, you add all the associated IP addresses as records in the A record set. After the record set is created, you can update it with more IP addresses.</p>
<h3 id="verify-your-global-azure-dns"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#verify-your-global-azure-dns">Verify your global Azure DNS</a></h3>
<p>In a real-world scenario, after you create the public DNS zone, you update the NS records of the domain-name registrar to delegate the domain to Azure.</p>
<p>Even though we don't have a registered domain, it's still possible to verify that the DNS zone works as expected by using the <code>nslookup</code> tool.</p>
<h4 id="use-nslookup-to-verify-the-configuration"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#use-nslookup-to-verify-the-configuration">Use nslookup to verify the configuration</a></h4>
<p>Here's how to use <code>nslookup</code> to verify the DNS zone configuration.</p>
<ol>
<li>
<p>Use Cloud Shell to run the following command. Replace the DNS zone name with the zone you created, and replace <code>&lt;name server address&gt;</code> with one of the NS values you copied after you created the DNS zone.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>nslookup www.wideworldimportsXXXX.com &lt;name server address&gt;
</code></pre></div>
<p>The command should look something like the following example:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>nslookup www.wideworldimportsXXXX.com ns1-04.azure-dns.com
</code></pre></div>
</li>
<li>
<p>You should see that your host name <code>www.wideworldimportsXXXX.com</code> resolves to 10.10.10.10.</p>
<p><img alt="Screenshot of Cloud Shell, showing the nslookup results." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/4-nslookup.png" /></p>
</li>
</ol>
<p>Congratulations! You successfully set up a DNS zone and created an A record.</p>
<h2 id="dynamically-resolve-resource-name-by-using-alias-record"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#dynamically-resolve-resource-name-by-using-alias-record">Dynamically resolve resource name by using alias record</a></h2>
<p>In the previous exercise, you successfully delegated the domain from the domain registrar to your Azure DNS and configured an A record to link the domain to your web server.</p>
<p>The next phase of the deployment is to improve resiliency by using a load balancer. Load balancers distribute inbound data requests and traffic across one or more servers. They reduce the load on any one server and improve performance. This technology is well established. You can use it throughout your on-premises network.</p>
<p>You know that the A record and CNAME record don't support direct connection to Azure resources like your load balancers. You're tasked with finding out how to link the apex domain with a load balancer.</p>
<h3 id="what-is-an-apex-domain"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#what-is-an-apex-domain">What is an apex domain?</a></h3>
<p>The apex domain is your domain's highest level. In our case, that's wideworldimports.com. The apex domain is also sometimes referred to as the <em>zone apex</em> or <em>root apex</em>. The <strong>@</strong> symbol often represents the apex domain in your DNS zone records.</p>
<p>If you check the DNS zone for wideworldimports.com, you see that there are two apex domain records: NS and SOA. The NS and SOA records are automatically created when you created the DNS zone.</p>
<p>CNAME records that you might need for an Azure Traffic Manager profile or Azure Content Delivery Network endpoints aren't supported at the zone apex level. However, other <em>alias records</em> are supported at the zone apex level.</p>
<h3 id="what-are-alias-records"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#what-are-alias-records">What are alias records?</a></h3>
<p>Azure alias records enable a zone apex domain to reference other Azure resources from the DNS zone. You don't need to create complex redirection policies. You can also use an Azure alias to route all traffic through Traffic Manager.</p>
<p>The Azure alias record can point to the following Azure resources:</p>
<ul>
<li>A Traffic Manager profile</li>
<li>Azure Content Delivery Network endpoints</li>
<li>A public IP resource</li>
<li>A front-door profile</li>
</ul>
<p>Alias records provide lifecycle tracking of target resources, ensuring that changes to any target resource are automatically applied to the DNS zone. Alias records also provide support for load-balanced applications in the zone apex.</p>
<p>The alias record set supports the following DNS zone record types:</p>
<ul>
<li><strong>A</strong>: The IPv4 domain name-mapping record.</li>
<li><strong>AAAA</strong>: The IPv6 domain name-mapping record.</li>
<li><strong>CNAME</strong>: The alias for your domain, which links to the A record.</li>
</ul>
<h3 id="uses-for-alias-records"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#uses-for-alias-records">Uses for alias records</a></h3>
<p>The following are some of the advantages of using alias records:</p>
<ul>
<li><strong>Prevents dangling DNS records</strong>: A dangling DNS record occurs when the DNS zone records aren't up to date with changes to IP addresses. Alias records prevent dangling references by tightly coupling the lifecycle of a DNS record with an Azure resource.</li>
<li><strong>Updates DNS record set automatically when IP addresses change</strong>: When the underlying IP address of a resource, service, or application is changed, the alias record ensures that any associated DNS records are automatically refreshed.</li>
<li><strong>Hosts load-balanced applications at the zone apex</strong>: Alias records allow for zone apex resource routing to Traffic Manager.</li>
<li><strong>Points zone apex to Azure Content Delivery Network endpoints</strong>: With alias records, you can now directly reference your Azure Content Delivery Network instance.</li>
</ul>
<p>An alias record allows you to link the zone apex (wideworldimports.com) to a load balancer. It creates a link to the Azure resource rather than a direct IP-based connection. So, if the IP address of your load balancer changes, the zone apex record continues to work.</p>
<h2 id="exercise-create-alias-records-for-azure-dns"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#exercise-create-alias-records-for-azure-dns">Exercise - Create alias records for Azure DNS</a></h2>
<p>Your new website's deployment was a huge success. Usage volumes are higher than anticipated. The single web server on which the website runs is showing signs of strain. Your organization wants to increase the number of servers and distribute the load using a load balancer.</p>
<p>You now know you can use an Azure alias record to provide a dynamic, automatically refreshing link between the zone apex and the load balancer.</p>
<p>In this unit, you'll:</p>
<ul>
<li>Set up a virtual network with two VMs and a load balancer.</li>
<li>Learn how to configure an Azure alias at the zone apex to direct to the load balancer.</li>
<li>Verify that the domain name resolves to one or either of the VMs on your virtual network.</li>
</ul>
<h3 id="set-up-a-virtual-network-load-balancer-and-vms-in-azure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#set-up-a-virtual-network-load-balancer-and-vms-in-azure">Set up a virtual network, load balancer, and VMs in Azure</a></h3>
<p>When you manually create a virtual network, load balancer, and two VMs, it takes some time. To reduce this time, you can use a Bash setup script that's available on GitHub. Follow these instructions to create a test environment for your alias record.</p>
<ol>
<li>
<p>In Azure Cloud Shell, run the following setup script:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/MicrosoftDocs/mslearn-host-domain-azure-dns.git
</code></pre></div>
</li>
<li>
<p>To run the setup script, run the following commands:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cd mslearn-host-domain-azure-dns
chmod +x setup.sh
./setup.sh
</code></pre></div>
<p>The setup script takes a few minutes to run. The script:</p>
<ul>
<li>Creates a network security group.</li>
<li>Creates two network interface controllers (NICs) and two VMs.</li>
<li>Creates a virtual network and assigns the VMs.</li>
<li>Creates a public IP address and updates the configuration of the VMs.</li>
<li>Creates a load balancer that references the VMs, including rules for the load balancer.</li>
<li>Links the NICs to the load balancer.</li>
</ul>
<p>After the script completes, it shows you the public IP address for the load balancer. Copy the IP address to use it later.</p>
</li>
</ol>
<h3 id="create-an-alias-record-in-your-zone-apex"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-an-alias-record-in-your-zone-apex">Create an alias record in your zone apex</a></h3>
<p>Now that you created a test environment, you're ready to set up the Azure alias record in your zone apex.</p>
<ol>
<li>
<p>In the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a>, select <strong>Resource groups</strong>. The <strong>Resource groups</strong> pane appears.</p>
</li>
<li>
<p>Select the resource group: [sandbox resource group]. The <strong>Resource group</strong> pane appears.</p>
</li>
<li>
<p>In the list of resources, select the DNS zone you created in the previous exercise, wideworldimportsXXXX.com. The <strong>wideworldimportsXXXX.com DNS zone</strong> pane appears.</p>
</li>
<li>
<p>In the menu bar, select <strong>+ Record set</strong>. The <strong>Add record set</strong> pane appears.</p>
</li>
<li>
<p>Enter the following values for each setting to create an alias record.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>Leave the name blank. Blank indicates the DNS zone for wideworldimportsXXXX.com.</td>
</tr>
<tr>
<td>Type</td>
<td>A. Even though we're creating an alias, the base record type must still be either A, AAAA, or CNAME.</td>
</tr>
<tr>
<td>Alias record set</td>
<td>Yes</td>
</tr>
<tr>
<td>Alias type</td>
<td>Azure resource</td>
</tr>
<tr>
<td>Azure resource</td>
<td>From the list of resources, select <strong>myPublicIP</strong>. It can take up to 15 minutes for the deployments to propagate. If this resource isn't listed, wait several minutes, refresh the portal, and try again.</td>
</tr>
</tbody>
</table>
<pre><code>![Screenshot of Add record set.](https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/6-aliasrecord-azurelb.png)
</code></pre>
<ol>
<li>Select <strong>OK</strong> to add the record to your zone.</li>
</ol>
<p>When the new alias record is created, it should look something like this:</p>
<p><img alt="Screenshot of the DNS zone, with an alias record created." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/6-aliasrecord04.png" /></p>
<h3 id="verify-that-the-alias-resolves-to-the-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#verify-that-the-alias-resolves-to-the-load-balancer">Verify that the alias resolves to the load balancer</a></h3>
<p>Now, you need to verify that the alias record is set up correctly. In a real-world scenario, you'd have an actual domain, and would complete the domain delegation to Azure DNS. You'd use the registered domain name for this exercise. Because this unit assumes there's no registered domain, you use the public IP address.</p>
<ol>
<li>
<p>In the Azure portal, go to the resource group, select <strong>myPublicIP</strong>, then select the <strong>Copy</strong> icon next to the IP address.</p>
<p><img alt="Screenshot of the DNS zone with an alias record created." src="https://learn.microsoft.com/en-us/training/modules/host-domain-azure-dns/media/6-publicipaddress.png" /></p>
</li>
<li>
<p>In a web browser, paste the Public IP address as the URL.</p>
</li>
<li>
<p>You see a basic web page that shows the name of the virtual machine (VM) to which the load balancer sent the request.</p>
</li>
</ol>
<hr />
<h2 id="manage-and-control-traffic-flow-in-your-azure-deployment-with-routes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#manage-and-control-traffic-flow-in-your-azure-deployment-with-routes">Manage and control traffic flow in your Azure deployment with routes</a></h2>
<h2 id="introduction_9"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction_9">Introduction</a></h2>
<p>A virtual network lets you implement a security perimeter around your resources in the cloud. You can control the information that flows in and out of a virtual network. You can also restrict access to allow only the traffic that originates from trusted sources.</p>
<p>Suppose that you're the solution architect for a retail organization. Also suppose that your organization recently suffered a security incident that exposed customer information such as names, addresses, and credit card numbers. Malicious actors infiltrated vulnerabilities in your retailer's network infrastructure, which resulted in the loss of customers' confidential information.</p>
<p>As part of a remediation plan, the security team recommends adding network protections in the form of network virtual appliances. The cloud infrastructure team must ensure traffic gets properly routed through the virtual appliances and gets inspected for malicious activity.</p>
<p>In this module, you'll learn about Azure routing, and you'll create custom routes to control the traffic flow. You'll also learn to redirect the traffic through the network virtual appliance so you can inspect the traffic before it's allowed through.</p>
<h3 id="learning-objectives_8"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learning-objectives_8">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Identify the routing capabilities of an Azure virtual network.</li>
<li>Configure routing within a virtual network.</li>
<li>Deploy a basic network virtual appliance.</li>
<li>Configure routing to send traffic through a network virtual appliance.</li>
</ul>
<h3 id="prerequisites_6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#prerequisites_6">Prerequisites</a></h3>
<ul>
<li>Knowledge of basic networking concepts, including subnets and IP addressing</li>
<li>Familiarity with Azure virtual networking</li>
</ul>
<h2 id="identify-routing-capabilities-of-an-azure-virtual-network"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#identify-routing-capabilities-of-an-azure-virtual-network">Identify routing capabilities of an Azure virtual network</a></h2>
<p>To control traffic flow within your virtual network, you must learn the purpose and benefits of custom routes. You must also learn how to configure the routes to direct traffic flow through a network virtual appliance (NVA).</p>
<h3 id="azure-routing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#azure-routing">Azure routing</a></h3>
<p>Network traffic in Azure is automatically routed across Azure subnets, virtual networks, and on-premises networks. System routes control this routing. They're assigned by default to each subnet in a virtual network. With these system routes, any Azure virtual machine that is deployed into a virtual network can communicate with any other in the network. These virtual machines are also potentially accessible from on-premises through a hybrid network or the internet.</p>
<p>You can't create or delete system routes, but you can override the system routes by adding custom routes to control traffic flow to the next hop.</p>
<p>Every subnet has the following default system routes:</p>
<table>
<thead>
<tr>
<th>Address prefix</th>
<th>Next hop type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Unique to the virtual network</td>
<td>Virtual network</td>
</tr>
<tr>
<td>0.0.0.0/0</td>
<td>Internet</td>
</tr>
<tr>
<td>10.0.0.0/8</td>
<td>None</td>
</tr>
<tr>
<td>172.16.0.0/12</td>
<td>None</td>
</tr>
<tr>
<td>192.168.0.0/16</td>
<td>None</td>
</tr>
<tr>
<td>100.64.0.0/10</td>
<td>None</td>
</tr>
</tbody>
</table>
<p>The <strong>Next hop type</strong> column shows the network path taken by traffic sent to each address prefix. The path can be one of the following hop types:</p>
<ul>
<li><strong>Virtual network</strong>: A route is created in the address prefix. The prefix represents each address range created at the virtual-network level. If multiple address ranges are specified, multiple routes are created for each address range.</li>
<li><strong>Internet</strong>: The default system route 0.0.0.0/0 routes any address range to the internet, unless you override Azure's default route with a custom route.</li>
<li><strong>None</strong>: Any traffic routed to this hop type is dropped and doesn't get routed outside the subnet. By default, the following IPv4 private-address prefixes are created: 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16. The prefix 100.64.0.0/10 for a shared address space is also added. None of these address ranges are globally routable.</li>
</ul>
<p>The following diagram shows an overview of system routes and shows how traffic flows among subnets and the internet by default. You can see from the diagram that traffic flows freely among the two subnets and the internet.</p>
<p><img alt="Diagram of traffic flowing among subnets and the internet." src="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/media/2-system-routes-subnets-internet.svg" /></p>
<p>Within Azure, there are other system routes. Azure creates these routes if the following capabilities are enabled:</p>
<ul>
<li>Virtual network peering</li>
<li>Service chaining</li>
<li>Virtual network gateway</li>
<li>Virtual network service endpoint</li>
</ul>
<h4 id="virtual-network-peering-and-service-chaining"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#virtual-network-peering-and-service-chaining">Virtual network peering and service chaining</a></h4>
<p>Virtual network peering and service chaining let virtual networks within Azure connect to one another. With this connection, virtual machines can communicate with each other within the same region or across regions. This communication in turn creates more routes within the default route table. Service chaining lets you override these routes by creating user-defined routes between peered networks.</p>
<p>The following diagram shows two virtual networks with peering configured. The user-defined routes are configured to route traffic through an NVA or an Azure VPN gateway.</p>
<p><img alt="Diagram of virtual network peering with user-defined routes." src="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/media/2-virtual-network-peering-udrs.svg" /></p>
<h4 id="virtual-network-gateway"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#virtual-network-gateway">Virtual network gateway</a></h4>
<p>Use a virtual network gateway to send encrypted traffic between Azure and on-premises over the internet and to send encrypted traffic between Azure networks. A virtual network gateway contains routing tables and gateway services.</p>
<p><img alt="Diagram of the structure of a virtual network gateway." src="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/media/2-virtual-network-gateway.svg" /></p>
<h4 id="virtual-network-service-endpoint"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#virtual-network-service-endpoint">Virtual network service endpoint</a></h4>
<p>Virtual network endpoints extend your private address space in Azure by providing a direct connection to your Azure resources. This connection restricts the flow of traffic: your Azure virtual machines can access your storage account directly from the private address space and deny access from a public virtual machine. As you enable service endpoints, Azure creates routes in the route table to direct this traffic.</p>
<h3 id="custom-routes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#custom-routes">Custom routes</a></h3>
<p>System routes might make it easy for you to quickly get your environment up and running. However, there are many scenarios in which you want to more closely control the traffic flow within your network. For example, you might want to route traffic through an NVA or through a firewall. This control is possible with custom routes.</p>
<p>You have two options for implementing custom routes: create a user-defined route, or use Border Gateway Protocol (BGP) to exchange routes between Azure and on-premises networks.</p>
<h4 id="user-defined-routes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#user-defined-routes">User-defined routes</a></h4>
<p>You can use a user-defined route to override the default system routes so traffic can be routed through firewalls or NVAs.</p>
<p>For example, you might have a network with two subnets and want to add a virtual machine in the perimeter network to be used as a firewall. You can create a user-defined route so that traffic passes through the firewall and doesn't go directly between the subnets.</p>
<p>When creating user-defined routes, you can specify these next hop types:</p>
<ul>
<li><strong>Virtual appliance</strong>: A virtual appliance is typically a firewall device used to analyze or filter traffic that is entering or leaving your network. You can specify the private IP address of a Network Interface Card (NIC) attached to a virtual machine so that IP forwarding can be enabled. Or you can provide the private IP address of an internal load balancer.</li>
<li><strong>Virtual network gateway</strong>: Use to indicate when you want routes for a specific address to be routed to a virtual network gateway. The virtual network gateway is specified as a VPN for the next hop type.</li>
<li><strong>Virtual network</strong>: Use to override the default system route within a virtual network.</li>
<li><strong>Internet</strong>: Use to route traffic to a specified address prefix that is routed to the internet.</li>
<li><strong>None</strong>: Use to drop traffic sent to a specified address prefix.</li>
</ul>
<p>With user-defined routes, you can't specify the next hop type <strong>VirtualNetworkServiceEndpoint</strong>, which indicates virtual network peering.</p>
<h4 id="service-tags-for-user-defined-routes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#service-tags-for-user-defined-routes">Service tags for user-defined routes</a></h4>
<p>You can specify a service tag as the address prefix for a user-defined route instead of an explicit IP range. A service tag represents a group of IP address prefixes from a given Azure service. Microsoft manages the address prefixes encompassed by the service tag and automatically updates the service tag as addresses change, thus minimizing the complexity of frequent updates to user-defined routes and reducing the number of routes you need to create.</p>
<h4 id="border-gateway-protocol"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#border-gateway-protocol">Border gateway protocol</a></h4>
<p>A network gateway in your on-premises network can exchange routes with a virtual network gateway in Azure by using BGP. BGP is the standard routing protocol that's normally used to exchange routing information among two or more networks. BGP is used to transfer data and information between autonomous systems on the internet, such as different host gateways.</p>
<p>Typically, you use BGP to advertise on-premises routes to Azure when you're connected to an Azure datacenter through Azure ExpressRoute. You can also configure BGP if you connect to an Azure virtual network by using a VPN site-to-site connection.</p>
<p>The following diagram shows a topology with paths that can pass data between Azure VPN Gateway and on-premises networks:</p>
<p><img alt="Diagram showing an example of using the Border Gateway Protocol." src="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/media/2-bgp.svg" /></p>
<p>BGP offers network stability, because routers can quickly change connections to send packets if a connection path goes down.</p>
<h3 id="route-selection-and-priority"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#route-selection-and-priority">Route selection and priority</a></h3>
<p>If multiple routes are available in a route table, Azure uses the route with the longest prefix match. For example, a message is sent to the IP address 10.0.0.2, but two routes are available with the 10.0.0.0/16 and 10.0.0.0/24 prefixes. Azure selects the route with the 10.0.0.0/24 prefix because it's more specific.</p>
<p>The longer the route prefix, the shorter the list of IP addresses available through that prefix. When you use longer prefixes, the routing algorithm can select the intended address more quickly.</p>
<p>You can't configure multiple user-defined routes with the same address prefix.</p>
<p>If there are multiple routes with the same address prefix, Azure selects the route based on the type in the following order of priority:</p>
<ol>
<li>User-defined routes</li>
<li>BGP routes</li>
<li>System routes</li>
</ol>
<h2 id="exercise-create-custom-routes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#exercise-create-custom-routes">Exercise - Create custom routes</a></h2>
<p>As you implement your security strategy, you want to control how network traffic is routed across your Azure infrastructure.</p>
<p>In the following exercise, you use a network virtual appliance (NVA) to help secure and monitor traffic. You want to ensure communication between front-end public servers and internal private servers is always routed through the appliance.</p>
<p>You configure the network so that all traffic flowing from a public subnet to a private subnet will be routed through the NVA. To make this flow happen, you create a custom route for the public subnet to route this traffic to a perimeter-network subnet. Later, you deploy an NVA to the perimeter-network subnet.</p>
<p><img alt="Diagram of virtual network, subnets, and route table." src="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/media/3-virtual-network-subnets-route-table.svg" /></p>
<p>In this exercise, you create the route table, custom route, and subnets. You'll then associate the route table with a subnet.</p>
<h3 id="create-a-route-table-and-custom-route"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-a-route-table-and-custom-route">Create a route table and custom route</a></h3>
<p>The first task is to create a new routing table and then add a custom route for all traffic intended for the private subnet.</p>
<p>Note</p>
<p>You might get an error that reads: <em>This command is implicitly deprecated</em>. Please ignore this error for this learning module. We're working on it!</p>
<ol>
<li>
<p>In the Cloud Shell window on the right side of the screen, select the <strong>More</strong> icon (<strong>...</strong>), then select <strong>Settings</strong> &gt; <strong>Go to Classic version</strong>.</p>
</li>
<li>
<p>In Azure Cloud Shell, run the following command to create a route table:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>    az network route-table create \
        --name publictable \
        --resource-group &quot;[sandbox resource group name]&quot; \
        --disable-bgp-route-propagation false
</code></pre></div>
</li>
<li>
<p>Run the following command in Cloud Shell to create a custom route:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>    az network route-table route create \
        --route-table-name publictable \
        --resource-group &quot;[sandbox resource group name]&quot; \
        --name productionsubnet \
        --address-prefix 10.0.1.0/24 \
        --next-hop-type VirtualAppliance \
        --next-hop-ip-address 10.0.2.4
</code></pre></div>
</li>
</ol>
<h3 id="create-a-virtual-network-and-subnets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-a-virtual-network-and-subnets">Create a virtual network and subnets</a></h3>
<p>The next task is to create the <strong>vnet</strong> virtual network and the three subnets you need: <strong>publicsubnet</strong>, <strong>privatesubnet</strong>, and <strong>dmzsubnet</strong>.</p>
<ol>
<li>
<p>Run the following command to create the <strong>vnet</strong> virtual network and the <strong>publicsubnet</strong> subnet:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>    az network vnet create \
        --name vnet \
        --resource-group &quot;[sandbox resource group name]&quot; \
        --address-prefixes 10.0.0.0/16 \
        --subnet-name publicsubnet \
        --subnet-prefixes 10.0.0.0/24
</code></pre></div>
</li>
<li>
<p>Run the following command in Cloud Shell to create the <strong>privatesubnet</strong> subnet:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>    az network vnet subnet create \
        --name privatesubnet \
        --vnet-name vnet \
        --resource-group &quot;[sandbox resource group name]&quot; \
        --address-prefixes 10.0.1.0/24
</code></pre></div>
</li>
<li>
<p>Run the following command to create the <strong>dmzsubnet</strong> subnet:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>    az network vnet subnet create \
        --name dmzsubnet \
        --vnet-name vnet \
        --resource-group &quot;[sandbox resource group name]&quot; \
        --address-prefixes 10.0.2.0/24
</code></pre></div>
</li>
<li>
<p>You should now have three subnets. Run the following command to show all of the subnets in the <strong>vnet</strong> virtual network:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>    az network vnet subnet list \
        --resource-group &quot;[sandbox resource group name]&quot; \
        --vnet-name vnet \
        --output table
</code></pre></div>
</li>
</ol>
<h3 id="associate-the-route-table-with-the-public-subnet"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#associate-the-route-table-with-the-public-subnet">Associate the route table with the public subnet</a></h3>
<p>The final task in this exercise is to associate the route table with the <strong>publicsubnet</strong> subnet.</p>
<p>Run the following command to associate the route table with the public subnet.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>    az network vnet subnet update \
        --name publicsubnet \
        --vnet-name vnet \
        --resource-group &quot;[sandbox resource group name]&quot; \
        --route-table publictable
</code></pre></div>
<h2 id="what-is-an-nva"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#what-is-an-nva">What is an NVA?</a></h2>
<p>A network virtual appliance (NVA) is a virtual appliance that consists of various layers like:</p>
<ul>
<li>A firewall</li>
<li>A WAN optimizer</li>
<li>Application-delivery controllers</li>
<li>Routers</li>
<li>Load balancers</li>
<li>IDS/IPS</li>
<li>Proxies</li>
</ul>
<p>You can deploy NVAs that you choose from providers in Azure Marketplace. Such providers include Cisco, Check Point, Barracuda, Sophos, WatchGuard, and SonicWall. You can use an NVA to filter traffic inbound to a virtual network, to block malicious requests, and to block requests made from unexpected resources.</p>
<p>In the retail-organization example scenario, you must work with the security and network teams. You want to implement a secure environment that scrutinizes all incoming traffic and blocks unauthorized traffic from passing on to the internal network. You also want to secure both virtual-machine networking and Azure-services networking as part of your company's network-security strategy.</p>
<p>Your goal is to prevent unwanted or unsecured network traffic from reaching key systems.</p>
<p>As part of the network-security strategy, you must control the flow of traffic within your virtual network. You also must learn the role of an NVA and the benefit of using an NVA to control traffic flow through an Azure network.</p>
<h3 id="network-virtual-appliance"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#network-virtual-appliance">Network virtual appliance</a></h3>
<p><strong>Network virtual appliances (NVAs) are virtual machines that control the flow of network traffic by controlling routing</strong>. You'll typically use them to manage traffic flowing from a perimeter-network environment to other networks or subnets.</p>
<p><img alt="Diagram of a network architecture with a network virtual appliance." src="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/media/4-nva.svg" /></p>
<p>You can deploy firewall appliances into a virtual network in different configurations. <strong>You can put a firewall appliance in a perimeter-network subnet in the virtual network</strong>, or if you want more control of security, implement a microsegmentation approach.</p>
<p>With the microsegmentation approach, you can create dedicated subnets for the firewall and then deploy web applications and other services in other subnets. All traffic is routed through the firewall and inspected by the NVAs. You'll enable forwarding on the virtual-appliance network interfaces to pass traffic that is accepted by the appropriate subnet.</p>
<p>Microsegmentation lets the firewall inspect all packets at OSI Layer 4 and, for application-aware appliances, Layer 7. When you deploy an NVA to Azure, it acts as a router that forwards requests between subnets on the virtual network.</p>
<p>Some NVAs require multiple network interfaces. One network interface is dedicated to the management network for the appliance. Additional network interfaces manage and control the traffic processing. After you’ve deployed the NVA, you can then configure the appliance to route the traffic through the proper interface.</p>
<h4 id="user-defined-routes_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#user-defined-routes_1">User-defined routes</a></h4>
<p>For most environments, the default system routes already defined by Azure are enough to get the environments up and running. In certain cases, you should create a routing table and add custom routes. Examples include:</p>
<ul>
<li>Access to the internet via on-premises network using forced tunneling</li>
<li>Using virtual appliances to control traffic flow</li>
</ul>
<p>You can create multiple route tables in Azure. Each route table can be associated with one or more subnets. A subnet can only be associated with one route table.</p>
<h3 id="network-virtual-appliances-in-a-highly-available-architecture"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#network-virtual-appliances-in-a-highly-available-architecture">Network virtual appliances in a highly available architecture</a></h3>
<p>If traffic is routed through an NVA, the NVA becomes a critical piece of your infrastructure. Any NVA failures directly affect the ability of your services to communicate. It's important to include a highly available architecture in your NVA deployment.</p>
<p>There are several methods of achieving high availability when using NVAs. At the end of this module, you can find more information about using NVAs in highly available scenarios.</p>
<h2 id="exercise-create-an-nva-and-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#exercise-create-an-nva-and-virtual-machines">Exercise - Create an NVA and virtual machines</a></h2>
<p>In the next stage of your security implementation, you'll deploy a network virtual appliance (NVA) to secure and monitor traffic between your front-end public servers and internal private servers.</p>
<p>First, configure the appliance to forward IP traffic. If IP forwarding isn't enabled, traffic that is routed through your appliance will never be received by its intended destination servers.</p>
<p>In this exercise, you deploy the <strong>nva</strong> network appliance to the <strong>dmzsubnet</strong> subnet. Then you enable IP forwarding so that traffic from <strong><code>*</code></strong> and traffic that uses the custom route is sent to the <strong>privatesubnet</strong> subnet.</p>
<p><img alt="Diagram of a Network virtual appliance with IP forwarding enabled." src="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/media/5-nva-ip-forwarding.svg" /></p>
<p>In the following steps, you'll deploy an NVA. You'll then update the Azure virtual NIC and the network settings within the appliance to enable IP forwarding.</p>
<h3 id="deploy-the-network-virtual-appliance"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#deploy-the-network-virtual-appliance">Deploy the network virtual appliance</a></h3>
<p>To build the NVA, deploy an Ubuntu LTS instance.</p>
<ol>
<li>
<p>In Cloud Shell, run the following command to deploy the appliance. Replace <code>&lt;password&gt;</code> with a suitable password of your choice for the <strong>azureuser</strong> admin account.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name nva \
    --vnet-name vnet \
    --subnet dmzsubnet \
    --image Ubuntu2204 \
    --admin-username azureuser \
    --admin-password &lt;password&gt;
</code></pre></div>
</li>
</ol>
<h3 id="enable-ip-forwarding-for-the-azure-network-interface"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#enable-ip-forwarding-for-the-azure-network-interface">Enable IP forwarding for the Azure network interface</a></h3>
<p>In the next steps, you enable IP forwarding for the <strong>nva</strong> network appliance. When traffic flows to the NVA but is meant for another target, the NVA will route that traffic to its correct destination.</p>
<ol>
<li>
<p>Run the following command to get the NVA network interface's ID:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>NICID=$(az vm nic list \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --vm-name nva \
    --query &quot;[].{id:id}&quot; --output tsv)

echo $NICID
</code></pre></div>
</li>
<li>
<p>Run the following command to get the NVA network interface's name:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>NICNAME=$(az vm nic show \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --vm-name nva \
    --nic $NICID \
    --query &quot;{name:name}&quot; --output tsv)

echo $NICNAME
</code></pre></div>
</li>
<li>
<p>Run the following command to enable IP forwarding for the network interface:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network nic update --name $NICNAME \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --ip-forwarding true
</code></pre></div>
</li>
</ol>
<h3 id="enable-ip-forwarding-in-the-appliance"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#enable-ip-forwarding-in-the-appliance">Enable IP forwarding in the appliance</a></h3>
<ol>
<li>
<p>Run the following command to save the NVA virtual machine's public IP address to the variable <code>NVAIP</code>:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>NVAIP=&quot;$(az vm list-ip-addresses \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name nva \
    --query &quot;[].virtualMachine.network.publicIpAddresses[*].ipAddress&quot; \
    --output tsv)&quot;

echo $NVAIP
</code></pre></div>
</li>
<li>
<p>Run the following command to enable IP forwarding within the NVA:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -t -o StrictHostKeyChecking=no azureuser@$NVAIP &#39;sudo sysctl -w net.ipv4.ip_forward=1; exit;&#39;
</code></pre></div>
<p>When prompted, enter the password you used when you created the virtual machine.</p>
</li>
</ol>
<h2 id="exercise-route-traffic-through-the-nva"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#exercise-route-traffic-through-the-nva">Exercise - Route traffic through the NVA</a></h2>
<p>Now that you've created the network virtual appliance (NVA) and virtual machines (VMs), you'll route the traffic through the NVA.</p>
<p><img alt="Visualization of virtual machines and IP addresses." src="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/media/6-vms-ip-addresses.svg" /></p>
<h3 id="create-public-and-private-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-public-and-private-virtual-machines">Create public and private virtual machines</a></h3>
<p>The next steps deploy a VM into the public and private subnets.</p>
<ol>
<li>
<p>Open the Cloud Shell editor and create a file named cloud-init.txt.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>code cloud-init.txt
</code></pre></div>
</li>
<li>
<p>Add the following configuration information to the file. With this configuration, the <code>inetutils-traceroute</code> package is installed when you create a new VM. This package contains the <code>traceroute</code> utility that you'll use later in this exercise.</p>
<p>TextCopy</p>
<div class="highlight"><pre><span></span><code>#cloud-config
package_upgrade: true
packages:
   - inetutils-traceroute
</code></pre></div>
</li>
<li>
<p>Press Ctrl+S to save the file, and then press Ctrl+Q to close the editor.</p>
</li>
<li>
<p>In Cloud Shell, run the following command to create the <strong>public</strong> VM. Replace <code>&lt;password&gt;</code> with a suitable password for the <strong>azureuser</strong> account.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name public \
    --vnet-name vnet \
    --subnet publicsubnet \
    --image Ubuntu2204 \
    --admin-username azureuser \
    --no-wait \
    --custom-data cloud-init.txt \
    --admin-password &lt;password&gt;
</code></pre></div>
</li>
<li>
<p>Run the following command to create the <strong>private</strong> VM. Replace <code>&lt;password&gt;</code> with a suitable password.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name private \
    --vnet-name vnet \
    --subnet privatesubnet \
    --image Ubuntu2204 \
    --admin-username azureuser \
    --no-wait \
    --custom-data cloud-init.txt \
    --admin-password &lt;password&gt;
</code></pre></div>
</li>
<li>
<p>Run the following Linux <code>watch</code> command to check that the VMs are running. The <code>watch</code> command periodically runs the <code>az vm list</code> command so that you can monitor the progress of the VMs.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>watch -d -n 5 &quot;az vm list \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --show-details \
    --query &#39;[*].{Name:name, ProvisioningState:provisioningState, PowerState:powerState}&#39; \
    --output table&quot;
</code></pre></div>
<p>A <strong>ProvisioningState</strong> value of "Succeeded" and a <strong>PowerState</strong> value of "VM running" indicate a successful deployment. When all three VMs are running, you're ready to move on. Press Ctrl-C to stop the command and continue with the exercise.</p>
</li>
<li>
<p>Run the following command to save the public IP address of the <strong>public</strong> VM to a variable named <code>PUBLICIP</code>:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>PUBLICIP=&quot;$(az vm list-ip-addresses \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name public \
    --query &quot;[].virtualMachine.network.publicIpAddresses[*].ipAddress&quot; \
    --output tsv)&quot;

echo $PUBLICIP
</code></pre></div>
</li>
<li>
<p>Run the following command to save the public IP address of the <strong>private</strong> VM to a variable named <code>PRIVATEIP</code>:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>PRIVATEIP=&quot;$(az vm list-ip-addresses \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name private \
    --query &quot;[].virtualMachine.network.publicIpAddresses[*].ipAddress&quot; \
    --output tsv)&quot;

echo $PRIVATEIP
</code></pre></div>
</li>
</ol>
<h3 id="test-traffic-routing-through-the-network-virtual-appliance"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#test-traffic-routing-through-the-network-virtual-appliance">Test traffic routing through the network virtual appliance</a></h3>
<p>The final steps use the Linux <code>traceroute</code> utility to show how traffic is routed. You'll use the <code>ssh</code> command to run <code>traceroute</code> on each VM. The first test shows the route taken by ICMP packets sent from the <strong>public</strong> VM to the <strong>private</strong> VM. The second test shows the route taken by ICMP packets sent from the <strong>private</strong> VM to the <strong>public</strong> VM.</p>
<ol>
<li>
<p>Run the following command to trace the route from <strong>public</strong> to <strong>private</strong>. When prompted, enter the password for the <strong>azureuser</strong> account that you specified earlier.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -t -o StrictHostKeyChecking=no azureuser@$PUBLICIP &#39;traceroute private --type=icmp; exit&#39;
</code></pre></div>
<p>If you receive the error message <code>bash: traceroute: command not found</code>, wait a minute and retry the command. The automated installation of <code>traceroute</code> can take a minute or two after VM deployment. After the command succeeds, the output should look similar to the following example:</p>
<p>TextCopy</p>
<div class="highlight"><pre><span></span><code>traceroute to private.kzffavtrkpeulburui2lgywxwg.gx.internal.cloudapp.net (10.0.1.4), 64 hops max
1   10.0.2.4  0.710ms  0.410ms  0.536ms
2   10.0.1.4  0.966ms  0.981ms  1.268ms
Connection to 52.165.151.216 closed.
</code></pre></div>
<p>Notice that the first hop is to 10.0.2.4. This address is the private IP address of <strong>nva</strong>. The second hop is to 10.0.1.4, the address of <strong>private</strong>. In the first exercise, you added this route to the route table and linked the table to the <strong>publicsubnet</strong> subnet. So now all traffic from <strong>public</strong> to <strong>private</strong> is routed through the NVA.</p>
<p><img alt="Diagram of route from public to private." src="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/media/6-public-private-route.svg" /></p>
</li>
<li>
<p>Run the following command to trace the route from <strong>private</strong> to <strong>public</strong>. When prompted, enter the password for the <strong>azureuser</strong> account.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh -t -o StrictHostKeyChecking=no azureuser@$PRIVATEIP &#39;traceroute public --type=icmp; exit&#39;
</code></pre></div>
<p>You should see the traffic go directly to <strong>public</strong> (10.0.0.4) and not through the NVA, as shown in the following command output.</p>
<p>TextCopy</p>
<div class="highlight"><pre><span></span><code>traceroute to public.kzffavtrkpeulburui2lgywxwg.gx.internal.cloudapp.net (10.0.0.4), 64 hops max
1   10.0.0.4  1.095ms  1.610ms  0.812ms
Connection to 52.173.21.188 closed.
</code></pre></div>
<p>The <strong>private</strong> VM is using default routes, and traffic is routed directly between the subnets.</p>
<p><img alt="Diagram of route from private to public." src="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/media/6-private-public-route.svg" /></p>
</li>
</ol>
<p>You've now configured routing between subnets to direct traffic from the public internet through the <strong>dmzsubnet</strong> subnet before it reaches the private subnet. In the <strong>dmzsubnet</strong> subnet, you added a VM that acts as an NVA. You can configure this NVA to detect potentially malicious requests and block them before they reach their intended targets.</p>
<hr />
<h2 id="improve-application-scalability-and-resiliency-by-using-azure-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#improve-application-scalability-and-resiliency-by-using-azure-load-balancer">Improve application scalability and resiliency by using Azure Load Balancer</a></h2>
<h2 id="introduction_10"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#introduction_10">Introduction</a></h2>
<p>Many apps need to be resilient to failure and scale easily when demand increases. You can address those needs by using Azure Load Balancer.</p>
<p>Suppose you work for a healthcare organization that's launching a new portal application with which patients can schedule appointments. The application has a patient portal, a web-application front end, and a business-tier database. The front end uses the database to retrieve and save patient information.</p>
<p>The new portal needs to be available around the clock to handle failures. The portal must adjust to load fluctuations by adding and removing resources to match the load. The organization needs a solution that distributes work to virtual machines across the system as virtual machines are added. The solution should detect failures and reroute jobs to virtual machines as needed. Improved resiliency and scalability help ensure that patients can schedule appointments from any location.</p>
<p>By the end of this module, you're able to use Azure Load Balancer to build a resilient and scalable app architecture.</p>
<h3 id="learning-objectives_9"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#learning-objectives_9">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Identify the features and capabilities of Azure Load Balancer.</li>
<li>Deploy and configure an instance of Azure Load Balancer.</li>
</ul>
<h3 id="prerequisites_7"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#prerequisites_7">Prerequisites</a></h3>
<ul>
<li>Basic knowledge of networking concepts.</li>
<li>Basic knowledge of Azure virtual machines.</li>
<li>Familiarity with the Azure portal.</li>
</ul>
<h2 id="azure-load-balancer-features-and-capabilities"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#azure-load-balancer-features-and-capabilities">Azure Load Balancer features and capabilities</a></h2>
<p>With Azure Load Balancer, you can spread user requests across multiple virtual machines or other services. It allows you to scale the app to larger sizes than a single virtual machine can support, and ensures that users get service even when a virtual machine fails.</p>
<p>In your healthcare organization, you can expect large user demand. It's vitally important that each user can book an appointment, even during peak demand or when one or more virtual machines fail. By using multiple virtual servers for your front end with a load balancer to distribute traffic among them, you achieve a high capacity because all the virtual servers collaborate to satisfy requests. You also improve resilience because the load balancer can automatically reroute traffic when a virtual server fails.</p>
<p>Here, you learn how Load Balancer's features can help you create robust app architectures.</p>
<h3 id="distribute-traffic-with-azure-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#distribute-traffic-with-azure-load-balancer">Distribute traffic with Azure Load Balancer</a></h3>
<p>Azure Load Balancer is a service you can use to distribute traffic across multiple virtual machines. Use Load Balancer to scale applications and create high availability for your virtual machines and services. Load balancers use a hash-based distribution algorithm. <strong>By default, a five-tuple hash is used to map traffic to available servers.</strong> The hash is made from the following elements:</p>
<ul>
<li><strong>Source IP</strong>: The IP address of the requesting client.</li>
<li><strong>Source port</strong>: The port of the requesting client.</li>
<li><strong>Destination IP</strong>: The destination IP of the request.</li>
<li><strong>Destination port</strong>: The destination port of the request.</li>
<li><strong>Protocol type</strong>: The specified protocol type. Transmission Control Protocol (TCP) or User Datagram Protocol (UDP).</li>
</ul>
<p><img alt="Diagram showing an overview of Azure Load Balancer." src="https://learn.microsoft.com/en-us/training/modules/improve-app-scalability-resiliency-with-load-balancer/media/2-load-balancer-distribution.svg" /></p>
<p>Load Balancer supports inbound and outbound scenarios, provides low latency and high throughput, and scales up to millions of flows for TCP and UDP applications.</p>
<p>Load balancers aren't physical instances. Load-balancer objects are used to express how Azure configures its infrastructure to meet your requirements.</p>
<p>With Load Balancer, you can use availability sets and availability zones to ensure that virtual machines are always available:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Configuration</th>
<th>Service level agreement (SLA)</th>
<th>Information</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Availability set</strong></td>
<td>99.95%</td>
<td>Protection from hardware failures within datacenters</td>
</tr>
<tr>
<td><strong>Availability zone</strong></td>
<td>99.99%</td>
<td>Protection from entire datacenter failure</td>
</tr>
</tbody>
</table>
<h4 id="availability-sets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#availability-sets">Availability sets</a></h4>
<p>An availability set is a logical grouping used to isolate virtual machine resources from each other when they're deployed. Azure ensures that the virtual machines you put in an availability set run across multiple physical servers, compute racks, storage units, and network switches. If there's a hardware or software failure, only a subset of your virtual machines is affected. Your overall solution stays operational. Availability sets are essential for building reliable cloud solutions.</p>
<p><img alt="Diagram showing an overview of availability sets in Azure." src="https://learn.microsoft.com/en-us/training/modules/improve-app-scalability-resiliency-with-load-balancer/media/2-availability-sets.svg" /></p>
<h4 id="availability-zones"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#availability-zones">Availability zones</a></h4>
<p>An availability zone offers groups of one or more datacenters that have independent power, cooling, and networking. The virtual machines in an availability zone are placed in different physical locations within the same region. Use this architecture when you want to ensure that you can continue to serve users when an entire datacenter fails.</p>
<p><img alt="Diagram showing an overview of availability zones in Azure." src="https://learn.microsoft.com/en-us/training/modules/improve-app-scalability-resiliency-with-load-balancer/media/2-az-graphic-two.svg" /></p>
<p>Availability zones don't support all virtual machine sizes and aren't available in all Azure regions. Check that they're supported in your region before you use them in your architecture.</p>
<h3 id="select-the-right-load-balancer-product"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#select-the-right-load-balancer-product">Select the right Load Balancer product</a></h3>
<p>Two products are available when you create a load balancer in Azure: <em>basic</em> load balancers and <em>standard</em> load balancers.</p>
<p>Basic load balancers allow:</p>
<ul>
<li>Port forwarding</li>
<li>Automatic reconfiguration</li>
<li>Health probes</li>
<li>Outbound connections through source network address translation (SNAT)</li>
<li>Diagnostics through Azure Log Analytics for public-facing load balancers</li>
</ul>
<p>You can only use basic load balancers with a single availability set or scale set.</p>
<p>Standard load balancers support all of the basic load balancer features. They also allow:</p>
<ul>
<li>HTTPS health probes</li>
<li>Availability zones</li>
<li>Diagnostics through Azure Monitor, for multidimensional metrics</li>
<li>High availability (HA) ports</li>
<li>Outbound rules</li>
<li>A guaranteed SLA (99.99% for two or more virtual machines)</li>
</ul>
<h3 id="internal-and-external-load-balancers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#internal-and-external-load-balancers">Internal and external load balancers</a></h3>
<p>An external load balancer operates by distributing client traffic across multiple virtual machines. An external load balancer permits traffic from the internet. The traffic might come from browsers, mobile apps, or other sources. In a healthcare organization, the balancer distributes the load of all the browsers that run the client healthcare application.</p>
<p>An internal load balancer distributes a load from internal Azure resources to other Azure resources. For example, if you have front-end web servers that need to call the business logic hosted on multiple middle-tier servers, you can distribute that load evenly by using an internal load balancer. No traffic is allowed from internet sources. In a healthcare organization, a load balancer distributes a load across the internal application tier.</p>
<h2 id="configure-a-public-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-a-public-load-balancer">Configure a public load balancer</a></h2>
<p>As the solution architect for the healthcare portal, you need to distribute the load from the client browsers over the virtual machines in your web farm. You need to set up a load balancer and configure the virtual machines to be balanced.</p>
<p>A public load balancer maps the public IP address and port number of incoming traffic to the private IP address and port number of a virtual machine in the back-end pool. The responses are then returned to the client. By applying load-balancing rules, you can distribute specific types of traffic across multiple virtual machines or services.</p>
<h3 id="distribution-modes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#distribution-modes">Distribution modes</a></h3>
<p>By default, Azure Load Balancer distributes network traffic equally among virtual machine instances. The following distribution modes are also possible if a different behavior is required:</p>
<ul>
<li>
<p><strong>Five-tuple hash</strong>: The default distribution mode for Load Balancer is a five-tuple hash. The tuple is composed of source IP, source port, destination IP, destination port, and protocol type. Because the source port is included in the hash and the source port changes for each session, clients might be directed to a different virtual machine for each session.</p>
<p><img alt="Diagram showing how hash-based distribution works." src="https://learn.microsoft.com/en-us/training/modules/improve-app-scalability-resiliency-with-load-balancer/media/3-load-balancer-distribution.svg" /></p>
</li>
<li>
<p><strong>Source IP affinity</strong>: This distribution mode is also known as <em>session affinity</em> or <em>client IP affinity</em>. To map traffic to the available servers, the source IP affinity mode uses a two-tuple hash (from the source IP address and destination IP address) or a three-tuple hash (from the source IP address, destination IP address, and protocol type). The hash ensures that requests from a specific client are always sent to the same virtual machine behind the load balancer.</p>
<p><img alt="Diagram showing how session affinity works." src="https://learn.microsoft.com/en-us/training/modules/improve-app-scalability-resiliency-with-load-balancer/media/3-load-balancer-session-affinity.svg" /></p>
</li>
</ul>
<h3 id="choose-a-distribution-mode"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#choose-a-distribution-mode">Choose a distribution mode</a></h3>
<p>In the healthcare-portal example, imagine that a developer requirement of the presentation tier is to use in-memory sessions to store the signed-in user's profile as the user interacts with the portal.</p>
<p>In this scenario, the load balancer must provide source IP affinity to maintain a user's session. The profile is stored only on the virtual machine to which the client first connects, because that IP address is directed to the same server. When you create the load-balancer endpoint, you must specify the distribution mode by using the following PowerShell example:</p>
<p>PowerShellCopy</p>
<div class="highlight"><pre><span></span><code>$lb = Get-AzLoadBalancer -Name MyLb -ResourceGroupName MyResourceGroup
$lb.LoadBalancingRules[0].LoadDistribution = &#39;sourceIp&#39;
Set-AzLoadBalancer -LoadBalancer $lb
</code></pre></div>
<p>To add session persistence through the Azure portal:</p>
<ol>
<li>
<p>In the Azure portal, select your Load Balancer resource.</p>
</li>
<li>
<p>In the <strong>Load balancing rules</strong> page under the <em>Settings</em> pane, select the relevant load balancing rule.</p>
<p><img alt="Screenshot showing how to select a load balancing rule in the Azure portal." src="https://learn.microsoft.com/en-us/training/modules/improve-app-scalability-resiliency-with-load-balancer/media/3-load-balancer-rules.png" /></p>
</li>
<li>
<p>In the <em>load balancing rule settings</em> page, change the value for <strong>Session persistence</strong> from <strong>None</strong> to <strong>Client IP</strong>.</p>
</li>
</ol>
<p><img alt="Screenshot showing how to set IP affinity in the Azure portal." src="https://learn.microsoft.com/en-us/training/modules/improve-app-scalability-resiliency-with-load-balancer/media/3-screenshot-session-persistence.png" /></p>
<h3 id="load-balancer-and-remote-desktop-gateway"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#load-balancer-and-remote-desktop-gateway">Load Balancer and Remote Desktop Gateway</a></h3>
<p>Remote Desktop Gateway is a Windows service that enables clients on the internet to make Remote Desktop Protocol (RDP) connections through firewalls to Remote Desktop servers on your private network. The default five-tuple hash in Load Balancer is incompatible with this service. If you want to use Load Balancer with your Remote Desktop servers, use source IP affinity.</p>
<h3 id="load-balancer-and-media-upload"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#load-balancer-and-media-upload">Load Balancer and media upload</a></h3>
<p>Another use case for source IP affinity is media upload. In many implementations, a client initiates a session through a Transmission Control Protocol (TCP) protocol and connects to a destination IP address. This connection remains open throughout the upload to monitor progress, but the file is uploaded through a separate User Datagram Protocol (UDP) protocol.</p>
<p>With the five-tuple hash, the load balancer likely sends the TCP and UDP connections to different destination IP addresses and the upload doesn't finish successfully. Use source IP affinity to resolve this issue.</p>
<h2 id="exercise-configure-a-public-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#exercise-configure-a-public-load-balancer">Exercise - Configure a public load balancer</a></h2>
<p>You can configure Azure Load Balancer by using the Azure portal, PowerShell, or the Azure CLI.</p>
<p>In your healthcare organization, you want to load-balance client traffic to provide a consistent response based on the patient portal web servers' health. You have two virtual machines (VMs) in an availability set to act as your healthcare-portal web application.</p>
<p>Here, you create a load balancer resource and use it to distribute a load across the virtual machines.</p>
<h3 id="deploy-the-patient-portal-web-application"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#deploy-the-patient-portal-web-application">Deploy the patient portal web application</a></h3>
<p>First, deploy your patient-portal application across two virtual machines in a single availability set. To save time, let's start by running a script to create this application. The script:</p>
<ul>
<li>Creates a virtual network and network infrastructure for the virtual machines.</li>
<li>Creates two virtual machines in this virtual network.</li>
</ul>
<p>To deploy the patient portal web application:</p>
<ol>
<li>
<p>Run the following <code>git clone</code> command in Azure Cloud Shell. The command clones the repo that contains the source for the app and runs the setup script from GitHub. Then changes to the directory of the cloned repo.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/MicrosoftDocs/mslearn-improve-app-scalability-resiliency-with-load-balancer.git
cd mslearn-improve-app-scalability-resiliency-with-load-balancer
</code></pre></div>
</li>
<li>
<p>As its name suggests, the script generates two virtual machines in a single availability set. It takes about two minutes to run.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>bash create-high-availability-vm-with-sets.sh [sandbox resource group name]
</code></pre></div>
</li>
<li>
<p>When the script finishes, on the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> menu or from the <strong>Home</strong> page, select <strong>Resource groups</strong>, then select the <strong>[sandbox resource group name]</strong> resource group. Review the resources created by the script.</p>
</li>
</ol>
<h3 id="create-a-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#create-a-load-balancer">Create a load balancer</a></h3>
<p>Let's use the Azure CLI to create the load balancer and its associated resources.</p>
<ol>
<li>
<p>Create a new public IP address.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network public-ip create \
  --resource-group [sandbox resource group name] \
  --allocation-method Static \
  --name myPublicIP
</code></pre></div>
</li>
<li>
<p>Create the load balancer.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network lb create \
  --resource-group [sandbox resource group name] \
  --name myLoadBalancer \
  --public-ip-address myPublicIP \
  --frontend-ip-name myFrontEndPool \
  --backend-pool-name myBackEndPool
</code></pre></div>
</li>
<li>
<p>Create a health probe that allows the load balancer to monitor the healthcare portal's status. The health probe dynamically adds or removes virtual machines from the load-balancer rotation based on their response to health checks.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network lb probe create \
  --resource-group [sandbox resource group name] \
  --lb-name myLoadBalancer \
  --name myHealthProbe \
  --protocol tcp \
  --port 80  
</code></pre></div>
</li>
<li>
<p>Now, you need a load balancer rule to define how traffic is distributed to the virtual machines. You define the front-end IP configuration for the incoming traffic and the back-end IP pool to receive the traffic, along with the required source and destination port. To make sure only healthy virtual machines receive traffic, you also define the health probe to use.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network lb rule create \
  --resource-group [sandbox resource group name] \
  --lb-name myLoadBalancer \
  --name myHTTPRule \
  --protocol tcp \
  --frontend-port 80 \
  --backend-port 80 \
  --frontend-ip-name myFrontEndPool \
  --backend-pool-name myBackEndPool \
  --probe-name myHealthProbe
</code></pre></div>
</li>
<li>
<p>Connect the virtual machines to the back-end pool by updating the network interfaces that the script created to use the back-end pool information.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az network nic ip-config update \
  --resource-group [sandbox resource group name] \
  --nic-name webNic1 \
  --name ipconfig1 \
  --lb-name myLoadBalancer \
  --lb-address-pools myBackEndPool

az network nic ip-config update \
  --resource-group [sandbox resource group name] \
  --nic-name webNic2 \
  --name ipconfig1 \
  --lb-name myLoadBalancer \
  --lb-address-pools myBackEndPool
</code></pre></div>
</li>
<li>
<p>Run the following command to get the load balancer's public IP address and your website's URL:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>echo http://$(az network public-ip show \
                --resource-group [sandbox resource group name] \
                --name myPublicIP \
                --query ipAddress \
                --output tsv)
</code></pre></div>
</li>
</ol>
<h3 id="test-the-load-balancer-configuration"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#test-the-load-balancer-configuration">Test the load balancer configuration</a></h3>
<p>Let's test the load balancer setup, by showing how it can handle availability and health issues dynamically.</p>
<ol>
<li>
<p>In a new browser tab, go to the public IP address that you noted. A response from one of the virtual machines is displayed in the browser.</p>
</li>
<li>
<p>Try a "force refresh" by pressing Ctrl+F5 a few times to see that the response is returned randomly from both virtual machines.</p>
</li>
<li>
<p>On the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> menu or from the <strong>Home</strong> page, select <strong>All resources</strong>. Then select <strong>webVM1</strong>, and select <strong>Stop</strong>.</p>
</li>
<li>
<p>Return to the tab that shows the website and force a refresh of the webpage. All requests are returned from <strong>webVM2</strong>.</p>
</li>
</ol>
<h2 id="internal-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#internal-load-balancer">Internal load balancer</a></h2>
<p>In addition to balancing requests from users to front-end servers, you can use Azure Load Balancer to distribute traffic from front-end servers evenly among back-end servers.</p>
<p>In your healthcare organization, front-end servers call business logic services hosted on a middle tier. You want to ensure that the middle tier is as scalable and resilient as the front end. You want to use a load balancer to distribute requests from the front-end servers evenly among the middle-tier servers. This way, you can scale out the middle-tier servers to achieve the highest capacity possible. You also ensure that the middle tier is resilient to failure. When a server fails, the load balancer automatically reroutes traffic to another server.</p>
<p>Here, you learn how to use load balancers to distribute internal traffic.</p>
<h3 id="configure-an-internal-load-balancer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#configure-an-internal-load-balancer">Configure an internal load balancer</a></h3>
<p>In the healthcare-portal scenario, a web tier handles requests from users. The web tier connects to databases to retrieve data for users. The database tier is also deployed on two virtual machines. To allow the front-end web portal to continue to serve client requests if a database server fails, you can set up an internal load balancer to distribute traffic to the database servers.</p>
<p>You can configure an internal load balancer in almost the same way as an external load balancer, but with these differences:</p>
<ul>
<li>When you create the load balancer, select <strong>Internal</strong> for the <strong>Type</strong> value. When you select this setting, the load balancer's front-end IP address isn't exposed to the internet.</li>
<li>Assign a private IP address instead of a public IP address for the load balancer's front end.</li>
<li>Place the load balancer in the protected virtual network that contains the virtual machines you want to handle the requests.</li>
</ul>
<p>The internal load balancer should be visible only to the web tier. All the virtual machines that host the databases are in one subnet. You can use an internal load balancer to distribute traffic to those virtual machines.</p>
<p><img alt="Diagram showing internal load balancer." src="https://learn.microsoft.com/en-us/training/modules/improve-app-scalability-resiliency-with-load-balancer/media/5-internal-load-balancer.svg" /></p>
<h3 id="choose-the-distribution-mode"><a class="toclink" href="2024/11/14/Az%20104%20-%20Configure%20and%20Manage%20virtual%20networks%20for%20azure%20administrators/#choose-the-distribution-mode">Choose the distribution mode</a></h3>
<p>In the healthcare portal, the application tier is stateless, so you don't need to use source IP affinity. You can use the default distribution mode of a five-tuple hash. This mode offers the greatest scalability and resilience. The load balancer routes traffic to any healthy server.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-11-14 00:00:00">November 14, 2024</time></li>
        
        
          
          <li class="md-meta__item">
            
              117 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="configure-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/">Configure virtual machines</a></h2>
<h2 id="introduction"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#introduction">Introduction</a></h2>
<p>Azure Virtual Machines enables you to create on-demand, scalable computing resources. Azure Architects commonly use virtual machines to gain greater control over the computing environment.</p>
<p>Your company is doing consumer research, and your team manages the on-premises servers. The servers you administer run the entire company infrastructure from web servers to databases. However, the hardware is aging and starting to struggle to keep up with some of the new data analysis applications being deployed. Rather than upgrade the hardware, the company decided to deploy Azure virtual machines. You're responsible for deploying the new virtual machines. Your deployment tasks include correctly sizing the machines, selecting storage, and configuring networking.</p>
<p>In this module, you learn how to configure virtual machine names and locations. You examine virtual machine pricing models and discover how to determine the correct virtual machine size. You learn how to configure virtual machine storage, and how to create a virtual machine in the Azure portal. You select a secure virtual machine connection method, and how to configure Windows and Linux virtual machine connections.</p>
<p>The goal of this module is to learn how to configure and manage virtual machines in Azure.</p>
<h3 id="learning-objectives"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#learning-objectives">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Determine the responsibilities of cloud service providers and customers in a cloud computing environment.</li>
<li>Identify the key considerations and factors involved in planning for virtual machines. Considerations include workload requirements, resource allocation, and secure access.</li>
<li>Configure virtual machine storage and virtual machine sizing.</li>
<li>Create a virtual machine in the Azure portal.</li>
<li>Practice deploying an Azure virtual machine and verify the configuration.</li>
</ul>
<h3 id="skills-measured"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#skills-measured">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/credentials/certifications/exams/az-104/">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#prerequisites">Prerequisites</a></h3>
<ul>
<li>
<p>Cloud computing concepts. Familiarity with Infrastructure as a Service (IaaS), virtualization, and resource provisioning in a cloud environment.</p>
</li>
<li>
<p>Azure fundamentals. Understanding of basic Azure concepts, including Azure subscriptions, resource groups, and storage accounts.</p>
</li>
<li>
<p>Networking fundamentals. Knowledge of basic networking concepts, including IP addressing, virtual networks, and subnets.</p>
</li>
<li>
<p>Azure portal. Ability to create and configure resources in the Azure portal.</p>
</li>
</ul>
<h2 id="review-cloud-services-responsibilities"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#review-cloud-services-responsibilities">Review cloud services responsibilities</a></h2>
<p>The primary advantage of working with virtual machines is to have more control over installed software and configuration settings. Azure Virtual Machines supports more granular control than other Azure services, such as Azure App Service or Azure Cloud Services.</p>
<h4 id="things-to-know-about-azure-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-azure-virtual-machines">Things to know about Azure Virtual Machines</a></h4>
<p>Consider the following characteristics of Azure Virtual Machines.</p>
<ul>
<li>
<p>Azure Virtual Machines is the basis of the Azure infrastructure as a service (IaaS) model. IaaS is an instant computing infrastructure, provisioned and managed over the internet.</p>
</li>
<li>
<p>A virtual machine provides its own operating system, storage, and networking capabilities, and can run a wide range of applications.</p>
</li>
<li>
<p>You can implement multiple virtual machines, and configure each machine with different software and settings to support separate operation scenarios, such as development, testing, and deployment.</p>
</li>
<li>
<p>You can use virtual machines to quickly scale up and down with demand and pay only for what you use.</p>
</li>
<li>
<p>The responsibilities associated with configuring and maintaining virtual machines is shared between Microsoft and the customer. The following chart shows how the responsibilities are handled across the IaaS (virtual machines), PaaS, SaaS, and on-premises offerings.</p>
<p><img alt="Diagram of the shared responsibility areas for IaaS, PaaS, SaaS, and on-premises offerings." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machines/media/responsibility-layers-4ffbf946.png" /></p>
</li>
</ul>
<h4 id="things-to-consider-when-using-iaas-and-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-iaas-and-virtual-machines">Things to consider when using IaaS and virtual machines</a></h4>
<p>Let's look at some scenarios for working with IaaS and virtual machines. Think about how you can implement virtual machines in Azure.</p>
<ul>
<li>
<p><strong>Consider test and development</strong>. Teams can quickly set up and dismantle test and development environments, bringing new applications to market faster. IaaS and virtual machines make it quick and economical to scale up dev-test environments up and down.</p>
</li>
<li>
<p><strong>Consider website hosting</strong>. Running websites by using IaaS and virtual machines can be less expensive than traditional web hosting.</p>
</li>
<li>
<p><strong>Consider storage, backup, and recovery</strong>. Virtual machines let organizations avoid the expense for storage and complexity of storage management. Recovery typically requires a skilled staff to manage data and meet legal and compliance requirements. IaaS is useful for handling unpredictable demand and steadily growing storage needs. You can simplify planning and management of backup and recovery systems.</p>
</li>
<li>
<p><strong>Consider high-performance computing</strong>. Virtual machines enable high-performance computing (HPC) on supercomputers, computer grids, or computer clusters. HPC helps solve complex problems involving millions of variables or calculations. You can support scenarios such as earthquake and protein folding simulations, climate and weather predictions, financial modeling, and evaluating product designs.</p>
</li>
<li>
<p><strong>Consider big data analysis</strong>. Big data is a popular term for massive data sets that contain potentially valuable patterns, trends, and associations. Mining data sets to locate or tease out these hidden patterns requires a huge amount of processing power, which IaaS economically provides.</p>
</li>
<li>
<p><strong>Consider extended datacenters</strong>. Add capacity to your datacenter by adding virtual machines in Azure. Avoid the costs of physically adding hardware or space to your physical location. Connect your physical network to the Azure cloud network seamlessly.</p>
</li>
</ul>
<h2 id="plan-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#plan-virtual-machines">Plan virtual machines</a></h2>
<p>Before you create an Azure virtual machine, it's helpful to make a plan for the machine configuration. You need to consider your preferences for several options, including the machine size and location, storage usage, and associated costs.</p>
<h4 id="things-to-know-about-configuring-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-configuring-virtual-machines">Things to know about configuring virtual machines</a></h4>
<p>Let's walk through a checklist of things you need to consider when configuring a virtual machine.</p>
<ul>
<li>Start with the network.</li>
<li>Choose a name for the virtual machine.</li>
<li>Decide the location for the virtual machine.</li>
<li>Determine the size of the virtual machine.</li>
<li>Review the pricing model and estimate your costs.</li>
<li>Identify which Azure Storage to use with the virtual machine.</li>
<li>Select an operating system for the virtual machine.</li>
</ul>
<h5 id="network-configuration"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#network-configuration">Network configuration</a></h5>
<p>Virtual networks are used in Azure to provide private connectivity between Azure Virtual Machines and other Azure services. Virtual machines and services that are part of the same virtual network can access one another. By default, services outside the virtual network can't connect to services within the virtual network. You can, however, configure the network to allow access to the external service, including your on-premises servers.</p>
<p>Network addresses and subnets aren't trivial to change after configuration. If you plan to connect your private company network to the Azure services, make sure you consider the topology before you put any virtual machines into place.</p>
<h5 id="virtual-machine-name"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#virtual-machine-name">Virtual machine name</a></h5>
<p>The virtual machine name is used as the computer name, which is configured as part of the operating system. You can specify a name with up to 15 characters on a Windows virtual machine and 64 characters on a Linux virtual machine.</p>
<p>The virtual machine name also defines a manageable Azure resource, and it's not trivial to change later. You should choose names that are meaningful and consistent, so you can easily identify what the virtual machine does. A good convention uses several of the following elements in the machine name:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Name element</th>
<th>Examples</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Environment or purpose</strong></td>
<td><code>dev</code> (development), <code>prod</code> (production), <code>QA</code> (testing)</td>
<td>A portion of the name should identify the environment or purpose for the machine.</td>
</tr>
<tr>
<td><strong>Location</strong></td>
<td><code>uw</code> (US West), <code>je</code> (Japan East), <code>ne</code> (North Europe)</td>
<td>Another portion of the name should specify the region where the machine is deployed.</td>
</tr>
<tr>
<td><strong>Instance</strong></td>
<td><code>1</code>, <code>02</code>, <code>005</code></td>
<td>For multiple machines that have similar names, include an instance number in the name to differentiate the machines in the same category.</td>
</tr>
<tr>
<td><strong>Product or service</strong></td>
<td><code>Outlook</code>, <code>SQL</code>, <code>AzureAD</code></td>
<td>A portion of the name can specify the product, application, or service that the machine supports.</td>
</tr>
<tr>
<td><strong>Role</strong></td>
<td><code>security</code>, <code>web</code>, <code>messaging</code></td>
<td>A portion of the name can specify what role the machine supports within the organization.</td>
</tr>
</tbody>
</table>
<p>Let's consider how to name the first development web server for your company, hosted in the US South Central location. In this scenario, you might use the machine name <code>devusc-webvm01</code>. <code>dev</code> stands for development and <code>usc</code> identifies the location. <code>web</code> indicates the machine as a web server, and the suffix <code>01</code> shows the machine is the first in the configuration.</p>
<h5 id="virtual-machine-location"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#virtual-machine-location">Virtual machine location</a></h5>
<p>Azure has datacenters all over the world filled with servers and disks. These datacenters are grouped into geographic regions like West US, North Europe, Southeast Asia, and so on. The datacenters provide redundancy and availability.</p>
<p>Each virtual machine is in a region where you want the resources like CPU and storage to be allocated. The regional location lets you place your virtual machines as close as possible to your users. The location of the machine can improve performance and ensure you meet any legal, compliance, or tax requirements.</p>
<p>There are two other points to consider about the virtual machine location.</p>
<ul>
<li>
<p>The machine location can limit your available options. Each region has different hardware available, and some configurations aren't available in all regions.</p>
</li>
<li>
<p>There are price differences between locations. To find the most cost-effective choice, check for your required configuration in different regions.</p>
</li>
</ul>
<h5 id="virtual-machine-size"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#virtual-machine-size">Virtual machine size</a></h5>
<p>Azure offers different memory and storage options for different <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/sizes">virtual machine sizes</a>. The best way to determine the appropriate machine size is to consider the type of workload your machine needs to run. Based on the workload, you can choose from a subset of available virtual machine sizes.</p>
<h5 id="azure-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#azure-storage">Azure Storage</a></h5>
<p><a href="https://learn.microsoft.com/en-us/azure/virtual-machines/managed-disks-overview">Azure Managed Disks</a> handle Azure storage account creation and management in the background for you. You specify the disk size and the performance tier (Standard or Premium). Azure creates and manages the disk. As you add disks or scale the virtual machine up and down, you don't have to worry about the storage being used.</p>
<h5 id="virtual-machine-pricing-options"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#virtual-machine-pricing-options">Virtual machine pricing options</a></h5>
<p>A subscription is billed two separate costs for every virtual machine: <em>compute</em> and <em>storage</em>. By separating these costs, you can scale them independently and only pay for what you need.</p>
<ul>
<li>
<p><strong>Compute expenses</strong> are priced on a per-hour basis but billed on a per-minute basis. If the virtual machine is deployed for 55 minutes, Azure charges you for only 55 minutes of usage. Azure doesn't charge for compute capacity if you stop and deallocate the virtual machine. The <a href="https://azure.microsoft.com/pricing/details/virtual-machines/linux/">hourly price</a> varies based on the virtual machine size and operating system you select. For the compute costs, you're able to choose from two payment options:</p>
<ul>
<li>
<p><strong>Consumption-based</strong>: With the consumption-based option, you pay for compute capacity by the second. You're able to increase or decrease compute capacity on demand and start or stop at any time. Use consumption-based pricing if you run applications with short-term or unpredictable workloads that can't be interrupted. An example scenario is if you're doing a quick test or developing an app in a virtual machine.</p>
</li>
<li>
<p><strong>Reserved Virtual Machine Instances</strong>: The Reserved Virtual Machine Instances (RI) option is an advance purchase of a virtual machine for one or three years in a specified region. The commitment is made up front, and in return, you get up to 72% price savings compared to pay-as-you-go pricing. RIs are flexible and can easily be exchanged or returned for an early termination fee. Use this option if the virtual machine has to run continuously, or you need budget predictability, and you can commit to using the virtual machine for at least a year.</p>
</li>
</ul>
</li>
<li>
<p><strong>Storage costs</strong> are charged separately for the Azure Storage used by the virtual machine. The status of the virtual machine has no relation to the Azure Storage charges that are incurred. Azure always charges you for any Azure Storage used by the disks.</p>
</li>
</ul>
<h5 id="operating-system"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#operating-system">Operating system</a></h5>
<p>Azure provides various operating system images that you can install into the virtual machine, including several versions of Windows and flavors of Linux. Azure bundles the cost of the operating system license into the price.</p>
<ul>
<li>
<p>If you're looking for more than just base operating system images, you can search <a href="https://azuremarketplace.microsoft.com/marketplace/apps/category/compute">Azure Marketplace</a>. There are various install images that include not only the operating system but popular software tools, such as WordPress. The image stack consists of a Linux server, Apache web server, a MySQL database, and PHP. Instead of setting up and configuring each component, you can install an Azure Marketplace image and get the entire stack all at once.</p>
</li>
<li>
<p>If you don't find a suitable operating system image, you can create your own disk image. Your disk image can be uploaded to Azure Storage and used to create an Azure virtual machine. Keep in mind that Azure only supports 64-bit operating systems.</p>
</li>
</ul>
<h2 id="determine-virtual-machine-sizing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#determine-virtual-machine-sizing">Determine virtual machine sizing</a></h2>
<p>Rather than specify processing power, memory, and storage capacity independently, Azure provides different virtual machine sizes that offer variations of these elements in different size configurations. Azure provides a wide range of virtual machine size options that allow you to select the appropriate mix of compute, memory, and storage for your needs.</p>
<h4 id="things-to-know-about-virtual-machine-sizes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-virtual-machine-sizes">Things to know about virtual machine sizes</a></h4>
<p>The best way to determine the appropriate virtual machine size is to consider the type of workload your virtual machine needs to run. Based on the workload, you can choose from a subset of available virtual machine sizes.</p>
<p>The following table shows size classifications for Azure Virtual Machines workloads and recommended usage scenarios.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Classification</th>
<th>Description</th>
<th>Scenarios</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>General purpose</strong></td>
<td>General-purpose virtual machines are designed to have a balanced CPU-to-memory ratio.</td>
<td>- Testing and development  <br>- Small to medium databases  <br>- Low to medium traffic web servers</td>
</tr>
<tr>
<td><strong>Compute optimized</strong></td>
<td>Compute optimized virtual machines are designed to have a high CPU-to-memory ratio.</td>
<td>- Medium traffic web servers  <br>- Network appliances  <br>- Batch processes  <br>- Application servers</td>
</tr>
<tr>
<td><strong>Memory optimized</strong></td>
<td>Memory optimized virtual machines are designed to have a high memory-to-CPU ratio.</td>
<td>- Relational database servers  <br>- Medium to large caches  <br>- In-memory analytics</td>
</tr>
<tr>
<td><strong>Storage optimized</strong></td>
<td>Storage optimized virtual machines are designed to have high disk throughput and I/O.</td>
<td>- Big Data  <br>- SQL and NoSQL databases  <br>- Data warehousing  <br>- Large transactional databases</td>
</tr>
<tr>
<td><strong>GPU</strong></td>
<td>GPU virtual machines are specialized virtual machines targeted for heavy graphics rendering and video editing. Available with single or multiple GPUs.</td>
<td>- Model training  <br>- Inferencing with deep learning</td>
</tr>
<tr>
<td><strong>High performance computes</strong></td>
<td>High performance compute offers the fastest and most powerful CPU virtual machines with optional high-throughput network interfaces (RDMA).</td>
<td>- Workloads that require fast performance  <br>- High traffic networks</td>
</tr>
</tbody>
</table>
<h5 id="resizing-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#resizing-virtual-machines">Resizing virtual machines</a></h5>
<p>Azure allows you to change the virtual machine size when the existing size no longer meets your needs. You can resize a virtual machine if your current hardware configuration is allowed in the new size. This option provides a fully agile and elastic approach to virtual machine management.</p>
<p>When you stop and deallocate the virtual machine, you can select any size available in your region.</p>
<p>Important</p>
<p>Be cautious when resizing production virtual machines. Resizing a machine might require a restart that can cause a temporary outage or change configuration settings such as the IP address.</p>
<h2 id="determine-virtual-machine-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#determine-virtual-machine-storage">Determine virtual machine storage</a></h2>
<p>Just like any other computer, virtual machines in Azure use disks as a place to store the operating system, applications, and data.</p>
<h4 id="things-to-know-about-virtual-machine-storage-and-disks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-virtual-machine-storage-and-disks">Things to know about virtual machine storage and disks</a></h4>
<p>All Azure virtual machines have at least two disks: an operating system disk and a temporary disk. Virtual machines can also have one or more data disks. All disks are stored as virtual hard disks (VHDs). A VHD is like a physical disk in an on-premises server but, virtualized.</p>
<p><img alt="Diagram that shows disks used by an Azure virtual machine, including disks for the OS, data, and temporary storage." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machines/media/virtual-machine-disks-ff57089c.png" /></p>
<h5 id="operating-system-disk"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#operating-system-disk">Operating system disk</a></h5>
<p>Every virtual machine has one attached operating system disk. The OS disk has a preinstalled operating system, which is selected when the virtual machine is created. The OS disk is registered as a SATA drive (Serial Advanced Technology Attachment) and labeled as the <code>C:</code> drive by default.</p>
<h5 id="temporary-disk"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#temporary-disk">Temporary disk</a></h5>
<p>Data on a temporary disk might be lost during a maintenance event or when you redeploy a virtual machine. During a standard reboot of the virtual machine, the data on the temporary drive should persist. However, there are cases where the data might not persist, such as moving to a new host. Therefore, any data on the temporary drive shouldn't be data that's critical to the system.</p>
<ul>
<li>On Windows virtual machines, the temporary disk is labeled as the <code>D:</code> drive by default. This drive is used for storing the <strong>pagefile.sys</strong> file.</li>
<li>On Linux virtual machines, the temporary disk is typically <code>/dev/sdb</code>. Azure Linux Agent formats this disk and mounts it to <code>/mnt</code>.</li>
</ul>
<p>Important</p>
<p>Don't store data on the temporary disk. This disk provides temporary storage for applications and processes and is intended to only store data like page or swap files.</p>
<h5 id="data-disks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#data-disks">Data disks</a></h5>
<p>A data disk is a managed disk attached to a virtual machine to store application data or other data you need to keep. Data disks are registered as SCSI drives and are labeled with a letter you choose. The size of a virtual machine determines how many data disks you can attach and the type of storage you can use to host the data disks.</p>
<h4 id="things-to-consider-when-choosing-storage-for-your-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-choosing-storage-for-your-virtual-machines">Things to consider when choosing storage for your virtual machines</a></h4>
<p>Review the following considerations about using Azure Storage and Azure Managed Disks with your virtual machines.</p>
<ul>
<li>
<p><strong>Consider Azure Premium Storage</strong>. You can choose Premium Storage to gain high-performance, low-latency disk support for your virtual machines with input/output (I/O)-intensive workloads. Virtual machine disks that use Premium Storage store data on solid-state drives (SSDs). To take advantage of the speed and performance of premium storage disks, you can migrate existing virtual machine disks to Premium Storage.</p>
</li>
<li>
<p><strong>Consider multiple Storage disks</strong>. In Azure, you can attach several Premium Storage disks to a virtual machine. Using multiple disks gives your applications up to 256 TB of storage per virtual machine. With Premium Storage, your applications can achieve 80,000 I/O operations per second (IOPS) per virtual machine, and a disk throughput of up to 2,000 megabytes per second (MB/s) per virtual machine. Read operations completed with Premium Storage yield low latencies.</p>
</li>
<li>
<p><strong>Consider managed disks</strong>. An Azure-managed disk is a VHD. Azure-managed disks are stored as page blobs, which are a random IO storage object in Azure. The disk is described as <em>managed</em> because it's an abstraction over page blobs, blob containers, and Azure storage accounts. With managed disks, you provision the disk, and Azure takes care of the rest. When you choose to use Azure-managed disks with your workloads, Azure creates and manages the disk for you. The available types of disks are Ultra Solid State Drives (SSD), Premium SSD, Standard SSD, and Standard Hard Disk Drives (HDD).</p>
<p>Note</p>
<p>Managed disks are required for the single instance virtual machine SLA.</p>
</li>
<li>
<p><strong>Consider migrating to Premium Storage</strong>. For the best performance for your application, we recommend that you migrate any virtual machine disk that requires high IOPS to Premium Storage. If your disk doesn't require high IOPS, you can help limit costs by keeping it in standard Azure Storage.</p>
</li>
</ul>
<h2 id="create-virtual-machines-in-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-virtual-machines-in-the-azure-portal">Create virtual machines in the Azure portal</a></h2>
<p>When you create virtual machines in the Azure portal, one of your first decisions is to specify which image to use. Azure supports Windows and Linux operating systems, and there are server and client platforms to choose from. You can also search Azure Marketplace for other supported images:</p>
<p><img alt="Screenshot that shows disk images for virtual machines in Azure Marketplace." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machines/media/server-versions-b93232ca.png" /></p>
<h3 id="configure-virtual-machine-image"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-virtual-machine-image">Configure virtual machine image</a></h3>
<p>The Azure portal guides you through the configuration process to create your virtual machine image. The process includes configuring basic and advanced options, and specifying details about the disks, virtual networks, and machine management.</p>
<p><img alt="Screenshot that shows the UI for creating a virtual machine in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machines/media/create-virtual-machines-a75605ba.png" /></p>
<ul>
<li>
<p>The <strong>Basics</strong> tab contains the project details, administrator account, and inbound port rules.</p>
</li>
<li>
<p>On the <strong>Disks</strong> tab, you select the OS disk type and specify your data disks.</p>
</li>
<li>
<p>The <strong>Networking</strong> tab provides settings to create virtual networks and load balancing.</p>
</li>
<li>
<p>On the <strong>Management</strong> tab, you can enable automatic shutdown and specify backup details.</p>
</li>
<li>
<p>On the <strong>Advanced</strong> tab, you can configure agents, scripts, or virtual machine extensions.</p>
</li>
<li>
<p>Other settings are available on the <strong>Monitoring</strong> and <strong>Tags</strong> tabs.</p>
</li>
</ul>
<h4 id="learn-how-to-reduce-costs-when-creating-your-virtual-machine"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#learn-how-to-reduce-costs-when-creating-your-virtual-machine">Learn how to reduce costs when creating your virtual machine</a></h4>
<p><img alt="" src="https://youtu.be/n9QRCdCNtG0" /></p>
<h2 id="connect-to-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#connect-to-virtual-machines">Connect to virtual machines</a></h2>
<p>There are several ways to access your Azure virtual machines. The Azure portal supports options for connecting your Windows and Linux machines, and making connections by using Azure Bastion. The following diagram shows how you can connect Azure virtual machines with the SSH and RDP protocols, Cloud Shell, and Azure Bastion.</p>
<p><img alt="Diagram that shows virtual machine access with the SSH and RDP protocols, Cloud Shell, and Azure Bastion." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machines/media/bastion-connections-29c60c68.png" /></p>
<h4 id="things-to-know-about-connecting-with-azure-bastion"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-connecting-with-azure-bastion">Things to know about connecting with Azure Bastion</a></h4>
<p>The Azure Bastion service is a fully platform-managed PaaS service. Azure Bastion provides secure and seamless RDP/SSH connectivity to your virtual machines directly over SSL. When you connect via Azure Bastion, your virtual machines don't need a public IP address. The following example shows a virtual machine connection with Azure Bastion in the Azure portal.</p>
<p><img alt="" src="https://youtu.be/epWKTGGa_wY" />  </p>
<p>Azure Bastion provides secure RDP and SSH connectivity to all virtual machines in the virtual network. Azure Bastion protects your virtual machines from exposing RDP/SSH ports to the outside world while still providing secure access with RDP/SSH. Azure Bastion lets you connect to the virtual machine directly from the Azure portal. You aren't a client, agent, or another piece of software.</p>
<h4 id="things-to-know-about-connecting-windows-based-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-connecting-windows-based-virtual-machines">Things to know about connecting Windows-based virtual machines</a></h4>
<p>To connect to a Windows-based virtual machine hosted on Azure, use the Microsoft Remote Desktop application with the remote desktop protocol (RDP). The Remote Desktop app provides a graphical user interface (GUI) session to an Azure virtual machine that runs any supported version of Windows. The following image shows how to use the RDP protocol to connect to a Windows-based virtual machine in the Azure portal.</p>
<p><img alt="Screenshot that shows how to use the RDP protocol to connect to a Windows-based virtual machine in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machines/media/rdp-connect.png" /></p>
<p>To create an RDP connection, you specify the IP address for the virtual machine. As an option, you can select the port to use for the connection. The system provides you with a downloadable RDP file to use for the connection.</p>
<h4 id="things-to-know-about-connecting-linux-based-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-connecting-linux-based-virtual-machines">Things to know about connecting Linux-based virtual machines</a></h4>
<p>To connect to a Linux-based virtual machine, you can use a secure shell protocol (SSH) client. SSH is an encrypted connection protocol that allows secure sign-ins over unsecured connections. Depending on your organization's security policies, you can reuse a single public-private key pair to access multiple Azure virtual machines and services. You don't need a separate pair of keys for each virtual machine or service you wish to access. The following image shows how to use the SSH protocol to connect to a Linux-based virtual machine in the Azure portal.</p>
<p><img alt="Screenshot that shows how to use the SSH protocol to connect to a Linux-based virtual machine in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machines/media/connect-ssh.png" /></p>
<ul>
<li>The <strong>public key</strong> is placed on your Linux virtual machine, or any other service that you wish to use with public-key cryptography.</li>
<li>The <strong>private key</strong> remains on your local system.</li>
</ul>
<p>Important</p>
<p><strong>Protect your private key</strong>. Don't share your private key. Your public key can be shared with anyone, but only you (or your local security infrastructure) should possess your private key.</p>
<h2 id="interactive-lab-simulation"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#interactive-lab-simulation">Interactive lab simulation</a></h2>
<h3 id="lab-scenario"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#lab-scenario">Lab scenario</a></h3>
<p>Your organization is planning on using virtual machines in Azure. As the Azure Administrator you need to:</p>
<ul>
<li>Be able to use virtual machine Quickstart templates.</li>
<li>Use templates to create and configure virtual machines.</li>
<li>Be able to monitor virtual machine activity.</li>
</ul>
<h3 id="objectives"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#objectives">Objectives</a></h3>
<ul>
<li><strong>Task 1</strong>: Use the Azure Quickstart Template gallery to deploy a virtual machine.<ul>
<li>Browse to the <a href="https://azure.microsoft.com/resources/templates/">Azure Quickstart Template gallery</a>.</li>
<li>Search for a template that deploys a simple Windows Server virtual machine.</li>
<li>Edit the template and customize the parameters and variables.</li>
<li>Deploy the template to create the virtual machine.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Verify and monitor your virtual machine.<ul>
<li>In the portal, locate your new virtual machine.</li>
<li>View monitoring data for CPU, network, and data usage.</li>
<li>View activity log information.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Click on the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%209"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machines/media/simulation-create-virtual-machine.png" /></a></p>
<hr />
<h2 id="configure-virtual-machine-availability"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-virtual-machine-availability">Configure virtual machine availability</a></h2>
<h2 id="introduction_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#introduction_1">Introduction</a></h2>
<p>Managing virtual machines at scale can be challenging, especially when usage patterns vary and demands on applications fluctuate. Azure Administrators need to be able to adjust their virtual machine resources to match changing demands. At the same time, they need to keep their virtual machine configuration consistent to ensure application stability. Achieving these goals means maintaining throughput and responsiveness while minimizing the costs of continually running a large collection of virtual machines.</p>
<p>Your company website uses virtual machines and manages large workloads. The IT department wants to ensure the virtual machines can dynamically adjust to increases and decreases in workloads. They also want to ensure there's a business continuity plan to provide for highly available machines. You're responsible for deploying highly available virtual machines. You decide to use Azure Virtual Machine Scale Sets and the autoscale feature.</p>
<p>In this module, you learn about scaling virtual machines. You learn about availability zones, availability sets, update domains, and fault domains. You also learn about scale sets and autoscale.</p>
<p>The goal of this module is to learn how to successfully respond to changing virtual machine workloads.</p>
<h3 id="learning-objectives_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#learning-objectives_1">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Implement availability sets and availability zones.</li>
<li>Implement update and fault domains.</li>
<li>Implement Azure Virtual Machine Scale Sets.</li>
<li>Autoscale virtual machines.</li>
</ul>
<h3 id="skills-measured_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#skills-measured_1">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#prerequisites_1">Prerequisites</a></h3>
<ul>
<li>Familiarity with creating and managing Azure virtual machines.</li>
<li>General knowledge of scaling infrastructure resources in fluctuating workloads.</li>
</ul>
<h2 id="plan-for-maintenance-and-downtime"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#plan-for-maintenance-and-downtime">Plan for maintenance and downtime</a></h2>
<p>Azure Administrators must be prepared for planned and unplanned failures. Let's explore three scenarios that can lead to your Azure virtual machine being impacted.</p>
<h4 id="things-to-know-about-maintenance-planning"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-maintenance-planning">Things to know about maintenance planning</a></h4>
<p>An availability plan for Azure virtual machines needs to include strategies for unplanned hardware maintenance, unexpected downtime, and planned maintenance. As you review the following scenarios, think about how these scenarios can affect the example company website.</p>
<ul>
<li>
<p>An <strong>unplanned hardware maintenance</strong> event occurs when the Azure platform predicts that the hardware or any platform component associated to a physical machine is about to fail. When the platform predicts a failure, it issues an unplanned hardware maintenance event. Azure uses Live Migration technology to migrate your virtual machines from the failing hardware to a healthy physical machine. Live Migration is a virtual machine preserving operation that only pauses the virtual machine for a short time, but performance might be reduced before or after the event.</p>
</li>
<li>
<p><strong>Unexpected downtime</strong> occurs when the hardware or the physical infrastructure for your virtual machine fails unexpectedly. Unexpected downtime can include local network failures, local disk failures, or other rack level failures. When detected, the Azure platform automatically migrates (heals) your virtual machine to a healthy physical machine in the same datacenter. During the healing procedure, virtual machines experience downtime (reboot) and in some cases loss of the temporary drive.</p>
</li>
<li>
<p><strong>Planned maintenance</strong> events are periodic updates made by Microsoft to the underlying Azure platform to improve overall reliability, performance, and security of the platform infrastructure that your virtual machines run on. Most of these updates are performed without any impact to your virtual machines or Cloud Services.</p>
</li>
</ul>
<p>Note</p>
<p>Microsoft doesn't automatically update your virtual machine operating system or other software. You have complete control and responsibility for those updates. However, the underlying software host and hardware are periodically patched to ensure reliability and high performance.</p>
<h2 id="create-availability-sets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-availability-sets">Create availability sets</a></h2>
<p>An availability set is a logical feature you can use to ensure a group of related virtual machines are deployed together. The grouping helps to prevent a single point of failure from affecting all of your machines. The grouping ensures that not all of the machines are upgraded at the same time during a host operating system upgrade in the datacenter.</p>
<h4 id="things-to-know-about-availability-sets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-availability-sets">Things to know about availability sets</a></h4>
<p>Let's review some characteristics of availability sets.</p>
<ul>
<li>
<p>All virtual machines in an availability set should perform the identical set of functionalities.</p>
</li>
<li>
<p>All virtual machines in an availability set should have the same software installed.</p>
</li>
<li>
<p>Azure ensures that virtual machines in an availability set run across multiple physical servers, compute racks, storage units, and network switches.</p>
<p>If a hardware or Azure software failure occurs, only a subset of the virtual machines in the availability set are affected. Your application stays up and continues to be available to your customers.</p>
</li>
<li>
<p>You can create a virtual machine and an availability set at the same time.</p>
<p>A virtual machine can only be added to an availability set when the virtual machine is created. To change the availability set for a virtual machine, you need to delete and then recreate the virtual machine.</p>
</li>
<li>
<p>You can build availability sets by using the Azure portal, Azure Resource Manager (ARM) templates, scripting, or API tools.</p>
</li>
<li>
<p>Microsoft provides robust Service Level Agreements (SLAs) for Azure virtual machines and availability sets. For details, see <a href="https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_9/">SLA for Azure Virtual Machines</a>.</p>
</li>
</ul>
<p>Note</p>
<p>Adding your virtual machines to an availability set won't protect your applications from operating system or application-specific failures. You'll need to explore other disaster recovery and backup techniques to provide application-level protection.</p>
<h4 id="things-to-consider-when-using-availability-sets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-availability-sets">Things to consider when using availability sets</a></h4>
<p>Availability sets are an essential capability when you want to build reliable cloud solutions. In your planning for availability sets, keep the following general principles in mind:</p>
<ul>
<li>
<p><strong>Consider redundancy</strong>. To achieve redundancy in your configuration, place multiple virtual machines in an availability set.</p>
</li>
<li>
<p><strong>Consider separation of application tiers</strong>. Each application tier exercised in your configuration should be located in a separate availability set. The separation helps to mitigate single point of failure on all machines.</p>
</li>
<li>
<p><strong>Consider load balancing</strong>. For high availability and network performance, create a load-balanced availability set by using Azure Load Balancer. Load Balancer distributes incoming traffic across working instances of services that are defined in your load-balanced availability set.</p>
</li>
<li>
<p><strong>Consider managed disks</strong>. You can use Azure managed disks with your Azure virtual machines in availability sets for block-level storage.</p>
</li>
</ul>
<h2 id="review-update-domains-and-fault-domains"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#review-update-domains-and-fault-domains">Review update domains and fault domains</a></h2>
<p>Azure Virtual Machine Availability Sets implements two node concepts to help Azure maintain high availability and fault tolerance when deploying and upgrading applications: <em>update domains</em> and <em>fault domains</em>. Each virtual machine in an availability set is placed in one update domain and one fault domain.</p>
<h4 id="things-to-know-about-update-domains"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-update-domains">Things to know about update domains</a></h4>
<p>An update domain is a group of nodes that are upgraded together during the process of a service upgrade (or <em>rollout</em>). An update domain allows Azure to perform incremental or rolling upgrades across a deployment. Here are some other characteristics of update domains.</p>
<ul>
<li>
<p>Each update domain contains a set of virtual machines and associated physical hardware that can be updated and rebooted at the same time.</p>
</li>
<li>
<p>During planned maintenance, only one update domain is rebooted at a time.</p>
</li>
<li>
<p>By default, there are five (non-user-configurable) update domains.</p>
</li>
<li>
<p>You can configure up to 20 update domains.</p>
</li>
</ul>
<h4 id="things-to-know-about-fault-domains"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-fault-domains">Things to know about fault domains</a></h4>
<p>A fault domain is a group of nodes that represent a physical unit of failure. Think of a fault domain as nodes that belong to the same physical rack.</p>
<ul>
<li>
<p>A fault domain defines a group of virtual machines that share a common set of hardware (or <em>switches</em>) that share a single point of failure. An example is a server rack serviced by a set of power or networking switches.</p>
</li>
<li>
<p>Two fault domains work together to mitigate against hardware failures, network outages, power interruptions, or software updates.</p>
</li>
</ul>
<p>Let's look at a scenario with two fault domains that have two virtual machines each. The virtual machines in each fault domain are contained in different availability sets. The web availability set contains two virtual machines with one machine from each fault domain. The SQL availability set contains two different virtual machines with one from each fault domain.</p>
<p><img alt="Illustration that shows two fault domains with two virtual machines each. The virtual machines in each fault domain are contained in different availability sets." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machine-availability/media/update-fault-domains-c1ceee00.png" /></p>
<h2 id="review-availability-zones"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#review-availability-zones">Review availability zones</a></h2>
<p>Availability zones are a high-availability offering that protects your applications and data from datacenter failures. An availability zone in an Azure region is a combination of a fault domain and an update domain.</p>
<p>Consider a scenario where you create three or more virtual machines across three zones in an Azure region. Your virtual machines are effectively distributed across three fault domains and three update domains. The Azure platform recognizes this distribution across update domains to make sure that virtual machines in different zones aren't updated at the same time.</p>
<p>You can use availability zones to build high-availability into your application architecture by colocating your compute, storage, networking, and data resources within a zone and replicating in other zones.</p>
<h4 id="things-to-know-about-availability-zones"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-availability-zones">Things to know about availability zones</a></h4>
<p>Review the following characteristics of availability zones.</p>
<ul>
<li>
<p>Availability zones are unique physical locations within an Azure region.</p>
</li>
<li>
<p>Each zone is made up of one or more datacenters that are equipped with independent power, cooling, and networking.</p>
</li>
<li>
<p>To ensure resiliency, there's a minimum of three separate zones in all enabled regions.</p>
</li>
<li>
<p>The physical separation of availability zones within a region protects applications and data from datacenter failures.</p>
</li>
<li>
<p>Zone-redundant services replicate your applications and data across availability zones to protect against single-points-of-failure.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-availability-zones"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-availability-zones">Things to consider when using availability zones</a></h4>
<p>Azure services that support availability zones are divided into two categories.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Description</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Zonal services</strong></td>
<td>Azure <em>zonal</em> services pin each resource to a specific zone.</td>
<td>- Azure Virtual Machines  <br>- Azure managed disks  <br>- Standard IP addresses</td>
</tr>
<tr>
<td><strong>Zone-redundant services</strong></td>
<td>For Azure services that are zone-redundant, the platform replicates automatically across all zones.</td>
<td>- Azure Storage that's zone-redundant  <br>- Azure SQL Database</td>
</tr>
</tbody>
</table>
<p>Tip</p>
<p>To achieve comprehensive business continuity on Azure, build your application architecture by using a combination of availability zones with Azure region pairs.</p>
<h2 id="compare-vertical-and-horizontal-scaling"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#compare-vertical-and-horizontal-scaling">Compare vertical and horizontal scaling</a></h2>
<p>A robust virtual machine configuration includes support for scalability. Scalability allows throughput for a virtual machine in proportion to the availability of the associated hardware resources. A scalable virtual machine can handle increases in requests without adversely affecting response time and throughput. For most scaling operations, there are two implementation options: <em>vertical</em> and <em>horizontal</em>.</p>
<h4 id="things-to-know-about-vertical-scaling"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-vertical-scaling">Things to know about vertical scaling</a></h4>
<p>Vertical scaling, also known as <em>scale up and scale down</em>, involves increasing or decreasing the virtual machine <strong>size</strong> in response to a workload. Vertical scaling makes a virtual machine more (scale up) or less (scale down) powerful.</p>
<p><img alt="Illustration that shows vertical scaling where a single virtual machine increases or decreases in size by scaling up or scaling down." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machine-availability/media/vertical-scaling-cdafa792.png" /></p>
<p>Here are some scenarios where using vertical scaling can be advantageous:</p>
<ul>
<li>
<p>If you have a service built on a virtual machine that's under-utilized such as on the weekend, you can use vertical scaling to decrease the virtual machine size and reduce your monthly costs.</p>
</li>
<li>
<p>You can implement vertical scaling to increase your virtual machine size to support larger demand without having to create extra virtual machines.</p>
</li>
</ul>
<h4 id="things-to-know-about-horizontal-scaling"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-horizontal-scaling">Things to know about horizontal scaling</a></h4>
<p>Horizontal scaling is used to adjust the <strong>number</strong> of virtual machines in your configuration to support the changing workload. When you implement horizontal scaling, there's an increase (scale out) or decrease (scale in) in the number of virtual machine instances.</p>
<p><img alt="Illustration that shows horizontal scaling where virtual machines are added to scale out the system to support the workload." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machine-availability/media/horizontal-scaling-3e457e75.png" /></p>
<h4 id="things-to-consider-when-using-vertical-and-horizontal-scaling"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-vertical-and-horizontal-scaling">Things to consider when using vertical and horizontal scaling</a></h4>
<p>Review the following considerations regarding vertical and horizontal scaling. Think about which implementation might be required to support your company website.</p>
<ul>
<li>
<p><strong>Consider limitations</strong>. Generally speaking, horizontal scaling has fewer limitations than vertical scaling. A vertical scaling implementation depends on the availability of larger hardware, which quickly hits an upper limit and can vary by region. Vertical scaling also usually requires a virtual machine to stop and restart, which can temporarily limit access to applications or data.</p>
</li>
<li>
<p><strong>Consider flexibility</strong>. When operating in the cloud, horizontal scaling is more flexible. A horizontal scaling implementation allows you to run potentially thousands of virtual machines to manage changes in workload and throughput.</p>
</li>
<li>
<p><strong>Consider reprovisioning</strong>. <em>Reprovisioning</em> is the process of removing an existing virtual machine and replacing it with a new machine. A robust availability plan considers where reprovisioning might be required and plans for interruptions to service. If reprovisioning might be required, determine if any data needs to be maintained and migrated to the new machine.</p>
</li>
</ul>
<h2 id="implement-azure-virtual-machine-scale-sets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#implement-azure-virtual-machine-scale-sets">Implement Azure Virtual Machine Scale Sets</a></h2>
<p>Azure Virtual Machine Scale Sets are an Azure Compute resource that you can use to deploy and manage a set of <strong>identical</strong> virtual machines. When you implement Virtual Machine Scale Sets and configure all your virtual machines in the same way, you gain true <em>autoscaling</em>. Virtual Machine Scale Sets automatically increases the number of your virtual machine instances as application demand increases, and reduces the number of machine instances as demand decreases.</p>
<p>With Virtual Machine Scale Sets, you don't need to pre-provision your virtual machines. It's easier to build large-scale services that target large compute, big data, and containerized workloads. As workloads increase, more virtual machine instances can be added. As workloads decrease, virtual machines instances can be removed. The process of adding and removing machines can be manual or automated, or a combination of both.</p>
<h4 id="things-to-know-about-azure-virtual-machine-scale-sets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-azure-virtual-machine-scale-sets">Things to know about Azure Virtual Machine Scale Sets</a></h4>
<p>Review the following characteristics of Azure Virtual Machine Scale Sets.</p>
<ul>
<li>
<p>All virtual machine instances are created from the same base operating system image and configuration. This approach lets you easily manage hundreds of virtual machines without extra configuration tasks or network management.</p>
</li>
<li>
<p>Virtual Machine Scale Sets support the use of Azure Load Balancer for basic layer-4 traffic distribution, and Azure Application Gateway for more advanced layer-7 traffic distribution and SSL termination.</p>
</li>
<li>
<p>You can use Virtual Machine Scale Sets to run multiple instances of your application. If one of the virtual machine instances has a problem, customers continue to access your application through another virtual machine instance with minimal interruption.</p>
</li>
<li>
<p>Customer demand for your application might change throughout the day or week. To meet customer demand, Virtual Machine Scale Sets implements autoscaling to automatically increase and decrease the number of virtual machines.</p>
</li>
<li>
<p>Virtual Machine Scale Sets support up to 1,000 virtual machine instances. If you create and upload your own custom virtual machine images, the limit is 600 virtual machine instances.</p>
</li>
</ul>
<h2 id="create-virtual-machine-scale-sets"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-virtual-machine-scale-sets">Create Virtual Machine Scale Sets</a></h2>
<p>You can implement Azure Virtual Machine Scale Sets in the Azure portal. You specify the number of virtual machines and their sizes, and indicate preferences for using Azure Spot instances, Azure managed disks, and allocation policies.</p>
<p>In the Azure portal, there are several settings to configure to create an Azure Virtual Machine Scale Sets implementation.</p>
<p><img alt="Screenshot that shows how to create Virtual Machine Scale Sets in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machine-availability/media/implement-scale-sets-61516afb.png" /></p>
<ul>
<li>
<p><strong>Orchestration mode</strong>: Choose how the scale set manages virtual machines. In flexible orchestration mode, you manually create and add a virtual machine of any configuration to the scale set. In uniform orchestration mode, you define a virtual machine model and Azure generates identical instances based on that model.</p>
</li>
<li>
<p><strong>Image</strong>: Choose the base operating system or application for the virtual machine (VM).</p>
</li>
<li>
<p><strong>VM Architecture</strong>: Azure provides a choice of x64 or Arm64-based virtual machines to run your applications.</p>
</li>
<li>
<p><strong>Run with Azure Spot discount</strong>: Azure Spot offers unused Azure capacity at a discounted rate versus pay as you go prices. Workloads should be tolerant to infrastructure loss as Azure may recall capacity.</p>
</li>
<li>
<p><strong>Size</strong>: Select a VM size to support the workload that you want to run. The size that you choose then determines factors such as processing power, memory, and storage capacity. Azure offers a wide variety of sizes to support many types of uses. Azure charges an hourly price based on the VM's size and operating system.</p>
</li>
</ul>
<p>Under the <strong>Advanced</strong> tab, you can also select the following:</p>
<ul>
<li>
<p><strong>Enable scaling beyond 100 instances</strong>: Identify your scaling allocation preference. If you select <strong>No</strong>, your Virtual Machine Scale Sets implementation is limited to one placement group with a maximum capacity of 100. If you select <strong>Yes</strong>, your implementation can span multiple placement groups with capacity up to 1,000. Selecting <strong>Yes</strong> also changes the availability characteristics of your implementation.</p>
</li>
<li>
<p><strong>Spreading algorithm</strong>: Microsoft recommends allocating <strong>Max spreading</strong> for your implementation. This approach provides the optimal spreading.</p>
</li>
</ul>
<h2 id="implement-autoscale"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#implement-autoscale">Implement autoscale</a></h2>
<p>An Azure Virtual Machine Scale Sets implementation can automatically increase or decrease the number of virtual machine instances that run your application. This process is known as <em>autoscaling</em>. Autoscaling allows you to dynamically scale your configuration to meet changing workload demands.</p>
<p><img alt="Illustration of a Virtual Machine Scale Sets implementation with a minimum of two virtual machines and a maximum of five machines that autoscale depending on workload demands." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machine-availability/media/autoscale-45b054e0.png" /></p>
<p>Autoscaling minimizes the number of unnecessary virtual machine instances that run your application when demand is low. Your customers continue to receive an acceptable level of performance as demand grows and more virtual machine instances are automatically added.</p>
<h4 id="things-to-consider-when-using-autoscaling"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-autoscaling">Things to consider when using autoscaling</a></h4>
<p>Review the following considerations about autoscaling. Think about how this process can benefit your company website implementation.</p>
<ul>
<li>
<p><strong>Consider automatic adjusted capacity</strong>. You can create autoscaling rules to define the acceptable performance for a positive customer experience. When the defined thresholds are met, the autoscale rules act to adjust the capacity of your Virtual Machine Scale Sets implementation.</p>
</li>
<li>
<p><strong>Consider scale out</strong>. If your application demand increases, the load on the virtual machine instances in your implementation increases. If the increased load is consistent, rather than a brief demand, you can configure autoscale rules to increase the number of virtual machine instances in your implementation.</p>
</li>
<li>
<p><strong>Consider scale in</strong>. On an evening or weekend, your application demand might decrease. If the decreased load is consistent over a period of time, you can configure autoscale rules to decrease the number of virtual machine instances in your implementation. The scale-in action reduces the cost to run your Virtual Machine Scale Sets implementation as you only run the number of instances required to meet the current demand.</p>
</li>
<li>
<p><strong>Consider scheduled events</strong>. You can implement autoscaling and schedule events to automatically increase or decrease the capacity of your implementation at fixed times.</p>
</li>
<li>
<p><strong>Consider overhead</strong>. Using Azure Virtual Machine Scale Sets with autoscaling reduces your management overhead to monitor and optimize the performance of your application.</p>
</li>
</ul>
<h2 id="configure-autoscale"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-autoscale">Configure autoscale</a></h2>
<p>When you create an Azure Virtual Machine Scale Sets implementation in the Azure portal, you can enable autoscaling. For optimal performance, you should define a minimum, maximum, and default number of virtual machine instances to use during the autoscale process.</p>
<p>In the Azure portal, there are several settings to configure to enable autoscaling with Azure Virtual Machine Scale Sets.</p>
<p><img alt="Screenshot of the settings for configuring virtual machine instances and autoscale in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machine-availability/media/implement-autoscale-74d25345.png" /></p>
<p><strong>Scaling policy</strong>: Manual scale maintains a fixed instance count. Custom autoscale scales the capacity on any schedule, based on any metrics.</p>
<ul>
<li>
<p><strong>Minimum number of VMs</strong>: Specify the minimum number of virtual machines that should be available when autoscaling is applied on your Virtual Machine Scale Sets implementation.</p>
</li>
<li>
<p><strong>Maximum number of VMs</strong>: Specify the maximum number of virtual machines that can be available when autoscaling is applied on your implementation.</p>
</li>
</ul>
<p><strong>Scale out</strong></p>
<ul>
<li>
<p><strong>CPU threshold</strong>: Specify the CPU usage percentage threshold to trigger the scale-out autoscale rule.</p>
</li>
<li>
<p><strong>Duration in minutes</strong>: Duration in minutes is the amount of time that Autoscale engine looks back for metrics. For example, 10 minutes means that every time autoscale runs, it queries metrics for the past 10 minutes. This delay allows your metrics to stabilize and avoids reacting to transient spikes.</p>
</li>
<li>
<p><strong>Number of VMs to increase by</strong>: Specify the number of virtual machines to add to your Virtual Machine Scale Sets implementation when the scale-out autoscale rule is triggered.</p>
</li>
</ul>
<p><strong>Scale in</strong></p>
<ul>
<li>
<p><strong>Scale in CPU threshold</strong>: Specify the CPU usage percentage threshold to trigger the scale-in autoscale rule.</p>
</li>
<li>
<p><strong>Number of VMs to decrease by</strong>: Specify the number of virtual machines to remove from your implementation when the scale-in autoscale rule is triggered.</p>
</li>
</ul>
<p><strong>Scale in policy</strong>: The <a href="https://learn.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-scale-in-policy">scale-in policy</a> feature provides users a way to configure the order in which virtual machines are scaled-in.</p>
<h2 id="interactive-lab-simulation_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#interactive-lab-simulation_1">Interactive lab simulation</a></h2>
<h3 id="lab-scenario_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#lab-scenario_1">Lab scenario</a></h3>
<p>Your organization is deploying virtual machines in Azure. As the Azure Administrator you need to:</p>
<ul>
<li>Determine different virtual machine compute and storage options.</li>
<li>Implement Virtual Machine Scale Sets, including storage resiliency and scalability options.</li>
<li>Explore using Azure Virtual Machine Custom Script extensions to automatically configure virtual machines.</li>
</ul>
<h3 id="architecture-diagram"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#architecture-diagram">Architecture diagram</a></h3>
<p><img alt="Architecture diagram as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machine-availability/media/lab-08.png" /></p>
<h3 id="objectives_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#objectives_1">Objectives</a></h3>
<p>Note</p>
<p>The <a href="https://github.com/MicrosoftLearning/AZ-104-MicrosoftAzureAdministrator/tree/master/Allfiles/Interactive%20Lab%20Simulation%20Files/08">lab files</a> are available in the GitHub.</p>
<ul>
<li><strong>Task 1</strong>: Deploy zone-resilient Azure virtual machines by using the Azure portal and an Azure Resource Manager template.<ul>
<li>Create a virtual machine in the Azure portal.</li>
<li>Review the template and deploy a second virtual machine.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Configure Azure virtual machines by using virtual machine extensions.<ul>
<li>Create a blob storage container.</li>
<li>Upload an Azure PowerShell script. This script installs the Windows Server Web Server role on a virtual machine.</li>
<li>Use the custom script extension feature to run the script on a virtual machine. Export the template.</li>
<li>Configure the exported template to install the role on a different virtual machine.</li>
</ul>
</li>
<li><strong>Task 3</strong>: Scale compute and storage for Azure virtual machines. In this task, you scale compute for Azure virtual machines by changing their size and scale their storage by attaching and configuring their data disks.<ul>
<li>Resize the virtual machine.</li>
<li>Create and attach a new disk to the virtual machine.</li>
<li>Use Azure PowerShell to initialize and partition the new disk.</li>
<li>Customize the template to resize the virtual machine and change the disk configuration.</li>
</ul>
</li>
<li><strong>Task 4</strong>: Register the Microsoft Insights and Microsoft Alerts Management resource providers.</li>
<li>
<p><strong>Task 5</strong>: Deploy zone-resilient Azure Virtual Machine Scale Sets by using the Azure portal.</p>
<ul>
<li>Use the Azure portal to create a Virtual Machine Scale Set.</li>
<li>Configure the virtual network to include an inbound rule to allow HTTP.</li>
<li>
<p>Configure load balancing and manual scaling.</p>
</li>
<li>
<p>Deploy the virtual scale set.</p>
</li>
<li><strong>Task 6</strong>: Configure Azure Virtual Machine Scale Sets by using virtual machine extensions.</li>
<li>Upload an Azure PowerShell script to install the install Windows Server Web Server role.</li>
<li>Run the script on the virtual machines using the custom script extension feature.</li>
<li>Confirm the Internet Information Service (IIS) is now available on the virtual machines.</li>
<li><strong>Task 7</strong>: Scale compute and storage for Azure Virtual Machine Scale Sets.</li>
<li>Confirm the virtual machines in the scale set are in different regions.</li>
<li>Configure autoscale based on a metric.</li>
<li>Use Azure PowerShell to start an infinite loop that sends the HTTP requests to the web sites hosted on the instances of Azure Virtual Machine Scale Sets</li>
<li>Verify a new resource is provisioned.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Click on the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2012"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-virtual-machine-availability/media/simulation-compute-thumbnail.jpg" /></a></p>
<hr />
<h2 id="configure-azure-app-service-plans"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-azure-app-service-plans">Configure Azure App Service plans</a></h2>
<h2 id="introduction_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#introduction_2">Introduction</a></h2>
<p>Azure Administrators need to be able to scale a web application. Scaling enables an application to remain responsive during periods of high demand. Scaling also helps to save money by reducing the resources required when demand drops.</p>
<p>Suppose you work for a large chain of hotels. You're responsible for maintaining the hotel website. Customers visit the website to make new reservations and view details for their current bookings. At certain times of the year, the volume of website traffic grows because customers are browsing hotels for vacations during national/regional holidays. At other times, traffic declines. These website usage patterns are predictable.</p>
<p>In this module, you learn to implementing Azure App Service plans. You learn how different App Service plans provide different pricing and scaling options. You learn how changing the plan affects performance.</p>
<p>The goal of this module is to ensure you can determine the best App Service plan for your application.</p>
<h3 id="learning-objectives_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#learning-objectives_2">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify features and usage cases for Azure App Service.</li>
<li>Select an appropriate Azure App Service plan pricing tier.</li>
<li>Scale an Azure App Service plan.</li>
<li>Scale out an Azure App Service plan.</li>
</ul>
<h3 id="skills-measured_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#skills-measured_2">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#prerequisites_2">Prerequisites</a></h3>
<ul>
<li>Basic knowledge of scaling and performance concepts.</li>
<li>Familiarity with the Azure portal so you can configure the correct App Service plan.</li>
</ul>
<h2 id="implement-azure-app-service-plans"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#implement-azure-app-service-plans">Implement Azure App Service plans</a></h2>
<p>In Azure App Service, an application runs in an Azure App Service plan. An App Service plan defines a set of compute resources for a web application to run. The compute resources are analogous to a server farm in conventional web hosting. One or more applications can be configured to run on the same computing resources (or in the same App Service plan).</p>
<h4 id="things-to-know-about-app-service-plans"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-app-service-plans">Things to know about App Service plans</a></h4>
<p>Let's take a closer look at how to implement and use an App Service plan with your virtual machines.</p>
<ul>
<li>
<p>When you create an App Service plan in a region, a set of compute resources is created for the plan in the specified region. Any applications that you place into the plan run on the compute resources defined by the plan.</p>
</li>
<li>
<p>Each App Service plan defines three settings:</p>
<ul>
<li><strong>Region</strong>: The region for the App Service plan, such as West US, Central India, North Europe, and so on.</li>
<li><strong>Number of VM instances</strong>: The number of virtual machine instances to allocate for the plan.</li>
<li><strong>Size of VM instances</strong>: The size of the virtual machine instances in the plan, including Small, Medium, or Large.</li>
<li>You can continue to add new applications to an existing plan as long as the plan has enough resources to handle the increasing load.</li>
</ul>
</li>
</ul>
<h5 id="how-applications-run-and-scale-in-app-service-plans"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#how-applications-run-and-scale-in-app-service-plans">How applications run and scale in App Service plans</a></h5>
<p>The Azure App Service plan is the scale unit of App Service applications. Depending on the pricing tier for your Azure App Service plan, your applications run and scale in a different manner. If your plan is configured to run five virtual machine instances, then all applications in the plan run on all five instances. If your plan is configured for autoscaling, then all applications in the plan are scaled out together based on the autoscale settings.</p>
<p>Here's a summary of how applications run and scale in Azure App Service plan pricing tiers:</p>
<ul>
<li>
<p><strong>Free or Shared tier</strong>:</p>
<ul>
<li>Applications run by receiving CPU minutes on a shared virtual machine instance.</li>
<li>Applications can't scale out.</li>
<li>
<p><strong>Basic, Standard, Premium, or Isolated tier</strong>:</p>
</li>
<li>
<p>Applications run on all virtual machine instances configured in the App Service plan.</p>
</li>
<li>Multiple applications in the same plan share the same virtual machine instances.</li>
<li>If you have multiple deployment slots for an application, all deployment slots run on the same virtual machine instances.</li>
<li>If you enable diagnostic logs, perform backups, or run WebJobs, these tasks use CPU cycles and memory on the same virtual machine instances.</li>
</ul>
</li>
</ul>
<h4 id="things-to-consider-when-using-app-service-plans"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-app-service-plans">Things to consider when using App Service plans</a></h4>
<p>Review the following considerations about using Azure App Service plans to run and scale your applications. Think about what conditions might apply to running and scaling the hotel website.</p>
<ul>
<li>
<p><strong>Consider cost savings</strong>. Because you pay for the computing resources that your App Service plan allocates, you can potentially save money by placing multiple applications into the same App Service plan.</p>
</li>
<li>
<p><strong>Consider multiple applications in one plan</strong>. Create a single plan to support multiple applications, to make it easier to configure and maintain shared virtual machine instances. Because the applications share the same virtual machine instances, you need to carefully manage your plan resources and capacity.</p>
</li>
<li>
<p><strong>Consider plan capacity</strong>. Before you add a new application to an existing plan, determine the resource requirements for the new application and identify the remaining capacity of your plan.</p>
<p>Important</p>
<p>Overloading an App Service plan can potentially cause downtime for new and existing applications.</p>
</li>
<li>
<p><strong>Consider application isolation</strong>. Isolate your application into a new App Service plan when:</p>
<ul>
<li>The application is resource-intensive.</li>
<li>You want to scale the application independently from the other applications in the existing plan.</li>
<li>The application needs resource in a different geographical region.</li>
</ul>
</li>
</ul>
<h2 id="determine-azure-app-service-plan-pricing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#determine-azure-app-service-plan-pricing">Determine Azure App Service plan pricing</a></h2>
<p>The pricing tier of an Azure App Service plan determines what App Service features you get and how much you pay for the plan.</p>
<h4 id="things-to-know-about-app-service-plan-pricing-tiers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-app-service-plan-pricing-tiers">Things to know about App Service plan pricing tiers</a></h4>
<p>There are six categories of pricing tiers for an Azure App Service plan. Examine the following plan details and think about which plans can support the hotel website requirements.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Free</th>
<th>Shared</th>
<th>Basic</th>
<th>Standard</th>
<th>Premium</th>
<th>Isolated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Usage</td>
<td>Development, Testing</td>
<td>Development, Testing</td>
<td>Dedicated development, Testing</td>
<td>Production workloads</td>
<td>Enhanced scale, performance</td>
<td>High performance, security, isolation</td>
</tr>
<tr>
<td>Web, mobile, or API applications</td>
<td>10</td>
<td>100</td>
<td>Unlimited</td>
<td>Unlimited</td>
<td>Unlimited</td>
<td>Unlimited</td>
</tr>
<tr>
<td>Disk space</td>
<td>1 GB</td>
<td>1 GB</td>
<td>10 GB</td>
<td>50 GB</td>
<td>250 GB</td>
<td>1 TB</td>
</tr>
<tr>
<td>Auto scale</td>
<td>n/a</td>
<td>n/a</td>
<td>n/a</td>
<td>Supported</td>
<td>Supported</td>
<td>Supported</td>
</tr>
<tr>
<td>Deployment slots</td>
<td>n/a</td>
<td>n/a</td>
<td>n/a</td>
<td>5</td>
<td>20</td>
<td>20</td>
</tr>
<tr>
<td>Max instances</td>
<td>n/a</td>
<td>n/a</td>
<td>Up to 3</td>
<td>Up to 10</td>
<td>Up to 30</td>
<td>Up to 100</td>
</tr>
</tbody>
</table>
<h5 id="free-and-shared"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#free-and-shared">Free and Shared</a></h5>
<p>The Free and Shared service plans are base tiers that run on the same Azure virtual machines as other applications. Some applications might belong to other customers. These tiers are intended to be used for development and testing purposes only. No SLA is provided for the Free and Shared service plans. Free and Shared plans are metered on a per application basis.</p>
<h5 id="basic"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#basic">Basic</a></h5>
<p>The Basic service plan is designed for applications that have lower traffic requirements, and don't need advanced auto scale and traffic management features. Pricing is based on the size and number of instances you run. Built-in network load-balancing support automatically distributes traffic across instances. The Basic service plan with Linux runtime environments supports Web App for Containers.</p>
<h5 id="standard"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#standard">Standard</a></h5>
<p>The Standard service plan is designed for running production workloads. Pricing is based on the size and number of instances you run. Built-in network load-balancing support automatically distributes traffic across instances. The Standard plan includes auto scale that can automatically adjust the number of virtual machine instances running to match your traffic needs. The Standard service plan with Linux runtime environments supports Web App for Containers.</p>
<h5 id="premium"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#premium">Premium</a></h5>
<p>The Premium service plan is designed to provide enhanced performance for production applications. The upgraded Premium plan, Premium v2, offers Dv2-series virtual machines with faster processors, SSD storage, and double memory-to-core ratio compared to the Standard tier. The new Premium plan also supports higher scale via increased instance count while still providing all the advanced capabilities of the Standard tier. The first generation of Premium plan is still available to support existing customer scaling needs.</p>
<h5 id="isolated"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#isolated">Isolated</a></h5>
<p>The Isolated service plan is designed to run mission critical workloads that are required to run in a virtual network. The Isolated plan allows customers to run their applications in a private, dedicated environment in an Azure datacenter. The plan offers Dv2-series virtual machines with faster processors, SSD storage, and a double memory-to-core ratio compared to the Standard tier. The private environment used with an Isolated plan is called the App Service Environment. The plan can scale to 100 instances with more available upon request.</p>
<h2 id="scale-up-and-scale-out-azure-app-service"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#scale-up-and-scale-out-azure-app-service">Scale up and scale out Azure App Service</a></h2>
<p>There are two methods for scaling your Azure App Service plan and applications: <em>scale up</em> and <em>scale out</em>. You can scale your applications manually or automatically, which is referred to as <em>autoscale</em>.</p>
<p>Watch the following video about how to implement automatic scaling for your Azure App Service plan and applications.</p>
<h4 id="things-to-know-about-azure-app-service-scaling"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-azure-app-service-scaling">Things to know about Azure App Service scaling</a></h4>
<p>Let's examine the details of scaling for your Azure App Service plan and App Service applications.</p>
<ul>
<li>
<p>The scale up method increases the amount of CPU, memory, and disk space. Scaling up gives you extra features like dedicated virtual machines, custom domains and certificates, staging slots, autoscaling, and more. You scale up by changing the pricing tier of the Azure App Service plan where your application is placed.</p>
</li>
<li>
<p>The scale-out method increases the number of virtual machine instances that run your application. You can scale out to as many as 30 instances, depending on your App Service plan pricing tier. Take advantage of App Service Environments in the Isolated tier to further increase your scale-out count to 100 instances. The scale instance count can be configured manually or automatically (autoscale).</p>
</li>
<li>
<p>With autoscale, you can automatically increase the scale instance count for the scale-out method. Autoscale is based on predefined rules and schedules.</p>
</li>
<li>
<p>Your App Service plan can be scaled up and down at any time by changing the pricing tier of the plan.</p>
</li>
</ul>
<p><img alt="" src="https://www.youtube.com/watch?v=LS8ZPbQzRpc" /></p>
<h4 id="things-to-consider-when-using-azure-app-service-scaling"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-azure-app-service-scaling">Things to consider when using Azure App Service scaling</a></h4>
<p>Review the following benefits of implementing scaling for your App Service plan and applications. Think about the scaling advantages for your hotel website.</p>
<ul>
<li>
<p><strong>Consider manually adjusting plan tiers</strong>. Start your plan at a lower pricing tier and scale up as needed to acquire more App Service features. Scale down when features are no longer needed, and control your overall costs.</p>
<p>Consider a scenario where you start testing your web app by using the Azure App Service Free tier, where you pay nothing to use the service. After a while, you decide to add a custom DNS name to your web app, so you scale your plan up to the Shared tier. Next, you discover you need to create an SSL binding, so you scale your plan up to the Basic tier. Later, you determine a need for staging environments, so you scale up to the Standard tier. When you need more cores, memory, or storage, you can scale up to a bigger virtual machine size in the same tier.</p>
<p>The same scaling process works in reverse. If you decide you no longer need capabilities or features of a higher tier, scale your plan down to a lower tier and save money.</p>
</li>
<li>
<p><strong>Consider autoscale to support users and reduce costs</strong>. Keep serving your users when your application is experiencing high throughput. Implement autoscale to control how many features and support are offered at a given time based on your preference settings and rule conditions. Autoscale helps you save money when the load on your application decreases by automatically reducing your subscribed features.</p>
</li>
<li>
<p><strong>Consider no redeployment</strong>. When you change your scale settings, you don't need to change your code or redeploy your applications. Changing your plan scale settings takes only seconds to apply. Your changes affect all applications in your App Service plan.</p>
</li>
<li>
<p><strong>Consider scaling for other Azure services</strong>. If your App Service application depends on other Azure services, such as Azure SQL Database or Azure Storage, you can scale these resources separately. These resources aren't managed by your App Service plan.</p>
</li>
</ul>
<h2 id="configure-azure-app-service-autoscale"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-azure-app-service-autoscale">Configure Azure App Service autoscale</a></h2>
<p>The autoscale process allows you to have the right amount of resources running to handle the load on your application. You can add resources to support increases in load and save money by removing idle resources.</p>
<h4 id="things-to-know-about-autoscale"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-autoscale">Things to know about autoscale</a></h4>
<p>Let's take a closer look at how to use autoscale for your Azure App Service plan and applications.</p>
<ul>
<li>
<p>To use autoscale, you specify the minimum, and maximum number of instances to run by using a set of rules and conditions.</p>
</li>
<li>
<p>When your application runs under autoscale conditions, the number of virtual machine instances are automatically adjusted based on your rules. When rule conditions are met, one or more autoscale actions are triggered.</p>
</li>
<li>
<p>An autoscale setting is read by the autoscale engine to determine whether to scale out or in. Autoscale settings are grouped into profiles.</p>
</li>
<li>
<p>Autoscale rules include a trigger and a scale action (in or out). The trigger can be metric-based or time-based.</p>
<p><img alt="Screenshot that shows how to create an autoscale condition in the Azure portal, including settings for the scale mode and instance count." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-app-service-plans/media/web-app-autoscale-94c4da54.png" /></p>
<ul>
<li>
<p><strong>Metric-based</strong> rules measure application load and add or remove virtual machines based on the load, such as "do this action when CPU usage is above 50%." Example metrics include CPU time, Average response time, and Requests.</p>
</li>
<li>
<p><strong>Time-based</strong> rules (or, schedule-based) allow you to scale when you see time patterns in your load and want to scale before a possible load increase or decrease occurs. An example is "trigger a webhook every 8:00 AM on Saturday in a given time zone."</p>
</li>
</ul>
</li>
<li>
<p>The autoscale engine uses notification settings.</p>
<p>A notification setting defines what notifications should occur when an autoscale event occurs based on satisfying the criteria of an autoscale setting profile. Autoscale can notify one or more email addresses or make calls to one or more webhooks.</p>
</li>
</ul>
<h4 id="things-to-consider-when-configuring-autoscale"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-configuring-autoscale">Things to consider when configuring autoscale</a></h4>
<p>There are several considerations to keep in mind when you configure autoscale for your Azure App Service plan and applications.</p>
<ul>
<li>
<p><strong>Minimum instance count</strong>. Set a minimum instance count to make sure your application is always running even when there's no load.</p>
</li>
<li>
<p><strong>Maximum instance count</strong>. Set a maximum instance count to limit your total possible hourly cost.</p>
</li>
<li>
<p><strong>Adequate scale margin</strong>. Make sure your maximum and minimum instance count values are different, and set an adequate margin between the two values. You can automatically scale between the minimum and maximum by using rules you create.</p>
</li>
<li>
<p><strong>Scale rule combinations</strong>. Always use a scale-out and scale-in rule combination that performs an increase and decrease. If you don't set a scale-out rule, your application might fail, or performance might degrade under increased loads. If you don't set a scale-in rule, you can experience unnecessary and extensive costs when the load decreases.</p>
</li>
<li>
<p><strong>Metric statistics</strong>. Carefully choose the appropriate statistic for your diagnostic metrics, including Average, Minimum, Maximum, and Total.</p>
</li>
<li>
<p><strong>Default instance count</strong>. Always select a safe default instance count. The default instance count is important because autoscale scales your service to the count you specify when metrics aren't available.</p>
</li>
<li>
<p><strong>Notifications</strong>. Always configure autoscale notifications. It's important to maintain awareness of how your application is performing as the load changes.</p>
</li>
</ul>
<hr />
<h2 id="configure-azure-app-service"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-azure-app-service">Configure Azure App Service</a></h2>
<h2 id="introduction_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#introduction_3">Introduction</a></h2>
<p>Azure Administrators are interested in solutions that make it easier to deploy and manage their web, mobile, and API applications.</p>
<p>Your company provides consumer research, and your team manages the on-premises servers. The servers you administer run the entire company infrastructure from web servers to databases. The hardware is aging and starting to struggle to keep up with some of the new data analysis applications. Rather than upgrade the hardware, the company decided to deploy Azure App Service.</p>
<p>In this module, you learn how to configure and manage Azure App Service. You learn about configuration settings, deployment slots, and custom domain names. You learn about application backup, recovery, and monitoring.</p>
<p>The goal of this module is to provide you with the knowledge and skills to effectively use Azure App Services.</p>
<h3 id="learning-objectives_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#learning-objectives_3">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify features and usage cases for Azure App Service.</li>
<li>Create an app with App Service.</li>
<li>Configure deployment settings, specifically deployment slots.</li>
<li>Secure your App Service app.</li>
<li>Configure custom domain names.</li>
<li>Back up and restore your App Service app.</li>
<li>Configure Azure Application Insights.</li>
</ul>
<h3 id="skills-measured_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#skills-measured_3">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#prerequisites_3">Prerequisites</a></h3>
<ul>
<li>
<p>Working knowledge of the Azure portal, so you can configure the service.</p>
</li>
<li>
<p>Familiarity with cloud-based services, specifically web hosting services.</p>
</li>
</ul>
<h2 id="implement-azure-app-service"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#implement-azure-app-service">Implement Azure App Service</a></h2>
<p>Azure App Service brings together everything you need to create websites, mobile backends, and web APIs for any platform or device. Applications run and scale with ease in both Windows and Linux-based environments.</p>
<p>App Service provides Quickstarts for several products to help you easily create and deploy your Windows and Linux apps:</p>
<p><img alt="Illustration that shows products for which you can use an App Service quickstart to develop and deploy your web, mobile, and API apps." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-app-services/media/web-quickstarts-c154c8e4.png" /></p>
<h4 id="app-service-benefits"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#app-service-benefits">App Service benefits</a></h4>
<p>There are many advantages to using App Service to develop and deploy your web, mobile, and API apps. Review the following table and think about what features can help you host your App Service instances.</p>
<table>
<thead>
<tr>
<th>Benefit</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Multiple languages and frameworks</strong></td>
<td>App Service has first-class support for ASP.NET, Java, Ruby, Node.js, PHP, and Python. You can also run PowerShell and other scripts or executables as background services.</td>
</tr>
<tr>
<td><strong>DevOps optimization</strong></td>
<td>App Service supports continuous integration and deployment with Azure DevOps, GitHub, BitBucket, Docker Hub, and Azure Container Registry. You can promote updates through test and staging environments. Manage your apps in App Service by using Azure PowerShell or the cross-platform command-line interface (CLI).</td>
</tr>
<tr>
<td><strong>Global scale with high availability</strong></td>
<td>App Service helps you scale up or out manually or automatically. You can host your apps anywhere within the Microsoft global datacenter infrastructure, and the App Service SLA offers high availability.</td>
</tr>
<tr>
<td><strong>Connections to SaaS platforms and on-premises data</strong></td>
<td>App Service lets you choose from more than 50 connectors for enterprise systems (such as SAP), SaaS services (such as Salesforce), and internet services (such as Facebook). You can access on-premises data by using Hybrid Connections and Azure Virtual Networks.</td>
</tr>
<tr>
<td><strong>Security and compliance</strong></td>
<td>App Service is ISO, SOC, and PCI compliant. You can authenticate users with Microsoft Entra ID or with social logins via Google, Facebook, X, or Microsoft. Create IP address restrictions and manage service identities.</td>
</tr>
<tr>
<td><strong>Application templates</strong></td>
<td>Choose from an extensive list of application templates in the Azure Marketplace, such as WordPress, Joomla, and Drupal.</td>
</tr>
<tr>
<td><strong>Visual Studio integration</strong></td>
<td>App Service offers dedicated tools in Visual Studio to help streamline the work of creating, deploying, and debugging.</td>
</tr>
<tr>
<td><strong>API and mobile features</strong></td>
<td>App Service provides turn-key CORS support for RESTful API scenarios. You can simplify your mobile app scenarios by enabling authentication, offline data sync, push notifications, and more.</td>
</tr>
<tr>
<td><strong>Serverless code</strong></td>
<td>App Service lets you run a code snippet or script on-demand without having to explicitly provision or manage infrastructure. You pay only for the compute time your code actually uses.</td>
</tr>
</tbody>
</table>
<h2 id="create-an-app-with-app-service"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-an-app-with-app-service">Create an app with App Service</a></h2>
<p>You can use the Web Apps, Mobile Apps, or API Apps features of Azure App Service, and create your own apps in the Azure portal.</p>
<p>Watch the following video to learn how to create an app with Azure App Service.</p>
<h4 id="how-to-create-app-services-in-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#how-to-create-app-services-in-the-azure-portal">How to create App Services in the Azure portal</a></h4>
<p><img alt="" src="https://youtu.be/dHTzv-zY17I" /></p>
<h4 id="things-to-know-about-configuration-settings"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-configuration-settings">Things to know about configuration settings</a></h4>
<p>Let's examine some of the basic configuration settings you need to create an app with App Service.</p>
<ul>
<li>
<p><strong>Name</strong>: The name for your app must be unique. The name identifies and locates your app in Azure. An example name is <code>webappces1.azurewebsites.net</code>. You can map a custom domain name, if you prefer to use that option instead.</p>
</li>
<li>
<p><strong>Publish</strong>: App Service hosts (publishes) your app as code or as a Docker Container.</p>
</li>
<li>
<p><strong>Runtime stack</strong>: App Service uses a software stack to run your app, including the language and SDK versions. For Linux apps and custom container apps, you can set an optional start-up command or file. Your choices for the stack include .NET Core, .NET Framework, Node.js, PHP, Python, and Ruby. Various versions of each product are available for Linux and Windows.</p>
</li>
<li>
<p><strong>Operating system</strong>: The operating system for your app runtime stack can be Linux or Windows.</p>
</li>
<li>
<p><strong>Region</strong>: The region location that you choose for your app affects the App Service plans that are available.</p>
</li>
<li>
<p><strong>App Service plan</strong>: Your app needs to be associated with an Azure App Service plan to establish available resources, features, and capacity. You can choose from pricing tiers that are available for the region location you selected.</p>
</li>
</ul>
<h5 id="post-creation-settings"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#post-creation-settings">Post-creation settings</a></h5>
<p>After your app is created, other configuration settings become available in the Azure portal, including app deployment options and path mapping.</p>
<p><img alt="Screenshot that shows other configuration options for an app with the App Service in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-app-services/media/web-app-configuration-27facdc5.png" /></p>
<p>Some of the extra configuration settings can be included in the developer's code, while others can be configured in your app. Here are a few of the extra application settings.</p>
<ul>
<li>
<p><strong>Always On</strong>: You can keep your app loaded even when there's no traffic. This setting is required for continuous WebJobs or for WebJobs that are triggered by using a CRON expression.</p>
</li>
<li>
<p><strong>ARR affinity</strong>: In a multi-instance deployment, you can ensure your app client is routed to the same instance for the life of the session.</p>
</li>
<li>
<p><strong>Connection strings</strong>: Connection strings for your app are encrypted at rest and transmitted over an encrypted channel.</p>
</li>
</ul>
<h2 id="explore-continuous-integration-and-deployment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#explore-continuous-integration-and-deployment">Explore continuous integration and deployment</a></h2>
<p>The Azure portal provides out-of-the-box continuous integration and deployment with Azure DevOps, GitHub, Bitbucket, FTP, or a local Git repository on your development machine. You can connect your web app with any of the above sources and App Service handles the rest for you. App Service auto-synchronizes your code and any future changes to the code into your web app. With Azure DevOps, you can also define your own build and release process. Compile your source code, run tests, and build and deploy the release into your web app every time you commit the code. All of the operations happen implicitly without any need for human administration.</p>
<p><img alt="Illustration that shows two developers sharing a single GitHub source to produce a website built with Azure App Service." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-app-services/media/continuous-development-a0dfd350.png" /></p>
<h4 id="things-to-know-about-continuous-deployment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-continuous-deployment">Things to know about continuous deployment</a></h4>
<p>When you create your web app with App Service, you can choose automated or manual deployment. As you review these options, consider which deployment method to implement for your App Service apps.</p>
<ul>
<li>
<p><strong>Automated deployment</strong> (continuous integration) is a process used to push out new features and bug fixes in a fast and repetitive pattern with minimal impact on end users. Azure supports automated deployment directly from several sources:</p>
<ul>
<li>
<p><strong>Azure DevOps</strong>: Push your code to Azure DevOps (previously known as Visual Studio Team Services), build your code in the cloud, run the tests, generate a release from the code, and finally, push your code to an Azure web app.</p>
</li>
<li>
<p><strong>GitHub</strong>: Azure supports automated deployment directly from GitHub. When you connect your GitHub repository to Azure for automated deployment, any changes you push to your production branch on GitHub are automatically deployed for you.</p>
</li>
<li>
<p><strong>Bitbucket</strong>: With its similarities to GitHub, you can configure an automated deployment with Bitbucket.</p>
</li>
</ul>
</li>
<li>
<p><strong>Manual deployment</strong> enables you to manually push your code to Azure. There are several options for manually pushing your code:</p>
<ul>
<li>
<p><strong>Git</strong>: The App Service Web Apps feature offers a Git URL that you can add as a remote repository. Pushing to the remote repository deploys your app.</p>
</li>
<li>
<p><strong>CLI</strong>: The <code>webapp up</code> command is a feature of the command-line interface that packages your app and deploys it. Deployment can include creating a new App Service web app.</p>
</li>
<li>
<p><strong>Visual Studio</strong>: Visual Studio features an App Service deployment wizard that can walk you through the deployment process.</p>
</li>
<li>
<p><strong>FTP/S</strong>: FTP or FTPS is a traditional way of pushing your code to many hosting environments, including App Service.</p>
</li>
</ul>
</li>
</ul>
<h2 id="create-deployment-slots"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-deployment-slots">Create deployment slots</a></h2>
<p>When you deploy your web app, web app on Linux, mobile backend, or API app to Azure App Service, you can use a separate deployment slot instead of the default production slot.</p>
<h4 id="things-to-know-about-deployment-slots"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-deployment-slots">Things to know about deployment slots</a></h4>
<p>Let's take a closer look at the characteristics of deployment slots.</p>
<ul>
<li>
<p>Deployment slots are live apps that have their own hostnames.</p>
</li>
<li>
<p>Deployment slots are available in the Standard, Premium, and Isolated App Service pricing tiers. Your app needs to be running in one of these tiers to use deployment slots.</p>
</li>
<li>
<p>The Standard, Premium, and Isolated tiers offer different numbers of deployment slots.</p>
</li>
<li>
<p>App content and configuration elements can be swapped between two deployment slots, including the production slot.</p>
</li>
</ul>
<p><img alt="Screenshot that shows how to work with deployment slots in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-app-services/media/deployment-slots-5b3660cc.png" /></p>
<h4 id="things-to-consider-when-using-deployment-slots"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-deployment-slots">Things to consider when using deployment slots</a></h4>
<p>There are several advantages to using deployment slots with your App Service app. Review the following benefits and think about how they can support your App Service implementation.</p>
<ul>
<li>
<p><strong>Consider validation</strong>. You can validate changes to your app in a staging deployment slot before swapping the app changes with the content in the production slot.</p>
</li>
<li>
<p><strong>Consider reductions in downtime</strong>. Deploying an app to a slot first and swapping it into production ensures that all instances of the slot are warmed up before being swapped into production. This option eliminates downtime when you deploy your app. The traffic redirection is seamless, and no requests are dropped because of swap operations. The entire workflow can be automated by configuring <strong>Auto swap</strong> when pre-swap validation isn't needed.</p>
</li>
<li>
<p><strong>Consider restoring to last known good site</strong>. After a swap, the slot with the previously staged app now has the previous production app. If the changes swapped into the production slot aren't as you expected, you can perform the same swap immediately to return to your "last known good site."</p>
</li>
<li>
<p><strong>Consider Auto swap</strong>. Auto swap streamlines Azure DevOps scenarios where you want to deploy your app continuously with zero cold starts and zero downtime for app customers. When Auto swap is enabled from a slot into production, every time you push your code changes to that slot, App Service automatically swaps the app into production after it's warmed up in the source slot. Auto swap isn't currently supported for Web Apps on Linux.</p>
</li>
</ul>
<h2 id="add-deployment-slots"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#add-deployment-slots">Add deployment slots</a></h2>
<p>Completed100 XP</p>
<ul>
<li>5 minutes</li>
</ul>
<p>Deployment slots are configured in the Azure portal. You can swap your app content and configuration elements between deployment slots, including the production slot.</p>
<h4 id="how-to-use-deployment-slots-in-azure-app-service"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#how-to-use-deployment-slots-in-azure-app-service">How to use deployment slots in Azure App Service</a></h4>
<p><img alt="" src="https://youtu.be/5rR5C4Z5dU4" /></p>
<h4 id="things-to-know-about-creating-deployment-slots"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-creating-deployment-slots">Things to know about creating deployment slots</a></h4>
<p>Let's review some details about how deployment slots are configured.</p>
<ul>
<li>
<p>New deployment slots can be empty or cloned.</p>
</li>
<li>
<p>Deployment slot settings fall into three categories:</p>
<ul>
<li>Slot-specific app settings and connection strings (if applicable)</li>
<li>Continuous deployment settings (when enabled)</li>
<li>Azure App Service authentication settings (when enabled)</li>
<li>When you clone a configuration from another deployment slot, the cloned configuration is editable. Some configuration elements follow the content across the swap. Other slot-specific configuration elements stay in the source slot after the swap.</li>
</ul>
</li>
</ul>
<h5 id="swapped-settings-versus-slot-specific-settings"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#swapped-settings-versus-slot-specific-settings">Swapped settings versus slot-specific settings</a></h5>
<p>The following table lists the settings that are swapped between deployment slots, and settings that remain in the source slot (slot-specific). As you review these settings, consider which features are required for your App Service apps.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Swapped settings</th>
<th>Slot-specific settings</th>
</tr>
</thead>
<tbody>
<tr>
<td>General settings, such as framework version, 32/64-bit, web sockets  <br>App settings <strong><em>*</em>  <br>Connection strings </strong><strong><em>  <br>Handler mappings  <br>Public certificates  <br>WebJobs content  <br>Hybrid connections </em></strong><strong><em>  <br>Service endpoints </em></strong><strong><em>  <br>Azure Content Delivery Network </em></strong>***  <br>Path mapping</td>
<td>Custom domain names  <br>Nonpublic certificates and TLS/SSL settings  <br>Scale settings  <br>Always On  <br>IP restrictions  <br>WebJobs schedulers  <br>Diagnostic settings  <br>Cross-origin resource sharing (CORS)  <br>Virtual network integration  <br>Managed identities  <br>Settings that end with the suffix _EXTENSION_VERSION</td>
</tr>
</tbody>
</table>
<p><strong>*</strong> Setting can be configured to be slot-specific.</p>
<p><strong>*</strong>* Feature isn't currently available.</p>
<h2 id="secure-your-app-service-app"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#secure-your-app-service-app">Secure your App Service app</a></h2>
<p>Azure App Service provides built-in authentication and authorization support. You can sign in users and access data by writing minimal or no code in your web app, API, and mobile backend, and also your Azure Functions apps.</p>
<p>Secure authentication and authorization require deep understanding of security, including federation, encryption, JSON web tokens (JWT) management, grant types, and so on. App Service provides these utilities so you can spend more time and energy on providing business value to your customer.</p>
<p>Note</p>
<p>You aren't required to use Azure App Service for authentication and authorization. Many web frameworks are bundled with security features, and you can use your preferred service.</p>
<h4 id="things-to-know-about-app-security-with-app-service"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-app-security-with-app-service">Things to know about app security with App Service</a></h4>
<p>Let's take a closer look at how App Service helps you provide security for your app.</p>
<ul>
<li>
<p>The authentication and authorization security module in Azure App Service runs in the same environment as your application code, yet separately.</p>
</li>
<li>
<p>The security module is configured by using app settings. No SDKs, specific languages, or changes to your application code are required.</p>
</li>
<li>
<p>When you enable the security module, every incoming HTTP request passes through the module before it's handled by your application code.</p>
</li>
<li>
<p>The security module handles several tasks for your app:</p>
<ul>
<li>Authenticate users with the specified provider</li>
<li>Validate, store, and refresh tokens</li>
<li>Manage the authenticated session</li>
<li>Inject identity information into request headers</li>
</ul>
</li>
</ul>
<h4 id="things-to-consider-when-using-app-service-for-app-security"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-app-service-for-app-security">Things to consider when using App Service for app security</a></h4>
<p>You configure authentication and authorization security in App Service by selecting features In the Azure portal. Review the following options and think about what security can benefit your App Service apps implementation.</p>
<ul>
<li>
<p><strong>Allow Anonymous requests (no action)</strong>. Defer authorization of unauthenticated traffic to your application code. For authenticated requests, App Service also passes along authentication information in the HTTP headers. This feature provides more flexibility for handling anonymous requests. With this feature, you can present multiple sign-in providers to your users.</p>
</li>
<li>
<p><strong>Allow only authenticated requests</strong>. Redirect all anonymous requests to <code>/.auth/login/&lt;provider&gt;</code> for the provider you choose. The feature is equivalent to <strong>Log in with <provider/></strong>. If the anonymous request comes from a native mobile app, the returned response is an <code>HTTP 401 Unauthorized</code> message. With this feature, you don't need to write any authentication code in your app.</p>
<p>Important</p>
<p>This feature restricts access to <strong>all</strong> calls to your app. Restricting access to all calls might not be desirable if your app requires a public home page, as is the case for many single-page apps.</p>
</li>
<li>
<p><strong>Logging and tracing</strong>. View authentication and authorization traces directly in your log files. If you see an authentication error that you didn’t expect, you can conveniently find all the details by looking in your existing application logs. If you enable failed request tracing, you can see exactly how the security module participated in a failed request. In the trace logs, look for references to a module named <code>EasyAuthModule_32/64</code>.</p>
</li>
</ul>
<h2 id="create-custom-domain-names"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-custom-domain-names">Create custom domain names</a></h2>
<p>When you create a web app, Azure assigns the app to a subdomain of <code>azurewebsites.net</code>. Suppose your web app is named <code>contoso</code>. Azure creates a URL for your web app as <code>contoso.azurewebsites.net</code>. Azure also assigns a virtual IP address for your app. For a production web app, you might want users to see a custom domain name.</p>
<h4 id="how-to-add-and-secure-a-custom-domain-on-your-app-service-web-app"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#how-to-add-and-secure-a-custom-domain-on-your-app-service-web-app">How to add and secure a custom domain on your App Service web app</a></h4>
<p><img alt="" src="https://youtu.be/bXP6IvNYISw" /></p>
<h4 id="steps-to-configure-a-custom-domain-name-for-your-app"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#steps-to-configure-a-custom-domain-name-for-your-app">Steps to configure a custom domain name for your app</a></h4>
<p>There are three steps to create a custom domain name. The following steps outline how to create a domain name in the Azure portal.</p>
<p>Important</p>
<p>To map a custom DNS name to your app, you need a paid tier of an App Service plan for your app.</p>
<ol>
<li>
<p><strong>Reserve your domain name</strong>. The easiest way to set up a custom domain is to buy one directly in the Azure portal. (This name isn't the Azure assigned name of <code>\*.azurewebsites.net</code>.) The registration process enables you to manage your web app's domain name directly in the Azure portal instead of going to a third-party site. Configuring the domain name in your web app is also a simple process in the Azure portal.</p>
</li>
<li>
<p><strong>Create DNS records to map the domain to your Azure web app</strong>. The Domain Name System (DNS) uses data records to map domain names to IP addresses. There are several types of DNS records.</p>
<ul>
<li>
<p>For web apps, you create either an <code>A</code> (Address) record or a <code>CNAME</code> (Canonical Name) record.</p>
<ul>
<li>An <code>A</code> record maps a domain name to an IP address.</li>
<li>A <code>CNAME</code> record maps a domain name to another domain name. DNS uses the second name to look up the address. Users still see the first domain name in their browser. As an example, you could map <code>contoso.com</code> to your <code>webapp.azurewebsites.net</code> URL.<ul>
<li>If the IP address changes, a <code>CNAME</code> entry is still valid, whereas an <code>A</code> record must be updated.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Some domain registrars don't allow <code>CNAME</code> records for the root domain or for wildcard domains. In such cases, you must use an <code>A</code> record.</p>
</li>
</ul>
</li>
<li>
<p><strong>Enable the custom domain</strong>. After you have your domain and create your DNS record, use the Azure portal to validate your custom domain and add it to your web app. Be sure to test your domain before publishing.</p>
</li>
</ol>
<h2 id="back-up-and-restore-your-app-service-app"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#back-up-and-restore-your-app-service-app">Back up and restore your App Service app</a></h2>
<p>The Backup and Restore feature in Azure App Service lets you easily create backups manually or on a schedule. You can configure the backups to be retained for a specific or indefinite amount of time. You can restore your app or site to a snapshot of a previous state by overwriting the existing content or restoring to another app or site.</p>
<p>Watch the following video on how to configure a backup for your App Service instance. This video is based on <a href="https://microsoft.github.io/AzureTipsAndTricks/blog/blog/tip28.html">Azure Tips and Tricks #28 - Configure a backup for Azure App Service</a>.</p>
<p><img alt="" src="https://youtu.be/uQXDkW1pCzs" /></p>
<h4 id="things-to-know-about-backup-and-restore"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-backup-and-restore">Things to know about Backup and Restore</a></h4>
<p>Examine the following details about the Backup and Restore feature. Think about how you can implement this feature for your App Service apps.</p>
<ul>
<li>
<p>To use the Backup and Restore feature, you need the Standard or Premium tier App Service plan for your app or site.</p>
</li>
<li>
<p>You need an Azure storage account and container in the same subscription as the app to back up.</p>
</li>
<li>
<p>Azure App Service can back up the following information to the Azure storage account and container you configured for your app:</p>
<ul>
<li>App configuration settings</li>
<li>File content</li>
<li>Any database connected to your app (SQL Database, Azure Database for MySQL, Azure Database for PostgreSQL, MySQL in-app)</li>
<li>
<p>In your storage account, each backup consists of a Zip file and XML file:</p>
</li>
<li>
<p>The Zip file contains the back-up data for your app or site.</p>
</li>
<li>The XML file contains a manifest of the Zip file contents.</li>
<li>You can configure backups manually or on a schedule.</li>
</ul>
</li>
<li>
<p>Full backups are the default.</p>
</li>
<li>
<p>Partial backups are supported. You can specify files and folders to exclude from a backup.</p>
</li>
<li>
<p>You restore partial backups of your app or site the same way you restore a regular backup.</p>
</li>
<li>
<p>Backups can hold up to 10 GB of app and database content.</p>
</li>
<li>
<p>Backups for your app or site are visible on the <strong>Containers</strong> page of your storage account and app (or site) in the Azure portal.</p>
</li>
</ul>
<h4 id="things-to-consider-when-creating-backups-and-restoring-backups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-creating-backups-and-restoring-backups">Things to consider when creating backups and restoring backups</a></h4>
<p>Let's review some considerations about creating a backup for your app or site, and restoring data and content from a backup.</p>
<ul>
<li>
<p><strong>Consider full backups</strong>. Do a full backup to easily save all configuration settings, all file content, and all database content connected with your app or site.</p>
<p>When you restore a full backup, all content on the site is replaced with whatever is in the backup. If a file is on the site, but not in the backup, the file is deleted.</p>
</li>
<li>
<p><strong>Consider partial backups</strong>. Specify a partial backup so you can choose exactly which files to back up.</p>
<p>When you restore a partial backup, any content located in an excluded folder or file is left as-is.</p>
</li>
<li>
<p><strong>Consider browsing back-up files</strong>. Unzip and browse the Zip and XML files associated with your backup to access your backups. This option lets you view the content without actually performing an app or site restore.</p>
</li>
<li>
<p><strong>Consider firewall on back-up destination</strong>. If your storage account is enabled with a firewall, you can't use the storage account as the destination for your backups.</p>
</li>
</ul>
<h2 id="use-azure-application-insights"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#use-azure-application-insights">Use Azure Application Insights</a></h2>
<p>Azure Application Insights is a feature of Azure Monitor that lets you monitor your live applications. You can integrate Application Insights with your App Service configure to automatically detect performance anomalies in your apps.</p>
<p>Application Insights is designed to help you continuously improve the performance and usability of your apps. The feature offers powerful analytics tools to help you diagnose issues and understand what users actually do with your apps.</p>
<h4 id="things-to-know-about-application-insights"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-application-insights">Things to know about Application Insights</a></h4>
<p>Let's examine some characteristics of Application Insights for Azure Monitor.</p>
<ul>
<li>
<p>Application Insights works on various platforms including .NET, Node.js and Java EE.</p>
</li>
<li>
<p>The feature can be used for configurations that are hosted on-premises, in a hybrid environment, or in any public cloud.</p>
</li>
<li>
<p>Application Insights integrates with your Azure DevOps process, and has connection points to many development tools.</p>
</li>
<li>
<p>You can monitor and analyze data from mobile apps by integrating with Visual Studio App Center.</p>
</li>
</ul>
<p><img alt="Diagram that shows Azure Application Insights receiving information from web pages, client apps, and web services, which is transferred to Alerts, Power BI, and Visual Studio." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-app-services/media/app-insights-16629887.png" /></p>
<h4 id="things-to-consider-when-using-application-insights"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-application-insights">Things to consider when using Application Insights</a></h4>
<p>Application Insights is ideal for supporting your development team. The feature helps developers understand how your app is performing and how it's being used. Consider monitoring the following items in your App Service configuration scenario.</p>
<ul>
<li>
<p><strong>Consider Request rates, response times, and failure rates</strong>. Find out which pages are most popular, at what times of day, and where your users are. See which pages perform best. If your response times and failure rates go high when there are more requests, then perhaps you have a resourcing problem.</p>
</li>
<li>
<p><strong>Consider Dependency rates, response times, and failure rates</strong>. Use Application Insights to discover if external services are degrading your app performance.</p>
</li>
<li>
<p><strong>Consider Exceptions</strong>. Analyze the aggregated statistics, or pick specific instances and drill into the stack trace and related requests. Both server and browser exceptions are reported.</p>
</li>
<li>
<p><strong>Consider Page views and load performance</strong>. Collect the number of page views reported by your users' browsers and analyze the load performance.</p>
</li>
<li>
<p><strong>Consider User and session counts</strong>. Application Insights can help you keep track of the number of users and sessions connected to your app.</p>
</li>
<li>
<p><strong>Consider Performance counters</strong>. Add Application Insights performance counters from your Windows or Linux server machines. Monitor performance output for the CPU, memory, network usage, and so on.</p>
</li>
<li>
<p><strong>Consider Host diagnostics</strong>. Integrate diagnostics from Docker or Azure into your app Application Insights.</p>
</li>
<li>
<p><strong>Consider Diagnostic trace logs</strong>. Implement trace logs from your app to help correlate trace events with requests and diagnose issues.</p>
</li>
<li>
<p><strong>Consider Custom events and metrics</strong>. Write your own custom events and metric tracking algorithms as client or server code. Track business events such as number of items sold, or number of games won.</p>
</li>
</ul>
<h2 id="interactive-lab-simulation_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#interactive-lab-simulation_2">Interactive lab simulation</a></h2>
<h3 id="lab-scenario_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#lab-scenario_2">Lab scenario</a></h3>
<p>Your organization is migrating on-premises web apps to Azure. As the Azure Administrator you need to:</p>
<ul>
<li>Host web sites running on Windows servers by using the PHP runtime stack.</li>
<li>Implement Azure DevOps practices by using Azure Web Apps deployment slots.</li>
</ul>
<h3 id="architecture-diagram_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#architecture-diagram_1">Architecture diagram</a></h3>
<p><img alt="Architecture diagram as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-app-services/media/lab-09a.png" /></p>
<h3 id="objectives_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#objectives_2">Objectives</a></h3>
<ul>
<li><strong>Task 1</strong>: Create an Azure web app.<ul>
<li>Create a web app by using the Azure portal.</li>
<li>The web app should run on Windows and use the PHP runtime stack.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Create a staging deployment slot.<ul>
<li>Verify there's a production deployment slot.</li>
<li>Create a new staging deployment slot.</li>
</ul>
</li>
<li><strong>Task 3</strong>: Configure Web App deployment settings.<ul>
<li>Deploy your web app from a local Git session.</li>
<li>Provide the authentication credentials.</li>
</ul>
</li>
<li><strong>Task 4</strong>: Deploy code to the staging deployment slot.<ul>
<li>Use Azure PowerShell to clone the remote repository and set the local path.</li>
<li>Add the remote Git session by using the authentication credentials.</li>
<li>Display the default web page in a new browser tab.</li>
<li>Push the sample web app code from the local repository to the Azure Web App staging deployment slot.</li>
</ul>
</li>
<li><strong>Task 5</strong>: Swap the staging slots.<ul>
<li>Swap the deployment slots.</li>
<li>Verify the default web page is replaced with the Hello World page.</li>
</ul>
</li>
<li><strong>Task 6</strong>: Configure and test autoscaling of your Azure web app.<ul>
<li>Configure a custom autoscale rule on the production deployment slot.</li>
<li>The scale rule should use the CPU percentage to increase the resource count.</li>
<li>Use Azure PowerShell to start an infinite loop that sends the HTTP requests to your web app.</li>
<li>Confirm the resource count automatically scales.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Select the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p>Note</p>
<p>You may find slight differences between the interactive simulation and the hosted lab, but the core concepts and ideas being demonstrated are the same.</p>
<p><a href="https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2013"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-app-services/media/simulation-web-apps-thumbnail.jpg" /></a></p>
<hr />
<h2 id="configure-azure-container-instances"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-azure-container-instances">Configure Azure Container Instances</a></h2>
<h2 id="introduction_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#introduction_4">Introduction</a></h2>
<p>Containers and virtual machines are both forms of virtualization, but there are some key differences between them.</p>
<p>To provide context, let's consider a scenario: You're an Azure Administrator responsible for deploying and managing applications in a cloud environment. Your organization is looking for a solution that offers fast startup times, easy management, and the ability to run applications in isolated containers. You want to understand the benefits of using Azure Container Instances and how it compares to virtual machines.</p>
<p>In this module, you learn when to use Azure Container Instances instead of virtual machines. You also get an overview of features and use cases.</p>
<p>The goal of this module is to introduce you to Azure Container Instances.</p>
<h3 id="learning-objectives_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#learning-objectives_4">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify when to use containers versus virtual machines.</li>
<li>Identify the features and usage cases of Azure Container Instances.</li>
<li>Implement Azure container groups.</li>
</ul>
<h3 id="skills-measured_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#skills-measured_4">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#prerequisites_4">Prerequisites</a></h3>
<ul>
<li>Working knowledge of containerization concepts and terminology.</li>
<li>Familiarity with cloud computing and experience with the Azure portal.</li>
</ul>
<h2 id="compare-containers-to-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#compare-containers-to-virtual-machines">Compare containers to virtual machines</a></h2>
<p>Hardware virtualization makes it possible to run multiple isolated instances of operating systems concurrently on the same physical hardware. Containers represent the next stage in the virtualization of computing resources.</p>
<p>Container-based virtualization allows you to virtualize the operating system. This approach lets you run multiple applications within the same instance of an operating system, while maintaining isolation between the applications. The containers within a virtual machine provide functionality similar to that of virtual machines within a physical server.</p>
<h4 id="things-to-know-about-containers-versus-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-containers-versus-virtual-machines">Things to know about containers versus virtual machines</a></h4>
<p>To better understand container-based virtualization, let's compare containers and virtual machines.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Compare</th>
<th>Containers</th>
<th>Virtual machines</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Isolation</strong></td>
<td>A container typically provides lightweight isolation from the host and other containers, but a container doesn't provide as strong a security boundary as a virtual machine.</td>
<td>A virtual machine provides complete isolation from the host operating system and other virtual machines. This separation is useful when a strong security boundary is critical, such as hosting apps from competing companies on the same server or cluster.</td>
</tr>
<tr>
<td><strong>Operating system</strong></td>
<td>Containers run the user mode portion of an operating system and can be tailored to contain just the needed services for your app. This approach helps you use fewer system resources.</td>
<td>Virtual machines run a complete operating system including the kernel, which requires more system resources (CPU, memory, and storage).</td>
</tr>
<tr>
<td><strong>Deployment</strong></td>
<td>You can deploy individual containers by using Docker via the command line. You can deploy multiple containers by using an orchestrator such as Azure Kubernetes Service.</td>
<td>You can deploy individual virtual machines by using Windows Admin Center or Hyper-V Manager. You can deploy multiple virtual machines by using PowerShell or System Center Virtual Machine Manager.</td>
</tr>
<tr>
<td><strong>Persistent storage</strong></td>
<td>Containers use Azure Disks for local storage for a single node, or Azure Files (SMB shares) for storage shared by multiple nodes or servers.</td>
<td>Virtual machines use a virtual hard disk (VHD) for local storage for a single machine, or an SMB file share for storage shared by multiple servers.</td>
</tr>
<tr>
<td><strong>Fault tolerance</strong></td>
<td>If a cluster node fails, the orchestrator on another cluster node rapidly recreates any containers running on the node.</td>
<td>Virtual machines can fail over to another server in a cluster, where the virtual machine's operating system restarts on the new server.</td>
</tr>
</tbody>
</table>
<h4 id="things-to-consider-when-using-containers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-containers">Things to consider when using containers</a></h4>
<p>Containers offer several advantages over physical and virtual machines. Review the following benefits and consider how you can implement containers for the internal apps for your company.</p>
<ul>
<li>
<p><strong>Consider flexibility and speed</strong>. Gain increased flexibility and speed when developing and sharing your containerized application code.</p>
</li>
<li>
<p><strong>Consider testing</strong>. Choose containers for your configuration to allow for simplified testing of your apps.</p>
</li>
<li>
<p><strong>Consider app deployment</strong>. Implement containers to gain streamlined and accelerated deployment of your apps.</p>
</li>
<li>
<p><strong>Consider workload density</strong>. Support higher workload density and improve your resource utilization by working with containers.</p>
</li>
</ul>
<h4 id="understand-container-images"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#understand-container-images">Understand container images</a></h4>
<p>All containers are created from container images. A container image is a lightweight, standalone, executable package of software that encapsulates everything needed to run an application. It includes the following components:</p>
<ul>
<li><strong>Code</strong>: The application’s source code.</li>
<li><strong>Runtime</strong>: The environment required to execute the application.</li>
<li><strong>System tools</strong>: Utilities necessary for the application to function.</li>
<li><strong>System libraries</strong>: Shared libraries used by the application.</li>
<li><strong>Settings</strong>: Configuration parameters specific to the application.</li>
</ul>
<p>When you create a container image, it becomes a portable unit that can run consistently across different computing environments. These images are the building blocks for containers, which are instances of these images running at runtime.</p>
<h2 id="review-azure-container-instances"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#review-azure-container-instances">Review Azure Container Instances</a></h2>
<p>Containers are becoming the preferred way to package, deploy, and manage cloud applications. There are many options for teams to build and deploy cloud native and containerized applications on Azure. In this unit, we review Azure Container Instances (ACI).</p>
<p>Azure Container Instances offers the fastest and simplest way to run a container in Azure, without having to manage any virtual machines and without having to adopt a higher-level service. Azure Container Instances is a great solution for any scenario that can operate in isolated containers, including simple applications, task automation, and build jobs, because it provides a single pod of Hyper-V isolated containers on demand.</p>
<p>The following illustration shows a web server container built with Azure Container Instances. The container is running on a virtual machine in a virtual network.</p>
<p><img alt="Diagram that shows a web server container running on a virtual machine in a virtual network." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-container-instances/media/container-overview-0e72c2ba.png" /></p>
<h4 id="things-to-know-about-azure-container-instances"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-azure-container-instances">Things to know about Azure Container Instances</a></h4>
<p>Let's review some of the benefits of using Azure Container Instances. As you review these points, think about how you can implement Container Instances for your internal applications.</p>
<ul>
<li>
<p><strong>Fast startup times</strong>. Containers can start in seconds without the need to provision and manage virtual machines.</p>
</li>
<li>
<p><strong>Public IP connectivity and DNS names</strong>. Containers can be directly exposed to the internet with an IP address and FQDN (fully qualified domain name).</p>
</li>
<li>
<p><strong>Custom sizes</strong>. Container nodes can be scaled dynamically to match actual resource demands for an application.</p>
</li>
<li>
<p><strong>Persistent storage</strong>. Containers support direct mounting of Azure Files file shares.</p>
</li>
<li>
<p><strong>Linux and Windows containers</strong>. Container Instances can schedule both Windows and Linux containers. Specify the operating system type when you create your container groups.</p>
</li>
<li>
<p><strong>Coscheduled groups</strong>. Container Instances supports scheduling of multi-container groups that share host machine resources.</p>
</li>
<li>
<p><strong>Virtual network deployment</strong>. Container Instances can be deployed into an Azure virtual network.</p>
</li>
</ul>
<h2 id="implement-container-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#implement-container-groups">Implement container groups</a></h2>
<p>The top-level resource in Azure Container Instances is the <strong>container group</strong>. A container group is a collection of containers that get scheduled on the same host machine. The containers in a container group share a lifecycle, resources, local network, and storage volumes.</p>
<h4 id="things-to-know-about-container-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-container-groups">Things to know about container groups</a></h4>
<p>Let's review some of details about container groups for Azure Container Instances.</p>
<ul>
<li>
<p>A container group is similar to a pod in Kubernetes. A pod typically has a 1:1 mapping with a container, but a pod can contain multiple containers. The containers in a multi-container pod can share related resources.</p>
</li>
<li>
<p>Azure Container Instances allocates resources to a multi-container group by adding together the resource requests of all containers in the group. Resources can include items such as CPUs, memory, and GPUs.</p>
<p>Consider a container group that has two containers that each require CPU resources. Each container requests one CPU. Azure Container Instances allocates two CPUs for the container group.</p>
</li>
<li>
<p>There are two common ways to deploy a multi-container group: Azure Resource Manager (ARM) templates and YAML files.</p>
<ul>
<li>
<p><strong>ARM template</strong>. An ARM template is recommended for deploying other Azure service resources when you deploy your container instances, such as an Azure Files file share.</p>
</li>
<li>
<p><strong>YAML file</strong>. Due to the concise nature of the YAML format, a YAML file is recommended when your deployment includes only container instances.</p>
</li>
</ul>
</li>
<li>
<p>Container groups can share an external-facing IP address, one or more ports on the IP address, and a DNS label with an FQDN.</p>
<ul>
<li>
<p><strong>External client access</strong>. You must expose the port on the IP address and from the container to enable external clients to reach a container in your group.</p>
</li>
<li>
<p><strong>Port mapping</strong>. Port mapping isn't supported because containers in a group share a port namespace.</p>
</li>
<li>
<p><strong>Deleted groups</strong>. When a container group is deleted, its IP address and FQDN are released.</p>
</li>
</ul>
</li>
</ul>
<h5 id="configuration-example"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configuration-example">Configuration example</a></h5>
<p>Consider the following example of a multi-container group with two containers.</p>
<p><img alt="Diagram that depicts an Azure Container Instances multi-container group that has two containers." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-container-instances/media/container-groups-ea19ee6b.png" /></p>
<p>The multi-container group has the following characteristics and configuration:</p>
<ul>
<li>The container group is scheduled on a single host machine, and is assigned a DNS name label.</li>
<li>The container group exposes a single public IP address with one exposed port.</li>
<li>One container in the group listens on port 80. The other container listens on port 1433.</li>
<li>The group includes two Azure Files file shares as volume mounts. Each container in the group mounts one of the file shares locally.</li>
</ul>
<h4 id="things-to-consider-when-using-container-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-container-groups">Things to consider when using container groups</a></h4>
<p>Multi-container groups are useful when you want to divide a single functional task into a few container images. Different teams can deliver the images, and the images can have separate resource requirements.</p>
<p>Consider the following scenarios for working with multi-container groups. Think about what options can support your internal apps for the online retailer.</p>
<ul>
<li>
<p><strong>Consider web app updates</strong>. Support updates to your web apps by implementing a multi-container group. One container in the group serves the web app and another container pulls the latest content from source control.</p>
</li>
<li>
<p><strong>Consider log data collection</strong>. Use a multi-container group to capture logging and metrics data about your app. Your application container outputs logs and metrics. A logging container collects the output data and writes the data to long-term storage.</p>
</li>
<li>
<p><strong>Consider app monitoring</strong>. Enable monitoring for your app with a multi-container group. A monitoring container periodically makes a request to your application container to ensure your app is running and responding correctly. The monitoring container raises an alert if it identifies possible issues with your app.</p>
</li>
<li>
<p><strong>Consider front-end and back-end support</strong>. Create a multi-container group to hold your front-end container and back-end container. The front-end container can serve a web app. The back-end container can run a service to retrieve data.</p>
</li>
</ul>
<h2 id="review-azure-container-apps"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#review-azure-container-apps">Review Azure Container Apps</a></h2>
<p>There are many options for teams to build and deploy cloud native and containerized applications on Azure. Let's understand which scenarios and use cases are best suited for Azure Container Apps and how it compares to other container options on Azure.</p>
<h4 id="things-to-know-about-azure-container-apps"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-know-about-azure-container-apps">Things to know about Azure Container Apps</a></h4>
<p>Azure Container Apps is a serverless platform that allows you to maintain less infrastructure and save costs while running containerized applications. Instead of worrying about server configuration, container orchestration, and deployment details, Container Apps provides all the up-to-date server resources required to keep your applications stable and secure.</p>
<p>Common uses of Azure Container Apps include:</p>
<ul>
<li>Deploying API endpoints</li>
<li>Hosting background processing jobs</li>
<li>Handling event-driven processing</li>
<li>Running microservices</li>
</ul>
<p>Additionally, applications built on Azure Container Apps can dynamically scale based on the following characteristics:</p>
<ul>
<li>HTTP traffic</li>
<li>Event-driven processing</li>
<li>CPU or memory load</li>
<li>Any KEDA-supported scaler</li>
</ul>
<h4 id="things-to-consider-when-using-azure-container-apps"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#things-to-consider-when-using-azure-container-apps">Things to consider when using Azure Container Apps</a></h4>
<p>Azure Container Apps enables you to build serverless microservices and jobs based on containers. Distinctive features of Container Apps include:</p>
<ul>
<li>Optimized for running general purpose containers, especially for applications that span many microservices deployed in containers.</li>
<li>Powered by Kubernetes and open-source technologies like Dapr, KEDA, and envoy.</li>
<li>Supports Kubernetes-style apps and microservices with features like service discovery and traffic splitting.</li>
<li>Enables event-driven application architectures by supporting scale based on traffic and pulling from event sources like queues, including scale to zero.</li>
<li>Supports running on demand, scheduled, and event-driven jobs.</li>
</ul>
<p>Azure Container Apps doesn't provide direct access to the underlying Kubernetes APIs. If you would like to build Kubernetes-style applications and don't require direct access to all the native Kubernetes APIs and cluster management, Container Apps provides a fully managed experience based on best-practices. For these reasons, many teams may prefer to start building container microservices with Azure Container Apps.</p>
<h5 id="compare-container-management-solutions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#compare-container-management-solutions">Compare container management solutions</a></h5>
<p>Azure Container Instances (ACI) can be managed in several ways. Azure Container Apps (ACA) is one way, and Azure Kubernetes Service (AKS) is another. Here’s a comparison table for when to use ACA and AKS.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Azure Container Apps (ACA)</th>
<th>Azure Kubernetes Service (AKS)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Overview</td>
<td>ACA is a serverless container platform that simplifies the deployment and management of microservices-based applications by abstracting away the underlying infrastructure.</td>
<td>AKS simplifies deploying a managed Kubernetes cluster in Azure by offloading the operational overhead to Azure. It’s suitable for complex applications that require orchestration.</td>
</tr>
<tr>
<td>Deployment</td>
<td>ACA provides a PaaS experience with quick deployment and management capabilities.</td>
<td>AKS offers more control and customization options for Kubernetes environments, making it suitable for complex applications and microservices.</td>
</tr>
<tr>
<td>Management</td>
<td>ACA builds upon AKS and offers a simplified PaaS experience for running containers, with additional features, like Dapr for microservices.</td>
<td>AKS provides a more granular control over the Kubernetes environment, suitable for teams with Kubernetes expertise.</td>
</tr>
<tr>
<td>Scalability</td>
<td>ACA supports both HTTP-based autoscaling and event-driven scaling, making it ideal for applications that need to respond quickly to changes in demand.</td>
<td>AKS offers horizontal pod autoscaling and cluster autoscaling, providing robust scalability options for containerized applications.</td>
</tr>
<tr>
<td>Use Cases</td>
<td>ACA is designed for microservices and serverless applications that benefit from rapid scaling and simplified management.</td>
<td>AKS is best for complex, long-running applications that require full Kubernetes features and tight integration with other Azure services.</td>
</tr>
<tr>
<td>Integration</td>
<td>ACA integrates with Azure Logic Apps, Functions, and Event Grid for event-driven architectures.</td>
<td>AKS provides features like Azure Policy for Kubernetes, Azure Monitor for containers, and Azure Defender for Kubernetes for comprehensive security and governance.</td>
</tr>
</tbody>
</table>
<h2 id="interactive-lab-simulation_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#interactive-lab-simulation_3">Interactive lab simulation</a></h2>
<h3 id="lab-scenario_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#lab-scenario_3">Lab scenario</a></h3>
<p>Your organization needs a new platform for its virtualized workloads. As the Azure Administrator you need to:</p>
<ul>
<li>Evaluate Azure Container Instances.</li>
<li>Identify and test your app container by using Docker images.</li>
</ul>
<h3 id="architecture-diagram_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#architecture-diagram_2">Architecture diagram</a></h3>
<p><img alt="Architecture diagram as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-container-instances/media/lab-09b.png" /></p>
<h3 id="objectives_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#objectives_3">Objectives</a></h3>
<ul>
<li><strong>Task 1</strong>: Deploy an Azure Container Instances using a Docker image.<ul>
<li>Create a new container instance by using a <a href="https://github.com/Azure-Samples/aci-helloworld">Linux image</a>.</li>
<li>Configure a valid globally unique DNS host name. This host name is used to test the container.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Review the functionality of Azure Container Instances.<ul>
<li>Confirm the container instance is running.</li>
<li>Verify that the Welcome to Azure Container Instances page is displayed.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Select the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2014"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-container-instances/media/simulation-container-thumbnail.jpg" /></a></p>
<hr />
<h2 id="manage-virtual-machines-with-the-azure-cli"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#manage-virtual-machines-with-the-azure-cli">Manage virtual machines with the Azure CLI</a></h2>
<h2 id="what-is-the-azure-cli"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#what-is-the-azure-cli">What is the Azure CLI?</a></h2>
<p>It's quite common for IT departments to manage a large set of Azure resources, ranging from Azure Virtual Machines to managed websites.</p>
<p>While the Azure portal is easy to use for one-off tasks, navigating through the various panes adds time when you have to create, change, or delete multiple things. This is where the command line shines; you can issue commands quickly and efficiently, or even use scripts to run repetitive tasks. With Azure, you have two different command-line tools you can work with: Azure PowerShell and the Azure CLI.</p>
<p>With either of these tools, you can write scripts to check the cloud-server status, deploy new configurations, open ports in the firewall, or connect to a virtual machine to change a setting. Windows admins tend to prefer Azure PowerShell, while developers and Linux admins often use the Azure CLI.</p>
<p>This module focuses on using the Azure CLI to create and manage virtual machines hosted in Azure. If you'd like to get an overview of the Azure CLI, how to install it, and how to work with your Azure subscriptions, make sure to check out the <a href="https://learn.microsoft.com/en-us/training/modules/control-azure-services-with-cli/">Control Azure services with the CLI</a> training module.</p>
<h3 id="what-is-the-azure-cli_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#what-is-the-azure-cli_1">What is the Azure CLI?</a></h3>
<p>The Azure CLI is Microsoft's cross-platform command-line tool for managing Azure resources. It's available for macOS, Linux, and Windows, or in the browser using <a href="https://learn.microsoft.com/en-us/azure/cloud-shell/overview">Azure Cloud Shell</a>.</p>
<p>The Azure CLI can help you manage Azure resources such as virtual machines and disks from the command line or in scripts. Let's get started and see what it can do with Azure Virtual Machines.</p>
<h3 id="learning-objectives_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#learning-objectives_5">Learning objectives</a></h3>
<p>In this module, you will:</p>
<ul>
<li>Create a virtual machine with the Azure CLI.</li>
<li>Resize virtual machines with the Azure CLI.</li>
<li>Perform basic management tasks using the Azure CLI.</li>
<li>Connect to a running VM with SSH and the Azure CLI.</li>
</ul>
<h3 id="prerequisites_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#prerequisites_5">Prerequisites</a></h3>
<ul>
<li>Basic understanding of the Azure CLI tool from the <a href="https://learn.microsoft.com/en-us/training/modules/control-azure-services-with-cli/">Control Azure services with the CLI</a> module.</li>
</ul>
<h2 id="exercise-create-a-virtual-machine"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-create-a-virtual-machine">Exercise - Create a virtual machine</a></h2>
<h3 id="logins-subscriptions-and-resource-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#logins-subscriptions-and-resource-groups">Logins, subscriptions, and resource groups</a></h3>
<p>You'll be working in the Azure Cloud Shell on the right. Once you activate the sandbox, you'll be logged into Azure with a free subscription that Microsoft Learn manages. You don't have to log in to Azure on your own or select a subscription; this is done for you. You'd also normally create a <em>resource group</em> to hold new resources. In this module, the Azure sandbox creates a resource group for you, which you'll use to execute all the commands.</p>
<h3 id="create-a-linux-vm-with-the-azure-cli"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-a-linux-vm-with-the-azure-cli">Create a Linux VM with the Azure CLI</a></h3>
<p>The Azure CLI includes the <code>vm</code> command to work with virtual machines in Azure. We can supply several subcommands to do specific tasks. The most common include:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Sub-command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create</code></td>
<td>Create a new virtual machine</td>
</tr>
<tr>
<td><code>deallocate</code></td>
<td>Deallocate a virtual machine</td>
</tr>
<tr>
<td><code>delete</code></td>
<td>Delete a virtual machine</td>
</tr>
<tr>
<td><code>list</code></td>
<td>List the created virtual machines in your subscription</td>
</tr>
<tr>
<td><code>open-port</code></td>
<td>Open a specific network port for inbound traffic</td>
</tr>
<tr>
<td><code>restart</code></td>
<td>Restart a virtual machine</td>
</tr>
<tr>
<td><code>show</code></td>
<td>Get the details for a virtual machine</td>
</tr>
<tr>
<td><code>start</code></td>
<td>Start a stopped virtual machine</td>
</tr>
<tr>
<td><code>stop</code></td>
<td>Stop a running virtual machine</td>
</tr>
<tr>
<td><code>update</code></td>
<td>Update a property of a virtual machine</td>
</tr>
</tbody>
</table>
<p>Note</p>
<p>For a complete list of commands, you can check the <a href="https://learn.microsoft.com/en-us/cli/azure/reference-index">Azure CLI reference documentation</a>.</p>
<p>Let's start with the first one: <code>az vm create</code>. You can use this command to create a virtual machine in a resource group. There are several parameters you can pass to configure all the aspects of the new VM. The four parameters that you must supply are:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--resource-group</code></td>
<td>The resource group that will own the virtual machine; use <strong>[sandbox Resource Group]</strong>.</td>
</tr>
<tr>
<td><code>--name</code></td>
<td>The name of the virtual machine; must be unique within the resource group.</td>
</tr>
<tr>
<td><code>--image</code></td>
<td>The operating system image to use to create the VM.</td>
</tr>
<tr>
<td><code>--location</code></td>
<td>The region in which to place the VM. Typically, this would be close to the VM's consumer.</td>
</tr>
</tbody>
</table>
<p>In addition, it's helpful to add the <code>--verbose</code> flag to see progress while the VM is being created.</p>
<h3 id="create-a-linux-virtual-machine"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-a-linux-virtual-machine">Create a Linux virtual machine</a></h3>
<p>Let's create a new Linux virtual machine. Execute the following command in Azure Cloud Shell to create an Ubuntu VM in the <em>West US</em> location.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm create \
  --resource-group &quot;[sandbox resource group name]&quot; \
  --location westus \
  --name SampleVM \
  --image Ubuntu2204 \
  --admin-username azureuser \
  --generate-ssh-keys \
  --verbose 
</code></pre></div>
<p>Tip</p>
<p>You can use the <strong>Copy</strong> button to copy commands to the clipboard. To paste, right-click on a new line in the Cloud Shell terminal and select <strong>Paste</strong>, or use the Shift+Insert keyboard shortcut (⌘+V on macOS).</p>
<p>This command creates a new <strong>Ubuntu</strong> Linux virtual machine with the name <code>SampleVM</code>. Notice that the Azure CLI tool waits while the VM is being created. You can add the <code>--no-wait</code> option to tell the Azure CLI tool to return immediately and have Azure continue creating the VM in the background. This is useful if you're executing the command in a script.</p>
<p>We're specifying the administrator account name through the <code>--admin-username</code> flag to be <code>azureuser</code>. If you omit this, the <code>az vm create</code> command will use your <em>current user name</em>. Because the rules for account names are different for each OS, it's safer to specify a specific name.</p>
<p>Note</p>
<p>Common names such as "root" and "admin" aren't allowed for most images.</p>
<p>We're also using the <code>generate-ssh-keys</code> flag. Linux distributions use this parameter, and it creates a pair of security keys so we can use the <code>ssh</code> tool to access the virtual machine remotely. The two files are placed into the <code>.ssh</code> folder on your machine and in the VM. If you already have an SSH key named <code>id_rsa</code> in the target folder, then that SSH key will be used rather than generating a new key.</p>
<p>Once Azure CLI finishes creating the VM, you'll get a JSON response which includes the current state of the virtual machine and its public and private IP addresses assigned by Azure:</p>
<p>JSONCopy</p>
<div class="highlight"><pre><span></span><code>{
  &quot;fqdns&quot;: &quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/Learn-bbbb1b1b-cc2c-dd3d-ee4e-ffffff5f5f5f/providers/Microsoft.Compute/virtualMachines/SampleVM&quot;,
  &quot;location&quot;: &quot;westus&quot;,
  &quot;macAddress&quot;: &quot;00-0D-3A-58-F8-45&quot;,
  &quot;powerState&quot;: &quot;VM running&quot;,
  &quot;privateIpAddress&quot;: &quot;10.0.0.4&quot;,
  &quot;publicIpAddress&quot;: &quot;40.83.165.85&quot;,
  &quot;resourceGroup&quot;: &quot;bbbb1b1b-cc2c-dd3d-ee4e-ffffff5f5f5f&quot;,
  &quot;zones&quot;: &quot;&quot;
}
</code></pre></div>
<h2 id="exercise-test-your-new-virtual-machine"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-test-your-new-virtual-machine">Exercise - Test your new virtual machine</a></h2>
<p>When you create a virtual machine, it's assigned a public IP address that's reachable over the internet and a private IP address used within the Azure datacenter. Both of these values appear in the JSON block the <code>create</code> command returns, like the following:</p>
<p>JSONCopy</p>
<div class="highlight"><pre><span></span><code>{
   ...
  &quot;privateIpAddress&quot;: &quot;10.0.0.4&quot;,
  &quot;publicIpAddress&quot;: &quot;40.83.165.85&quot;,
   ...
}
</code></pre></div>
<h3 id="connecting-to-the-vm-with-ssh"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#connecting-to-the-vm-with-ssh">Connecting to the VM with SSH</a></h3>
<p>We can quickly test that the Linux VM is up and running by using the public IP address in the Secure Shell (<code>ssh</code>) tool. Remember that we set our admin name to <code>azureuser</code>, so we need specify that. Make sure to use the public IP address from <em>your</em> running instance.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>ssh azureuser@&lt;public-ip-address&gt;
</code></pre></div>
<p>Note</p>
<p>We don't need a password because we generated an SSH key pair as part of the VM creation. The first time you shell into the VM, you receive a prompt regarding the authenticity of the host.</p>
<p>This is because we are attempting to access an IP address directly instead of through a host name. Answering <strong>yes</strong> saveS the IP address as a valid host for connection and allows the connection to proceed.</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>The authenticity of host &#39;40.83.165.85 (40.83.165.85)&#39; can&#39;t be established.
RSA key fingerprint is SHA256:hlFnTCAzgWVFiMxHK194I2ap6+5hZoj9ex8+/hoM7rE.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;40.83.165.85&#39; (RSA) to the list of known hosts.
</code></pre></div>
<p>Then, you'll be presented with a remote shell where you can enter Linux commands.</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 5.0.0-1014-azure x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Wed Aug 21 20:32:04 UTC 2019

  System load:  0.0               Processes:           108
  Usage of /:   4.2% of 28.90GB   Users logged in:     0
  Memory usage: 9%                IP address for eth0: 10.0.0.5
  Swap usage:   0%

0 packages can be updated.
0 updates are security updates.

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

To run a command as administrator (user &quot;root&quot;), use &quot;sudo &lt;command&gt;&quot;.
See &quot;man sudo_root&quot; for details.

azureuser@SampleVM:~$
</code></pre></div>
<p>Try a few commands, such as <code>ps</code> or <code>ls</code>, as practice. When you're finished, sign out of the virtual machine by typing <code>exit</code> or <code>logout</code>.</p>
<h2 id="exercise-explore-other-vm-images"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-explore-other-vm-images">Exercise - Explore other VM images</a></h2>
<p>We used UbuntuLTS for the image to create the virtual machine. Azure has several standard VM images you can use to create a virtual machine.</p>
<h3 id="listing-images"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#listing-images">Listing images</a></h3>
<p>You can get a list of the available VM images using the following command:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm image list --output table
</code></pre></div>
<p>Note</p>
<p>If you get the error <em>az: command not found</em>, type <code>exit</code> into the shell and try again.</p>
<p>This outputs the most popular images that are part of an offline list built into the Azure CLI. However, there are <em>hundreds</em> of image options available in the Azure Marketplace.</p>
<h3 id="getting-all-images"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#getting-all-images">Getting all images</a></h3>
<p>You can get a full list by adding the <code>--all</code> flag to the command. Because the list of images in the Marketplace is very large, it's helpful to filter the list with the <code>--publisher</code>, <code>--sku</code> or <code>–-offer</code> options.</p>
<p>For example, try the following command to see <em>all</em> Wordpress images available:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm image list --sku Wordpress --output table --all
</code></pre></div>
<p>Or this command to see all images provided by Microsoft:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm image list --publisher Microsoft --output table --all
</code></pre></div>
<p>These commands can take a few moments to complete.</p>
<h3 id="location-specific-images"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#location-specific-images">Location-specific images</a></h3>
<p>Some images are only available in certain locations. Try adding the <code>--location [location]</code> flag to the command to scope the results to ones available in the region where you want to create the virtual machine. For example, type the following into Azure Cloud Shell to get a list of images available in the <code>eastus</code> region.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm image list --location eastus --output table
</code></pre></div>
<p>Try checking some of the images in the other Azure sandbox available locations:</p>
<ul>
<li>westus2</li>
<li>southcentralus</li>
<li>centralus</li>
<li>eastus</li>
<li>westeurope</li>
<li>southeastasia</li>
<li>japaneast</li>
<li>brazilsouth</li>
<li>australiasoutheast</li>
<li>centralindia</li>
</ul>
<p>Tip</p>
<p>These are the standard images that are provided by Azure. Keep in mind that you can also <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/linux/tutorial-custom-images">create and upload your own custom images</a> to create VMs based on unique configurations or less common versions or distributions of an operating system.</p>
<p>Your command window is probably full now. If you like, you can type <code>clear</code> to clear the screen.</p>
<h2 id="exercise-sizing-vms-properly"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-sizing-vms-properly">Exercise - Sizing VMs properly</a></h2>
<p>Virtual machines must be sized appropriately for the expected work. A VM without the correct amount of memory or CPU will fail under load or run too slowly to be effective.</p>
<h3 id="predefined-vm-sizes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#predefined-vm-sizes">Predefined VM sizes</a></h3>
<p>When you create a virtual machine, you can supply a <em>VM size</em> value that determines the amount of compute resources devoted to the VM, including CPU, GPU, and memory made available to the virtual machine from Azure.</p>
<p>Azure defines a set of predefined VM sizes for Linux and Windows from which to choose based on the expected usage.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Sizes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>General purpose</td>
<td>Dsv3, Dv3, DSv2, Dv2, DS, D, Av2, A0-7</td>
<td>Balanced CPU-to-memory. Ideal for dev/test and small to medium applications and data solutions.</td>
</tr>
<tr>
<td>Compute optimized</td>
<td>Fs, F</td>
<td>High CPU-to-memory. Good for medium-traffic applications, network appliances, and batch processes.</td>
</tr>
<tr>
<td>Memory optimized</td>
<td>Esv3, Ev3, M, GS, G, DSv2, DS, Dv2, D</td>
<td>High memory-to-core. Great for relational databases, medium to large caches, and in-memory analytics.</td>
</tr>
<tr>
<td>Storage optimized</td>
<td>Ls</td>
<td>High disk throughput and IO. Ideal for big data, SQL, and NoSQL databases.</td>
</tr>
<tr>
<td>GPU optimized</td>
<td>NV, NC</td>
<td>Specialized VMs targeted for heavy graphic rendering and video editing.</td>
</tr>
<tr>
<td>High performance</td>
<td>H, A8-11</td>
<td>Our most powerful CPU VMs with optional high-throughput network interfaces (RDMA).</td>
</tr>
</tbody>
</table>
<p>The available sizes change based on the region in which you're creating the VM. You can get a list of the available sizes using the <code>vm list-sizes</code> command. Try typing the following command into Azure Cloud Shell:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm list-sizes --location eastus --output table
</code></pre></div>
<p>Here's an abbreviated response for <code>eastus</code>:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>  MaxDataDiskCount    MemoryInMb  Name                      NumberOfCores    OsDiskSizeInMb    ResourceDiskSizeInMb
------------------  ------------  ----------------------  ---------------  ----------------  ----------------------
                 2          2048  Standard_B1ms                         1           1047552                    4096
                 2          1024  Standard_B1s                          1           1047552                    2048
                 4          8192  Standard_B2ms                         2           1047552                   16384
                 4          4096  Standard_B2s                          2           1047552                    8192
                 8         16384  Standard_B4ms                         4           1047552                   32768
                16         32768  Standard_B8ms                         8           1047552                   65536
                 4          3584  Standard_DS1_v2                       1           1047552                    7168
                 8          7168  Standard_DS2_v2                       2           1047552                   14336
                16         14336  Standard_DS3_v2                       4           1047552                   28672
                32         28672  Standard_DS4_v2                       8           1047552                   57344
                64         57344  Standard_DS5_v2                      16           1047552                  114688
        ....
                64       3891200  Standard_M128-32ms                  128           1047552                 4096000
                64       3891200  Standard_M128-64ms                  128           1047552                 4096000
                64       3891200  Standard_M128ms                     128           1047552                 4096000
                64       2048000  Standard_M128s                      128           1047552                 4096000
                64       1024000  Standard_M64                         64           1047552                 8192000
                64       1792000  Standard_M64m                        64           1047552                 8192000
                64       2048000  Standard_M128                       128           1047552                16384000
                64       3891200  Standard_M128m                      128           1047552                16384000
</code></pre></div>
<h3 id="specify-a-size-during-vm-creation"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#specify-a-size-during-vm-creation">Specify a size during VM creation</a></h3>
<p>We didn't specify a size when we created our VM, so Azure selected a default general-purpose size for us. However, we can specify the size as part of the <code>vm create</code> command using the <code>--size</code> parameter. For example, you could use the following command to create a two-core virtual machine:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name SampleVM2 \
    --image Ubuntu2204 \
    --admin-username azureuser \
    --generate-ssh-keys \
    --verbose \
    --size &quot;Standard_DS2_v2&quot;
</code></pre></div>
<p>Warning</p>
<p>Your subscription tier <a href="https://learn.microsoft.com/en-us/azure/azure-subscription-service-limits">enforces limits</a> on how many resources you can create, as well as the total size of those resources. Quota limits depend upon your subscription type and region. The Azure CLI lets you know when you exceed this limit with a <strong>Quota Exceeded</strong> error. If you hit this error in your own paid subscription, you can request to raise the limits associated with your paid subscription (up to 10,000 vCPUs) through a <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/resource-manager-quota-errors">free online request</a>.</p>
<h3 id="resize-an-existing-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#resize-an-existing-vm">Resize an existing VM</a></h3>
<p>We can also resize an existing VM if the workload changes or if it was incorrectly sized at creation. Let's use the first VM we created, SampleVM. Before requesting a resize, we must check to see if the desired size is available in the cluster of which our VM is a part. We can use the <code>vm list-vm-resize-options</code> command:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm list-vm-resize-options \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name SampleVM \
    --output table
</code></pre></div>
<p>This command returns a list of all the possible size configurations available in the resource group. If the size we want isn't available in our cluster but <em>is</em> available in the region, we can <a href="https://learn.microsoft.com/en-us/cli/azure/vm#az-vm-deallocate">deallocate the VM</a>. This command stops the running VM and removes it from the current cluster without losing any resources. We can then resize it, which re-creates the VM in a new cluster where the size configuration is available.</p>
<p>Note</p>
<p>The Microsoft Learn sandbox is limited to a few VM sizes.</p>
<p>To resize a VM, we'll use the <code>vm resize</code> command. For example, perhaps we find our VM is underpowered for the task we want it to perform. We could bump it up to a D2s_v3, where it has 2 vCores and 8 GB of memory. Type this command in Cloud Shell:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm resize \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name SampleVM \
    --size Standard_D2s_v3
</code></pre></div>
<p>This command takes a few minutes to reduce the resources of the VM, and once it's done, it returns a new JSON configuration.</p>
<h2 id="exercise-query-system-and-runtime-information-about-the-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-query-system-and-runtime-information-about-the-vm">Exercise - Query system and runtime information about the VM</a></h2>
<p>Now that we've created a virtual machine, we can get information about it through other commands.</p>
<p>Let's start by running <code>vm list</code>.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm list
</code></pre></div>
<p>This command will return <em>all</em> virtual machines defined in this subscription. You can filter the output to a specific resource group through the <code>--resource-group</code> parameter.</p>
<h3 id="output-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#output-types">Output types</a></h3>
<p>Notice that the default response type for all the commands we've done so far is JSON. This is great for scripting, but most people find it harder to read. You can change the output style for any response through the <code>--output</code> flag. For example, run the following command in Azure Cloud Shell to see the different output style.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm list --output table
</code></pre></div>
<p>Along with <code>table</code>, you can specify <code>json</code> (the default), <code>jsonc</code> (colorized JSON), or <code>tsv</code> (Tab-Separated Values). Try a few variations with the preceding command to see the difference.</p>
<h3 id="get-the-ip-address"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#get-the-ip-address">Get the IP address</a></h3>
<p>Another useful command is <code>vm list-ip-addresses</code>, which lists the public and private IP addresses for a VM. If they change, or you didn't capture them during creation, you can retrieve them at any time.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm list-ip-addresses -n SampleVM -o table
</code></pre></div>
<p>This returns output like:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>VirtualMachine    PublicIPAddresses    PrivateIPAddresses
----------------  -------------------  --------------------
SampleVM          168.61.54.62         10.0.0.4
</code></pre></div>
<p>Tip</p>
<p>Notice that we're using a shorthand syntax for the <code>--output</code> flag as <code>-o</code>. You can shorten most parameters to Azure CLI commands to a single dash and letter. For example, you can shorten <code>--name</code> to <code>-n</code> and <code>--resource-group</code> to <code>-g</code>. This is handy for entering keyboard characters, but we recommend using the full option name in scripts for clarity. Check the documentation for details about each command.</p>
<h3 id="get-vm-details"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#get-vm-details">Get VM details</a></h3>
<p>We can get more detailed information about a specific virtual machine by name or ID running the <code>vm show</code> command.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm show --resource-group &quot;[sandbox resource group name]&quot; --name SampleVM
</code></pre></div>
<p>This returns a fairly large JSON block with all sorts of information about the VM, including attached storage devices, network interfaces, and all of the object IDs for resources that the VM is connected to. Again, we could change to a table format, but that omits almost all of the interesting data. Instead, we can turn to a built-in query language for JSON called <a href="http://jmespath.org/">JMESPath</a>.</p>
<h3 id="add-filters-to-queries-with-jmespath"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#add-filters-to-queries-with-jmespath">Add filters to queries with JMESPath</a></h3>
<p>JMESPath is an industry-standard query language built around JSON objects. The simplest query is to specify an <em>identifier</em> that selects a key in the JSON object.</p>
<p>For example, given the object:</p>
<p>JSONCopy</p>
<div class="highlight"><pre><span></span><code>{
  &quot;people&quot;: [
    {
      &quot;name&quot;: &quot;Fred&quot;,
      &quot;age&quot;: 28
    },
    {
      &quot;name&quot;: &quot;Barney&quot;,
      &quot;age&quot;: 25
    },
    {
      &quot;name&quot;: &quot;Wilma&quot;,
      &quot;age&quot;: 27
    }
  ]
}
</code></pre></div>
<p>We can use the query <code>people</code> to return the array of values for the <code>people</code> array. If we just want <em>one</em> of the people, we can use an indexer. For example, <code>people[1]</code> would return:</p>
<p>JSONCopy</p>
<div class="highlight"><pre><span></span><code>{
    &quot;name&quot;: &quot;Barney&quot;,
    &quot;age&quot;: 25
}
</code></pre></div>
<p>We can also add specific qualifiers that would return a subset of the objects based on some criteria. For example, adding the qualifier <code>people[?age &gt; '25']</code> would return:</p>
<p>JSONCopy</p>
<div class="highlight"><pre><span></span><code>[
  {
    &quot;name&quot;: &quot;Fred&quot;,
    &quot;age&quot;: 28
  },
  {
    &quot;name&quot;: &quot;Wilma&quot;,
    &quot;age&quot;: 27
  }
]
</code></pre></div>
<p>Finally, we can constrain the results by adding a select: <code>people[?age &gt; '25'].[name]</code> that returns just the names:</p>
<p>JSONCopy</p>
<div class="highlight"><pre><span></span><code>[
  [
    &quot;Fred&quot;
  ],
  [
    &quot;Wilma&quot;
  ]
]
</code></pre></div>
<p>JMESQuery has several other interesting query features. When you have time, check out the <a href="http://jmespath.org/tutorial.html">online tutorial</a> available on the <a href="http://jmespath.org/">JMESPath.org</a> site.</p>
<h3 id="filter-your-azure-cli-queries"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#filter-your-azure-cli-queries">Filter your Azure CLI queries</a></h3>
<p>With a basic understanding of JMES queries, we can add filters to the data returned by queries like the <code>vm show</code> command. For example, we can retrieve the admin username:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm show \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name SampleVM \
    --query &quot;osProfile.adminUsername&quot;
</code></pre></div>
<p>We can get the size assigned to our VM:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm show \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name SampleVM \
    --query hardwareProfile.vmSize
</code></pre></div>
<p>Or, to retrieve all the IDs for your network interfaces, we can run the query:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm show \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name SampleVM \
    --query &quot;networkProfile.networkInterfaces[].id&quot;
</code></pre></div>
<p>This query technique works with any Azure CLI command, and you can use it to pull specific bits of data out on the command line. It's useful for scripting, as well. For example, you can pull a value out of your Azure account and store it in an environment or script variable. If you decide to use it this way, it's useful to add the <code>--output tsv</code> parameter (which you can shorten to <code>-o tsv</code>). This will return results that only include the actual data values with tab separators.</p>
<p>For example:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm show \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name SampleVM \
    --query &quot;networkProfile.networkInterfaces[].id&quot; -o tsv
</code></pre></div>
<p>returns the text: <code>/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/bbbb1b1b-cc2c-dd3d-ee4e-ffffff5f5f5f/providers/Microsoft.Network/networkInterfaces/SampleVMVMNic</code></p>
<h2 id="exercise-start-and-stop-your-vm-with-the-azure-cli"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-start-and-stop-your-vm-with-the-azure-cli">Exercise - Start and stop your VM with the Azure CLI</a></h2>
<p>One of the main tasks you'll want to do while running virtual machines is to start and stop them.</p>
<h3 id="stop-a-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#stop-a-vm">Stop a VM</a></h3>
<p>We can stop a running VM with the <code>vm stop</code> command. You must pass the name and resource group or the unique ID for the VM:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm stop \
    --name SampleVM \
    --resource-group &quot;[sandbox resource group name]&quot;
</code></pre></div>
<p>You can verify the VM has stopped by attempting to ping the public IP address, using <code>ssh</code>, or through the <code>vm get-instance-view</code> command. This final approach returns the same basic data as <code>vm show</code>, but includes details about the instance itself. Try entering the following command into Azure Cloud Shell to see the current running state of your VM:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm get-instance-view \
    --name SampleVM \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --query &quot;instanceView.statuses[?starts_with(code, &#39;PowerState/&#39;)].displayStatus&quot; -o tsv
</code></pre></div>
<p>This command should return <code>VM stopped</code> as the result.</p>
<h3 id="start-a-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#start-a-vm">Start a VM</a></h3>
<p>We can do the reverse through the <code>vm start</code> command.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm start \
    --name SampleVM \
    --resource-group &quot;[sandbox resource group name]&quot;
</code></pre></div>
<p>This command starts a stopped VM. You can verify it through the <code>vm get-instance-view</code> query you used in the last section, which should now return <code>VM running</code>.</p>
<h3 id="restart-a-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#restart-a-vm">Restart a VM</a></h3>
<p>Finally, we can restart a VM if we've made changes that require a reboot by running the <code>vm restart</code> command. You can add the <code>--no-wait</code> flag if you want the Azure CLI to return immediately without waiting for the VM to reboot.</p>
<h2 id="exercise-install-software-on-your-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-install-software-on-your-vm">Exercise - Install software on your VM</a></h2>
<p>The last thing we want to try on our VM is to install a web server. One of the easiest packages to install is <code>nginx</code>.</p>
<h3 id="install-nginx-web-server"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#install-nginx-web-server">Install NGINX web server</a></h3>
<ol>
<li>
<p>Locate the public IP address of your <em>SampleVM</em> Linux virtual machine.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm list-ip-addresses --name SampleVM --output table
</code></pre></div>
</li>
<li>
<p>Next, open an <code>ssh</code> connection to <em>SampleVM</em> using the Public IP address from the preceding step.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ssh azureuser@&lt;PublicIPAddress&gt;
</code></pre></div>
</li>
<li>
<p>After you're logged in to the virtual machine, run the following command to install the <code>nginx</code> web server. The command takes a few moments to complete.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>sudo apt-get -y update &amp;&amp; sudo apt-get -y install nginx
</code></pre></div>
</li>
<li>
<p>Exit the Secure Shell:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>exit
</code></pre></div>
</li>
</ol>
<h3 id="retrieve-your-default-page"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#retrieve-your-default-page">Retrieve your default page</a></h3>
<ol>
<li>
<p>In Azure Cloud Shell, use <code>curl</code> to read the default page from your Linux web server by running the following command, replacing <code>&lt;PublicIPAddress&gt;</code> with the public IP you found previously. You can also open a new browser tab and try to browse to the public IP address.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>curl -m 80 &lt;PublicIPAddress&gt;
</code></pre></div>
<p>This command will fail, because the Linux virtual machine doesn't expose port 80 (<code>http</code>) through the network security group that secures the network connectivity to the virtual machine. We can fix the failure by running the Azure CLI command <code>vm open-port</code>.</p>
</li>
<li>
<p>Enter the following command into Cloud Shell to open port 80:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm open-port \
    --port 80 \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name SampleVM
</code></pre></div>
<p>It takes a moment to add the network rule and open the port through the firewall.</p>
</li>
<li>
<p>Run the <code>curl</code> command again.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>curl -m 80 &lt;PublicIPAddress&gt;
</code></pre></div>
<p>This time, it should return data like the following. You can see the page in a browser as well.</p>
<p>HTMLCopy</p>
<div class="highlight"><pre><span></span><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
body {
    width: 35em;
    margin: 0 auto;
    font-family: Tahoma, Verdana, Arial, sans-serif;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support, refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div>
</li>
</ol>
<hr />
<h2 id="create-a-windows-virtual-machine-in-azure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-a-windows-virtual-machine-in-azure">Create a Windows virtual machine in Azure</a></h2>
<h2 id="introduction_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#introduction_5">Introduction</a></h2>
<p>Imagine that you work for a company that does video-data processing and pattern analysis. You're building a new prototype platform to process the video from traffic cameras, analyze trends, and provide actionable data for traffic and road improvements.</p>
<p>To improve your algorithms, you've made arrangements with several new cities to collect their traffic-camera data. However, not all of the video data is in the same format, and many of the formats only have Windows codecs to decode the data. Therefore, you've decided to use Virtual Machines (VMs) to do the initial processing and then push the data onto Azure Functions, which will process a standard format. This approach allows you to bring on new data formats dynamically without stopping the entire system.</p>
<p>Azure provides a robust virtual machine hosting solution that can meet your needs. Let's explore how to create and work with Windows virtual machines in Azure.</p>
<h3 id="learning-objectives_6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#learning-objectives_6">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Understand the options that are available for virtual machines in Azure.</li>
<li>Create a Windows virtual machine using the Azure portal.</li>
<li>Connect to a running Windows virtual machine using Remote Desktop.</li>
<li>Install software and change the network configuration on a VM using the Azure portal.</li>
</ul>
<h3 id="prerequisites_6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#prerequisites_6">Prerequisites</a></h3>
<ul>
<li>Basic understanding of Azure Virtual Machines from <a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-virtual-machines/">Introduction to Azure Virtual Machines</a></li>
<li>Remote Desktop client</li>
</ul>
<h2 id="create-a-windows-virtual-machine-in-azure_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-a-windows-virtual-machine-in-azure_1">Create a Windows virtual machine in Azure</a></h2>
<p>Your company has decided to manage the video data from their traffic cameras in Azure using VMs. In order to run the multiple codecs, we first need to create the VMs. We also need to connect and interact with the VMs. In this unit, you'll learn how to create a VM using the Azure portal. You'll configure the VM for remote access, select a VM image, and choose the proper storage option.</p>
<h3 id="introduction-to-windows-virtual-machines-in-azure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#introduction-to-windows-virtual-machines-in-azure">Introduction to Windows virtual machines in Azure</a></h3>
<p>Azure VMs are an on-demand, scalable cloud-computing resource. They're similar to virtual machines that are hosted in Windows Hyper-V. They include processor, memory, storage, and networking resources. You can start and stop virtual machines at will, just like with Hyper-V, and manage them from the Azure portal or with the Azure CLI. You can also use a Remote Desktop Protocol (RDP) client to connect directly to the Windows desktop user interface (UI) and use the VM as if you were signed in to a local Windows computer.</p>
<h3 id="create-an-azure-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-an-azure-vm">Create an Azure VM</a></h3>
<p>You can define and deploy VMs on Azure in several ways: the Azure portal, a script (using the Azure CLI or Azure PowerShell), or through an Azure Resource Manager template. In all cases, you'll need to supply several pieces of information, which we'll cover shortly.</p>
<p>The Azure Marketplace also provides preconfigured images that include both an OS and popular software tools installed for specific scenarios.</p>
<p><img alt="Screenshot showing the Azure Marketplace list of Virtual Machines." src="https://learn.microsoft.com/en-us/training/modules/create-windows-virtual-machine-in-azure/media/2-marketplace-vm-choices.png" /></p>
<h3 id="resources-used-in-a-windows-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#resources-used-in-a-windows-vm">Resources used in a Windows VM</a></h3>
<p>When creating a Windows VM in Azure, you also create resources to host the VM. These resources work together to virtualize a computer and run the Windows operating system. These must either exist (and be selected during VM creation), or they'll be created with the VM.</p>
<ul>
<li>A virtual machine that provides CPU and memory resources</li>
<li>An Azure Storage account to hold the virtual hard disks</li>
<li>Virtual disks to hold the OS, applications, and data</li>
<li>A virtual network (VNet) to connect the VM to other Azure services or your own on-premises hardware</li>
<li>A network interface to communicate with the VNet</li>
<li>A public IP address so you can access the VM (this is optional)</li>
</ul>
<p>Like other Azure services, you'll need a <strong>resource group</strong> to contain the VM (and optionally group these resources together for administration). When you create a new VM, you can either use an existing resource group or create a new one.</p>
<h3 id="choose-the-vm-image"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#choose-the-vm-image">Choose the VM image</a></h3>
<p>Selecting an image is one of the first and most important decisions you'll make when creating a VM. An image is a template that's used to create a VM. These templates include an OS and often other software, such as development tools or web-hosting environments.</p>
<p>You can include any application that the computer can support in the VM image. You can create a VM from an image that's preconfigured to exactly match your requirements, such as hosting an ASP.NET Core app.</p>
<p>Tip</p>
<p>You can also create and upload your own images. <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/windows/tutorial-custom-images">Check the documentation</a> for more information.</p>
<h3 id="size-your-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#size-your-vm">Size your VM</a></h3>
<p>Just as a physical machine has a certain amount of memory and CPU power, so does a virtual machine. Azure offers a range of VMs of differing sizes at different price points. The size that you choose will determine the VM's processing power, memory, and max storage capacity.</p>
<p>Warning</p>
<p>There are quota limits on each subscription that can impact VM creation. In the classic deployment model, you can't have more than 20 virtual <em>cores</em> across all VMs within a region. You can either split up VMs across regions or file an <a href="https://learn.microsoft.com/en-us/azure/azure-supportability/resource-manager-core-quotas-request">online request</a> to increase your limits.</p>
<p>VM sizes are grouped into categories, starting with the B-series for basic testing, and running up to the H-series for massive computing tasks. You should select the VM's size based on the workload you want to perform. It's possible to change a VM's size after it's been created, but the VM must be stopped first, so it's best to size it appropriately from the start if possible.</p>
<h4 id="here-are-some-guidelines-based-on-the-scenario-youre-targeting"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#here-are-some-guidelines-based-on-the-scenario-youre-targeting">Here are some guidelines based on the scenario you're targeting:</a></h4>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>What are you doing?</th>
<th>Consider these sizes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>General use computing/web</strong>: Testing and development, small to medium databases, or low to medium traffic web servers</td>
<td>B, Dsv3, Dv3, DSv2, Dv2</td>
</tr>
<tr>
<td><strong>Heavy computational tasks</strong>: Medium traffic web servers, network appliances, batch processes, and application servers</td>
<td>Fsv2, Fs, F</td>
</tr>
<tr>
<td><strong>Large memory usage</strong>: Relational database servers, medium to large caches, and in-memory analytics.</td>
<td>Esv3, Ev3, M, GS, G, DSv2, Dv2</td>
</tr>
<tr>
<td><strong>Data storage and processing</strong>: Big Data, SQL, and NoSQL databases, which need high disk throughput and IO</td>
<td>Ls</td>
</tr>
<tr>
<td><strong>Heavy graphics rendering</strong> or video editing, as well as model training and inferencing (ND) with deep learning</td>
<td>NV, NC, NCv2, NCv3, ND</td>
</tr>
<tr>
<td><strong>High-performance computing (HPC)</strong>: If you need the fastest and most powerful CPU virtual machines with optional high-throughput network interfaces</td>
<td>H</td>
</tr>
</tbody>
</table>
<h3 id="choose-storage-options"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#choose-storage-options">Choose storage options</a></h3>
<p>The next set of decisions revolves around storage. First, you can choose the disk technology. Options include a traditional platter-based hard disk drive (HDD) or a more modern solid-state drive (SSD). Just like the hardware you purchase, SSD storage costs more, but provides better performance.</p>
<p>Tip</p>
<p>There are two levels of SSD storage available: Standard and Premium. Choose Standard SSD disks if you have normal workloads but want better performance. Choose Premium SSD disks if you have I/O intensive workloads or mission-critical systems that need to process data very quickly.</p>
<h4 id="map-storage-to-disks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#map-storage-to-disks">Map storage to disks</a></h4>
<p>Azure uses virtual hard disks (VHDs) to represent physical disks for the VM. VHDs replicate the logical format and data of a disk drive, but are stored as page blobs in an Azure Storage account. You can choose on a per-disk basis what type of storage it should use (SSD or HDD). This allows you to control each disk's performance, likely based on the I/O you plan to perform on it.</p>
<p>By default, two virtual hard disks (VHDs) will be created for your Windows VM:</p>
<ol>
<li>
<p><strong>The Operating System disk</strong>: This is your primary or C: drive and has a maximum capacity of 2048 GB.</p>
</li>
<li>
<p><strong>A Temporary disk</strong>: This provides temporary storage for the OS or any apps. It's configured as the D: drive by default and is sized based on the VM size, making it an ideal location for the Windows paging file.</p>
</li>
</ol>
<p>Warning</p>
<p>The temporary disk is not persistent. You should only write data to this disk that you're willing to lose at any time.</p>
<h5 id="what-about-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#what-about-data">What about data?</a></h5>
<p>You can store data on the C: drive along with the OS, but a better approach is to create dedicated <em>data disks</em>. You can create and attach additional disks to the VM. Each data disk can hold up to 32,767 gibibytes (GiB) of data, with the maximum amount of storage determined by the VM size you select.</p>
<p>Note</p>
<p>An interesting capability is to create a VHD image from a real disk. This allows you to easily migrate <em>existing</em> information from an on-premises computer to the cloud.</p>
<h4 id="unmanaged-vs-managed-disks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#unmanaged-vs-managed-disks">Unmanaged vs. Managed disks</a></h4>
<p>The final storage choice you'll make is whether to use <strong>unmanaged</strong> or <strong>managed</strong> disks.</p>
<p>With unmanaged disks, you're responsible for the storage accounts that are used to hold the VHDs corresponding to your VM disks. You pay the storage account rates for the amount of space you use. A single storage account has a fixed rate limit of 20,000 I/O operations/sec. This means that a single storage account is capable of supporting 40 standard virtual hard disks at full throttle. If you need to scale out, then you need more than one storage account, which can get complicated.</p>
<p>Managed disks are the newer (and recommended) disk-storage model. They elegantly solve the complexity of unmanaged disks by putting the burden of managing the storage accounts onto Azure. You specify the disk type (Premium or Standard) and the disk size, and Azure creates and manages both the disk <em>and</em> the storage it uses. You don't have to worry about storage account limits, which makes them easier to scale out. They also offer several other benefits:</p>
<ul>
<li><strong>Increased reliability</strong>: Azure ensures that VHDs associated with high-reliability VMs will be placed in different parts of Azure storage to provide similar levels of resilience.</li>
<li><strong>Better security</strong>: Managed disks are truly managed resources in the resource group. This means they can use role-based access control (RBAC) to restrict who can work with the VHD data.</li>
<li><strong>Snapshot support</strong>: You can use snapshots to create a read-only copy of a VHD. You have to shut down the owning VM, but creating the snapshot only takes a few seconds. Once it's done, you can power on the VM and use the snapshot to create a duplicate VM to troubleshoot a production issue or roll back the VM to the point in time that the snapshot was taken.</li>
<li><strong>Backup support</strong>: You can automatically back up managed disks to different regions for disaster recovery with Azure Backup, all without affecting the service of the VM.</li>
</ul>
<h3 id="network-communication"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#network-communication">Network communication</a></h3>
<p>Virtual machines communicate with external resources using a virtual network (VNet). The VNet represents a private network in a single region on which your resources communicate. A virtual network is just like the networks you manage on-premises. You can divide them up with subnets to isolate resources, connect them to other networks (including your on-premises networks), and apply traffic rules to govern inbound and outbound connections.</p>
<h4 id="plan-your-network"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#plan-your-network">Plan your network</a></h4>
<p>When you create a new VM, you'll have the option of creating a new virtual network or using an existing VNet in your region.</p>
<p>Having Azure create the network together with the VM is simple, but it's likely not ideal for most scenarios. It's better to plan your network requirements <em>up front</em> for all the components in your architecture and create the VNet structure you'll need separately and then create the VMs and place them into the already-created VNets.</p>
<p>We'll look more at virtual networks a bit later in this module. Let's apply some of this knowledge and create a VM in Azure.</p>
<h2 id="exercise-create-a-windows-virtual-machine"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-create-a-windows-virtual-machine">Exercise - Create a Windows virtual machine</a></h2>
<p>Your company processes video content on Windows VMs. A new city has contracted with your company to process their traffic cameras, but it's a model with which you haven't worked before. You need to create a new Windows VM and install some proprietary codecs in order to process and analyze the new video content.</p>
<h3 id="create-a-new-windows-virtual-machine"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-a-new-windows-virtual-machine">Create a new Windows virtual machine</a></h3>
<p>You can create Windows VMs with the Azure portal, Azure CLI, or Azure PowerShell. The best approach is to use the portal, because the <strong>Create a virtual machine</strong> wizard collects all the required information and provides hints and validation messages throughout the process.</p>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> using the same account you used to activate the sandbox.</p>
</li>
<li>
<p>On the Azure portal, under <strong>Azure services</strong>, select <strong>Create a resource</strong>. The <strong>Create a resource</strong> pane appears.</p>
</li>
<li>
<p>In <em>Search services and marketplace</em> search box, search for <em>Windows Server</em> and press Enter. Select <strong>Windows Server</strong> by Microsoft. The <strong>Windows Server</strong> pane appears.</p>
</li>
<li>
<p>There are several Windows Server options to choose from to create your VM. In the <strong>Plan</strong> dropdown list, scroll down, and select <strong>[smalldisk] Windows Server 2019 Datacenter</strong>.</p>
</li>
<li>
<p>Select <strong>Create</strong>. The <strong>Create a virtual machine</strong> pane appears.</p>
</li>
</ol>
<h3 id="configure-the-vm-settings"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-the-vm-settings">Configure the VM settings</a></h3>
<p>Azure presents a <em>wizard</em> as a series of tabs to walk you through all the configuration details for creating the VM. The first tab is <strong>Basics</strong>. You can select <strong>Next</strong> or <strong>Previous</strong> to move from one tab to another, or you can select any tab in the horizontal menu to move to a customizable configuration section.</p>
<p><img alt="Screenshot showing **Basics** tab of the **Create a virtual machine** pane." src="https://learn.microsoft.com/en-us/training/modules/create-windows-virtual-machine-in-azure/media/3-azure-portal-create-vm.png" /></p>
<h4 id="configure-basic-vm-settings"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-basic-vm-settings">Configure basic VM settings</a></h4>
<p>Note</p>
<p>As you add or change settings in the wizard, Azure validates each value and places a green check mark next to a validated field, or red error indicator below the field. You can hover over an error indicator to get more information about a validation issue.</p>
<p>Note</p>
<p>It's a best practice to use a standard naming convention for resource names so you can easily identify their purpose. Windows VM names are a bit limited; they must be between 1 and 15 characters, cannot contain non-ASCII or special characters, and must be unique in the current resource group.</p>
<ol>
<li>On the <strong>Basics</strong> tab, enter the following values for each setting.</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Project details</strong></td>
<td></td>
</tr>
<tr>
<td>Subscription</td>
<td>Concierge Subscription (the subscription that should be billed for VM hours).</td>
</tr>
<tr>
<td>Resource Group</td>
<td>Select <em><strong>[sandbox resource group name]</strong></em>.</td>
</tr>
<tr>
<td><strong>Instance details</strong></td>
<td></td>
</tr>
<tr>
<td>Virtual machine name</td>
<td>Enter a name for your VM, such as <strong>test-vp-vm2</strong> (for Test Video Processor VM #2).</td>
</tr>
<tr>
<td>Region</td>
<td>Select a region close to you from the global regions listed in the following table.</td>
</tr>
<tr>
<td>Availability options</td>
<td>Accept default <strong>No infrastructure redundancy required</strong>. This option is used to ensure the VM is highly available by grouping multiple VMs together to deal with planned or unplanned maintenance events or outages.</td>
</tr>
<tr>
<td>Security type</td>
<td>Standard</td>
</tr>
<tr>
<td>Image</td>
<td>Select <strong>[smalldisk] Windows Server 2019 Datacenter - x64 Gen2</strong> from the dropdown list.</td>
</tr>
<tr>
<td>VM architecture</td>
<td>Accept default (x64)</td>
</tr>
<tr>
<td>Run with Azure Spot discount</td>
<td>Accept default (unchecked).</td>
</tr>
<tr>
<td>Size</td>
<td>The <strong>Size</strong> field isn't directly editable. Select or accept the default <strong>Standard DS1 v2</strong>, which will give the VM 1 CPU and 3.5 GB of memory. Optionally, select the field to view recommended or recently chosen sizes; select <strong>See all sizes</strong> to explore filters for sizes based on vCPUs, RAM, Data disks, operations per second, and cost. Select the X in the top right of the pane to close the pane.</td>
</tr>
<tr>
<td><strong>Administrator account</strong></td>
<td></td>
</tr>
<tr>
<td>Username</td>
<td>Enter a username you'll use to sign in to the VM.</td>
</tr>
<tr>
<td>Password</td>
<td>Enter a password that's at least 12 characters long and has at least three of the following four characteristics: one lower case character, one uppercase character, one number, and one special character that isn't '\' or '-'. Use something you'll remember or write it down, as you'll need it later.</td>
</tr>
<tr>
<td>Confirm password</td>
<td>Confirm your password.</td>
</tr>
<tr>
<td><strong>Inbound port rules</strong></td>
<td></td>
</tr>
<tr>
<td>Public inbound ports</td>
<td>Select <strong>Allow selected ports</strong>. We want to be able to access the desktop for this Windows VM using RDP.</td>
</tr>
<tr>
<td>Select inbound ports</td>
<td>Select <strong>RDP (3389)</strong> from the dropdown list. As the note in the UI indicates, we can also adjust the network ports after we create the VM.</td>
</tr>
<tr>
<td><strong>Licensing</strong></td>
<td></td>
</tr>
<tr>
<td>Would you like to use an existing Windows Server License</td>
<td>Leave unchecked</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<pre><code>The free sandbox allows you to create resources in a subset of the Azure global regions. Select a region from the following list when you create resources:

- West US 2
- South Central US
- Central US
- East US
- West Europe

- Southeast Asia
- Japan East
- Brazil South
- Australia Southeast
- Central India
</code></pre>
<ol>
<li>
<p>Select <strong>Next : Disks</strong>.</p>
<p>Tip</p>
<p>You can use the horizonal scroll bar to slide the view to the left to get back to the VM settings, which had opened a new pane to the right.</p>
</li>
</ol>
<h3 id="configure-disks-for-the-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-disks-for-the-vm">Configure disks for the VM</a></h3>
<ol>
<li>On the <strong>Disks</strong> tab, enter or select the following values for each setting.</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Disk options</strong></td>
<td></td>
</tr>
<tr>
<td>Encryption at host</td>
<td>Accept the default (unchecked)</td>
</tr>
<tr>
<td>OS disk size</td>
<td>Accept the default <strong>Image default (30 GiB)</strong>.</td>
</tr>
<tr>
<td>OS disk type</td>
<td>Accept the default <strong>Premium SSD (locally redundant storage)</strong>.</td>
</tr>
<tr>
<td>Delete with VM</td>
<td>Accept the default (checked)</td>
</tr>
<tr>
<td>Key management</td>
<td>Accept the default.</td>
</tr>
<tr>
<td>Enable Ultra Disk compatibility</td>
<td>Accept the default (unchecked)</td>
</tr>
<tr>
<td><strong>Data disks</strong></td>
<td></td>
</tr>
<tr>
<td>Select <strong>Create and attach a new disk</strong> link. The <strong>Create a new disk</strong> pane appears.</td>
<td>Accept all the default values for the following settings: <em>Name</em>; <em>Source type</em>; <em>Size</em>; <em>Key management</em>; and <em>Enable shared disk</em>. This is where you could use a snapshot, or Storage Blob, to create a VHD.</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>Select <strong>OK</strong> to save the settings and close the pane.</p>
<p><img alt="Screenshot showing the configure disks section for the VM." src="https://learn.microsoft.com/en-us/training/modules/create-windows-virtual-machine-in-azure/media/3-configure-disks.png" /></p>
</li>
<li>
<p>On the <strong>Create a virtual machine</strong> pane <strong>Disks</strong> tab, under <strong>Data disks</strong>, there should now be a new row showing the newly configured disk.</p>
<p><img alt="Screenshot showing the newly added disk in the VM." src="https://learn.microsoft.com/en-us/training/modules/create-windows-virtual-machine-in-azure/media/3-new-disk.png" /></p>
</li>
</ol>
<h3 id="configure-the-network"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-the-network">Configure the network</a></h3>
<ol>
<li>
<p>Select <strong>Next : Networking</strong>.</p>
<p>In a production system where other components are already in use, it would be important to use an <em>existing</em> virtual network so that the VM can communicate with the other cloud services in the production solution. If no virtual network has been defined in this location, create it here and configure the:</p>
<ul>
<li><strong>Subnet</strong>: First subnet to subdivide the address space; it must fit within the defined address space. After the VNet is created, you can add more subnets.</li>
<li><strong>Public IP</strong>: Overall IPV4 space available to this network.</li>
<li>On the <strong>Networking</strong> tab, let's change some of the settings. Under the input field for <strong>Virtual network</strong>, select <strong>Create new</strong>. The <strong>Create virtual network</strong> pane appears.</li>
</ul>
</li>
<li>
<p>On the <strong>Create virtual network</strong> pane, enter the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>Accept the default name.</td>
</tr>
<tr>
<td><strong>Address space</strong></td>
<td></td>
</tr>
<tr>
<td><em>Address range</em></td>
<td>In the row below the heading, enter <code>172.16.0.0/16</code> to give the address space a full range of addresses, then check the box next to the address you just entered. If another address range row exists, select the <strong>Delete</strong> icon to delete it.</td>
</tr>
<tr>
<td><strong>Subnets</strong></td>
<td></td>
</tr>
<tr>
<td><em>Subnet name</em></td>
<td>Enter <em>default</em> in the first input field, then select the checkbox next to the name you just entered. If another row exists, select it to delete it.</td>
</tr>
<tr>
<td><em>Address range</em></td>
<td>In the empty input field, enter <code>172.16.1.0/24</code> to give the subnet 256 IP addresses of space.</td>
</tr>
</tbody>
</table>
<ol>
<li>Select <strong>OK</strong> to save your settings and return to the <strong>Create a virtual machine</strong> pane.</li>
</ol>
<p>Note</p>
<p>By default, Azure will create a virtual network, network interface, and public IP for your VM. It's not trivial to change networking options after the VM is created, so always double-check the network assignments for services you create in Azure.</p>
<h3 id="finish-configuring-the-vm-and-create-the-image"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#finish-configuring-the-vm-and-create-the-image">Finish configuring the VM and create the image</a></h3>
<p>On the <strong>Create a virtual machine</strong> pane, the rest of the tabs have reasonable defaults and there's no need to change any of them. You can explore the other tabs if you like. Each field has an <strong>(i)</strong> icon next to it which, if selected, will show a detailed definition of that configuration setting. Reviewing field descriptions is a great way to learn about the settings you can use to configure the VM.</p>
<ol>
<li>
<p>Select <strong>Review + create</strong>. The system will validate your options and display details about the VM being created.</p>
</li>
<li>
<p>Select <strong>Create</strong> to deploy the VM. The Azure dashboard will show the name of the VM that's being deployed and details about your deployment. Deployment may take several minutes.</p>
</li>
<li>
<p>After deployment completes, select <strong>Go to resource</strong>. Your virtual machine pane appears.</p>
</li>
</ol>
<p>Now, let's look at what we can do with this VM.</p>
<h2 id="use-rdp-to-connect-to-windows-azure-virtual-machines"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#use-rdp-to-connect-to-windows-azure-virtual-machines">Use RDP to connect to Windows Azure virtual machines</a></h2>
<p>Now that you have a Windows VM in Azure, the next thing you’ll do is put your applications and data on those VMs to process our traffic videos.</p>
<p>However, unless you’ve set up a site-to-site VPN to Azure, your Azure VMs won’t be accessible from your local network. If you’re just getting started with Azure, it’s unlikely that you have a working site-to-site VPN, so how can you transfer files to Azure VMs? One easy way is to use Azure’s Remote Desktop Connections feature to share your local drives with your new Azure VMs.</p>
<p>Now that we have a new Windows virtual machine, we need to install our custom software onto it. There are several options to choose from:</p>
<ul>
<li>Remote Desktop Protocol (RDP)</li>
<li>Custom scripts</li>
<li>Custom VM images (with the software preinstalled)</li>
</ul>
<p>Let's look at the simplest approach for Windows VMs: Remote Desktop.</p>
<h3 id="what-is-the-remote-desktop-protocol"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#what-is-the-remote-desktop-protocol">What is the Remote Desktop Protocol?</a></h3>
<p>Remote Desktop Protocol (RDP) provides remote connectivity to the UI of Windows-based computers. RDP lets you sign in to a remote physical or virtual Windows computer and control that computer as if you were seated at the console. An RDP connection allows you to carry out most operations that you can do from a physical computer's console, except for some power and hardware-related functions.</p>
<p>An RDP connection requires an RDP client. Microsoft provides RDP clients for the following operating systems:</p>
<ul>
<li>Windows (built-in)</li>
<li>macOS</li>
<li>iOS</li>
<li>Android</li>
</ul>
<p>The following screenshot displays the Remote Desktop Protocol client in Windows 10.</p>
<p><img alt="Screenshot of the user interface of the Remote Desktop Protocol client." src="https://learn.microsoft.com/en-us/training/modules/create-windows-virtual-machine-in-azure/media/4-rdp-client.png" /></p>
<p>There are also open-source Linux clients, such as Remmina, that allow you to connect to a Windows PC from an Ubuntu distribution.</p>
<h3 id="connecting-to-an-azure-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#connecting-to-an-azure-vm">Connecting to an Azure VM</a></h3>
<p>As we learned a moment ago, Azure VMs communicate on a virtual network. They can also have an optional public IP address assigned to them. With a public IP, we can communicate with the VM over the Internet. Alternatively, we can set up a virtual private network (VPN) that connects our on-premises network to Azure, letting us securely connect to the VM without exposing a public IP. This approach is covered in another module, and is fully documented if you're interested in exploring that option.</p>
<p>One thing to be aware of with public IP addresses in Azure is they're often dynamically allocated. That means the IP address can change over time; for VMs, this happens when the VM is restarted. You can pay more to assign static addresses if you want to connect directly to an IP address instead of a name and need to ensure that the IP address won't change.</p>
<h4 id="how-do-you-connect-to-a-vm-in-azure-using-rdp"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#how-do-you-connect-to-a-vm-in-azure-using-rdp">How do you connect to a VM in Azure using RDP?</a></h4>
<p>Connecting to a VM in Azure using RDP is a simple process. In the Azure portal, you'll go to your VM's properties, and at the top, select <strong>Connect</strong>. This shows you the IP addresses assigned to the VM and give you the option to download a <strong>preconfigured.rdp</strong> file that Windows then opens in the RDP client. You can choose to connect over the public IP address of the VM in the RDP file. Instead, if you're connecting over VPN or ExpressRoute, you can select the internal IP address. You can also select the port number for the connection.</p>
<p>If you're using a static public IP address for the VM, you can save the <strong>.rdp</strong> file to your desktop. If you're using dynamic IP addressing, the <strong>.rdp</strong> file only remains valid while the VM is running. If you stop and restart the VM, you must download another <strong>.rdp</strong> file.</p>
<p>Tip</p>
<p>You can also enter the public IP address of the VM into the Windows RDP client and select <strong>Connect</strong>.</p>
<p>When you connect, you'll typically receive two warnings. These are:</p>
<ul>
<li><strong>Publisher warning</strong>: caused by the <strong>.rdp</strong> file not being publicly signed</li>
<li><strong>Certificate warning</strong>: caused by the machine certificate not being trusted</li>
</ul>
<p>In test environments, you can ignore these warnings. In production environments, the <strong>.rdp</strong> file can be signed using <strong>RDPSIGN.EXE</strong> and the machine certificate placed in the client's <strong>Trusted Root Certification Authorities</strong> store.</p>
<p>Let's try using RDP to connect to our VM.</p>
<h2 id="exercise-connect-to-a-windows-virtual-machine-using-rdp"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-connect-to-a-windows-virtual-machine-using-rdp">Exercise - Connect to a Windows virtual machine using RDP</a></h2>
<p>We have our Windows VM deployed and running, but it's not configured to do any work.</p>
<p>Recall that our scenario is a video-processing system. Our platform receives files through FTP. The traffic cameras upload video clips to a known URL, which is mapped to a folder on the server. The custom software on each Windows VM runs as a service and watches the folder and processes each uploaded clip. It then passes the normalized video to our algorithms running on other Azure services.</p>
<p>There are a few things we'd need to configure to support this scenario:</p>
<ul>
<li>Install FTP and open the ports it needs to communicate</li>
<li>Install the proprietary video codec unique to the city's camera system</li>
<li>Install our transcoding service that processes uploaded videos</li>
</ul>
<p>Many of these are typical administrative tasks we won't actually cover here, and we don't have software to install. Instead, we'll walk through the steps and show you how you <em>could</em> install custom or third-party software using Remote Desktop. Let's start by getting the connection information.</p>
<h3 id="connect-to-the-vm-with-remote-desktop-protocol"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#connect-to-the-vm-with-remote-desktop-protocol">Connect to the VM with Remote Desktop Protocol</a></h3>
<p>To connect to an Azure VM with an RDP client, you'll need:</p>
<ul>
<li>Public IP address of the VM (or private if the VM is configured to connect to your network)</li>
<li>Port number</li>
</ul>
<p>You can enter this information into the RDP client, or download a pre-configured <strong>RDP</strong> file.</p>
<p>Note</p>
<p>An <strong>RDP</strong> file is a text file that contains a set of name/value pairs that define the connection parameters for an RDP client to connect to a remote computer using the Remote Desktop Protocol.</p>
<h4 id="download-the-rdp-file"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#download-the-rdp-file">Download the RDP file</a></h4>
<ol>
<li>
<p>In the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a>, ensure the <strong>Overview</strong> pane for the virtual machine that you created earlier is open. You can also find the VM on the Azure <strong>Home</strong> page under <strong>All Resources</strong> if you need to open it. The <strong>Overview</strong> pane has a lot of information about the VM. You can:</p>
<ul>
<li>Determine whether the VM is running</li>
<li>Stop or restart it</li>
<li>Get the public IP address to connect to the VM</li>
<li>Get the activity of the CPU, disk, and network</li>
<li>In the top menu bar, select <strong>Connect</strong>, then select <strong>Connect</strong> in the drop-down.</li>
</ul>
</li>
<li>
<p>Note the <strong>IP address</strong> and <strong>Port number</strong> settings, then select <strong>Download RDP File</strong> and save it to your computer.</p>
</li>
<li>
<p>Before we connect, let's adjust a few settings. On Windows, find the file using Explorer, right-click it, and select <strong>Edit</strong> (you might need to select <strong>Show more options</strong> to find the <strong>Edit</strong> option). On macOS, you'll need to open the file first with the RDP client, then right-click on the item in the displayed list and select <strong>Edit</strong>.</p>
</li>
<li>
<p>You can adjust a variety of settings to control the experience in connecting to the Azure VM. The settings you'll want to examine are:</p>
<ul>
<li><strong>Display</strong>: By default, it'll be full screen. You can change this to a lower resolution, or use all your monitors if you have more than one.</li>
<li><strong>Local Resources</strong>: You can share local drives with the VM, allowing you to copy files from your PC to the VM. Select the <strong>More</strong> button under <strong>Local devices and resources</strong> to select what is shared.</li>
<li><strong>Experience</strong>: Adjust the visual experience based on your network quality.</li>
<li>Share your Local C: drive so it will be visible to the VM.</li>
</ul>
</li>
<li>
<p>Switch back to the <strong>General</strong> tab and select <strong>Save</strong> to save the changes. You can always come back and edit this file later to try other settings.</p>
</li>
</ol>
<h4 id="connect-to-the-windows-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#connect-to-the-windows-vm">Connect to the Windows VM</a></h4>
<ol>
<li>
<p>Select <strong>Connect</strong>.</p>
</li>
<li>
<p>On the <strong>Remote Desktop Connection</strong> dialog box, note the security warning and the remote computer IP address, then select <strong>Connect</strong> to start the connection to the VM.</p>
</li>
<li>
<p>In the <strong>Windows Security</strong> dialog box, enter your username and password that you created in the previous exercise.</p>
<p>Note</p>
<p>If you're using a Windows client to connect to the VM, it will default to known identities on your machine. Select the <strong>More choices</strong> option, and then select <strong>Use a different account</strong> that lets you enter a different username/password combination.</p>
</li>
<li>
<p>In the second <strong>Remote Desktop Connection</strong> dialog box, note the certificate errors, then select <strong>Yes</strong>.</p>
</li>
</ol>
<h4 id="install-worker-roles"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#install-worker-roles">Install worker roles</a></h4>
<p>The first time you connect to a Windows server VM, it launches Server Manager. This allows you to assign a worker role for common web or data tasks. You can also launch the Server Manager through the <strong>Start</strong> menu.</p>
<p>This is where we'd add the Web Server role to the server. This installs IIS, and as part of the configuration, you'd turn off HTTP requests and enable the FTP server. We could also ignore IIS and install a third-party FTP server. We'd then configure the FTP server to allow access to a folder on our big data drive we added to the VM.</p>
<p>Because we aren't going to actually configure that here, just close Server Manager.</p>
<h3 id="install-custom-software"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#install-custom-software">Install custom software</a></h3>
<p>We have two approaches we can use to install software. First, this VM is connected to the internet. If the software you need has a downloadable installer, you can open a web browser in the RDP session, download the software, and install it. Second, if your software is custom, like our custom service, you can copy it from your local machine over to the VM to install it. Let's look at this latter approach.</p>
<ol>
<li>
<p>Open File Explorer. In the sidebar, select <strong>This PC</strong>. You should see several drives:</p>
<ul>
<li>Windows (C:) drive representing the OS</li>
<li>Temporary Storage (D:) drive</li>
<li>Your local C: drive (it will have a different name than the following screenshot)</li>
</ul>
<p><img alt="Screenshot showing the local drive shared with the Azure VM." src="https://learn.microsoft.com/en-us/training/modules/create-windows-virtual-machine-in-azure/media/6-drive-list.png" /></p>
</li>
</ol>
<p>With access to your local drive, you can copy the files for the custom software onto the VM and install the software. We won't actually do that because it's just a simulated scenario, but you can imagine how it would work.</p>
<p>The more interesting thing to observe in the list of drives is what is <em>missing</em>. Notice that our <strong>Data</strong> drive is not present. Azure added a VHD, but didn't initialize it.</p>
<h3 id="initialize-data-disks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#initialize-data-disks">Initialize data disks</a></h3>
<p>Any additional drives you create from scratch will need to be initialized and formatted. The process for doing this is identical to a physical drive.</p>
<ol>
<li>
<p>Launch the Disk Management tool from the <strong>Start</strong> menu. You might have to go to the <strong>Computer Management</strong> tool first, then <strong>Disk Management</strong>, or try searching for <em>Disk Management</em> in the <strong>Start</strong> Menu.</p>
</li>
<li>
<p>The Disk Management tool will display a warning that it has detected an uninitialized disk.</p>
<p><img alt="Screenshot showing the Disk Management tool warning about an uninitialized data disk in the VM." src="https://learn.microsoft.com/en-us/training/modules/create-windows-virtual-machine-in-azure/media/6-disk-management.png" /></p>
</li>
<li>
<p>Select <strong>OK</strong> to initialize the disk. It'll then appear in the list of volumes, where you can format it and assign a drive letter.</p>
</li>
<li>
<p>Open File Explorer, and you should now have your data drive.</p>
</li>
<li>
<p>Go ahead and close the RDP client to disconnect from the VM. The server will continue to run.</p>
</li>
</ol>
<p>RDP allows you to work with the Azure VM just like a local computer. With Desktop UI access, you can administer this VM as you would any Windows computer; installing software, configuring roles, adjusting features and other common tasks. However, it's a manual process. If you always need to install some software, you might consider automating the process using scripting.</p>
<h2 id="configure-azure-virtual-machine-network-settings"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#configure-azure-virtual-machine-network-settings">Configure Azure virtual machine network settings</a></h2>
<p>We've installed our custom software, set up an FTP server, and configured the VM to receive our video files. However, if we try to connect to our public IP address with FTP, we'll find that it's blocked.</p>
<p>Making adjustments to server configuration is commonly performed with equipment in your on-premises environment. In this sense, you can consider Azure VMs to be an extension of that environment. You can make configuration changes, manage networks, open or block traffic, and more through the Azure portal, Azure CLI, or Azure PowerShell tools.</p>
<p>You've already seen some of the basic information and management options in the <strong>Overview</strong> panel for the virtual machine. Let's explore network configuration a bit more.</p>
<h3 id="open-ports-in-azure-vms"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#open-ports-in-azure-vms">Open ports in Azure VMs</a></h3>
<p>By default, new VMs are locked down.</p>
<p>Apps can make outgoing requests, but the only inbound traffic allowed is from the virtual network (for example, other resources on the same local network), and from Azure's Load Balancer (probe checks).</p>
<p>There are two steps to adjusting the configuration to support FTP. When you create a new VM, you have an opportunity to open a few common ports (RDP, HTTP, HTTPS, and SSH). However, if you require other changes to the firewall, you will need to make them yourself.</p>
<p>The process for this involves two steps:</p>
<ol>
<li>Create a Network Security Group.</li>
<li>Create an inbound rule allowing traffic on port 20 and 21 for active FTP support.</li>
</ol>
<h4 id="what-is-a-network-security-group"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#what-is-a-network-security-group">What is a Network Security Group?</a></h4>
<p>Virtual networks (VNets) are the foundation of the Azure networking model, and provide isolation and protection. Network Security Groups (NSGs) are the main tool you use to enforce and control network traffic rules at the networking level. NSGs are an optional security layer that provides a software firewall by filtering inbound and outbound traffic on the VNet.</p>
<p>Security groups can be associated to a network interface (for per-host rules), a subnet in the virtual network (to apply to multiple resources), or both levels.</p>
<h5 id="security-group-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#security-group-rules">Security group rules</a></h5>
<p>NSGs use <em>rules</em> to allow or deny traffic moving through the network. Each rule identifies the source and destination address (or range), protocol, port (or range), direction (inbound or outbound), a numeric priority, and whether to allow or deny the traffic that matches the rule. The following illustration shows NSG rules applied at the subnet and network-interface levels.</p>
<p><img alt="Illustration showing the architecture of network security groups in two different subnets. In one subnet, there are two virtual machines, each with their own network interface rules. The subnet itself has a set of rules that applies to both the virtual machines." src="https://learn.microsoft.com/en-us/training/modules/create-windows-virtual-machine-in-azure/media/7-nsg-rules.png" /></p>
<p>Each security group has a set of default security rules to apply the default network rules described in the preceding passage. You can't modify these default rules, but you <em>can</em> override them.</p>
<h5 id="how-azure-uses-network-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#how-azure-uses-network-rules">How Azure uses network rules</a></h5>
<p>For inbound traffic, Azure processes the security group associated to the subnet, then the security group applied to the network interface. Outbound traffic is processed in the opposite order (the network interface first, followed by the subnet).</p>
<p>Warning</p>
<p>Keep in mind that security groups are optional at both levels. If no security group is applied, then <strong>all traffic is allowed</strong> by Azure. If the VM has a public IP, this could be a serious risk, particularly if the OS doesn't provide some sort of firewall.</p>
<p>The rules are evaluated in <em>priority order</em>, starting with the <strong>lowest priority</strong> rule. Deny rules always <strong>stop</strong> the evaluation. For example, if an outbound request is blocked by a network interface rule, any rules applied to the subnet will not be checked. In order for traffic to be allowed through the security group, it must pass through <em>all</em> applied groups.</p>
<p>The last rule is always a <strong>Deny All</strong> rule. This is a default rule added to every security group for both inbound and outbound traffic with a priority of 65500. That means to have traffic pass through the security group, <em>you must have an allow rule</em> or the default final rule will block it. <a href="https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview#security-rules">Learn more about security rules</a>.</p>
<p>Note</p>
<p>SMTP (port 25) is a special case. Depending on your subscription level and when your account was created, outbound SMTP traffic might be blocked. You can make a request to remove this restriction with business justification.</p>
<hr />
<h2 id="host-a-web-application-with-azure-app-service"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#host-a-web-application-with-azure-app-service">Host a web application with Azure App Service</a></h2>
<h2 id="introduction_6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#introduction_6">Introduction</a></h2>
<p>Imagine you're building a website for a new business, or you're running an existing web app on an aging on-premises server. Setting up a new server can be challenging. You need the appropriate hardware, likely a server-level operating system, and a web-hosting stack.</p>
<p>Once it's running, you need to maintain the server. And what happens if your website traffic increases? You might need to invest in more hardware.</p>
<p>Hosting your web application using Azure App Service makes deploying and managing a web app easier when compared to managing a physical server. In this module, we implement and deploy a web app to App Service.</p>
<h3 id="learning-objectives_7"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#learning-objectives_7">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Use the Azure portal to create an Azure App Service web app.</li>
<li>Use developer tools to create the code for a starter web application.</li>
<li>Deploy your code to App Service.</li>
</ul>
<h3 id="prerequisites_7"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#prerequisites_7">Prerequisites</a></h3>
<ul>
<li>Ability to navigate the Azure portal</li>
<li>Ability to use a command-line interface</li>
</ul>
<h2 id="create-a-web-app-in-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-a-web-app-in-the-azure-portal">Create a web app in the Azure portal</a></h2>
<p>In this unit, you learn how to create an Azure App Service web app using the Azure portal.</p>
<h3 id="why-use-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#why-use-the-azure-portal">Why use the Azure portal?</a></h3>
<p>The first step in hosting your web application is to create a web app (an Azure App Service app) inside your Azure subscription.</p>
<p>There are several ways you can create a web app. You can use the Azure portal, the Azure Command Line Interface (CLI), a script, or an integrated development environment (IDE) like Visual Studio.</p>
<p>The information in this unit discusses how to use the Azure portal to create a web app, and you use this information to create a web app in the next exercise. For this module, we demonstrate using the Azure portal because it's a graphical experience, which makes it a great learning tool. The portal helps you discover available features, add other resources, and customize existing resources.</p>
<h3 id="what-is-azure-app-service"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#what-is-azure-app-service">What is Azure App Service?</a></h3>
<p>Azure App Service is a fully managed web application hosting platform. This platform as a service (PaaS) offered by Azure allows you to focus on designing and building your app while Azure takes care of the infrastructure to run and scale your applications.</p>
<h4 id="deployment-slots"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#deployment-slots">Deployment slots</a></h4>
<p>Using the Azure portal, you can easily add <strong>deployment slots</strong> to an App Service web app. For instance, you can create a <strong>staging</strong> deployment slot where you can push your code to test on Azure. Once you're happy with your code, you can easily <strong>swap</strong> the staging deployment slot with the production slot. All it takes is a few mouse clicks in the Azure portal.</p>
<p><img alt="Screenshot of the staging deployment slot to test the deployments." src="https://learn.microsoft.com/en-us/training/modules/host-a-web-app-with-azure-app-service/media/2-deployment-slots.png" /></p>
<h4 id="continuous-integrationdeployment-support"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#continuous-integrationdeployment-support">Continuous integration/deployment support</a></h4>
<p>The Azure portal provides out-of-the-box continuous integration and deployment with Azure Repos, GitHub, Bitbucket, FTP, or a local Git repository on your development machine. You can connect your web app with any of the preceding sources, and App Service does the rest for you. It automatically syncs your code and any future changes on the code into the web app. Furthermore, with Azure Repos, you can define your own build and release process. A full process that compiles your source code, runs the tests, builds a release, and finally deploys the release into your web app every time you commit the code. All that happens implicitly, without any need for you to intervene.</p>
<p><img alt="Screenshot of setting up deployment options and choosing source for the deployment source code." src="https://learn.microsoft.com/en-us/training/modules/host-a-web-app-with-azure-app-service/media/2-continuous-integration.png" /></p>
<h4 id="integrated-visual-studio-publishing-and-ftp-publishing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#integrated-visual-studio-publishing-and-ftp-publishing">Integrated Visual Studio publishing and FTP publishing</a></h4>
<p>In addition to being able to set up continuous integration/deployment for your web app, you can always benefit from the tight integration with Visual Studio to publish your web app to Azure via Web Deploy technology. App Service also supports FTP-based publishing for more traditional workflows.</p>
<h4 id="built-in-autoscale-support-automatic-scale-out-based-on-real-world-load"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#built-in-autoscale-support-automatic-scale-out-based-on-real-world-load">Built-in autoscale support (automatic scale-out based on real-world load)</a></h4>
<p>The ability to scale up/down or scale out is baked into the web app. Depending on the web app's usage, you can scale your app up/down by increasing/decreasing the resources of the underlying machine that's hosting your web app. Resources can be the number of cores or the amount of RAM available. On the other hand, you can scale out your app by increasing the number of machine instances that are running your web app.</p>
<h3 id="creating-a-web-app"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#creating-a-web-app">Creating a web app</a></h3>
<p>When you're ready to run a web app on Azure, you can visit the Azure portal and create a <strong>Web App</strong> resource. Creating a web app allocates a set of hosting resources in App Service. You can use these resources to host any web-based application Azure supports, whether it's ASP.NET Core, Node.js, Java, Python, and so on.</p>
<p>The Azure portal provides a wizard to create a web app. This wizard requires the following fields:</p>
<table>
<thead>
<tr>
<th><em>Field</em></th>
<th><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Subscription</strong></td>
<td>A valid and active Azure subscription.</td>
</tr>
<tr>
<td><strong>Resource group</strong></td>
<td>A valid resource group.</td>
</tr>
<tr>
<td><strong>Name</strong></td>
<td>The name of the web app. This name becomes part of the app's URL, so it must be unique among all Azure App Service web apps.</td>
</tr>
<tr>
<td><strong>Publish</strong></td>
<td>You can deploy your application to App Service as <strong>code</strong> or as a ready-to-run Docker <strong>Container</strong>. Selecting <strong>Container</strong> activates the wizard's Container tab, where you provide information about the Docker registry from which App Service retrieves your image.</td>
</tr>
<tr>
<td><strong>Runtime stack</strong></td>
<td>If you choose to deploy your application as code, App Service needs to know what runtime your application uses (examples include Node.js, Python, Java, and .NET). If you deploy your application as a container, you don't need to choose a runtime stack, because your image includes it.</td>
</tr>
<tr>
<td><strong>Operating system</strong></td>
<td>App Service can host applications on <strong>Windows</strong> or <strong>Linux</strong> servers. For more information, see the <em>Operating systems</em> section in this unit.</td>
</tr>
<tr>
<td><strong>Region</strong></td>
<td>The Azure region from which your application is served.</td>
</tr>
<tr>
<td><strong>Pricing Plans</strong></td>
<td>See the <em>Pricing Plans</em> section in this unit for information about App Service plans.</td>
</tr>
</tbody>
</table>
<h4 id="operating-systems"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#operating-systems">Operating systems</a></h4>
<p>If you're deploying your app as code, many of the available runtime stacks are limited to one operating system or the other. After you choose a runtime stack, the toggle will indicate whether or not you have a choice of operating system. If your target runtime stack is available on both operating systems, select the one that you use to develop and test your application.</p>
<p>If your application is packaged as a container, specify the operating system in your container.</p>
<h4 id="app-service-plans"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#app-service-plans">App Service plans</a></h4>
<p>An <strong>App Service</strong> plan is a set of virtual server resources that run App Service apps. A plan's <strong>size</strong> (sometimes referred to as its <strong>sku</strong> or <strong>pricing tier</strong>) determines the performance characteristics of the virtual servers that run the apps assigned to the plan, and the App Service features to which those apps have access. Every App Service web app you create must be assigned to a single App Service plan that runs it.</p>
<p>A single App Service plan can host multiple App Service web apps. In most cases, the number of apps you can run on a single plan is limited by the apps' performance characteristics and the plan's resource limitations.</p>
<p>App Service plans determine the App Service's unit of billing. The size of each App Service plan in your subscription, in addition to the bandwidth resources the apps deployed to those plans use, determines the price you pay. The number of web apps deployed to your App Service plans has no effect on your bill.</p>
<p>You can use any of the available Azure management tools to create an App Service plan. When you create a web app via the Azure portal, the wizard helps you to create a new plan at the same time if you don't already have one.</p>
<h2 id="exercise-create-a-web-app-in-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-create-a-web-app-in-the-azure-portal">Exercise - Create a web app in the Azure portal</a></h2>
<p>Choose your development language</p>
<p>C#JavaNode.jsPython</p>
<p>In this unit, you use the Azure portal to create a web app.</p>
<h3 id="create-a-web-app"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-a-web-app">Create a web app</a></h3>
<p>Sign in to the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> using the same account you used to activate the sandbox.</p>
<ol>
<li>
<p>On the Azure portal menu or from the <strong>Home</strong> page, select <strong>Create a resource</strong>. Everything you create on Azure is a resource. The <strong>Create a resource</strong> pane appears.</p>
<p>Here, you can search for the resource you want to create, or select one of the popular resources that people create in the Azure portal.</p>
</li>
<li>
<p>In the <strong>Create a resource</strong> menu, select <strong>Web</strong>.</p>
</li>
<li>
<p>Select <strong>Web App</strong>. If you don't see it, in the search box, search for and select <strong>Web App</strong>. The <strong>Create Web App</strong> pane appears.</p>
</li>
<li>
<p>On the <strong>Basics</strong> tab, enter the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Project Details</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Subscription</td>
<td>Concierge Subscription</td>
<td>The web app you're creating must belong to a resource group. Here, you select the Azure subscription to which the resource group belongs (or is going to belong, if you're creating it within the wizard).</td>
</tr>
<tr>
<td>Resource Group</td>
<td>Select [Sandbox resource group]</td>
<td>The resource group to which the web app belongs. All Azure resources must belong to a resource group.</td>
</tr>
<tr>
<td><strong>Instance Details</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Name</td>
<td><em>Enter a unique name</em></td>
<td>The name of your web app. This name becomes part of the app's URL: <em>appname</em>.azurewebsites.net. The name you choose must be unique among all Azure web apps.</td>
</tr>
<tr>
<td>Publish</td>
<td>Code</td>
<td>The method you want to use to publish your application. When publishing an application as code, you must also configure <strong>Runtime stack</strong> to prepare App Service resources to run your app.</td>
</tr>
<tr>
<td>Runtime stack</td>
<td>.NET 8 (LTS)</td>
<td>The platform on which your application is going to run. Your choice might affect whether you have a choice of operating system - for some runtime stacks, App Service supports only one operating system.</td>
</tr>
<tr>
<td>Operating System</td>
<td>Linux</td>
<td>The operating system used on the virtual servers to run your app.</td>
</tr>
<tr>
<td>Region</td>
<td>Central US</td>
<td>The geographical region from which your app is hosted.</td>
</tr>
<tr>
<td><strong>Pricing plans</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Linux Plan</td>
<td>Accept default</td>
<td>The name of the App Service plan that powers your app. By default, the wizard creates a new plan in the same region as the web app.</td>
</tr>
<tr>
<td>Pricing plan</td>
<td>Free F1</td>
<td>The pricing tier of the service plan being created. The pricing plan determines the performance characteristics of the virtual servers that power your app and the features to which it has access. Select <strong>Free F1</strong> in the drop-down.</td>
</tr>
</tbody>
</table>
<p><img alt="Screenshot showing web app creation details." src="https://learn.microsoft.com/en-us/training/modules/host-a-web-app-with-azure-app-service/media/3-create-web-app-dotnet.png" /></p>
<ol>
<li>
<p>Leave any other settings as default. Select <strong>Review + Create</strong> to go to the review pane, and then select <strong>Create</strong>. The portal shows the deployment pane, where you can view the status of your deployment.</p>
<p>Note</p>
<p>It can take a moment for deployment to complete.</p>
</li>
</ol>
<h3 id="preview-your-web-app"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#preview-your-web-app">Preview your web app</a></h3>
<ol>
<li>
<p>When deployment is complete, select <strong>Go to resource</strong>. The portal shows the App Service Overview pane for your web app.</p>
<p><img alt="Screenshot showing the App Service pane with the URL link of the overview section highlighted." src="https://learn.microsoft.com/en-us/training/modules/host-a-web-app-with-azure-app-service/media/3-web-app-home.png" /></p>
</li>
<li>
<p>To preview your web app's default content, select the URL under <strong>Default domain</strong> at the top right. The placeholder page that loads indicates that your web app is up and running and is ready to receive deployment of your app's code.</p>
</li>
</ol>
<p><img alt="Screenshot showing your App Service in a browser." src="https://learn.microsoft.com/en-us/training/modules/host-a-web-app-with-azure-app-service/media/3-web-app-online-dotnet.png" /></p>
<p>Leave the browser tab with the new app's placeholder page open. You'll come back to it after your app is deployed.</p>
<h2 id="prepare-the-web-application-code"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#prepare-the-web-application-code">Prepare the web application code</a></h2>
<p>Choose your development language</p>
<p>C#JavaNode.jsPython</p>
<p>In this unit, you learn how to create the code for your web application and integrate it into a source-control repository.</p>
<h3 id="bootstrap-a-web-application"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#bootstrap-a-web-application">Bootstrap a web application</a></h3>
<p>Now that you created the resources for deploying your web application, you have to prepare the code you want to deploy. There are many ways to bootstrap a new web application, so what we learn here might be different to what you're used to. The goal is to quickly provide you a starting point to complete a full cycle up to the deployment.</p>
<p>Note</p>
<p>All the code and commands shown on this page are only for explanation purposes; <strong>you do not need to execute any of them</strong>. We use them in a subsequent exercise.</p>
<p>The <code>dotnet</code> command-line tool that's part of the .NET SDK allows you to directly create the code for a new web application. In particular, you can use the <code>dotnet new</code> command to generate a new application from a template:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>dotnet new mvc --name &lt;YourAppName&gt;
</code></pre></div>
<p>This command creates a new ASP.NET Core Model-View Cotroller (MVC) application in a new folder with the specified name.</p>
<h3 id="adding-your-code-to-source-control"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#adding-your-code-to-source-control">Adding your code to source control</a></h3>
<p>After your web application code is ready, the next step is usually to put the code into a source-control repository such as Git. If you have Git installed on your machine, running these commands in your source-code folder initializes the repository.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>git init
git add .
git commit -m &quot;Initial commit&quot;
</code></pre></div>
<p>These commands allow you to initialize a local Git repository and create a first commit with your code. You immediately gain the benefit of keeping a history of your changes with commits. Later on, you're able to synchronize your local repository with a remote repository; for example, hosted on GitHub. This synchronization allows you to set up continuous integration and continuous deployment (CI/CD). While we recommend using a source-control repository for production applications, it's not a requirement to be able to deploy an application to Azure App Service.</p>
<p>Note</p>
<p>Using CI/CD enables more frequent code deployment in a reliable manner by automating builds, tests, and deployments for every code change. It enables delivering new features and bug fixes for your application faster and more effectively.</p>
<h2 id="exercise-write-code-to-implement-a-web-application"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-write-code-to-implement-a-web-application">Exercise - Write code to implement a web application</a></h2>
<p>Choose your development language</p>
<p>C#JavaNode.jsPython</p>
<p>In this unit, you use developer tools to create the code for a starter web application.</p>
<h3 id="create-a-new-web-project"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#create-a-new-web-project">Create a new web project</a></h3>
<p>The heart of the .NET CLI tools is the <code>dotnet</code> command-line tool. Using this command, you create a new ASP.NET Core web project.</p>
<p>Run the following command to create a new ASP.NET Core Model-View Cotroller (MVC) application named "BestBikeApp":</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>dotnet new mvc --name BestBikeApp
</code></pre></div>
<p>The command creates a new folder named "BestBikeApp" to hold your project.</p>
<h4 id="optionally-test-your-web-app"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#optionally-test-your-web-app">Optionally test your web app</a></h4>
<p>You can test your application locally on Azure. To do so, use the following steps:</p>
<ol>
<li>
<p>Run the following commands to build and run your web application in the background:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cd BestBikeApp
dotnet run &amp;
</code></pre></div>
<p>You should get output like the following example:</p>
<p>ConsoleCopy</p>
<div class="highlight"><pre><span></span><code>[1] &lt;process-number&gt;
&lt;username&gt; [ ~/BestBikeApp ]$ Building...
warn: Microsoft.AspNetCore.DataProtection.KeyManagement.XmlKeyManager[35]
      No XML encryptor configured. Key {b4a2970c-215c-4eb2-92b4-c28d021158c6} may be persisted to storage in unencrypted form.
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:&lt;port&gt;
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: /home/cephas_lin/BestBikeApp
</code></pre></div>
<p>In the output, take note of the values of <em><process-number/></em> and <em><port/></em>.</p>
</li>
<li>
<p>Run the following command to browse to your web application, replacing <em><port/></em> with the port you noted in the last step.</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>curl -kL http://localhost:&lt;port&gt;/
</code></pre></div>
<p>You should see some HTML appear, ending in the following lines:</p>
<p>HTMLCopy</p>
<div class="highlight"><pre><span></span><code>&lt;html&gt;
...
&lt;div class=&quot;text-center&quot;&gt;
    &lt;h1 class=&quot;display-4&quot;&gt;Welcome&lt;/h1&gt;
    &lt;p&gt;Learn about &lt;a href=&quot;https://learn.microsoft.com/aspnet/core&quot;&gt;building Web apps with ASP.NET Core&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;

        &lt;/main&gt;
    &lt;/div&gt;

    &lt;footer b-b5g3qljvtd class=&quot;border-top footer text-muted&quot;&gt;
        &lt;div b-b5g3qljvtd class=&quot;container&quot;&gt;
            &amp;copy; 2024 - BestBikeApp - &lt;a href=&quot;/Home/Privacy&quot;&gt;Privacy&lt;/a&gt;
        &lt;/div&gt;
    &lt;/footer&gt;
    &lt;script src=&quot;/lib/jquery/dist/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;/lib/bootstrap/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;/js/site.js?v=hRQyftXiu1lLX2P9Ly9xa4gHJgLeR1uGN5qegUobtGo&quot;&gt;&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre></div>
</li>
<li>
<p>Using <em><process-number/></em> that you noted earlier, stop dotnet:</p>
<p>Azure CLICopy</p>
<p>Open Cloud Shell</p>
<div class="highlight"><pre><span></span><code>kill &lt;process-number/&gt;
</code></pre></div>
</li>
</ol>
<h2 id="deploy-code-to-app-service"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#deploy-code-to-app-service">Deploy code to App Service</a></h2>
<p>Now, let's see how we can deploy our application to App Service.</p>
<h3 id="automated-deployment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#automated-deployment">Automated deployment</a></h3>
<p>Automated deployment, or continuous integration, is a process used to push out new features and bug fixes in a fast and repetitive pattern with minimal impact on end users.</p>
<p>Azure supports automated deployment directly from several sources. The following options are available:</p>
<ul>
<li><strong>Azure Repos</strong>: You can push your code to Azure Repos, build your code in the cloud, run the tests, generate a release from the code, and finally push your code to an Azure Web App.</li>
<li><strong>GitHub</strong>: Azure supports automated deployment directly from GitHub. When you connect your GitHub repository to Azure for automated deployment, any changes you push to your production branch on GitHub are automatically deployed for you.</li>
<li><strong>Bitbucket</strong>: Due to its similarities to GitHub, you can configure an automated deployment with Bitbucket.</li>
</ul>
<h3 id="manual-deployment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#manual-deployment">Manual deployment</a></h3>
<p>There are a few options that you can use to manually push your code to Azure:</p>
<ul>
<li><strong>Git</strong>: App Service web apps feature a Git URL that you can add as a remote repository. Pushing to the remote repository deploys your app.</li>
<li><em><strong>az webapp up</strong></em>: <code>webapp up</code> is a feature of the <code>az</code> command-line interface that packages your app and deploys it. Unlike other deployment methods, <code>az webapp up</code> can create a new App Service web app for you if one isn't created.</li>
<li><strong>Deploy application packages</strong>: You can use <code>az webapp deploy</code> to deploy a ZIP, WAR, EAR, or JAR to App Service. You can also deploy scripts and static files with the same method.</li>
<li><strong>Visual Studio</strong>: Visual Studio features an App Service deployment wizard that walks you through the deployment process.</li>
<li><strong>FTP/S</strong>: FTP or FTPS is a traditional way of pushing your code to many hosting environments, including App Service.</li>
</ul>
<h2 id="exercise-deploy-your-code-to-app-service"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#exercise-deploy-your-code-to-app-service">Exercise - Deploy your code to App Service</a></h2>
<p>Choose your development language</p>
<p>C#JavaNode.jsPython</p>
<p>In this unit, you deploy your web application to App Service.</p>
<h3 id="deploy-with-az-webapp-deploy"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#deploy-with-az-webapp-deploy">Deploy with <code>az webapp deploy</code></a></h3>
<p>Let's deploy the .NET application with ZIP deploy.</p>
<p>First, use <code>dotnet publish</code> to build the final app files and <code>zip</code> to package them into a zip file:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cd ~/BestBikeApp
dotnet publish -o pub
cd pub
zip -r site.zip *
</code></pre></div>
<p>Finally, perform the deployment with <code>az webapp deploy</code>. Replace <code>&lt;your-app-name&gt;</code> in the following command with the name of your Azure web app and run it:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>az webapp deploy \
    --src-path site.zip \
    --resource-group [sandbox resource group name] \
    --name &lt;your-app-name&gt;
</code></pre></div>
<p>The deployment takes a few minutes, during which time you get status output. When the command finishes running, you see an output message like this:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Deployment has completed successfully
You can visit your app at: http://&lt;app-name&gt;-&lt;hash&gt;.&lt;region&gt;.azurewebsites.net
</code></pre></div>
<h3 id="verify-the-deployment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Deploy%20and%20manage%20azure%20compute%20resources/#verify-the-deployment">Verify the deployment</a></h3>
<p>In a new tab, navigate to the URL shown in the output. You get the splash page for a new ASP.NET Core web app.</p>
<p><img alt="Screenshot of welcome page." src="https://learn.microsoft.com/en-us/training/modules/host-a-web-app-with-azure-app-service/media/7-web-app-in-browser.png" /></p>
<p>Congratulations, you successfully hosted your new ASP.NET Core application, on App Service!</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-11-14 00:00:00">November 14, 2024</time></li>
        
        
          
          <li class="md-meta__item">
            
              89 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="configure-storage-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/">Configure storage accounts</a></h2>
<h2 id="introduction"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#introduction">Introduction</a></h2>
<p>Azure Storage is Microsoft's cloud storage solution for modern data storage scenarios.</p>
<p>Suppose you work for a large e-commerce company that needs to store and serve a vast number of product images to its customers. The company wants a scalable and reliable solution that can handle high traffic and ensure data durability. They want to quickly restore data if there's an outage.</p>
<p>In this module, you learn how to configure storage accounts and select appropriate storage types in Azure. The module covers topics such as implementing replication strategies, and configuring secure access to storage.</p>
<p>The goal of this module is to provide Azure Administrators with the knowledge and skills to effectively configure and manage Azure storage accounts.</p>
<h3 id="learning-objectives"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#learning-objectives">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify features and usage cases for Azure storage accounts.</li>
<li>Select between different types of Azure Storage and create storage accounts.</li>
<li>Select a storage replication strategy.</li>
<li>Configure secure network access to storage endpoints.</li>
</ul>
<h3 id="skills-measured"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#skills-measured">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#prerequisites">Prerequisites</a></h3>
<ul>
<li>Experience with the Azure portal.</li>
<li>Familiarity with managing different types of data storage.</li>
</ul>
<h2 id="implement-azure-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#implement-azure-storage">Implement Azure Storage</a></h2>
<p>Azure Storage is Microsoft's cloud storage solution for modern data storage scenarios. Azure Storage offers a massively scalable object store for data objects. It provides a file system service for the cloud, a messaging store for reliable messaging, and a NoSQL store.</p>
<p>Azure Storage is a service that you can use to store files, messages, tables, and other types of information. You use Azure Storage for applications like file shares. Developers use Azure Storage for working data. Working data includes websites, mobile apps, and desktop applications. Azure Storage is also used by IaaS virtual machines, and PaaS cloud services.</p>
<h4 id="things-to-know-about-azure-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-azure-storage">Things to know about Azure Storage</a></h4>
<p>You can think of Azure Storage as supporting three categories of data: structured data, unstructured data, and virtual machine data. Review the following categories and think about which types of storage are used in your organization.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Description</th>
<th>Storage examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Virtual machine data</strong></td>
<td>Virtual machine data storage includes disks and files. Disks are persistent block storage for Azure IaaS virtual machines. Files are fully managed file shares in the cloud.</td>
<td>Storage for virtual machine data is provided through Azure managed disks. Data disks are used by virtual machines to store data like database files, website static content, or custom application code. The number of data disks you can add depends on the virtual machine size. Each data disk has a maximum capacity of 32,767 GB.</td>
</tr>
<tr>
<td><strong>Unstructured data</strong></td>
<td>Unstructured data is the least organized. Unstructured data may not have a clear relationship. The format of unstructured data is referred to as <em>nonrelational</em>.</td>
<td>Unstructured data can be stored by using Azure Blob Storage and Azure Data Lake Storage. Blob Storage is a highly scalable, REST-based cloud object store. Azure Data Lake Storage is the Hadoop Distributed File System (HDFS) as a service.</td>
</tr>
<tr>
<td><strong>Structured data</strong></td>
<td>Structured data is stored in a relational format that has a shared schema. Structured data is often contained in a database table with rows, columns, and keys. Tables are an autoscaling NoSQL store.</td>
<td>Structured data can be stored by using Azure Table Storage, Azure Cosmos DB, and Azure SQL Database. Azure Cosmos DB is a globally distributed database service. Azure SQL Database is a fully managed database-as-a-service built on SQL.</td>
</tr>
</tbody>
</table>
<h4 id="how-to-create-a-storage-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#how-to-create-a-storage-account">How to create a storage account</a></h4>
<h5 id="storage-account-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#storage-account-types">Storage account types</a></h5>
<p>General purpose Azure storage accounts have two types: Standard and Premium.</p>
<ul>
<li>
<p><strong>Standard</strong> storage accounts are backed by magnetic hard disk drives (HDD). A standard storage account provides the lowest cost per GB. You can use Standard storage for applications that require bulk storage or where data is infrequently accessed.</p>
</li>
<li>
<p><strong>Premium</strong> storage accounts are backed by solid-state drives (SSD) and offer consistent low-latency performance. You can use Premium storage for Azure virtual machine disks with I/O-intensive applications like databases.</p>
</li>
</ul>
<p>Note</p>
<p>You can't convert a Standard storage account to a Premium storage account or vice versa. You must create a new storage account with the desired type and copy data, if applicable, to a new storage account.</p>
<h4 id="things-to-consider-when-using-azure-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-using-azure-storage">Things to consider when using Azure Storage</a></h4>
<p>As you think about your configuration plan for Azure Storage, consider these prominent features.</p>
<ul>
<li>
<p><strong>Consider durability and availability</strong>. Azure Storage is durable and highly available. Redundancy ensures your data is safe during transient hardware failures. You replicate data across datacenters or geographical regions for protection from local catastrophe or natural disaster. Replicated data remains highly available during an unexpected outage.</p>
</li>
<li>
<p><strong>Consider secure access</strong>. Azure Storage encrypts all data. Azure Storage provides you with fine-grained control over who has access to your data.</p>
</li>
<li>
<p><strong>Consider scalability</strong>. Azure Storage is designed to be massively scalable to meet the data storage and performance needs of modern applications.</p>
</li>
<li>
<p><strong>Consider manageability</strong>. Microsoft Azure handles hardware maintenance, updates, and critical issues for you.</p>
</li>
<li>
<p><strong>Consider data accessibility</strong>. Data in Azure Storage is accessible from anywhere in the world over HTTP or HTTPS. Microsoft provides SDKs for Azure Storage in various languages. You can use .NET, Java, Node.js, Python, PHP, Ruby, Go, and the REST API. Azure Storage supports scripting in Azure PowerShell or the Azure CLI. The Azure portal and Azure Storage Explorer offer easy visual solutions for working with your data.</p>
</li>
</ul>
<h2 id="explore-azure-storage-services"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#explore-azure-storage-services">Explore Azure Storage services</a></h2>
<p>Azure Storage offers four data services that can be accessed by using an Azure storage account:</p>
<ul>
<li>
<p><strong>Azure Blob Storage (containers)</strong>: A massively scalable object store for text and binary data.</p>
</li>
<li>
<p><strong>Azure Files</strong>: Managed file shares for cloud or on-premises deployments.</p>
</li>
<li>
<p><strong>Azure Queue Storage</strong>: A messaging store for reliable messaging between application components.</p>
</li>
<li>
<p><strong>Azure Table Storage</strong>: A service that stores nonrelational structured data (also known as structured NoSQL data).</p>
</li>
</ul>
<p>Let's examine the details of these services.</p>
<h4 id="azure-blob-storage-containers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#azure-blob-storage-containers">Azure Blob Storage (containers)</a></h4>
<p>Azure Blob Storage is Microsoft's object storage solution for the cloud. Blob Storage is optimized for storing massive amounts of unstructured or <em>nonrelational</em> data, such as text or binary data. Blob Storage is ideal for:</p>
<ul>
<li>Serving images or documents directly to a browser.</li>
<li>Storing files for distributed access.</li>
<li>Streaming video and audio.</li>
<li>Storing data for backup and restore, disaster recovery, and archiving.</li>
<li>Storing data for analysis by an on-premises or Azure-hosted service.</li>
</ul>
<p>Objects in Blob Storage can be accessed from anywhere in the world via HTTP or HTTPS. Users or client applications can access blobs via URLs, the Azure Storage REST API, Azure PowerShell, the Azure CLI, or an Azure Storage client library. The storage client libraries are available for multiple languages, including .NET, Java, Node.js, Python, PHP, and Ruby.</p>
<p>Note</p>
<p>You can access data from Azure Blob Storage <a href="https://learn.microsoft.com/en-us/training/modules/access-data-azure-blob-storage-multiple-protocols/4-access-data-azure-blob-storage-nfs-protocol">by using the NFS protocol</a>.</p>
<h4 id="azure-files"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#azure-files">Azure Files</a></h4>
<p>Azure Files enables you to set up highly available network file shares. Shares can be accessed by using the Server Message Block (SMB) protocol and the Network File System (NFS) protocol. Multiple virtual machines can share the same files with both read and write access. You can also read the files by using the REST interface or the storage client libraries.</p>
<p>File shares can be used for many common scenarios:</p>
<ul>
<li>Many on-premises applications use file shares. This feature makes it easier to migrate those applications that share data to Azure. If you mount the file share to the same drive letter that the on-premises application uses, the part of your application that accesses the file share should work with minimal, if any, changes.</li>
<li>Configuration files can be stored on a file share and accessed from multiple virtual machines. Tools and utilities used by multiple developers in a group can be stored on a file share, ensuring that everybody can find them, and that they use the same version.</li>
<li>Diagnostic logs, metrics, and crash dumps are just three examples of data that can be written to a file share and processed or analyzed later.</li>
</ul>
<p>The storage account credentials are used to provide authentication for access to the file share. All users who have the share mounted should have full read/write access to the share.</p>
<h4 id="azure-queue-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#azure-queue-storage">Azure Queue Storage</a></h4>
<p>Azure Queue Storage is used to store and retrieve messages. Queue messages can be up to 64 KB in size, and a queue can contain millions of messages. Queues are used to store lists of messages to be processed asynchronously.</p>
<p>Consider a scenario where you want your customers to be able to upload pictures, and you want to create thumbnails for each picture. You could have your customer wait for you to create the thumbnails while uploading the pictures. An alternative is to use a queue. When the customer finishes the upload, you can write a message to the queue. Then you can use an Azure Function to retrieve the message from the queue and create the thumbnails. Each of the processing parts can be scaled separately, which gives you more control when tuning the configuration.</p>
<h4 id="azure-table-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#azure-table-storage">Azure Table Storage</a></h4>
<p>Azure Table storage is a service that stores non-relational structured data (also known as structured NoSQL data) in the cloud, providing a key/attribute store with a schemaless design. Because Table storage is schemaless, it's easy to adapt your data as the needs of your application evolve. Access to Table storage data is fast and cost-effective for many types of applications, and is typically lower in cost than traditional SQL for similar volumes of data. In addition to the existing Azure Table Storage service, there's a new Azure Cosmos DB Table API offering that provides throughput-optimized tables, global distribution, and automatic secondary indexes.</p>
<h4 id="things-to-consider-when-choosing-azure-storage-services"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-choosing-azure-storage-services">Things to consider when choosing Azure Storage services</a></h4>
<p>As you think about your configuration plan for Azure Storage, consider the prominent features of the types of Azure Storage and which options support your application needs.</p>
<ul>
<li>
<p><strong>Consider storage optimization for massive data</strong>. Azure Blob Storage is optimized for storing massive amounts of unstructured data. Objects in Blob Storage can be accessed from anywhere in the world via HTTP or HTTPS. Blob Storage is ideal for serving data directly to a browser, streaming data, and storing data for backup and restore.</p>
</li>
<li>
<p><strong>Consider storage with high availability</strong>. Azure Files supports highly available network file shares. On-premises apps use file shares for easy migration. By using Azure Files, all users can access shared data and tools. Storage account credentials provide file share authentication to ensure all users who have the file share mounted have the correct read/write access.</p>
</li>
<li>
<p><strong>Consider storage for messages</strong>. Use Azure Queue Storage to store large numbers of messages. Queue Storage is commonly used to create a backlog of work to process asynchronously.</p>
</li>
<li>
<p><strong>Consider storage for structured data</strong>. Azure Table Storage is ideal for storing structured, nonrelational data. It provides throughput-optimized tables, global distribution, and automatic secondary indexes. Because Azure Table Storage is part of Azure Cosmos DB, you have access to a fully managed NoSQL database service for modern app development.</p>
</li>
</ul>
<h2 id="determine-storage-account-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#determine-storage-account-types">Determine storage account types</a></h2>
<p>Azure Storage offers several storage account options. Each <a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-account-overview">storage account</a> supports different features and has its own pricing model.</p>
<h4 id="things-to-know-about-storage-account-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-storage-account-types">Things to know about storage account types</a></h4>
<p>Review the following options and think about what storage accounts are required to support your applications.</p>
<table>
<thead>
<tr>
<th>Storage account</th>
<th>Supported services</th>
<th>Recommended usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-account-upgrade"><strong>Standard</strong> <strong>general-purpose v2</strong></a></td>
<td>Blob Storage (including Data Lake Storage), Queue Storage, Table Storage, and Azure Files</td>
<td>Standard storage account for most scenarios, including blobs, file shares, queues, tables, and disks (page blobs).</td>
</tr>
<tr>
<td><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-block-blob-premium"><strong>Premium</strong> <strong>block blobs</strong></a></td>
<td>Blob Storage (including Data Lake Storage)</td>
<td>Premium storage account for block blobs and append blobs. Recommended for applications with high transaction rates. Use Premium block blobs if you work with smaller objects or require consistently low storage latency. This storage is designed to scale with your applications.</td>
</tr>
<tr>
<td><a href="https://learn.microsoft.com/en-us/azure/storage/files/storage-how-to-create-file-share"><strong>Premium</strong> <strong>file shares</strong></a></td>
<td>Azure Files</td>
<td>Premium storage account for file shares only. Recommended for enterprise or high-performance scale applications. Use Premium file shares if you require support for both Server Message Block (SMB) and NFS file shares.</td>
</tr>
<tr>
<td><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-pageblob-overview"><strong>Premium</strong> <strong>page blobs</strong></a></td>
<td>Page blobs only</td>
<td>Premium high-performance storage account for page blobs only. Page blobs are ideal for storing index-based and sparse data structures, such as operating systems, data disks for virtual machines, and databases.</td>
</tr>
</tbody>
</table>
<p>Note</p>
<p>All storage account types are encrypted by using Storage Service Encryption (SSE) for data at rest.</p>
<h4 id="how-to-manage-your-storage-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#how-to-manage-your-storage-account">How to manage your storage account</a></h4>
<p>Learn more about <a href="https://www.youtube.com/embed/-j_8clCWYn8">how to manage your storage account</a>.</p>
<h2 id="determine-replication-strategies"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#determine-replication-strategies">Determine replication strategies</a></h2>
<p>The data in your Azure storage account is always replicated to ensure durability and high availability. Azure Storage replication copies your data to protect from planned and unplanned events. These events range from transient hardware failures, network or power outages, massive natural disasters, and so on. You can choose to replicate your data within the same data center, across zonal data centers within the same region, and even across regions. Replication ensures your storage account meets the Service-Level Agreement (SLA) for Azure Storage even if there are failures.</p>
<p>We explore four replication strategies:</p>
<ul>
<li>Locally redundant storage (LRS)</li>
<li>Zone redundant storage (ZRS)</li>
<li>Geo-redundant storage (GRS)</li>
<li>Geo-zone-redundant storage (GZRS)</li>
</ul>
<h4 id="locally-redundant-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#locally-redundant-storage">Locally redundant storage</a></h4>
<p>Locally redundant storage is the lowest-cost replication option and offers the least durability compared to other strategies. If a data center-level disaster occurs, such as fire or flooding, all replicas might be lost or unrecoverable. Despite its limitations, LRS can be appropriate in several scenarios:</p>
<ul>
<li>Your application stores data that can be easily reconstructed if data loss occurs.</li>
<li>Your data is constantly changing like in a live feed, and storing the data isn't essential.</li>
<li>Your application is restricted to replicating data only within a country/region due to data governance requirements.</li>
</ul>
<h4 id="zone-redundant-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#zone-redundant-storage">Zone redundant storage</a></h4>
<p>Zone redundant storage synchronously replicates your data across three storage clusters in a single region. Each storage cluster is physically separated from the others and resides in its own availability zone. Each availability zone, and the ZRS cluster within it, is autonomous, and has separate utilities and networking capabilities. Storing your data in a ZRS account ensures you can access and manage your data if a zone becomes unavailable. ZRS provides excellent performance and low latency.</p>
<ul>
<li>ZRS isn't currently available in all regions.</li>
<li>Changing to ZRS from another data replication option requires the physical data movement from a single storage stamp to multiple stamps within a region.</li>
</ul>
<h4 id="geo-redundant-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#geo-redundant-storage">Geo-redundant storage</a></h4>
<p>Geo-redundant storage replicates your data to a secondary region (hundreds of miles away from the primary location of the source data). GRS provides a higher level of durability even during a regional outage. GRS is designed to provide at least 99.99999999999999% <strong>(16 9's) durability</strong>. When your storage account has GRS enabled, your data is durable even when there's a complete regional outage or a disaster where the primary region isn't recoverable.</p>
<p>If you implement GRS, you have two related options to choose from:</p>
<ul>
<li>
<p><strong>GRS</strong> replicates your data to another data center in a secondary region. The data is available to be read only if Microsoft initiates a failover from the primary to secondary region.</p>
</li>
<li>
<p><strong>Read-access geo-redundant storage</strong> (RA-GRS) is based on GRS. RA-GRS replicates your data to another data center in a secondary region, and also provides you with the option to read from the secondary region. With RA-GRS, you can read from the secondary region regardless of whether Microsoft initiates a failover from the primary to the secondary.</p>
</li>
</ul>
<p>For a storage account with GRS or RA-GRS enabled, all data is first replicated with locally redundant storage. An update is first committed to the primary location and replicated by using LRS. The update is then replicated asynchronously to the secondary region by using GRS. Data in the secondary region uses LRS. Both the primary and secondary regions manage replicas across separate fault domains and upgrade domains within a storage scale unit. The storage scale unit is the basic replication unit within the datacenter. Replication at this level is provided by LRS.</p>
<h4 id="geo-zone-redundant-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#geo-zone-redundant-storage">Geo-zone redundant storage</a></h4>
<p>Geo-zone-redundant storage combines the high availability of zone-redundant storage with protection from regional outages as provided by geo-redundant storage. Data in a GZRS storage account is replicated across three Azure availability zones in the primary region, and also replicated to a secondary geographic region for protection from regional disasters. Each Azure region is paired with another region within the same geography, together making a regional pair.</p>
<p>With a GZRS storage account, you can continue to read and write data if an availability zone becomes unavailable or is unrecoverable. Additionally, your data is also durable during a complete regional outage or during a disaster in which the primary region isn't recoverable. GZRS is designed to provide at least 99.99999999999999% (16 9's) durability of objects over a given year. GZRS also offers the same scalability targets as LRS, ZRS, GRS, or RA-GRS. You can optionally enable read access to data in the secondary region with read-access geo-zone-redundant storage (RA-GZRS).</p>
<p>Tip</p>
<p>Microsoft recommends using GZRS for applications that require consistency, durability, high availability, excellent performance, and resilience for disaster recovery. Enable RA-GZRS for read access to a secondary region when there's a regional disaster.</p>
<h4 id="things-to-consider-when-choosing-replication-strategies"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-choosing-replication-strategies">Things to consider when choosing replication strategies</a></h4>
<p>Let's examine the scope of durability and availability for the different replication strategies. The following table describes several key factors during the replication process, including node unavailability within a data center, and whether the entire data center (zonal or nonzonal) becomes unavailable. The table identifies read access to data in a remote, geo-replicated region during region-wide unavailability, and the supported Azure storage account types.</p>
<table>
<thead>
<tr>
<th>Node in data center unavailable</th>
<th>Entire data center unavailable</th>
<th>Region-wide outage</th>
<th>Read access during region-wide outage</th>
</tr>
</thead>
<tbody>
<tr>
<td>- <strong>LRS</strong>  <br>- <strong>ZRS</strong>  <br>- <strong>GRS</strong>  <br>- <strong>RA-GRS</strong>  <br>- <strong>GZRS</strong>  <br>- <strong>RA-GZRS</strong></td>
<td>- <strong>ZRS</strong>  <br>- <strong>GRS</strong>  <br>- <strong>RA-GRS</strong>  <br>- <strong>GZRS</strong>  <br>- <strong>RA-GZRS</strong></td>
<td>- <strong>GRS</strong>  <br>- <strong>RA-GRS</strong>  <br>- <strong>GZRS</strong>  <br>- <strong>RA-GZRS</strong></td>
<td>- <strong>RA-GRS</strong>  <br>- <strong>RA-GZRS</strong></td>
</tr>
</tbody>
</table>
<h2 id="access-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#access-storage">Access storage</a></h2>
<p>Every object you store in Azure Storage has a unique URL address. Your storage account name forms the <em>subdomain</em> portion of the URL address. The combination of the subdomain and the domain name, which is specific to each service, forms an endpoint for your storage account.</p>
<p>Let's look at an example. If your storage account name is <em>mystorageaccount</em>, default endpoints for your storage account are formed for the Azure services as shown in the following table:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Default endpoint</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Container service</strong></td>
<td><code>//</code><strong><code>mystorageaccount</code></strong><code>.blob.core.windows.net</code></td>
</tr>
<tr>
<td><strong>Table service</strong></td>
<td><code>//</code><strong><code>mystorageaccount</code></strong><code>.table.core.windows.net</code></td>
</tr>
<tr>
<td><strong>Queue service</strong></td>
<td><code>//</code><strong><code>mystorageaccount</code></strong><code>.queue.core.windows.net</code></td>
</tr>
<tr>
<td><strong>File service</strong></td>
<td><code>//</code><strong><code>mystorageaccount</code></strong><code>.file.core.windows.net</code></td>
</tr>
</tbody>
</table>
<p>We create the URL to access an object in your storage account by appending the object's location in the storage account to the endpoint.</p>
<p>To access the <em>myblob</em> data in the <em>mycontainer</em> location in your storage account, we use the following URL address:</p>
<p><code>//</code><strong><code>mystorageaccount</code></strong><code>.blob.core.windows.net/</code><strong><code>mycontainer</code></strong><code>/</code><strong><code>myblob</code></strong>.</p>
<h3 id="configure-custom-domains"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#configure-custom-domains">Configure custom domains</a></h3>
<p>You can configure a custom domain to access blob data in your Azure storage account. As we reviewed, the default endpoint for Azure Blob Storage is <code>\&lt;storage-account-name&gt;.blob.core.windows.net</code>. If you map a custom domain and subdomain, such as <code>www.contoso.com</code>, to the blob or web endpoint for your storage account, your users can use that domain to access blob data in your storage account.</p>
<p>Note</p>
<p>Azure Storage doesn't currently provide native support for HTTPS with custom domains. You can implement an Azure Content Delivery Network (CDN) to access blobs by using custom domains over HTTPS.</p>
<p>There are two ways to configure a custom domain: direct mapping and intermediary domain mapping.</p>
<ul>
<li>
<p><strong>Direct mapping</strong> lets you enable a custom domain for a subdomain to an Azure storage account. For this approach, you create a <code>CNAME</code> record that points from the subdomain to the Azure storage account.</p>
<p>The following example shows how a subdomain is mapped to an Azure storage account to create a <code>CNAME</code> record in the domain name system (DNS):</p>
<ul>
<li>Subdomain: <code>blobs.contoso.com</code></li>
<li>Azure storage account: <code>\&lt;storage account&gt;\.blob.core.windows.net</code></li>
<li>Direct <code>CNAME</code> record: <code>contosoblobs.blob.core.windows.net</code></li>
<li><strong>Intermediary domain mapping</strong> is applied to a domain that's already in use within Azure. This approach might result in minor downtime while the domain is being mapped. To avoid downtime, you can use the <code>asverify</code> intermediary domain to validate the domain. By prepending the <code>asverify</code> keyword to your own subdomain, you permit Azure to recognize your custom domain without modifying the DNS record for the domain. After you modify the DNS record for the domain, your domain is mapped to the blob endpoint with no downtime.</li>
</ul>
<p>The following example shows how a domain in use is mapped to an Azure storage account in the DNS with the <code>asverify</code> intermediary domain:</p>
<ul>
<li><code>CNAME</code> record: <strong><code>asverify</code></strong><code>.blobs.contoso.com</code></li>
<li>Intermediate <code>CNAME</code> record: <strong><code>asverify</code></strong><code>.contosoblobs.blob.core.windows.net</code></li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-custom-domain-name?tabs=azure-portal">Learn more about intermediary domain mapping</a></p>
</li>
</ul>
<h2 id="secure-storage-endpoints"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#secure-storage-endpoints">Secure storage endpoints</a></h2>
<p>In the Azure portal, each Azure service requires certain steps to configure the service endpoints and restrict network access.</p>
<p>To access these settings for your storage account, you use the <strong>Firewalls and virtual networks</strong> settings. You add the virtual networks that should have access to the service for the account.</p>
<p><img alt="Screenshot of the Storage Account Firewalls and virtual networks settings in the Azure portal. One virtual network is selected and the firewall has an IP address range." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-storage-accounts/media/secure-storage-access-d32868ef.png" /></p>
<h4 id="things-to-know-about-configuring-service-endpoints"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-configuring-service-endpoints">Things to know about configuring service endpoints</a></h4>
<p>Here are some points to consider about configuring service access settings:</p>
<ul>
<li>
<p>The <strong>Firewalls and virtual networks</strong> settings restrict access to your storage account from specific subnets on virtual networks or public IPs.</p>
</li>
<li>
<p>You can configure the service to allow access to one or more public IP ranges.</p>
</li>
<li>
<p>Subnets and virtual networks must exist in the same Azure region or region pair as your storage account.</p>
</li>
</ul>
<p>Important</p>
<p>Be sure to test the service endpoint and verify the endpoint limits access as expected.</p>
<hr />
<h2 id="configure-azure-blob-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#configure-azure-blob-storage">Configure Azure Blob Storage</a></h2>
<h2 id="introduction_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#introduction_1">Introduction</a></h2>
<p>Azure Blob Storage is a service for storing large amounts of unstructured object data. Unstructured data is data that doesn't adhere to a particular data model or definition, such as text or binary data.</p>
<p>In this module, your media company has an extensive library of video clips that are accessed thousands of times a day. The company relies on you to configure Blob Storage for the video data. You plan to use access tiers to reduce cost and improve performance. You're developing a lifecycle management strategy for the older videos. Your plan also includes configuring object replication for failover.</p>
<h3 id="learning-objectives_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#learning-objectives_1">Learning objectives</a></h3>
<p>In this module, you will:</p>
<ul>
<li>Understand the purpose and benefits of Azure Blob Storage.</li>
<li>Create and configure Azure Blob Storage accounts.</li>
<li>Manage containers and blobs within Azure Blob Storage.</li>
<li>Optimize blob storage performance and scalability.</li>
<li>Implement lifecycle management policies to automate data movement and deletion.</li>
<li>Determine the best pricing plans for your Azure Blob Storage.</li>
</ul>
<h3 id="skills-measured_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#skills-measured_1">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#prerequisites_1">Prerequisites</a></h3>
<p>Here are some common prerequisites that can be beneficial for understanding and successfully completing this module.</p>
<ul>
<li>
<p>Basic understanding of cloud computing: Familiarity with cloud computing concepts, such as virtualization, scalability, and pay-as-you-go pricing models, can provide a foundation for understanding how Azure Blob Storage fits into the broader cloud ecosystem.</p>
</li>
<li>
<p>Knowledge of Azure fundamentals: Having a basic understanding of Microsoft Azure services and concepts, such as Azure Resource Manager, Azure Storage Accounts, and Azure Virtual Networks, can help you navigate and configure blob storage effectively.</p>
</li>
<li>
<p>Familiarity with storage concepts: Understanding fundamental storage concepts like file systems, directories, files, and data replication can be beneficial when working with blob storage.</p>
</li>
<li>
<p>Experience with Azure Portal or Azure CLI: Familiarity with the Azure Portal (web-based management interface) or Azure CLI (command-line interface) can help you navigate and configure blob storage resources efficiently.</p>
</li>
<li>
<p>Basic programming or scripting skills: While not always required, having some knowledge of programming or scripting languages like PowerShell or Python can be advantageous when automating blob storage configuration tasks.</p>
</li>
</ul>
<h2 id="implement-azure-blob-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#implement-azure-blob-storage">Implement Azure Blob Storage</a></h2>
<p>Azure Blob Storage is a service that stores unstructured data in the cloud as objects or blobs. Blob stands for Binary Large Object. Blob Storage is also referred to as <em>object storage</em> or <em>container storage</em>.</p>
<h4 id="things-to-know-about-azure-blob-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-azure-blob-storage">Things to know about Azure Blob Storage</a></h4>
<p>Let's examine some configuration characteristics of Blob Storage.</p>
<ul>
<li>
<p>Blob Storage can store any type of text or binary data. Some examples are text documents, images, video files, and application installers.</p>
</li>
<li>
<p>Blob Storage uses three resources to store and manage your data:</p>
<ul>
<li>An Azure storage account</li>
<li>Containers in an Azure storage account</li>
<li>Blobs in a container</li>
<li>
<p>To implement Blob Storage, you configure several settings:</p>
</li>
<li>
<p>Blob container options</p>
</li>
<li>Blob types and upload options</li>
<li>Blob Storage access tiers</li>
<li>Blob lifecycle rules</li>
<li>Blob object replication options</li>
</ul>
</li>
</ul>
<p>The following diagram shows the relationship between the Blob Storage resources.</p>
<p><img alt="Diagram that shows the Azure Blob Storage architecture." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-blob-storage/media/blob-storage-94fb52b8.png" /></p>
<h4 id="things-to-consider-when-implementing-azure-blob-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-implementing-azure-blob-storage">Things to consider when implementing Azure Blob Storage</a></h4>
<p>There are many common uses for Blob Storage. Consider the following scenarios and think about your own data needs:</p>
<ul>
<li>
<p><strong>Consider browser uploads</strong>. Use Blob Storage to serve images or documents directly to a browser.</p>
</li>
<li>
<p><strong>Consider distributed access</strong>. Blob Storage can store files for distributed access, such as during an installation process.</p>
</li>
<li>
<p><strong>Consider streaming data</strong>. Stream video and audio by using Blob Storage.</p>
</li>
<li>
<p><strong>Consider archiving and recovery</strong>. Blob Storage is a great solution for storing data for backup and restore, disaster recovery, and archiving.</p>
</li>
<li>
<p><strong>Consider application access</strong>. You can store data in Blob Storage for analysis by an on-premises or Azure-hosted service.</p>
</li>
</ul>
<h2 id="create-blob-containers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#create-blob-containers">Create blob containers</a></h2>
<p>Azure Blob Storage uses a container resource to group a set of blobs. A blob can't exist by itself in Blob Storage. A blob must be stored in a container resource.</p>
<h4 id="things-to-know-about-containers-and-blobs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-containers-and-blobs">Things to know about containers and blobs</a></h4>
<p>Let's look at the configuration characteristics of containers and blobs.</p>
<ul>
<li>
<p>All blobs must be in a container.</p>
</li>
<li>
<p>A container can store an unlimited number of blobs.</p>
</li>
<li>
<p>An Azure storage account can contain an unlimited number of containers.</p>
</li>
<li>
<p>You can create the container in the Azure portal.</p>
</li>
<li>
<p>You upload blobs into a container.</p>
</li>
</ul>
<h4 id="how-to-move-content-between-containers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#how-to-move-content-between-containers">How to move content between containers</a></h4>
<h4 id="configure-a-container"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#configure-a-container">Configure a container</a></h4>
<p>In the Azure portal, you configure two settings to create a container for an Azure storage account. As you review these details, consider how you might organize containers in your storage account.</p>
<p><img alt="Screenshot that shows the container creation page and the public access level choices in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-blob-storage/media/blob-containers-a243a2b9.png" /></p>
<ul>
<li>
<p><strong>Name</strong>: Enter a name for your container. The name must be unique within the Azure storage account.</p>
<ul>
<li>The name can contain only lowercase letters, numbers, and hyphens.</li>
<li>The name must begin with a letter or a number.</li>
<li>The minimum length for the name is three characters.</li>
<li>The maximum length for the name is 63 characters.</li>
<li>
<p><strong>Public access level</strong>: The access level specifies whether the container and its blobs can be accessed publicly. By default, container data is private and visible only to the account owner. There are three access level choices:</p>
</li>
<li>
<p><strong>Private</strong>: (Default) Prohibit anonymous access to the container and blobs.</p>
</li>
<li><strong>Blob</strong>: Allow anonymous public read access for the blobs only.</li>
<li><strong>Container</strong>: Allow anonymous public read and list access to the entire container, including the blobs.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>You can also create a blob container with PowerShell by using the <code>New-AzStorageContainer</code> command.</p>
<h2 id="assign-blob-access-tiers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#assign-blob-access-tiers">Assign blob access tiers</a></h2>
<p>Azure Storage supports several access tiers for blob data, including Hot, Cool, and Archive. Each access tier is optimized to support a particular pattern of data usage.</p>
<h4 id="things-to-know-about-blob-access-tiers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-blob-access-tiers">Things to know about blob access tiers</a></h4>
<p>Let's examine characteristics of the blob access tiers.</p>
<h5 id="hot-tier"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#hot-tier">Hot tier</a></h5>
<p>The Hot tier is optimized for frequent reads and writes of objects in the Azure storage account. A good usage case is data that is actively being processed. By default, new storage accounts are created in the Hot tier. This tier has the lowest access costs, but higher storage costs than the Cool and Archive tiers.</p>
<h5 id="cool-tier"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#cool-tier">Cool tier</a></h5>
<p>The Cool tier is optimized for storing large amounts of data that's infrequently accessed. This tier is intended for data that remains in the Cool tier for at least 30 days. A usage case for the Cool tier is short-term backup and disaster recovery datasets and older media content. This content shouldn't be viewed frequently, but it needs to be immediately available. Storing data in the Cool tier is more cost-effective. Accessing data in the Cool tier can be more expensive than accessing data in the Hot tier.</p>
<h5 id="cold-tier"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#cold-tier">Cold tier</a></h5>
<p>The Cold tier is also optimized for storing large amounts of data that's infrequently accessed. This tier is intended for data that can remain in the tier for at least 90 days.</p>
<h5 id="archive-tier"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#archive-tier">Archive tier</a></h5>
<p>The Archive tier is an offline tier that's optimized for data that can tolerate several hours of retrieval latency. Data must remain in the Archive tier for at least 180 days or be subject to an early deletion charge. Data for the Archive tier includes secondary backups, original raw data, and legally required compliance information. This tier is the most cost-effective option for storing data. Accessing data is more expensive in the Archive tier than accessing data in the other tiers.</p>
<h4 id="compare-access-tiers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#compare-access-tiers">Compare access tiers</a></h4>
<p>The access options for Azure Blob Storage offer a range of features and support levels to help you optimize your storage costs. As you compare the features and support, think about which access options can best support your application needs.</p>
<table>
<thead>
<tr>
<th>Comparison</th>
<th>Hot access tier</th>
<th>Cool access tier</th>
<th>Cold access tier</th>
<th>Archive access tier</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Availability</strong></td>
<td>99.9%</td>
<td>99%</td>
<td>99%</td>
<td>99%</td>
</tr>
<tr>
<td><strong>Availability (RA-GRS reads)</strong></td>
<td>99.99%</td>
<td>99.9%</td>
<td>99.9%</td>
<td>99.9%</td>
</tr>
<tr>
<td><strong>Latency (time to first byte)</strong></td>
<td>milliseconds</td>
<td>milliseconds</td>
<td>milliseconds</td>
<td>hours</td>
</tr>
<tr>
<td><strong>Minimum storage duration</strong></td>
<td>N/A</td>
<td>30 days</td>
<td>90 days</td>
<td>180 days</td>
</tr>
</tbody>
</table>
<h4 id="configure-the-blob-access-tier"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#configure-the-blob-access-tier">Configure the blob access tier</a></h4>
<p>In the Azure portal, you can select the blob access tier for your Azure storage account. You can also change the blob access tier for your account at any time. By selecting the correct access tier for your needs, you can store your blob data in the most cost-effective manner.</p>
<h2 id="add-blob-lifecycle-management-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#add-blob-lifecycle-management-rules">Add blob lifecycle management rules</a></h2>
<p>Every data set has a unique lifecycle. Early in the lifecycle, users tend to access some of the data in the set, but not all of the data. As the data set ages, access to all of the data in the set tends to dramatically reduce. Some data set stays idle in the cloud and is rarely accessed after it's stored. Some data expires within a few days or months after it's created. Other data is actively read and modified throughout the data set lifetime.</p>
<p>Azure Blob Storage supports lifecycle management for data sets. It offers a rich rule-based policy for GPv2 and Blob Storage accounts. You can use lifecycle policy rules to transition your data to the appropriate access tiers, and set expiration times for the end of a data set's lifecycle.</p>
<h4 id="how-to-automatically-manage-azure-blobs-lifecycles-azure-tips-and-tricks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#how-to-automatically-manage-azure-blobs-lifecycles-azure-tips-and-tricks">How to automatically manage Azure Blobs lifecycles | Azure Tips and Tricks</a></h4>
<h4 id="things-to-know-about-lifecycle-management"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-lifecycle-management">Things to know about lifecycle management</a></h4>
<p>You can use Azure Blob Storage lifecycle management policy rules to accomplish several tasks.</p>
<ul>
<li>
<p>Transition blobs to a cooler storage tier (Hot to Cool, Hot to Archive, Cool to Archive) to optimize for performance and cost.</p>
</li>
<li>
<p>Delete blobs at the end of their lifecycles.</p>
</li>
<li>
<p>Define rule-based conditions to run once per day at the Azure storage account level.</p>
</li>
<li>
<p>Apply rule-based conditions to containers or a subset of blobs.</p>
</li>
</ul>
<h5 id="business-scenario"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#business-scenario">Business scenario</a></h5>
<p>Consider a scenario where data is frequently accessed in the early stages of the lifecycle, but only occasionally after two weeks. After the first month, the data set is rarely accessed. In this scenario, the Hot tier of Blob Storage is best during the early stages. Cool tier storage is most appropriate for occasional access. Archive tier storage is the best option after the data ages over a month. To achieve this transition, lifecycle management policy rules are available to move aging data to cooler tiers.</p>
<h4 id="configure-lifecycle-management-policy-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#configure-lifecycle-management-policy-rules">Configure lifecycle management policy rules</a></h4>
<p>In the Azure portal, you create lifecycle management policy rules for your Azure storage account by specifying several settings. For each rule, you create <strong>If - Then</strong> block conditions to transition or expire data based on your specifications. As you review these details, consider how you can set up lifecycle management policy rules for your data sets.</p>
<p><img alt="Screenshot that shows how to add a lifecycle management policy rule for blob data in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-blob-storage/media/blob-lifecycle-2854d812.png" /></p>
<ul>
<li>
<p><strong>If</strong>: The <strong>If</strong> clause sets the evaluation clause for the policy rule. When the <strong>If</strong> clause evaluates to true, the <strong>Then</strong> clause is executed. Use the <strong>If</strong> clause to set the time period to apply to the blob data. The lifecycle management feature checks if the data is accessed or modified according to the specified time.</p>
<ul>
<li><strong>More than (days ago)</strong>: The number of days to use in the evaluation condition.</li>
<li>
<p><strong>Then</strong>: The <strong>Then</strong> clause sets the action clause for the policy rule. When the <strong>If</strong> clause evaluates to true, the <strong>Then</strong> clause is executed. Use the <strong>Then</strong> clause to set the transition action for the blob data. The lifecycle management feature transitions the data based on the setting.</p>
</li>
<li>
<p><strong>Move to cool storage</strong>: The blob data is transitioned to Cool tier storage.</p>
</li>
<li><strong>Move to archive storage</strong>: The blob data is transitioned to Archive tier storage.</li>
<li><strong>Delete the blob</strong>: The blob data is deleted.</li>
</ul>
</li>
</ul>
<p>By designing policy rules to adjust storage tiers in respect to the age of data, you can design the least expensive storage options for your needs.</p>
<h2 id="determine-blob-object-replication"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#determine-blob-object-replication">Determine blob object replication</a></h2>
<p>Object replication copies blobs in a container asynchronously according to policy rules that you configure. During the replication process, the following contents are copied from the source container to the destination container:</p>
<ul>
<li>The blob contents</li>
<li>The blob metadata and properties</li>
<li>Any versions of data associated with the blob</li>
</ul>
<p>The following illustration shows an example of asynchronous replication of blob containers between regions.</p>
<p><img alt="Diagram that shows asynchronous replication of blob containers between regions." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-blob-storage/media/blob-object-replication-21fd3c07.png" /></p>
<h4 id="things-to-know-about-blob-object-replication"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-blob-object-replication">Things to know about blob object replication</a></h4>
<p>There are several considerations to keep in mind when planning your configuration for blob object replication.</p>
<ul>
<li>
<p>Object replication requires that blob versioning is enabled on both the source and destination accounts.</p>
</li>
<li>
<p>Object replication doesn't support blob snapshots. Any snapshots on a blob in the source account aren't replicated to the destination account.</p>
</li>
<li>
<p>Object replication is supported when the source and destination accounts are in the Hot, Cool, or Cold tier. The source and destination accounts can be in different tiers.</p>
</li>
<li>
<p>When you configure object replication, you create a replication policy that specifies the source Azure storage account and the destination storage account.</p>
</li>
<li>
<p>A replication policy includes one or more rules that specify a source container and a destination container. The policy identifies the blobs in the source container to replicate.</p>
</li>
</ul>
<h4 id="things-to-consider-when-configuring-blob-object-replication"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-configuring-blob-object-replication">Things to consider when configuring blob object replication</a></h4>
<p>There are many benefits to using blob object replication. Consider the following scenarios and think about how replication can be a part of your Blob Storage strategy.</p>
<ul>
<li>
<p><strong>Consider latency reductions</strong>. Minimize latency with blob object replication. You can reduce latency for read requests by enabling clients to consume data from a region that's in closer physical proximity.</p>
</li>
<li>
<p><strong>Consider efficiency for compute workloads</strong>. Improve efficiency for compute workloads by using blob object replication. With object replication, compute workloads can process the same sets of blobs in different regions.</p>
</li>
<li>
<p><strong>Consider data distribution</strong>. Optimize your configuration for data distribution. You can process or analyze data in a single location and then replicate only the results to other regions.</p>
</li>
<li>
<p><strong>Consider costs benefits</strong>. Manage your configuration and optimize your storage policies to achieve cost benefits. After your data is replicated, you can reduce costs by moving the data to the Archive tier by using lifecycle management policies.</p>
</li>
</ul>
<h2 id="upload-blobs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#upload-blobs">Upload blobs</a></h2>
<p>A blob can be any type of data and any size file. Azure Storage offers three types of blobs: <em>block blob</em>, <em>page blob</em>, and <em>append blob</em>.</p>
<h4 id="things-to-know-about-blob-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-blob-types">Things to know about blob types</a></h4>
<p>Let's take a closer look at the characteristics of blob types.</p>
<ul>
<li>
<p><strong>Block blobs</strong>. A block blob consists of blocks of data that are assembled to make a blob. Most Blob Storage scenarios use block blobs. Block blobs are ideal for storing text and binary data in the cloud, like files, images, and videos.</p>
</li>
<li>
<p><strong>Append blobs</strong>. An append blob is similar to a block blob because the append blob also consists of blocks of data. The blocks of data in an append blob are optimized for <em>append</em> operations. Append blobs are useful for logging scenarios, where the amount of data can increase as the logging operation continues.</p>
</li>
<li>
<p><strong>Page blobs</strong>. A page blob can be up to 8 TB in size. Page blobs are more efficient for frequent read/write operations. Azure Virtual Machines uses page blobs for operating system disks and data disks.</p>
</li>
<li>
<p>The block blob type is the default type for a new blob. When you're creating a new blob, if you don't choose a specific type, the new blob is created as a block blob.</p>
</li>
<li>
<p>After you create a blob, you can't change its type.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-blob-upload-tools"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-using-blob-upload-tools">Things to consider when using blob upload tools</a></h4>
<p>A common approach for uploading blobs to your Azure storage account is to use Azure Storage Explorer. Many other tools are also available. Review the following options and consider which tools would suit your configuration needs.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Upload tool</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>AzCopy</strong></td>
<td>An easy-to-use command-line tool for Windows and Linux. You can copy data to and from Blob Storage, across containers, and across storage accounts.</td>
</tr>
<tr>
<td><strong>Azure Data Box Disk</strong></td>
<td>A service for transferring on-premises data to Blob Storage when large datasets or network constraints make uploading data over the wire unrealistic. You can use Azure Data Box Disk to request solid-state disks (SSDs) from Microsoft. You can copy your data to those disks and ship them back to Microsoft to be uploaded into Blob Storage.</td>
</tr>
<tr>
<td><strong>Azure Import/Export</strong></td>
<td>A service that helps you export large amounts of data from your storage account to hard drives that you provide and that Microsoft then ships back to you with your data.</td>
</tr>
</tbody>
</table>
<h5 id="business-scenario_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#business-scenario_1">Business scenario</a></h5>
<p>The following example shows how to upload blob data in Azure Storage Explorer. After you identify the files to upload, you choose the blob type and block size, and the container folder. You also set the authentication method and encryption scope.</p>
<p><img alt="Screenshot of the Upload Blob page that shows the Authentication type, blob types, and block size." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-blob-storage/media/upload-blobs-7ad73d30.png" /></p>
<h4 id="how-to-use-blob-versioning"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#how-to-use-blob-versioning">How to use Blob versioning</a></h4>
<p>You can enable Blob storage versioning to automatically maintain previous versions of an object. When blob versioning is enabled, you can access earlier versions of a blob to recover your data if it's modified or deleted.</p>
<h2 id="determine-blob-storage-pricing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#determine-blob-storage-pricing">Determine Blob Storage pricing</a></h2>
<p>All Azure storage accounts use a pricing model for Azure Blob Storage that's based on the tier of each blob.</p>
<h4 id="things-to-know-about-pricing-for-blob-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-pricing-for-blob-storage">Things to know about pricing for Blob Storage</a></h4>
<p>Review the following billing considerations for an Azure storage account and Blob Storage.</p>
<ul>
<li>
<p><strong>Performance tiers</strong>. The Blob Storage tier determines the amount of data stored and the cost for storing that data. As the performance tier gets cooler, the per-gigabyte cost decreases.</p>
</li>
<li>
<p><strong>Data access costs</strong>. Data access charges increase as the tier gets cooler. For data in the Cool and Archive tiers, you're billed a per-gigabyte data access charge for reads.</p>
</li>
<li>
<p><strong>Transaction costs</strong>. There's a per-transaction charge for all tiers. The charge increases as the tier gets cooler.</p>
</li>
<li>
<p><strong>Geo-replication data transfer costs</strong>. This charge only applies to accounts that have geo-replication configured, including GRS and RA-GRS. Geo-replication data transfer incurs a per-gigabyte charge.</p>
</li>
<li>
<p><strong>Outbound data transfer costs</strong>. Outbound data transfers (data that's transferred out of an Azure region) incur billing for bandwidth usage on a per-gigabyte basis. This billing is consistent with general-purpose Azure storage accounts.</p>
</li>
<li>
<p><strong>Changes to the storage tier</strong>. If you change the account storage tier from Cool to Hot, you incur a charge equal to reading all the data existing in the storage account. Changing the account storage tier from Hot to Cool incurs a charge equal to writing all the data into the Cool tier (GPv2 accounts only).</p>
</li>
</ul>
<h2 id="interactive-lab-simulation"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#interactive-lab-simulation">Interactive lab simulation</a></h2>
<h3 id="lab-scenario"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#lab-scenario">Lab scenario</a></h3>
<p>Your organization is migrating storage to Azure. As the Azure Administrator you need to:</p>
<ul>
<li>Organize content into storage accounts.</li>
<li>Upload and manage images.</li>
<li>Monitor and troubleshoot storage accounts.</li>
</ul>
<h3 id="objectives"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#objectives">Objectives</a></h3>
<ul>
<li><strong>Task 1</strong>: Create a storage account.<ul>
<li>Create a storage account in your region with locally redundant storage.</li>
<li>Verify the storage account was created.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Work with blob storage.<ul>
<li>Create a private blob container.</li>
<li>Upload a file to the container.</li>
</ul>
</li>
<li><strong>Task 3</strong>: Monitor the storage container.<ul>
<li>Review common storage problems and troubleshooting guides.</li>
<li>Review insights for performance, availability, and capacity.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Click on the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%205"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-blob-storage/media/simulation-blob-storage.jpg" /></a></p>
<hr />
<h2 id="configure-azure-storage-security"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#configure-azure-storage-security">Configure Azure Storage security</a></h2>
<h2 id="introduction_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#introduction_2">Introduction</a></h2>
<p>Azure Storage provides a comprehensive set of security capabilities that work together to enable developers to build secure applications.</p>
<p>In this module, your company is storing sensitive data in Azure Storage, including personal information. The data is used internally and by external application developers. You're responsible for ensuring the data is secure for all users. You're tasked with providing configuration solutions to grant secure access to the information.</p>
<h3 id="learning-objectives_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#learning-objectives_2">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Configure a shared access signature, including the uniform resource identifier (URI) and SAS parameters.</li>
<li>Configure Azure Storage encryption.</li>
<li>Implement customer-managed keys.</li>
<li>Recommend opportunities to improve Azure Storage security.</li>
</ul>
<h3 id="skills-measured_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#skills-measured_2">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>. The module concepts are covered in:</p>
<p>Implement and manage storage (15–20%)</p>
<ul>
<li>Secure storage<ul>
<li>Generate shared access signature (SAS) tokens</li>
<li>Manage access keys</li>
<li>Configure Microsoft Entra authentication for an Azure storage account</li>
</ul>
</li>
</ul>
<h2 id="review-azure-storage-security-strategies"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#review-azure-storage-security-strategies">Review Azure Storage security strategies</a></h2>
<p>Administrators use different strategies to ensure their data is secure. Common approaches include encryption, authentication, authorization, and user access control with credentials, file permissions, and private signatures. Azure Storage offers a suite of security capabilities based on common strategies to help you secure your data.</p>
<h4 id="things-to-know-about-azure-storage-security-strategies"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-azure-storage-security-strategies">Things to know about Azure Storage security strategies</a></h4>
<p>Let's look at some characteristics of Azure Storage security.</p>
<ul>
<li>
<p><strong>Encryption</strong>. All data written to Azure Storage is automatically encrypted by using Azure Storage encryption.</p>
</li>
<li>
<p><strong>Authentication</strong>. Microsoft Entra ID and role-based access control (RBAC) are supported for Azure Storage for both resource management operations and data operations.</p>
<ul>
<li>Assign RBAC roles scoped to an Azure storage account to security principals, and use Microsoft Entra ID to authorize resource management operations like key management.</li>
<li>Microsoft Entra integration is supported for data operations on Azure Blob Storage and Azure Queue Storage.</li>
<li><strong>Data in transit</strong>. Data can be secured in transit between an application and Azure by using Client-Side Encryption, HTTPS, or SMB 3.0.</li>
</ul>
</li>
<li>
<p><strong>Disk encryption</strong>. Operating system disks and data disks used by Azure Virtual Machines can be encrypted by using Azure Disk Encryption.</p>
</li>
<li>
<p><strong>Shared access signatures</strong>. Delegated access to the data objects in Azure Storage can be granted by using a shared access signature (SAS).</p>
</li>
<li>
<p><strong>Authorization</strong>. Every request made against a secured resource in Blob Storage, Azure Files, Queue Storage, or Azure Cosmos DB (Azure Table Storage) must be authorized. Authorization ensures that resources in your storage account are accessible only when you want them to be, and to only those users or applications whom you grant access.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-authorization-security"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-using-authorization-security">Things to consider when using authorization security</a></h4>
<p>Review the following strategies for authorizing requests to Azure Storage. Think about what security strategies would work for your Azure Storage.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Authorization strategy</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Microsoft Entra ID</strong></td>
<td>Microsoft Entra ID is Microsoft's cloud-based identity and access management service. With Microsoft Entra ID, you can assign fine-grained access to users, groups, or applications by using role-based access control.</td>
</tr>
<tr>
<td><strong>Shared Key</strong></td>
<td>Shared Key authorization relies on your Azure storage account access keys and other parameters to produce an encrypted signature string. The string is passed on the request in the Authorization header.</td>
</tr>
<tr>
<td><strong>Shared access signatures</strong></td>
<td>A SAS delegates access to a particular resource in your Azure storage account with specified permissions and for a specified time interval.</td>
</tr>
<tr>
<td><strong>Anonymous access to containers and blobs</strong></td>
<td>You can optionally make blob resources public at the container or blob level. A public container or blob is accessible to any user for anonymous read access. Read requests to public containers and blobs don't require authorization.</td>
</tr>
</tbody>
</table>
<h2 id="create-shared-access-signatures"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#create-shared-access-signatures">Create shared access signatures</a></h2>
<p>A shared access signature (SAS) is a uniform resource identifier (URI) that grants restricted access rights to Azure Storage resources. SAS is a secure way to share your storage resources without compromising your account keys.</p>
<p>You can provide a SAS to clients who shouldn't have access to your storage account key. By distributing a SAS URI to these clients, you grant them access to a resource for a specified period of time.</p>
<h4 id="things-to-know-about-shared-access-signatures"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-shared-access-signatures">Things to know about shared access signatures</a></h4>
<p>Let's review some characteristics of a SAS.</p>
<ul>
<li>
<p>A SAS gives you granular control over the type of access you grant to clients who have the SAS.</p>
</li>
<li>
<p>An account-level SAS can delegate access to multiple Azure Storage services, such as blobs, files, queues, and tables.</p>
</li>
<li>
<p>You can specify the time interval for which a SAS is valid, including the start time and the expiration time.</p>
</li>
<li>
<p>You specify the permissions granted by the SAS. A SAS for a blob might grant read and write permissions to that blob, but not delete permissions.</p>
</li>
<li>
<p>SAS provides account-level and service-level control.</p>
<ul>
<li>
<p><strong>Account-level</strong> SAS delegates access to resources in one or more Azure Storage services.</p>
</li>
<li>
<p><strong>Service-level</strong> SAS delegates access to a resource in only one Azure Storage service.</p>
</li>
</ul>
<p>Note</p>
<p>A <strong>stored access policy</strong> can provide another level of control when you use a service-level SAS on the server side. You can group SASs and provide other restrictions by using a stored access policy.</p>
</li>
<li>
<p>There are optional SAS configuration settings:</p>
<ul>
<li>
<p><strong>IP addresses</strong>. You can identify an IP address or range of IP addresses from which Azure Storage accepts the SAS. Configure this option to specify a range of IP addresses that belong to your organization.</p>
</li>
<li>
<p><strong>Protocols</strong>. You can specify the protocol over which Azure Storage accepts the SAS. Configure this option to restrict access to clients by using HTTPS.</p>
</li>
</ul>
</li>
</ul>
<h3 id="configure-a-shared-access-signature"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#configure-a-shared-access-signature">Configure a shared access signature</a></h3>
<p>In the Azure portal, you configure several settings to create a SAS. As you review these details, consider how you might implement shared access signatures in your storage security solution.</p>
<p><img alt="Screenshot of the Create a shared access signature key page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-storage-security/media/configure-secure-signatures-be02fa89.png" /></p>
<ul>
<li><strong>Signing method</strong>: Choose the signing method: Account key or User delegation key.</li>
<li><strong>Signing key</strong>: Select the signing key from your list of keys.</li>
<li><strong>Permissions</strong>: Select the permissions granted by the SAS, such as read or write.</li>
<li><strong>Start and Expiry date/time</strong>: Specify the time interval for which the SAS is valid. Set the start time and the expiry time.</li>
<li><strong>Allowed IP addresses</strong>: (Optional) Identify an IP address or range of IP addresses from which Azure Storage accepts the SAS.</li>
<li><strong>Allowed protocols</strong>: (Optional) Select the protocol over which Azure Storage accepts the SAS.</li>
</ul>
<h2 id="identify-uri-and-sas-parameters"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#identify-uri-and-sas-parameters">Identify URI and SAS parameters</a></h2>
<p>When you create your shared access signature (SAS), a uniform resource identifier (URI) is created by using parameters and tokens. The URI consists of your Azure Storage resource URI and the SAS token.</p>
<p><img alt="Storage Resource and the S A S Token combine to form the U R I." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-storage-security/media/secure-parameters-76db5bda.png" /></p>
<h4 id="things-to-know-about-uri-definitions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-uri-definitions">Things to know about URI definitions</a></h4>
<p>Let's look at a sample URI definition and examine the parameters. This sample creates a service-level SAS that grants read and write permissions to a blob. Consider how you might configure the parameters to support your Azure Storage resources.</p>
<p>URICopy</p>
<div class="highlight"><pre><span></span><code>https://myaccount.blob.core.windows.net/?restype=service&amp;comp=properties&amp;sv=2015-04-05&amp;ss=bf&amp;st=2015-04-29T22%3A18%3A26Z&amp;se=2015-04-30T02%3A23%3A26Z&amp;sr=b&amp;sp=rw&amp;sip=168.1.5.60-168.1.5.70&amp;spr=https&amp;sig=F%6GRVAZ5Cdj2Pw4tgU7IlSTkWgn7bUkkAg8P6HESXwmf%4B
</code></pre></div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Resource URI</strong></td>
<td><code>https://myaccount.</code><strong><code>blob</code></strong><code>.core.windows.net/</code> <code>?restype=</code><strong><code>service</code></strong> <code>&amp;amp;comp=properties</code></td>
<td>Defines the Azure Storage endpoint and other parameters. This example defines an endpoint for Blob Storage and indicates that the SAS applies to service-level operations. When the URI is used with <code>GET</code>, the Storage properties are retrieved. When the URI is used with <code>SET</code>, the Storage properties are configured.</td>
</tr>
<tr>
<td><strong>Storage version</strong></td>
<td><strong><code>sv</code></strong><code>=2015-04-05</code></td>
<td>For Azure Storage version 2012-02-12 and later, this parameter indicates the version to use. This example indicates that version 2015-04-05 (April 5, 2015) should be used.</td>
</tr>
<tr>
<td><strong>Storage service</strong></td>
<td><strong><code>ss</code></strong><code>=bf</code></td>
<td>Specifies the Azure Storage to which the SAS applies. This example indicates that the SAS applies to Blob Storage and Azure Files.</td>
</tr>
<tr>
<td><strong>Start time</strong></td>
<td><strong><code>st</code></strong><code>=2015-04-29T22%3A18%3A26Z</code></td>
<td>(Optional) Specifies the start time for the SAS in UTC time. This example sets the start time as April 29, 2015 22:18:26 UTC. If you want the SAS to be valid immediately, omit the start time.</td>
</tr>
<tr>
<td><strong>Expiry time</strong></td>
<td><strong><code>se</code></strong><code>=2015-04-30T02%3A23%3A26Z</code></td>
<td>Specifies the expiration time for the SAS in UTC time. This example sets the expiry time as April 30, 2015 02:23:26 UTC.</td>
</tr>
<tr>
<td><strong>Resource</strong></td>
<td><strong><code>sr</code></strong><code>=b</code></td>
<td>Specifies which resources are accessible via the SAS. This example specifies that the accessible resource is in Blob Storage.</td>
</tr>
<tr>
<td><strong>Permissions</strong></td>
<td><strong><code>sp</code></strong><code>=rw</code></td>
<td>Lists the permissions to grant. This example grants access to read and write operations.</td>
</tr>
<tr>
<td><strong>IP range</strong></td>
<td><strong><code>sip</code></strong><code>=168.1.5.60-168.1.5.70</code></td>
<td>Specifies a range of IP addresses from which a request is accepted. This example defines the IP address range 168.1.5.60 through 168.1.5.70.</td>
</tr>
<tr>
<td><strong>Protocol</strong></td>
<td><strong><code>spr</code></strong><code>=https</code></td>
<td>Specifies the protocols from which Azure Storage accepts the SAS. This example indicates that only requests by using HTTPS are accepted.</td>
</tr>
<tr>
<td><strong>Signature</strong></td>
<td><strong><code>sig</code></strong><code>=F%6GRVAZ5Cdj2Pw4tgU7Il</code> <code>STkWgn7bUkkAg8P6HESXwmf%4B</code></td>
<td>Specifies that access to the resource is authenticated by using an HMAC signature. The signature is computed over a string-to-sign with a key by using the SHA256 algorithm, and encoded by using Base64 encoding.</td>
</tr>
</tbody>
</table>
<h2 id="determine-azure-storage-encryption"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#determine-azure-storage-encryption">Determine Azure Storage encryption</a></h2>
<p>Azure Storage encryption for data at rest protects your data by ensuring your organizational security and compliance commitments are met. The encryption and decryption processes happen automatically. Because your data is secured by default, you don't need to modify your code or applications.</p>
<h4 id="things-to-know-about-azure-storage-encryption"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-azure-storage-encryption">Things to know about Azure Storage encryption</a></h4>
<p>Examine the following characteristics of Azure Storage encryption.</p>
<ul>
<li>
<p>Data is encrypted automatically before it's persisted to Azure Managed Disks, Azure Blob Storage, Azure Queue Storage, Azure Cosmos DB, Azure Table Storage, or Azure Files.</p>
</li>
<li>
<p>Data is automatically decrypted before it's retrieved.</p>
</li>
<li>
<p>Azure Storage encryption, encryption at rest, decryption, and key management are transparent to users.</p>
</li>
<li>
<p>All data written to Azure Storage is encrypted through 256-bit advanced encryption standard (AES) encryption. AES is one of the strongest block ciphers available.</p>
</li>
<li>
<p>Azure Storage encryption is enabled for all new and existing storage accounts and can't be disabled.</p>
</li>
</ul>
<h3 id="configure-azure-storage-encryption"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#configure-azure-storage-encryption">Configure Azure Storage encryption</a></h3>
<p>In the Azure portal, you configure Azure Storage encryption by specifying the encryption type. You can manage the keys yourself, or you can have the keys managed by Microsoft. Consider how you might implement Azure Storage encryption for your storage security.</p>
<p><img alt="Screenshot that shows Azure Storage encryption, including keys managed by Microsoft and customer-managed keys." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-storage-security/media/secure-encryption-e3b68445.png" /></p>
<h2 id="create-customer-managed-keys"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#create-customer-managed-keys">Create customer-managed keys</a></h2>
<p>For your Azure Storage security solution, you can use Azure Key Vault to manage your encryption keys. The Azure Key Vault APIs can be used to generate encryption keys. You can also create your own encryption keys and store them in a key vault.</p>
<h4 id="things-to-know-about-customer-managed-keys"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-customer-managed-keys">Things to know about customer-managed keys</a></h4>
<p>Consider the following characteristics of customer-managed keys.</p>
<ul>
<li>
<p>By creating your own keys (referred to as <em>customer-managed</em> keys), you have more flexibility and greater control.</p>
</li>
<li>
<p>You can create, disable, audit, rotate, and define access controls for your encryption keys.</p>
</li>
<li>
<p>Customer-managed keys can be used with Azure Storage encryption. You can use a new key or an existing key vault and key. The Azure storage account and the key vault must be in the same region, but they can be in different subscriptions.</p>
</li>
</ul>
<h3 id="configure-customer-managed-keys"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#configure-customer-managed-keys">Configure customer-managed keys</a></h3>
<p>In the Azure portal, you can configure customer-managed encryption keys. You can create your own keys, or you can have the keys managed by Microsoft. Consider how you might use Azure Key Vault to create your own customer-managed encryption keys.</p>
<p><img alt="Screenshot that shows how to create a customer-managed key." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-storage-security/media/customer-keys-b24acc48.png" /></p>
<ul>
<li><strong>Encryption type</strong>: Choose how the encryption key is managed: by Microsoft or by yourself (customer).</li>
<li><strong>Encryption key</strong>: Specify an encryption key by entering a URI, or select a key from an existing key vault.</li>
</ul>
<h2 id="apply-azure-storage-security-best-practices"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#apply-azure-storage-security-best-practices">Apply Azure Storage security best practices</a></h2>
<p>We reviewed how to create and work with a shared access signature (SAS) and the benefits it can provide to your storage security solution.</p>
<p>It's important to understand that when you use a SAS in your application, there can be potential risks.</p>
<ul>
<li>
<p>If a SAS is compromised, it can be used by anyone who obtains it, including a malicious user.</p>
</li>
<li>
<p>If a SAS provided to a client application expires and the application is unable to retrieve a new SAS from your service, the application functionality might be hindered.</p>
</li>
</ul>
<p>Watch this video for more ideas on how to secure your storage. This video is based on <a href="https://microsoft.github.io/AzureTipsAndTricks/blog/blog/tip272.html">Azure Tips and Tricks #272 Azure Security Best Practices</a>.</p>
<h4 id="recommendations-for-managing-risks"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#recommendations-for-managing-risks">Recommendations for managing risks</a></h4>
<p>Let's look at some recommendations that can help mitigate risks when working with a SAS.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Recommendation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Always use HTTPS for creation and distribution</strong></td>
<td>If a SAS is passed over HTTP and intercepted, an attacker can intercept and use the SAS. These <em>man-in-the-middle</em> attacks can compromise sensitive data or allow for data corruption by the malicious user.</td>
</tr>
<tr>
<td><strong>Reference stored access policies where possible</strong></td>
<td>Stored access policies give you the option to revoke permissions without having to regenerate the Azure storage account keys. Set the storage account key expiration date far in the future.</td>
</tr>
<tr>
<td><strong>Set near-term expiry times for an unplanned SAS</strong></td>
<td>If a SAS is compromised, you can mitigate attacks by limiting the SAS validity to a short time. This practice is important if you can't reference a stored access policy. Near-term expiration times also limit the amount of data that can be written to a blob by limiting the time available to upload to it.</td>
</tr>
<tr>
<td><strong>Require clients automatically renew the SAS</strong></td>
<td>Require your clients to renew the SAS well before the expiration date. By renewing early, you allow time for retries if the service providing the SAS is unavailable.</td>
</tr>
<tr>
<td><strong>Plan carefully for the SAS start time</strong></td>
<td>If you set the start time for a SAS to now, then due to clock skew (differences in current time according to different machines), failures might be observed intermittently for the first few minutes. In general, set the start time to at least 15 minutes in the past. Or, don't set a specific start time, which causes the SAS to be valid immediately in all cases. The same conditions generally apply to the expiry time. You might observe up to 15 minutes of clock skew in either direction on any request. For clients that use a REST API version earlier than 2012-02-12, the maximum duration for a SAS that doesn't reference a stored access policy is 1 hour. Any policies that specify a longer term will fail.</td>
</tr>
<tr>
<td><strong>Define minimum access permissions for resources</strong></td>
<td>A security best practice is to provide a user with the minimum required privileges. If a user only needs read access to a single entity, then grant them read access to that single entity, and not read/write/delete access to all entities. This practice also helps lessen the damage if a SAS is compromised because the SAS has less power in the hands of an attacker.</td>
</tr>
<tr>
<td><strong>Understand account billing for usage, including a SAS</strong></td>
<td>If you provide write access to a blob, a user might choose to upload a 200-GB blob. If you've given them read access as well, they might choose to download the blob 10 times, which incurs 2 TB in egress costs for you. Again, provide limited permissions to help mitigate the potential actions of malicious users. Use a short-lived SAS to reduce this threat, but be mindful of clock skew on the end time.</td>
</tr>
<tr>
<td><strong>Validate data written by using a SAS</strong></td>
<td>When a client application writes data to your Azure storage account, keep in mind there can be problems with the data. If your application requires validated or authorized data, validate the data after it's written, but before it's used. This practice also protects against corrupt or malicious data being written to your account, either by a user who properly acquired the SAS, or by a user exploiting a leaked SAS.</td>
</tr>
<tr>
<td><strong>Don't assume a SAS is always the correct choice</strong></td>
<td>In some scenarios, the risks associated with a particular operation against your Azure storage account outweigh the benefits of using a SAS. For such operations, create a middle-tier service that writes to your storage account after performing business rule validation, authentication, and auditing. Also, sometimes it's easier to manage access in other ways. If you want to make all blobs in a container publicly readable, you can make the container Public, rather than providing a SAS to every client for access.</td>
</tr>
<tr>
<td><strong>Monitor your applications with Azure Storage Analytics</strong></td>
<td>You can use logging and metrics to observe any spike in authentication failures. You might see spikes from an outage in your SAS provider service or to the inadvertent removal of a stored access policy.</td>
</tr>
</tbody>
</table>
<h2 id="interactive-lab-simulation_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#interactive-lab-simulation_1">Interactive lab simulation</a></h2>
<h3 id="lab-scenario_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#lab-scenario_1">Lab scenario</a></h3>
<p>Your organization is migrating storage to Azure. As the Azure Administrator you need to:</p>
<ul>
<li>Evaluate the use of Azure storage for storing files. These files are currently residing in on-premises data stores.</li>
<li>Minimize the cost of storage by placing less frequently accessed files in lower-priced storage tiers.</li>
<li>Explore different protection mechanisms that Azure Storage offers, including network access, authentication, authorization, and replication.</li>
<li>Determine to what extent Azure Files service might be suitable for hosting your on-premises file shares.</li>
</ul>
<h3 id="architecture-diagram"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#architecture-diagram">Architecture diagram</a></h3>
<p><img alt="Architecture diagram as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-storage-security/media/lab-07.png" /></p>
<h3 id="objectives_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#objectives_1">Objectives</a></h3>
<ul>
<li><strong>Task 1</strong>: Create the infrastructure environment.<ul>
<li>Use a template to create the virtual networks and virtual machines. You can review the <a href="https://github.com/MicrosoftLearning/AZ-104-MicrosoftAzureAdministrator/tree/master/Allfiles/Interactive%20Lab%20Simulation%20Files/07">lab template</a>.</li>
<li>Use Azure PowerShell to deploy the template.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Create and configure Azure Storage accounts.<ul>
<li>Create a storage account.</li>
<li>Configure the storage account to include redundancy and access tiers.</li>
</ul>
</li>
<li><strong>Task 3</strong>: Manage blob storage.<ul>
<li>Create a private Blob container.</li>
<li>Upload a file into the container.</li>
</ul>
</li>
<li><strong>Task 4</strong>: Manage authentication and authorization for Azure Storage.<ul>
<li>Generate a shared access signature (SAS) with limited time access.</li>
<li>Verify the SAS is working correctly.</li>
</ul>
</li>
<li><strong>Task 5</strong>: Create and configure an Azure Files share.<ul>
<li>Create a file and connect to it.</li>
<li>Use Azure PowerShell to add items to the file share.</li>
</ul>
</li>
<li><strong>Task 6</strong>: Manage network access for Azure Storage.<ul>
<li>Limit access to the Azure storage account from only specific IP addresses.</li>
<li>Confirm access is denied from the Cloud Shell.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Click on the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2011"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-storage-security/media/simulation-storage-thumbnail.jpg" /></a></p>
<hr />
<h2 id="configure-azure-files-and-azure-file-sync"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#configure-azure-files-and-azure-file-sync">Configure Azure Files and Azure File Sync</a></h2>
<h2 id="introduction_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#introduction_3">Introduction</a></h2>
<p>Azure Files offers fully managed file shares in the cloud that are accessible via industry standard protocols. Azure File Sync is a service that allows you to cache several Azure Files shares on an on-premises Windows Server or cloud virtual machine.</p>
<p>In this module, your company has a large repository of organizational documents. Offices are located in different geographical regions, and users need the most current versions of the documents. You're researching how to implement Azure Files shares to provide a central location for the documents. You'd like to configure Azure File Sync to keep the documents up to date across the dispersed offices.</p>
<h3 id="learning-objectives_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#learning-objectives_3">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify storage for file shares.</li>
<li>Compare file shares to blob and disk storage.</li>
<li>Configure Azure file shares, file share snapshots, and soft delete.</li>
<li>Use Azure Storage Explorer to access your file share.</li>
<li>Identify use cases and features of Azure File Sync.</li>
</ul>
<h3 id="skills-measured_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#skills-measured_3">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>. The module concepts are covered in:</p>
<p>Implement and manage storage (15–20%).</p>
<ul>
<li>Configure Azure Files and Azure Blob Storage<ul>
<li>Create and configure a files share in Azure storage.</li>
<li>Configure snapshots and soft delete for Azure Files.</li>
</ul>
</li>
</ul>
<h2 id="compare-storage-for-file-shares-and-blob-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#compare-storage-for-file-shares-and-blob-data">Compare storage for file shares and blob data</a></h2>
<p><a href="https://learn.microsoft.com/en-us/azure/storage/files/storage-files-introduction">Azure Files</a> offers shared storage for applications by using the industry standard <a href="https://msdn.microsoft.com/library/windows/desktop/aa365233.aspx">Server Message Block</a> and Network File System (NFS) protocols. Azure virtual machines (VMs) and cloud services can share file data across application components by using mounted shares. On-premises applications can also access file data in the share.</p>
<h4 id="things-to-know-about-azure-files"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-azure-files">Things to know about Azure Files</a></h4>
<p>Let's examine some characteristics of Azure Files.</p>
<ul>
<li>
<p>Azure Files stores data as true directory objects in file shares.</p>
</li>
<li>
<p>Azure Files provides shared access to files across multiple VMs. Any number of Azure virtual machines or roles can mount and access an Azure file share simultaneously.</p>
</li>
<li>
<p>Applications that run in Azure VMs or cloud services can mount an Azure file share to access file data. This process is similar to how a desktop application mounts a typical SMB share.</p>
</li>
<li>
<p>Azure Files offers fully managed file shares in the cloud. Azure file shares can be mounted concurrently by cloud or on-premises deployments of Windows, Linux, and macOS.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-azure-files"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-using-azure-files">Things to consider when using Azure Files</a></h4>
<p>There are many common scenarios for using Azure Files. As you review the following suggestions, think about how Azure Files can provide solutions for your organization.</p>
<ul>
<li>
<p><strong>Consider replacement and supplement options</strong>. Replace or supplement traditional on-premises file servers or NAS devices by using Azure Files.</p>
</li>
<li>
<p><strong>Consider global access</strong>. Directly access Azure file shares by using most operating systems, such as Windows, macOS, and Linux, from anywhere in the world.</p>
</li>
<li>
<p><strong>Consider lift and shift support</strong>. <em>Lift and shift</em> applications to the cloud with Azure Files for apps that expect a file share to store file application or user data.</p>
</li>
<li>
<p><strong>Consider using Azure File Sync</strong>. Replicate Azure file shares to Windows Servers by using Azure File Sync. You can replicate on-premises or in the cloud for performance and distributed caching of the data where it's being used. We'll take a closer look at Azure File Sync in a later unit.</p>
</li>
<li>
<p><strong>Consider shared applications</strong>. Store shared application settings such as configuration files in Azure Files.</p>
</li>
<li>
<p><strong>Consider diagnostic data</strong>. Use Azure Files to store diagnostic data such as logs, metrics, and crash dumps in a shared location.</p>
</li>
<li>
<p><strong>Consider tools and utilities</strong>. Azure Files is a good option for storing tools and utilities that are needed for developing or administering Azure VMs or cloud services.</p>
</li>
</ul>
<h3 id="compare-azure-files-to-azure-blob-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#compare-azure-files-to-azure-blob-storage">Compare Azure Files to Azure Blob Storage</a></h3>
<p>It's important to understand when to use Azure Files to store data in file shares rather than using Azure Blob Storage to store data as blobs. The following table compares different features of these services and common implementation scenarios.</p>
<table>
<thead>
<tr>
<th>Azure Files (file shares)</th>
<th>Azure Blob Storage (blobs)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Azure Files provides the SMB and NFS protocols, client libraries, and a REST interface that allows access from anywhere to stored files.</td>
<td>Azure Blob Storage provides client libraries and a REST interface that allows unstructured data to be stored and accessed at a massive scale in block blobs.</td>
</tr>
<tr>
<td>- Files in an Azure Files share are true directory objects.  <br>- Data in Azure Files is accessed through file shares across multiple virtual machines.</td>
<td>- Blobs in Azure Blob Storage are a flat namespace.  <br>- Blob data in Azure Blob Storage is accessed through a container.</td>
</tr>
<tr>
<td><em><strong>Azure Files</strong> is ideal to lift and shift an application to the cloud that already uses the native file system APIs. Share data between the app and other applications running in Azure.</em>  <br>  <br><em>Azure Files is a good option when you want to store development and debugging tools that need to be accessed from many virtual machines.</em></td>
<td><em><strong>Azure Blob Storage</strong> is ideal for applications that need to support streaming and random-access scenarios.</em>  <br>  <br><em>Azure Blob Storage is a good option when you want to be able to access application data from anywhere.</em></td>
</tr>
</tbody>
</table>
<h2 id="manage-azure-file-shares"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#manage-azure-file-shares">Manage Azure file shares</a></h2>
<p>Azure Files offers two industry-standard file system protocols for mounting Azure file shares: the Server Message Block (SMB) protocol and the Network File System (NFS) protocol. Azure file shares don't support both the SMB and NFS protocols on the same file share, although you can create SMB and NFS Azure file shares within the same storage account.</p>
<h3 id="types-of-azure-file-shares"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#types-of-azure-file-shares">Types of Azure file shares</a></h3>
<p>Azure also offers two types of file shares: standard and premium. There are key differences between premium and standard file shares:</p>
<ul>
<li>
<p>The premium tier stores data on modern solid-state drives (SSDs), while the standard tier uses hard disk drives (HDDs).</p>
</li>
<li>
<p>Standard file shares can be used with SMB and REST protocols only, while premium file shares can be used with SMB, NFS, and REST protocols.</p>
</li>
<li>
<p>You can easily switch between hot, cool, and transaction optimized tiers of standard file shares, but you can't switch from premium file shares to any of the standard tiers.</p>
</li>
</ul>
<h3 id="creating-smb-azure-file-shares"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#creating-smb-azure-file-shares">Creating SMB Azure file shares</a></h3>
<p>There are two important settings that you need to be aware of when creating and configuring SMB Azure file shares.</p>
<ul>
<li>
<p><strong>Open port 445</strong>. SMB communicates over TCP port 445. Make sure port 445 is open. Also, make sure your firewall isn't blocking TCP port 445 from the client machine. If you can't unblock port 445, then a VPN or ExpressRoute connection from on-premises to your Azure network is required, with Azure Files exposed on your internal network using private endpoints.</p>
</li>
<li>
<p><strong>Enable secure transfer</strong>. The <code>Secure transfer required</code> setting enhances the security of your storage account by limiting requests to your storage account from secure connections only. Consider the scenario where you use REST APIs to access your storage account. If you attempt to connect, and secure transfer required is enabled, you must connect by using HTTPS. If you try to connect to your account by using HTTP, and secure transfer required is enabled, the connection is rejected.</p>
</li>
</ul>
<h3 id="mount-an-smb-azure-file-share-on-windows"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#mount-an-smb-azure-file-share-on-windows">Mount an SMB Azure file share on Windows</a></h3>
<p>You can use Azure file shares seamlessly in Windows and Windows Server. You can connect to your Azure file share with Windows or Windows Server in the Azure portal. Specify the <strong>Drive</strong> where you want to mount the share, and choose the <strong>Authentication method</strong>. The Azure portal supplies you with PowerShell commands to run when you're ready to work with the file share. This video shows you how to mount the SMB file share on Windows.</p>
<p><img alt="Manage Azure file shares - Training | Microsoft Learn" src="https://learn.microsoft.com/en-us/training/modules/configure-azure-files-file-sync/3-manage-file-shares" /></p>
<h3 id="mount-smb-azure-file-share-on-linux"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#mount-smb-azure-file-share-on-linux">Mount SMB Azure file share on Linux</a></h3>
<p>You can also connect to Azure file shares from Linux machines. From your virtual machine page, select <strong>Connect</strong>. SMB Azure file shares can be mounted in Linux distributions by using the CIFS kernel client. File mounting can be done on-demand with the <code>mount</code> command or on-boot (persistent) by creating an entry in /etc/fstab.</p>
<h2 id="create-file-share-snapshots"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#create-file-share-snapshots">Create file share snapshots</a></h2>
<p>Azure Files provides the capability to take share <a href="https://learn.microsoft.com/en-us/azure/storage/files/storage-snapshots-files">snapshots of file shares</a>. File share snapshots capture a point-in-time, read-only copy of your data.</p>
<p><img alt="Screenshot of a file share snapshot that shows the snapshot name and date it was created." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-files-file-sync/media/file-share-snapshot-cbda2136.png" /></p>
<h4 id="things-to-know-about-file-share-snapshots"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-file-share-snapshots">Things to know about file share snapshots</a></h4>
<p>Let's review some characteristics of file share snapshots.</p>
<ul>
<li>
<p>The Azure Files share snapshot capability is provided at the file share level.</p>
</li>
<li>
<p>Share snapshots are incremental in nature. Only data changed since the most recent share snapshot is saved.</p>
</li>
<li>
<p>Incremental snapshots minimize the time required to create share snapshots and saves on storage costs.</p>
</li>
<li>
<p>Even though share snapshots are saved incrementally, you only need to retain the most recent share snapshot to restore the share.</p>
</li>
<li>
<p>You can retrieve a share snapshot for an individual file. This level of support helps with restoring individual files rather than having to restore to the entire file share.</p>
</li>
<li>
<p>Share snapshots provide only file-level protection. They don't prevent fat-finger deletions on a file share or storage account. If you delete a file share that has share snapshots, all of its snapshots will be deleted along with the share.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-file-share-snapshots"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-using-file-share-snapshots">Things to consider when using file share snapshots</a></h4>
<p>There are several benefits to using file share snapshots and having access to incremental point-in-time data storage. As you review the following suggestions, think about how you can implement file share snapshots in your Azure Files storage solution.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Benefit</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Protect against application error and data corruption</em></strong></td>
<td>Applications that use file shares perform operations like writing, reading, storage, transmission, and processing. When an application is misconfigured or an unintentional bug is introduced, accidental overwrite or damage can happen to a few data blocks. To help protect against these scenarios, you can take a share snapshot before you deploy new application code. When a bug or application error is introduced with the new deployment, you can go back to a previous version of your data on that file share.</td>
</tr>
<tr>
<td><strong><em>Protect against accidental deletions or unintended changes</em></strong></td>
<td>Imagine you're working on a text file in a file share. After the text file is closed, you lose the ability to undo your changes. In this scenario, you need to recover a previous version of your file. You can use share snapshots to recover previous versions of the file if it's accidentally renamed or deleted.</td>
</tr>
<tr>
<td><strong><em>Support backup and recovery</em></strong></td>
<td>After you create a file share, you can periodically create a snapshot of the file share to use it for data backup. A share snapshot, when taken periodically, helps maintain previous versions of data that can be used for future audit requirements or disaster recovery.</td>
</tr>
</tbody>
</table>
<h2 id="implement-soft-delete-for-azure-files"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#implement-soft-delete-for-azure-files">Implement soft delete for Azure Files</a></h2>
<p>Azure Files offers <a href="https://learn.microsoft.com/en-us/azure/storage/files/storage-files-prevent-file-share-deletion?toc=%2Fazure%2Fstorage%2Ffile-sync">soft delete for file shares</a>. Soft delete lets you recover deleted files and file shares.</p>
<p><img alt="Illustration that depicts how to enable soft delete on an Azure file share." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-files-file-sync/media/files-enable-soft-delete-new-ui.png" /></p>
<h4 id="things-to-know-about-soft-delete-for-azure-files"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-soft-delete-for-azure-files">Things to know about soft delete for Azure Files</a></h4>
<p>Let's take a look at the characteristics of soft delete for Azure Files.</p>
<ul>
<li>
<p>Soft delete for file shares is enabled at the file share level.</p>
</li>
<li>
<p>Soft delete transitions content to a soft deleted state instead of being permanently erased.</p>
</li>
<li>
<p>Soft delete lets you configure the retention period. The retention period is the amount of time that soft deleted file shares are stored and available for recovery.</p>
</li>
<li>
<p>Soft delete provides a retention period between 1 and 365 days.</p>
</li>
<li>
<p>Soft delete can be enabled on either new or existing file shares.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-soft-delete-for-azure-files"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-using-soft-delete-for-azure-files">Things to consider when using soft delete for Azure Files</a></h4>
<p>There are many advantages to using soft delete for Azure Files. Consider the following scenarios, and think about how you can use soft delete.</p>
<ul>
<li>
<p><strong>Recover from accidental data loss</strong>. Use soft delete to recover data that is deleted or corrupted.</p>
</li>
<li>
<p><strong>Upgrade scenarios</strong>. Use soft delete to restore to a known good state after a failed upgrade attempt.</p>
</li>
<li>
<p><strong>Ransomware protection</strong>. Use soft delete to recover data without paying ransom to cybercriminals.</p>
</li>
<li>
<p><strong>Long-term retention</strong>. Use soft delete to comply with data retention requirements.</p>
</li>
<li>
<p><strong>Business continuity</strong>. Use soft delete to prepare your infrastructure to be highly available for critical workloads.</p>
</li>
</ul>
<h2 id="use-azure-storage-explorer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#use-azure-storage-explorer">Use Azure Storage Explorer</a></h2>
<p><a href="https://learn.microsoft.com/en-us/azure/storage/storage-explorer/vs-azure-tools-storage-manage-with-storage-explorer?tabs=windows">Azure Storage Explorer</a> is a standalone application that makes it easy to work with Azure Storage data on Windows, macOS, and Linux. With Azure Storage Explorer, you can access multiple accounts and subscriptions, and manage all your Storage content.</p>
<p><img alt="Screenshot of Azure Storage Explorer that shows the Emulator storage account open, which has a folder and several documents. The access tier information is visible." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-files-file-sync/media/storage-explorer.png" /></p>
<h4 id="things-to-know-about-azure-storage-explorer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-azure-storage-explorer">Things to know about Azure Storage Explorer</a></h4>
<p>Azure Storage Explorer has the following characteristics.</p>
<ul>
<li>
<p>Azure Storage Explorer requires both management (Azure Resource Manager) and data layer permissions to allow full access to your resources. You need Microsoft Entra ID (formerly Azure Active Directory) permissions to access your storage account, the containers in your account, and the data in the containers.</p>
</li>
<li>
<p>Azure Storage Explorer lets you connect to different storage accounts.</p>
<ul>
<li>Connect to storage accounts associated with your Azure subscriptions.</li>
<li>Connect to storage accounts and services that are shared from other Azure subscriptions.</li>
<li>Connect to and manage local storage by using the Azure Storage Emulator.</li>
</ul>
<p><img alt="Screenshot of the Azure Explorer Manage Accounts page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-files-file-sync/media/connection-options-1df9c8f7.png" /></p>
</li>
</ul>
<h4 id="things-to-consider-when-using-azure-storage-explorer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-using-azure-storage-explorer">Things to consider when using Azure Storage Explorer</a></h4>
<p>Azure Storage Explorer supports many scenarios for working with storage accounts in global and national Azure. As you review these options, think about which scenarios apply to your Azure Storage implementation.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Connect to an Azure subscription</strong></td>
<td>Manage storage resources that belong to your Azure subscription.</td>
</tr>
<tr>
<td><strong>Work with local development storage</strong></td>
<td>Manage local storage by using the Azure Storage Emulator.</td>
</tr>
<tr>
<td><strong>Attach to external storage</strong></td>
<td>Manage storage resources that belong to another Azure subscription or that are under national Azure clouds by using the storage account name, key, and endpoints. This scenario is described in more detail in the next section.</td>
</tr>
<tr>
<td><strong>Attach a storage account with a SAS</strong></td>
<td>Manage storage resources that belong to another Azure subscription by using a shared access signature (SAS).</td>
</tr>
<tr>
<td><strong>Attach a service with a SAS</strong></td>
<td>Manage a specific Azure Storage service (blob container, queue, or table) that belongs to another Azure subscription by using a SAS.</td>
</tr>
</tbody>
</table>
<h3 id="attach-to-external-storage-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#attach-to-external-storage-account">Attach to external storage account</a></h3>
<p>Azure Storage Explorer lets you attach to external storage accounts so storage accounts can be easily shared.</p>
<p>To create the connection, you need the external storage <strong>Account name</strong> and <strong>Account key</strong>. In the Azure portal, the account key is called <strong>key1</strong>.</p>
<p><img alt="Screenshot of the Azure Storage Explorer wizard to connect to an external storage account." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-files-file-sync/media/attach-name-key-13fe3ba3.png" /></p>
<p>To use a storage account name and key from a national Azure cloud, use the <strong>Storage endpoints domain</strong> drop-down menu to select <strong>Other</strong>, and then enter the custom storage account endpoint domain.</p>
<h4 id="access-keys"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#access-keys">Access keys</a></h4>
<p>Access keys provide access to the entire storage account. You're provided two access keys so you can maintain connections by using one key while regenerating the other.</p>
<p>Important</p>
<p>Store your access keys securely. We recommend regenerating your access keys regularly.</p>
<p>When you regenerate your access keys, you must update any Azure resources and applications that access this storage account to use the new keys. This action doesn't interrupt access to disks from your virtual machines.</p>
<h2 id="deploy-azure-file-sync"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#deploy-azure-file-sync">Deploy Azure File Sync</a></h2>
<p><a href="https://learn.microsoft.com/en-us/azure/storage/file-sync/file-sync-introduction">Azure File Sync</a> enables you to cache several Azure Files shares on an on-premises Windows Server or cloud virtual machine. You can use Azure File Sync to centralize your organization's file shares in Azure Files, while keeping the flexibility, performance, and compatibility of an on-premises file server.</p>
<p><img alt="Illustration that depicts how Azure File Sync can be used to cache an organization's file shares in Azure Files." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-files-file-sync/media/file-sync-1d3fd2e7.png" /></p>
<h4 id="things-to-know-about-azure-file-sync"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-know-about-azure-file-sync">Things to know about Azure File Sync</a></h4>
<p>Let's take a look at the characteristics of Azure File Sync.</p>
<ul>
<li>
<p>Azure File Sync transforms Windows Server into a quick cache of your Azure Files shares.</p>
</li>
<li>
<p>You can use any protocol that's available on Windows Server to access your data locally with Azure File Sync, including SMB, NFS, and FTPS.</p>
</li>
<li>
<p>Azure File Sync supports as many caches as you need around the world.</p>
</li>
</ul>
<h5 id="cloud-tiering"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#cloud-tiering">Cloud tiering</a></h5>
<p>Cloud tiering is an optional feature of Azure File Sync. Frequently accessed files are cached locally on the server while all other files are tiered to Azure Files based on policy settings.</p>
<ul>
<li>
<p>When a file is tiered, Azure File Sync replaces the file locally with a pointer. A pointer is commonly referred to as a <em>reparse point</em>. The reparse point represents a URL to the file in Azure Files.</p>
</li>
<li>
<p>When a user opens a tiered file, Azure File Sync seamlessly recalls the file data from Azure Files without the user needing to know that the file is stored in Azure.</p>
</li>
<li>
<p>Cloud tiering files have greyed icons with an offline <code>O</code> file attribute to let the user know when the file is only in Azure.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-azure-file-sync"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#things-to-consider-when-using-azure-file-sync">Things to consider when using Azure File Sync</a></h4>
<p>There are many advantages to using Azure File Sync. Consider the following scenarios, and think about how you can use Azure File Sync with your Azure Files shares.</p>
<ul>
<li>
<p><strong>Consider application lift and shift</strong>. Use Azure File Sync to move applications that require access between Azure and on-premises systems. Provide write access to the same data across Windows Servers and Azure Files.</p>
</li>
<li>
<p><strong>Consider support for branch offices</strong>. Support your branch offices that need to back up files by using Azure File Sync. Use the service to set up a new server that connects to Azure storage.</p>
</li>
<li>
<p><strong>Consider backup and disaster recovery</strong>. After you implement Azure File Sync, Azure Backup backs up your on-premises data. Restore file metadata immediately and recall data as needed for rapid disaster recovery.</p>
</li>
<li>
<p><strong>Consider file archiving with cloud tiering</strong>. Azure File Sync stores only recently accessed data on local servers. Implement cloud tiering so non-used data moves to Azure Files.</p>
</li>
</ul>
<hr />
<h2 id="create-an-azure-storage-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#create-an-azure-storage-account">Create an Azure Storage account</a></h2>
<h2 id="introduction_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#introduction_4">Introduction</a></h2>
<p>Most organizations have diverse requirements for their cloud-hosted data. For example, storing data in a specific region, or needing separate billing for different data categories. Azure storage accounts let you formalize these types of policies and apply them to your Azure data.</p>
<p>Suppose you work at a chocolate manufacturer that produces baking ingredients such as cocoa powder and chocolate chips. You market your products to grocery stores who then sell them to consumers.</p>
<p>Your formulations and manufacturing processes are trade secrets. The spreadsheets, documents, and instructional videos that capture this information are critical to your business and require geographically redundant storage. This data is primarily accessed from your main factory, so you would like to store it in a nearby datacenter. The expense for this storage needs to be billed to the manufacturing department.</p>
<p>You also have a sales group that creates cookie recipes and baking videos to promote your products to consumers. Your priority for this data is low cost, rather than redundancy or location. This storage must be billed to the sales team.</p>
<p>By creating multiple Azure storage accounts, with each one having the appropriate settings for the data it holds, you can handle these types of business requirements.</p>
<h3 id="learning-objectives_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#learning-objectives_4">Learning objectives</a></h3>
<p>In this module, you will:</p>
<ul>
<li>Decide how many storage accounts you need for your project.</li>
<li>Determine the appropriate settings for each storage account.</li>
<li>Create a storage account using the Azure portal.</li>
</ul>
<h2 id="decide-how-many-storage-accounts-you-need"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#decide-how-many-storage-accounts-you-need">Decide how many storage accounts you need</a></h2>
<p>Organizations often have multiple storage accounts to enable them to implement different sets of requirements. In the chocolate-manufacturer example, there's one storage account for private business data and one storage account for consumer-facing files. In this unit, you learn the policy factors that each type of storage account controls, which helps you decide how many accounts you need.</p>
<h3 id="what-is-azure-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#what-is-azure-storage">What is Azure Storage?</a></h3>
<p>Azure provides many ways to store your data, including multiple database options like Azure SQL Database, Azure Cosmos DB, and Azure Table Storage. Azure offers multiple ways to store and send messages, such as Azure Queues and Event Hubs. You can even store loose files using services like Azure Files and Azure Blobs.</p>
<p>Azure groups four of these data services together under the name <em>Azure Storage</em>. The four services are:</p>
<ul>
<li>Azure Blobs</li>
<li>Azure Files</li>
<li>Azure Queues</li>
<li>Azure Tables</li>
</ul>
<p>The following illustration shows the elements of Azure Storage.</p>
<p><img alt="Illustration identifying the Azure data services that are part of Azure Storage." src="https://learn.microsoft.com/en-us/training/modules/create-azure-storage-account/media/2-azure-storage.png" /></p>
<p>These four data services are all primitive, cloud-based storage services, and are often used together in the same application.</p>
<h3 id="what-is-a-storage-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#what-is-a-storage-account">What is a storage account?</a></h3>
<p>A <em>storage account</em> is a container that groups a set of Azure Storage services together. Only data services from Azure Storage can be included in a storage account (Azure Blobs, Azure Files, Azure Queues, and Azure Tables). The following illustration shows a storage account containing several data services.</p>
<p><img alt="Illustration of an Azure storage account containing a mixed collection of data services." src="https://learn.microsoft.com/en-us/training/modules/create-azure-storage-account/media/2-what-is-a-storage-account.png" /></p>
<p>Combining data services into a single storage account enables you to manage them as a group. The settings you specify when you create the account, or any changes that you make after creation, apply to all services in the storage account. Deleting a storage account deletes all of the data stored inside it.</p>
<p>A storage account is an Azure resource and is part of a resource group. The following illustration shows an Azure subscription containing multiple resource groups, where each group contains one or more storage accounts.</p>
<p><img alt="Illustration of an Azure subscription containing multiple resource groups, each with one or more storage accounts." src="https://learn.microsoft.com/en-us/training/modules/create-azure-storage-account/media/2-resource-groups-and-storage-accounts.png" /></p>
<p>Other Azure data services, such as Azure SQL and Azure Cosmos DB, are managed as independent Azure resources and can't be included in a storage account. The following illustration shows a typical arrangement: Blobs, Files, Queues, and Tables are contained within storage accounts, while other services aren't.</p>
<p><img alt="Illustration of an Azure subscription showing some data services that cannot be placed in a storage account." src="https://learn.microsoft.com/en-us/training/modules/create-azure-storage-account/media/2-typical-subscription-organization.png" /></p>
<h3 id="storage-account-settings"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#storage-account-settings">Storage account settings</a></h3>
<p>A storage account defines a policy that applies to all the storage services in the account. For example, you could specify that all the contained services will be stored in the West US datacenter, accessible only over https, and billed to the sales department's subscription.</p>
<p>A storage account defines the following settings:</p>
<ul>
<li>
<p><strong>Subscription</strong>: The Azure subscription that the storage account services are billed to.</p>
</li>
<li>
<p><strong>Location</strong>: The datacenter that stores the services in the account.</p>
</li>
<li>
<p><strong>Performance</strong>: Determines the data services you can have in your storage account and the type of hardware disks used to store the data.</p>
<ul>
<li><strong>Standard</strong> allows you to have any data service (Blob, File, Queue, Table) and uses magnetic disk drives.</li>
<li><strong>Premium</strong> provides more services for storing data. For example, storing unstructured object data as block blobs or append blobs, and specialized file storage used to store and create premium file shares. These storage accounts use solid-state drives (SSD) for storage.</li>
<li><strong>Replication</strong>: Determines the strategy used to make copies of your data to protect against hardware failure or natural disaster. At a minimum, Azure automatically maintains three copies of your data within the datacenter associated with the storage account. The minimum replication is called locally redundant storage (LRS), and guards against hardware failure but doesn't protect you from an event that incapacitates the entire datacenter. You can upgrade to one of the other options such as geo-redundant storage (GRS) to get replication at different datacenters across the world.</li>
</ul>
</li>
<li>
<p><strong>Access tier</strong>: Controls how quickly you're able to access the blobs in a storage account. The Hot access tier is optimized for storing frequently accessed or modified data and provides quicker access than Cool, but at increased storage cost. The Cool access tier is optimized for storing infrequently accessed or modified data, and has a lower storage cost. Hot access tier applies only to blobs, and serves as the default value for new blobs.</p>
</li>
<li>
<p><strong>Secure transfer required</strong>: A security feature that determines the supported protocols for access. Enabled requires HTTPS, while disabled allows HTTP.</p>
</li>
<li>
<p><strong>Virtual networks</strong>: A security feature that allows inbound access requests from only the virtual networks that you specify.</p>
</li>
</ul>
<h3 id="how-many-storage-accounts-do-you-need"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#how-many-storage-accounts-do-you-need">How many storage accounts do you need?</a></h3>
<p>A storage account represents a collection of settings like location, replication strategy, and subscription owner. You need one storage account for each group of settings that you want to apply to your data. The following illustration shows two storage accounts that differ in one setting; that one difference is enough to require separate storage accounts.</p>
<p><img alt="Illustration showing two storage accounts with different settings." src="https://learn.microsoft.com/en-us/training/modules/create-azure-storage-account/media/2-multiple-storage-accounts.png" /></p>
<p>Typically, your data diversity, cost sensitivity, and tolerance for management overhead determine the number of storage accounts you need.</p>
<h4 id="data-diversity"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#data-diversity">Data diversity</a></h4>
<p>Organizations often generate data that differs along several vectors. For example, where the data is consumed, how sensitive it is, which group pays the bills for it, etc. Diversity along any of these vectors can lead to multiple storage accounts. Let's consider two examples:</p>
<ol>
<li>
<p>Do you have data that is specific to a country/region? If so, you might want to store the data in a datacenter in that country/region for performance or compliance reasons. You need one storage account for each geographical region.</p>
</li>
<li>
<p>Do you have some data that is proprietary and some for public consumption? If so, you could enable virtual networks for the proprietary data and not for the public data. Separating proprietary data and public data requires separate storage accounts.</p>
</li>
</ol>
<p>In general, increased diversity means an increased number of storage accounts.</p>
<h4 id="cost-sensitivity"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#cost-sensitivity">Cost sensitivity</a></h4>
<p>A storage account by itself has no financial cost; however, the settings you choose for the account do influence the cost of services in the account. Geo-redundant storage costs more than locally redundant storage. Premium performance and the Hot access tier increase the cost of blobs.</p>
<p>You can use multiple storage accounts to reduce costs. For example, you could partition your data into critical and noncritical categories. You could place your critical data into a storage account with geo-redundant storage and put your noncritical data in a different storage account with locally redundant storage.</p>
<h4 id="tolerance-for-management-overhead"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#tolerance-for-management-overhead">Tolerance for management overhead</a></h4>
<p>Each storage account requires some time and attention from an administrator to create and maintain. It also increases complexity for anyone who adds data to your cloud storage. Everyone in an administrator role needs to understand the purpose of each storage account so they add new data to the correct account.</p>
<p>Storage accounts are powerful tools to help you obtain the performance and security you need while minimizing costs. A typical strategy is to start with an analysis of your data. Create partitions that share characteristics like location, billing, and replication strategy. Then, create one storage account for each partition.</p>
<h2 id="choose-your-account-settings"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#choose-your-account-settings">Choose your account settings</a></h2>
<p>The storage account settings that we covered in the previous unit apply to the data services in the account. Here, we discuss the three settings that apply to the account itself, rather than to the data stored in the account:</p>
<ul>
<li>Name</li>
<li>Deployment model</li>
<li>Account kind</li>
</ul>
<p>These settings affect how you manage your account and the cost of the services within it.</p>
<h3 id="name"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#name">Name</a></h3>
<p>Each storage account has a name. The name must be globally unique within Azure, use only lowercase letters and digits, and be between 3 and 24 characters.</p>
<h3 id="deployment-model"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#deployment-model">Deployment model</a></h3>
<p>A <em>deployment model</em> is the system Azure uses to organize your resources. The model defines the API that you use to create, configure, and manage those resources. Azure provides two deployment models, <em>Resource Manager</em> and <em>Classic</em>. Resource Manager is the current model that uses the Azure Resource Manager API. The Classic model, <a href="https://azure.microsoft.com/updates/cloud-services-classic-retirement-announcement-feb2024">which is currently being retired</a>, was a legacy offering that used the classic deployment model.</p>
<p>Most Azure resources only work with Resource Manager, which makes it easy to decide which model to choose. However, storage accounts, virtual machines, and virtual networks support both, so you must choose one or the other when you create your storage account.</p>
<p>The key feature difference between the two models is their support for grouping. The Resource Manager model adds the concept of a <em>resource group</em>, which isn't available in the classic model. A resource group lets you deploy and manage a collection of resources as a single unit.</p>
<p>Microsoft recommends that you use the <strong>Resource Manager</strong> deployment model for all new resources.</p>
<h3 id="account-kind"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#account-kind">Account kind</a></h3>
<p>Storage account <em>kind</em> is a set of policies that determine which data services you can include in the account and the pricing of those services. There are four kinds of storage accounts:</p>
<ul>
<li><strong>Standard - StorageV2 (general purpose v2)</strong>: the current offering that supports all storage types and all of the latest features.</li>
<li><strong>Premium - Page blobs</strong>: Premium storage account type for page blobs only.</li>
<li><strong>Premium - Block blobs</strong>: Premium storage account type for block blobs and append blobs.</li>
<li><strong>Premium - File shares</strong>: Premium storage account type for file shares only.</li>
</ul>
<p>Microsoft recommends that you use the <strong>Standard - StorageV2 (general purpose v2)</strong> option for new storage accounts.</p>
<p>The core advice is to choose the <strong>Resource Manager</strong> deployment model and the <strong>Standard - StorageV2 (general purpose v2)</strong> account kind for all your storage accounts. For new resources, there are few reasons to consider the other choices.</p>
<h2 id="choose-an-account-creation-tool"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#choose-an-account-creation-tool">Choose an account creation tool</a></h2>
<p>There are several tools that create a storage account. Your choice is typically based on if you want a GUI and whether you need automation.</p>
<h3 id="available-tools"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#available-tools">Available tools</a></h3>
<p>The available tools are:</p>
<ul>
<li>Azure portal</li>
<li>Azure CLI (Command-line interface)</li>
<li>Azure PowerShell</li>
<li>Management client libraries</li>
</ul>
<p>The Azure portal provides a GUI with explanations for each setting, which makes it easy to use and helpful for learning about the options.</p>
<p>The other tools in this list all support automation. The Azure CLI and Azure PowerShell let you write scripts, while the management libraries allow you to incorporate the creation into a client app.</p>
<h3 id="how-to-choose-a-tool"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#how-to-choose-a-tool">How to choose a tool</a></h3>
<p>Storage accounts are typically based on an analysis of your data, so they tend to be relatively stable. As a result, storage-account creation is usually a one-time operation done at the start of a project. For one-time activities, the portal is the most common choice.</p>
<p>In the rare cases where you need automation, the decision is between a programmatic API or a scripting solution. Scripts are typically faster to create and less work to maintain because there's no need for an IDE, NuGet packages, or build steps. If you have an existing client application, the management libraries might be an attractive choice; otherwise, scripts are a better option.</p>
<h2 id="exercise-create-a-storage-account-using-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#exercise-create-a-storage-account-using-the-azure-portal">Exercise - Create a storage account using the Azure portal</a></h2>
<h3 id="verify-your-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#verify-your-account">Verify your account</a></h3>
<p>In this unit, you use the Azure portal to create a storage account for a fictitious southern California surf report web app. The surf report site lets users upload photos and videos of local beach conditions. Viewers of the site use the content to help them choose the beach with the best surfing conditions.</p>
<p>Your list of design and feature goals is:</p>
<ul>
<li>Video content must load quickly.</li>
<li>The site must handle unexpected spikes in upload volume.</li>
<li>Outdated content must be removed as surf conditions change so the site always shows current conditions.</li>
</ul>
<p>You decide to buffer uploaded content in an Azure Queue for processing and then transfer it to an Azure Blob for persistent storage. You need a storage account that can hold both queues and blobs while delivering low-latency access to your content.</p>
<h3 id="create-a-storage-account-using-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#create-a-storage-account-using-azure-portal">Create a storage account using Azure portal</a></h3>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> using the same account you used to activate the sandbox.</p>
</li>
<li>
<p>On the resource menu, or from the <strong>Home</strong> page, select <strong>Storage accounts</strong>. The <strong>Storage accounts</strong> pane appears.</p>
</li>
<li>
<p>On the command bar, select <strong>Create.</strong> The <strong>Create a storage account</strong> pane appears.</p>
</li>
<li>
<p>On the <strong>Basics</strong> tab, enter the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Project details</strong></td>
<td></td>
</tr>
<tr>
<td>Subscription</td>
<td>Concierge Subscription</td>
</tr>
<tr>
<td>Resource group</td>
<td>[sandbox resource group name] from the dropdown list.</td>
</tr>
<tr>
<td><strong>Instance details</strong></td>
<td></td>
</tr>
<tr>
<td>Storage account name</td>
<td>Enter a unique name. This name is used to generate the public URL to access the data in the account. The name must be unique across all existing storage account names in Azure. Names must have 3 to 24 characters and can contain only lowercase letters and numbers.</td>
</tr>
<tr>
<td>Region</td>
<td>Select a location near to you from the dropdown list.</td>
</tr>
<tr>
<td>Performance</td>
<td><em>Standard</em>. This option decides the type of disk storage used to hold the data in the Storage account. Standard uses traditional hard disks, and Premium uses solid-state drives (SSD) for faster access.</td>
</tr>
<tr>
<td>Redundancy</td>
<td>Select <em>Locally redundant storage (LRS)</em> from the dropdown list. In our case, the images and videos quickly become out-of-date and are removed from the site. As a result, there's little value to paying extra for <em>Geo-redundant storage (GRS)</em>. If a catastrophic event results in data loss, you can restart the site with fresh content from your users.</td>
</tr>
</tbody>
</table>
<ol>
<li>Select <strong>Next</strong>. On the <strong>Advanced</strong> tab, enter the following values for each setting.</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Security</strong></td>
<td></td>
</tr>
<tr>
<td>Require secure transfer for REST API operations</td>
<td><em>Check</em>. This setting controls whether <strong>HTTP</strong> can be used for the REST APIs that access data in the storage account. Setting this option to <em>enable</em> forces all clients to use <strong>HTTPS</strong>. Most of the time, you want to set secure transfer to <em>enable</em>; using HTTPS over the network is considered a best practice.</td>
</tr>
<tr>
<td>Allow enabling anonymous access on individual containers</td>
<td><em>Check</em>. Blob containers, by default, don't permit anonymous access to their content. This setting allows authorized users to selectively enable anonymous access on specific containers.</td>
</tr>
<tr>
<td>Enable storage account key access</td>
<td><em>Check</em>. We want to allow clients to access data via SAS.</td>
</tr>
<tr>
<td>Default to Microsoft Entra authorization in the Azure portal</td>
<td><em>Uncheck</em>. Clients are public, not part of an Active Directory.</td>
</tr>
<tr>
<td>Minimum TLS version</td>
<td>Select <em>Version 1.2</em> from dropdown list. TLS 1.2 is a secure version of TLS, and Azure Storage uses it on public HTTPS endpoints. TLS 1.1 and 1.0 are supported for backwards compatibility. See <em>Warning</em> at end of table.</td>
</tr>
<tr>
<td>Permitted scope for copy operations</td>
<td>Accept default</td>
</tr>
<tr>
<td><strong>Hierarchical Namespace</strong></td>
<td></td>
</tr>
<tr>
<td>Enable hierarchical namespace</td>
<td><em>Uncheck</em>. Data Lake hierarchical namespace is for big-data applications that aren't relevant to this module.</td>
</tr>
<tr>
<td><strong>Access protocols</strong></td>
<td></td>
</tr>
<tr>
<td>Enable SFTP</td>
<td>Accept default.</td>
</tr>
<tr>
<td>Enable network file system v3</td>
<td>Accept default.</td>
</tr>
<tr>
<td><strong>Blob storage</strong></td>
<td></td>
</tr>
<tr>
<td>Allow cross-tenant replication</td>
<td><em>Uncheck</em>. Active Directory isn't being used for this exercise.</td>
</tr>
<tr>
<td>Access tier</td>
<td><em>Hot</em>. This setting is only used for Blob storage. The <em>Hot</em> access tier is ideal for frequently accessed data; the <em>Cool</em> access tier is better for infrequently accessed data. This setting only sets the <em>default</em> value. When you create a Blob, you can set a different value for the data. In our case, we want the videos to load quickly, so we use the high-performance option for our blobs.</td>
</tr>
<tr>
<td><strong>Azure Files</strong></td>
<td></td>
</tr>
<tr>
<td>Enable large file shares</td>
<td>Accept default. Large file shares provide support up to a 100 TiB, however this type of storage account can't convert to a Geo-redundant storage offering, and upgrades are permanent.</td>
</tr>
</tbody>
</table>
<pre><code> Warning

If _Enable large file shares_ is selected, it will enforce additional restrictions, and Azure files service connections without encryption will fail, including scenarios using SMB 2.1 or 3.0 on Linux. Because Azure storage doesn't support SSL for custom domain names, this option cannot be used with a custom domain name.
</code></pre>
<ol>
<li>
<p>Select <strong>Next</strong>. On the <strong>Networking</strong> tab, enter the following values for each setting.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Network connectivity</strong></td>
<td></td>
</tr>
<tr>
<td>Network access</td>
<td><em>Enable public access from all networks</em>. We want to allow public Internet access. Our content is public facing, and we need to allow access from public clients.</td>
</tr>
<tr>
<td><strong>Network routing</strong></td>
<td></td>
</tr>
<tr>
<td>Routing preference</td>
<td><em>Microsoft network routing</em>. We want to make use of the Microsoft global network that is optimized for low-latency path selection.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Select <strong>Next</strong>. On the <strong>Data protection</strong> tab, enter the following values for each setting.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Recovery</strong></td>
<td></td>
</tr>
<tr>
<td>Enable point-in-time restore for containers</td>
<td><em>Uncheck</em>. Not necessary for this implementation.</td>
</tr>
<tr>
<td>Enable soft delete for blobs</td>
<td><em>Uncheck</em>. Soft delete lets you recover blob data in cases where blobs or blob snapshots are deleted accidentally or overwritten.</td>
</tr>
<tr>
<td>Enable soft delete for containers</td>
<td><em>Uncheck</em>. Soft delete lets you recover your containers that are deleted accidentally.</td>
</tr>
<tr>
<td>Enable soft delete for file shares</td>
<td><em>Uncheck</em>. File share soft delete lets you recover your accidentally deleted file share data more easily.</td>
</tr>
<tr>
<td><strong>Tracking</strong></td>
<td></td>
</tr>
<tr>
<td>Enable versioning for blobs</td>
<td><em>Uncheck</em>. Not necessary for this implementation.</td>
</tr>
<tr>
<td>Enable blob change feed</td>
<td><em>Uncheck</em>. Not necessary for this implementation.</td>
</tr>
<tr>
<td><strong>Access control</strong></td>
<td></td>
</tr>
<tr>
<td>Enable version-level immutability support</td>
<td><em>Uncheck</em>. Not necessary for this implementation.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Select <strong>Next</strong>. Accept the defaults on the <strong>Encryption</strong> tab.</p>
</li>
<li>
<p>Select <strong>Next</strong>. Here on the <strong>Tags</strong> tab, you can associate key/value pairs with the account for your categorization to determine if a feature is available to selected Azure resources.</p>
</li>
<li>
<p>Select <strong>Next</strong> to validate your options and to ensure all the required fields are selected. If there are issues, this tab identifies them so you can correct them.</p>
</li>
<li>
<p>When validation passes successfully, select <strong>Create</strong> to deploy the storage account.</p>
</li>
<li>
<p>When deployment is complete, which can take up to two minutes, select <strong>Go to resource</strong>. View the details about your new storage account in the <strong>Essentials</strong> section.</p>
</li>
</ol>
<p>You created a storage account with settings driven by your business requirements. For example, you might select a West US datacenter because your customers are primarily located in southern California. The typical flow for creating a storage account is: first analyze your data and goals, and then configure the storage account options to match.</p>
<hr />
<h2 id="upload-download-and-manage-data-with-azure-storage-explorer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#upload-download-and-manage-data-with-azure-storage-explorer">Upload, download, and manage data with Azure Storage Explorer</a></h2>
<h2 id="introduction_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#introduction_5">Introduction</a></h2>
<p>Azure Storage Explorer makes it easy to access and edit data in Azure.</p>
<p>Suppose you work for an enterprise that has developed a customer relationship management (CRM) application. The application writes data to Azure Data Lake Storage. Your software engineers occasionally need to view stored data, upload new data, and administer these storage services. They'd like to have a user-friendly tool for these activities.</p>
<p>In this module, you'll learn about the features of Azure Storage Explorer, how to install it, and what it can connect to. Finally, you'll use Storage Explorer to connect to Data Lake Storage to create a database and upload data.</p>
<p>By the end of this module, you'll know how to use Storage Explorer to manipulate data in multiple Azure services.</p>
<h3 id="learning-objectives_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#learning-objectives_5">Learning objectives</a></h3>
<ul>
<li>Identify the features of Azure Storage Explorer</li>
<li>Install Storage Explorer</li>
<li>Use Storage Explorer to connect to Azure Storage services and manipulate stored data</li>
</ul>
<h3 id="prerequisites_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#prerequisites_2">Prerequisites</a></h3>
<ul>
<li>Basic knowledge of Azure Storage and Azure Data Lake Storage</li>
<li>Ability to install software locally</li>
</ul>
<h2 id="connect-azure-storage-explorer-to-a-storage-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#connect-azure-storage-explorer-to-a-storage-account">Connect Azure Storage Explorer to a storage account</a></h2>
<p>Storage accounts provide a flexible solution that keeps data as files, tables, and messages. With Azure Storage Explorer, it's easy to read and manipulate this data.</p>
<p>You want to enable your engineers to manage the data stored in Azure Storage so they can maintain the data that your CRM application uses. You want to assess whether they can use Storage Explorer for this purpose.</p>
<p>Here, you'll learn about Storage Explorer and how you can use it to manage data from multiple storage accounts and subscriptions. You'll learn different ways of using Storage Explorer to connect to your data, Azure Stack, and data held in Azure Data Lake Storage.</p>
<h3 id="what-is-storage-explorer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#what-is-storage-explorer">What is Storage Explorer?</a></h3>
<p>Storage Explorer is a GUI application that Microsoft developed to simplify accessing and managing data stored in Azure Storage accounts. Storage Explorer is available on Windows, macOS, and Linux.</p>
<p>Some of the benefits of using Storage Explorer are:</p>
<ul>
<li>It's easy to connect to and manage multiple storage accounts.</li>
<li>The interface lets you connect to Data Lake Storage.</li>
<li>You can also use the interface to update and view entities in your storage accounts.</li>
<li>Storage Explorer is free to download and use.</li>
</ul>
<p>With Storage Explorer, you can use a range of storage and data-operation tasks on any of your Azure Storage accounts. These tasks include edit, download, copy, and delete.</p>
<h4 id="supported-software-versions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#supported-software-versions">Supported software versions</a></h4>
<p>The latest version of the Azure Storage Explorer application runs on the following versions of these platforms:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Operating system</th>
<th>Versions</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows</td>
<td>Windows 11 and Windows 10</td>
</tr>
<tr>
<td>macOS</td>
<td>macOS 10.15 Catalina and later</td>
</tr>
<tr>
<td>Linux</td>
<td>Ubuntu 20.04 x64, Ubuntu 18.04 x64, or Ubuntu 16.04 x64</td>
</tr>
</tbody>
</table>
<h4 id="azure-storage-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#azure-storage-types">Azure Storage types</a></h4>
<p>Azure Storage Explorer can access many different data types from services like these:</p>
<ul>
<li><strong>Azure Blob Storage</strong>: Blob storage is used to store unstructured data as a binary large object (blob).</li>
<li><strong>Azure Table Storage</strong>: Table storage is used to store NoSQL, semi-structured data.</li>
<li><strong>Azure Queue Storage</strong>: Queue storage is used to store messages in a queue, which applications can then access and process through HTTP(S) calls.</li>
<li><strong>Azure Files</strong>: Azure Files is a file-sharing service that enables access through the Server Message Block protocol, similar to traditional file servers.</li>
<li><strong>Azure Data Lake Storage</strong>: Azure Data Lake, based on Apache Hadoop, is designed for large data volumes and can store unstructured and structured data. Azure Data Lake Storage Gen2 is Azure Blob Storage with the hierarchical namespace feature enabled on the account.</li>
</ul>
<h4 id="manage-multiple-storage-accounts-in-multiple-subscriptions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#manage-multiple-storage-accounts-in-multiple-subscriptions">Manage multiple storage accounts in multiple subscriptions</a></h4>
<p>If you have multiple storage accounts across multiple subscriptions in your Azure tenant, managing them through the Azure portal can be time consuming. Storage Explorer lets you manage the data stored in multiple Azure Storage accounts and across Azure subscriptions.</p>
<h4 id="use-local-emulators"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#use-local-emulators">Use local emulators</a></h4>
<p>During the development phase of your project, you might not want developers to incur additional costs by using Azure Storage accounts. In those cases, you can use a locally based emulator. Storage Explorer supports two emulators: Azure Storage Emulator and Azurite.</p>
<ul>
<li>Azure Storage Emulator uses a local instance of Microsoft SQL Server 2012 Express LocalDB. It emulates Azure Table, Queue, and Blob storage.</li>
<li>Azurite, which is based on Node.js, is an open-source emulator that supports most Azure Storage commands through an API.</li>
</ul>
<p>Storage Explorer requires the emulator to be running before you open it. Connecting to your emulator is no different than connecting to Azure Storage accounts, except that you'll choose the <strong>Attach to a local emulator</strong> connection type.</p>
<p>All locally emulated storage connection types appear in <strong>Local &amp; Attached</strong> &gt; <strong>Storage accounts</strong>.</p>
<h3 id="connecting-storage-explorer-to-azure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#connecting-storage-explorer-to-azure">Connecting Storage Explorer to Azure</a></h3>
<p>There are several ways to connect your Storage Explorer application to your Azure Storage accounts.</p>
<p>You need two permissions to access your Azure Storage account: management and data. However, you can use Storage Explorer with only the data-layer permission. The data layer requires the user to be granted, at a minimum, a read data role. The nature of the read/write role should be specific to the type of data stored in the storage account. The data layer is used to access blobs, containers, and other data resources.</p>
<p>The management role grants access to view lists of your various storage accounts, containers, and service endpoints.</p>
<h4 id="connection-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#connection-types">Connection types</a></h4>
<p>There are many ways to connect an Azure Storage Explorer instance to your Azure resources. For example:</p>
<ul>
<li>Add resources by using Microsoft Entra ID</li>
<li>Use a connection string</li>
<li>Use a shared access signature URI</li>
<li>Use a name and key</li>
<li>Attach to a local emulator</li>
<li>Attach to Azure Data Lake Storage by using a URI</li>
</ul>
<p>We'll explore a few of these connection types and provide an overview of the required steps to set up the connection.</p>
<h4 id="add-an-azure-account-by-using-microsoft-entra-id"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#add-an-azure-account-by-using-microsoft-entra-id">Add an Azure account by using Microsoft Entra ID</a></h4>
<p>Use this connection type when the user can access the data layer. You can use it only to create a container. Connecting to Azure Storage through Microsoft Entra ID requires more configuration than the other methods. The account that you use to connect to Azure must have the correct permissions and authorization to access the target resources.</p>
<p>To add a resource by using Microsoft Entra ID:</p>
<ol>
<li>Open Storage Explorer.</li>
<li>Select the <strong>Sign in with Azure</strong> option and sign in to Azure.</li>
<li>Connect to your Azure Storage account.</li>
<li>Select <strong>Add a resource via Microsoft Entra ID</strong>, and then choose the Azure tenant and the associated account.</li>
<li>When you're prompted, provide the type of resource that you're connecting to.</li>
<li>Review and verify the connection details, and then select <strong>Connect</strong>.</li>
</ol>
<p>It's crucial to select the correct resource type because it changes the information that you need to enter.</p>
<p>Any connections that you create through this approach will appear in the resource tree, in this branch: <strong>Local &amp; attached</strong> &gt; <strong>Storage Accounts</strong> &gt; <strong>Attached Containers</strong> &gt; <strong>Blob</strong>.</p>
<h4 id="connect-by-using-a-shared-access-signature-uri"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#connect-by-using-a-shared-access-signature-uri">Connect by using a shared access signature URI</a></h4>
<p>A shared access signature (SAS) URI is an unambiguous identifier that's used to access your Azure Storage resources.</p>
<p>With this connection method, you'll use a SAS URI for the required storage account. You'll need a SAS URI whether you want to use a file share, table, queue, or blob container. You can get a SAS URI either from the Azure portal or from Storage Explorer. For more information, see <a href="https://learn.microsoft.com/en-us/rest/api/storageservices/create-account-sas?redirectedfrom=MSDN">Create an account SAS</a>.</p>
<p>To add a SAS connection:</p>
<ol>
<li>Open Storage Explorer.</li>
<li>Connect to your Azure Storage account.</li>
<li>Select the connection type: <strong>Shared access signature URI (SAS)</strong>.</li>
<li>Provide a meaningful name for the connection.</li>
<li>Provide the Service URL.</li>
<li>Review and verify the connection details, and then select <strong>Connect</strong>.</li>
</ol>
<p>When you've added a connection, it appears in the resource tree as a new node. You'll find the connection node in this branch: <strong>Local &amp; attached</strong> &gt; <strong>Storage Accounts</strong> &gt; <strong>Attached Container</strong> &gt; <strong>Service</strong>.</p>
<h4 id="connect-by-using-a-storage-account-name-and-key"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#connect-by-using-a-storage-account-name-and-key">Connect by using a storage account name and key</a></h4>
<p>To connect to a storage account on Azure quickly, you use the account key that's associated with the storage. To find the storage access keys from the Azure portal, go to the correct storage account page and select <strong>access keys</strong>.</p>
<p>To add a connection:</p>
<ol>
<li>Open Storage Explorer.</li>
<li>Connect to your Azure Storage account.</li>
<li>Select the connection type: <strong>Storage account name and key</strong>.</li>
<li>Provide a meaningful name for the connection.</li>
<li>When you're prompted, provide the name of the storage account and either of the account keys needed to access it.</li>
<li>From the provided list, select the storage domain that you want to use.</li>
<li>Review and verify the connection details, and then select <strong>Connect</strong>.</li>
</ol>
<p>When the connection is added, it appears in the resource tree as a connection node. The connection node is in this branch: <strong>Local &amp; attached</strong> &gt; <strong>Storage Accounts</strong>.</p>
<h2 id="exercise-connect-azure-storage-explorer-to-a-storage-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#exercise-connect-azure-storage-explorer-to-a-storage-account">Exercise - Connect Azure Storage Explorer to a storage account</a></h2>
<p>It's easy to browse through the contents of an Azure Storage account by using Azure Storage Explorer.</p>
<p>Now that you have a better understanding of the features and capabilities of Storage Explorer, you can try it for yourself. Use Storage Explorer to explore some of the files that your CRM system stores in Azure Storage.</p>
<p>Here, you'll try Storage Explorer by downloading, installing, and connecting to an Azure Storage account. You'll create a blob and a queue in your storage account.</p>
<h3 id="download-and-install-azure-storage-explorer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#download-and-install-azure-storage-explorer">Download and install Azure Storage Explorer</a></h3>
<p>First, you need to download and install Storage Explorer.</p>
<ol>
<li>
<p>Browse to the <a href="https://azure.microsoft.com/products/storage/storage-explorer/?azure-sandbox=true">Azure Storage Explorer website</a>.</p>
</li>
<li>
<p>Select <strong>Download now</strong>, then select your preferred operating system. The following steps will go through the Windows version of the application. Your steps will be different if you're using a different OS.</p>
</li>
<li>
<p>Locate the downloaded file and run it. For the Windows version, use the <strong>StorageExplorer.exe</strong> file.</p>
</li>
<li>
<p>Accept the license agreement and select <strong>Install</strong>.</p>
</li>
<li>
<p>Browse to the location where you want to install Storage Explorer or accept the default location. Select <strong>Next</strong>.</p>
</li>
<li>
<p>For Windows installations, select the <strong>Start menu</strong> folder. Accept the default and select <strong>Next</strong>.</p>
</li>
<li>
<p>When the installation is complete, select <strong>Finish</strong>.</p>
</li>
</ol>
<p>Storage Explorer automatically opens after installation.</p>
<h3 id="connect-to-an-azure-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#connect-to-an-azure-account">Connect to an Azure account</a></h3>
<p>When you first open Storage Explorer, it displays the <strong>Connect to Azure Storage</strong> wizard.</p>
<ol>
<li>
<p>First, select <strong>Connect to Azure resources</strong>, and then choose <strong>Subscription</strong>.</p>
<p><img alt="Screenshot that shows the Select resource screen in the Azure Storage wizard." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/3-connect-resource.png" /></p>
</li>
<li>
<p>There are several <strong>Azure environment</strong> options to select from. Select <strong>Azure</strong>, then select <strong>Next</strong>.</p>
<p><img alt="Screenshot that shows the Select Azure environment screen in the Connect to Azure Storage wizard." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/3-storage-explorer-connect.png" /></p>
</li>
<li>
<p>Your browser opens and an Azure sign-in page appears. Use your Azure credentials to sign in.</p>
<p><img alt="Screenshot that shows the Azure sign-in page." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/3-storage-explorer-azure-sign-in.png" /></p>
</li>
<li>
<p>When you've signed in to your Azure instance, the associated Azure account and Azure subscription appear in the <strong>Account Management</strong> section.</p>
<p><img alt="Screenshot that shows the account management panel after signing in to an Azure account." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/3-account-panel-subscriptions-apply.png" /></p>
<p>Confirm that the <strong>Concierge Subscription</strong> subscription is selected and account details are correct, and then select <strong>Open Explorer</strong>.</p>
</li>
</ol>
<p>You've now connected Storage Explorer to your Azure subscription. Leave Storage Explorer open while you work through the next steps.</p>
<h3 id="create-a-storage-account-and-add-a-blob"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#create-a-storage-account-and-add-a-blob">Create a storage account and add a blob</a></h3>
<ol>
<li>
<p>In Azure Cloud Shell, run the following command to create a storage account.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az storage account create \
--name mslearn$RANDOM \
--resource-group &quot;[sandbox resource group name]&quot; \
--sku Standard_GRS \
--kind StorageV2
</code></pre></div>
<p>In the output, note the name of the storage account. After the storage account is created, switch back to Storage Explorer.</p>
</li>
<li>
<p>If it isn't currently visible, toggle the <strong>EXPLORER</strong> view so that the pane is shown.</p>
</li>
<li>
<p>In the <strong>EXPLORER</strong> pane, select <strong>Refresh All</strong>, then locate and expand <strong>Concierge Subscription</strong>.</p>
<p><img alt="Screenshot that shows the expansion of Concierge Subscription." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/3-storage-explorer-create-blob-1.png" /></p>
</li>
<li>
<p>Locate and expand the storage account that you created earlier. It should be named something similar to <strong>mslearn12345</strong>, ending with a different set of numbers. It has four virtual folders: <strong>Blob Containers</strong>, <strong>File Shares</strong>, <strong>Queues</strong>, and <strong>Tables</strong>.</p>
<p>Note</p>
<p>If the storage account you created earlier isn't listed, wait a few moments and select <strong>Refresh All</strong>; it can take a couple of minutes for the account to appear.</p>
</li>
<li>
<p>Right-click the <strong>Blob Containers</strong> virtual folder to access the shortcut menu, then select <strong>Create Blob Container</strong>.</p>
<p><img alt="Screenshot that shows the shortcut menu options for the Blob Containers folder." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/3-storage-explorer-create-blob-context-menu.png" /></p>
</li>
<li>
<p>Name the container <strong>myblobcontainer</strong> and press Enter.</p>
<p>Each created container appears in a tab to the right of the resource tree.</p>
<p><img alt="Screenshot that shows the content and details of the new myblobcontainer blob container." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/3-storage-explorer-create-blob-view.png" /></p>
</li>
<li>
<p>Upload a blob to the container. In the <strong>myblobcontainer</strong> pane, select <strong>Upload</strong>, then select <strong>Upload Files</strong>. The <strong>Upload Files</strong> dialog box appears.</p>
</li>
<li>
<p>For <strong>Selected files</strong>, select the ellipsis (<strong>...</strong>). Browse to a small file on your device and select <strong>Open</strong>. Select <strong>Upload</strong> to upload the file.</p>
<p><img alt="Screenshot that shows the Upload Files dialog box." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/3-upload-blob.png" /></p>
<p>You should now see your file stored in your storage account.</p>
<p><img alt="Screenshot that shows the file in the storage account." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/3-upload-blob-complete.png" /></p>
</li>
</ol>
<p>From here, you can upload additional files, download files, make copies, and do other administrative tasks.</p>
<h3 id="create-a-queue-in-your-azure-storage-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#create-a-queue-in-your-azure-storage-account">Create a queue in your Azure Storage account</a></h3>
<p>To create a queue in your storage account:</p>
<ol>
<li>
<p>In the resource tree, find <strong>Concierge Subscription</strong> and expand the options.</p>
</li>
<li>
<p>Expand the <strong>cloudshell</strong> storage account.</p>
</li>
<li>
<p>Right-click the <strong>Queues</strong> virtual folder to access the shortcut menu, then select <strong>Create Queue</strong>.</p>
</li>
<li>
<p>An empty and unnamed queue is created inside the <strong>Queues</strong> folder. The queue won't be created until you give it a name.</p>
<p>Note</p>
<p>Containers have specific rules that govern how they can be named. They must begin and end with either a letter or a number, must be all lowercase, and can have numbers and hyphens. The name can't contain a double hyphen.</p>
<p>Name this new queue <strong>myqueue</strong> and press Enter to create the queue. Each created queue appears on a tab to the right of the resource tree.</p>
<p><img alt="Screenshot that shows the content and details of the new myblob blob container." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/3-storage-explorer-create-queue-view.png" /></p>
<p>From this view, you can manage the queue's content. If our application used this queue and experienced an issue with processing a message, you could connect to the queue and view the message contents to determine the issue.</p>
</li>
</ol>
<h2 id="connect-azure-storage-explorer-to-azure-data-lake-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#connect-azure-storage-explorer-to-azure-data-lake-storage">Connect Azure Storage Explorer to Azure Data Lake Storage</a></h2>
<p>Azure Storage Explorer doesn't just access Azure Storage. It can also access data in Azure Data Lake Storage.</p>
<h3 id="use-storage-explorer-to-manage-data-lake-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#use-storage-explorer-to-manage-data-lake-storage">Use Storage Explorer to manage Data Lake Storage</a></h3>
<p>You've worked through the basics of connecting Storage Explorer to your Azure account. In the CRM system, your developers use Data Lake Storage for big-data storage. You want to use Storage Explorer to connect to it.</p>
<p>Azure Data Lake Storage is used for storing and analyzing large data sets. It supports large data workloads. It's well suited to capture data of any type or size, and at any speed. Data Lake Storage features all the expected enterprise-grade capabilities like security, scalability, reliability, manageability, and availability.</p>
<p>There are two types of Azure Data Lake Storage: Gen1 and Gen2. Azure Data Lake Storage Gen1 has been retired; follow the <a href="https://azure.microsoft.com/updates/action-required-switch-to-azure-data-lake-storage-gen2-by-29-february-2024/">Azure Data Lake Storage Gen1 migration guidance</a> for existing Gen1 accounts.</p>
<p>You can use Storage Explorer to connect to Data Lake accounts. Just like with storage accounts, you can use Storage Explorer to:</p>
<ul>
<li>Create, delete, and manage containers.</li>
<li>Upload, manage, and administer blobs.</li>
</ul>
<p>Let's create Azure Data Lake Storage, then use Storage Explorer to connect to it.</p>
<h2 id="exercise-connect-azure-storage-explorer-to-azure-data-lake-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#exercise-connect-azure-storage-explorer-to-azure-data-lake-storage">Exercise - Connect Azure Storage Explorer to Azure Data Lake Storage</a></h2>
<p>Azure Storage Explorer isn't just about storage accounts. You can also use it to investigate and download data from Azure Data Lake Storage.</p>
<p>You've learned how simple creating and managing blob and queue resources in your Azure Storage account is. Now you want to push your understanding further and learn how the storage account connects to your developers' data lake, which they use to store infrastructure data for the CRM system.</p>
<p>Azure Data Lake Storage Gen2 isn't a dedicated service or account type. It's a set of capabilities that you unlock by enabling the hierarchical namespace feature of an Azure Storage account.</p>
<p>Here, you'll learn how to use Storage Explorer to connect to Azure Data Lake Storage Gen2, create a container, and upload data into it.</p>
<h3 id="create-a-storage-account-with-azure-data-lake-storage-gen2-capabilities"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#create-a-storage-account-with-azure-data-lake-storage-gen2-capabilities">Create a storage account with Azure Data Lake Storage Gen2 capabilities</a></h3>
<p>Let's look at connecting to a Data Lake Storage Gen2-enabled account. Before you can use Storage Explorer to manage your Data Lake Storage Gen2-enabled account, you need to create the storage account in Azure.</p>
<p>To create the storage account, use the <strong>az storage account create</strong> command:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az storage account create \
    --name dlstoragetest$RANDOM \
    --resource-group [Sandbox resource group] \
    --location westus2 \
    --sku Standard_LRS \
    --kind StorageV2 \
    --hns
</code></pre></div>
<p>Note</p>
<p>Please give the storage account several minutes to complete.</p>
<h3 id="connect-to-your-data-lake-gen2-enabled-storage-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#connect-to-your-data-lake-gen2-enabled-storage-account">Connect to your Data Lake Gen2 enabled storage account</a></h3>
<p>Now that you've created a Gen2-enabled storage account, Storage Explorer should automatically connect to it.</p>
<ol>
<li>
<p>In Storage Explorer, in the <strong>EXPLORER</strong> pane, locate <strong>Concierge Subscription</strong> and expand it to show all the storage accounts.</p>
<p>Note</p>
<p>It might take several minutes for the storage account to display in Storage Explorer. If you don't see the storage account, wait a few moments and select <strong>Refresh all</strong>.</p>
</li>
<li>
<p>You'll see the <strong>dlstoragetest001 (ADLS Gen2)</strong> storage account displayed under the storage accounts. Your account will have a different number suffix.</p>
<p><img alt="Screenshot that shows the Azure Data Lake Storage Gen2 account." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/5-azure-data-lake-gen2-storage-account.png" /></p>
</li>
</ol>
<h4 id="create-a-container"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#create-a-container">Create a container</a></h4>
<p>All containers in a Data Lake Gen2-enabled storage account are blobs. To create a new container:</p>
<ol>
<li>
<p>Expand the <strong>dlstoragetest001</strong> storage account, right-click <strong>Blob Containers</strong>, and select <strong>Create Blob Container</strong> from the shortcut menu.</p>
<p><img alt="Screenshot that shows the shortcut menu for adding a container." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/5-data-lake-create-blob-container.png" /></p>
</li>
<li>
<p>Name the new container <strong>myfilesystem</strong>.</p>
</li>
<li>
<p>When the container is created, the pane for the container appears. There, you can manage the container contents.</p>
<p><img alt="Screenshot that shows the myfilesystem control ribbon and view." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/5-data-lake-create-blob-container-view.png" /></p>
</li>
</ol>
<h4 id="upload-and-view-blob-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#upload-and-view-blob-data">Upload and view blob data</a></h4>
<p>With the new <strong>myfilesystem</strong> container created, you can now upload files or folders to it.</p>
<ol>
<li>
<p>To upload a file, select the <strong>Upload</strong> option, then select <strong>Upload Files</strong>.</p>
<p><img alt="Screenshot that shows the upload options." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/5-data-lake-container-upload-options.png" /></p>
</li>
<li>
<p>In the dialog box, use the ellipsis (<strong>...</strong>) to select the file that you want to upload.</p>
</li>
<li>
<p>Select the file you want to upload, then select <strong>Open</strong>.</p>
</li>
<li>
<p>Select the <strong>Upload</strong> button.</p>
</li>
<li>
<p>The file is available to the <strong>myfilesystem</strong> container.</p>
<p><img alt="Screenshot that shows the uploaded file." src="https://learn.microsoft.com/en-us/training/modules/upload-download-and-manage-data-with-azure-storage-explorer/media/5-data-lake-file-uploaded.png" /></p>
</li>
</ol>
<p>You can upload as many files as you want to this folder. Also, you can create an unlimited number of folders. You can then organize and manage the content in your folders as you do with your file system.</p>
<hr />
<p>in addition but unknown</p>
<h2 id="choose-a-data-storage-approach-in-azure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#choose-a-data-storage-approach-in-azure">Choose a data storage approach in Azure</a></h2>
<h2 id="introduction_6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#introduction_6">Introduction</a></h2>
<p>Data comes in different shapes and sizes. No single storage solution fits all data. For example, an online retail website has multiple, distinct datasets that are all used to run the business. Datasets include product catalog data, media files like photos and videos, and financial business data. Each dataset has different requirements. It's your job to figure out which storage solution is best. The key factors to consider in deciding on the optimal storage solution are how to classify your data, how your data will be used, and how you can get the best performance for your application.</p>
<h3 id="learning-objectives_6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#learning-objectives_6">Learning objectives</a></h3>
<p>In this module, you will:</p>
<ul>
<li>Classify your data as structured, semi-structured, or unstructured.</li>
<li>Determine how your data will be used.</li>
<li>Determine whether your data requires transactions.</li>
</ul>
<h2 id="classify-your-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#classify-your-data">Classify your data</a></h2>
<p>An online retail business has different types of data. Each type of data might benefit from a different storage solution.</p>
<p>Application data can be classified in one of three ways: structured, semi-structured, and unstructured. Here, you'll learn how to classify your data so that you can choose the appropriate storage solution for the type of data.</p>
<h3 id="approaches-to-storing-data-in-the-cloud"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#approaches-to-storing-data-in-the-cloud">Approaches to storing data in the cloud</a></h3>
<p>The following video introduces your options for storing data in the cloud:  </p>
<h4 id="structured-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#structured-data">Structured data</a></h4>
<p>In structured data, sometimes called <em>relational data</em>, all data has the same fields or properties. All the data has the same organization and shape, or <em>schema</em>. The shared schema allows this type of data to be easily searched by using query languages like Structured Query Language (SQL). This capability makes this data style perfect for applications like CRM systems, reservations, and inventory management.</p>
<p>Structured data often is stored in database tables with rows and columns. In the table, a key column indicates how one row in a table relates to data in another row of another table. In the following image, a table that has data about grades gets data from a table of student names and a table of class data by using key columns.</p>
<p><img alt="Diagram that shows two structured data tables and a relationship table that has data that ties them together." src="https://learn.microsoft.com/en-us/training/modules/choose-storage-approach-in-azure/media/relational-database.png" /></p>
<p>Structured data is straightforward in that it's easy to enter, query, and analyze. All the data is in the same format. However, forcing a consistent structure also means that the evolution of the data is more difficult. If you add or remove data fields, you must update each record to conform to the new structure.</p>
<h4 id="semi-structured-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#semi-structured-data">Semi-structured data</a></h4>
<p>Semi-structured data is less organized than structured data. Semi-structured data isn't stored in a relational format because the fields don't fit neatly into tables, rows, and columns. Semi-structured data contains tags that make the organization and hierarchy of the data apparent. One example is key/value pairs. Semi-structured data is also referred to as non-relational or <em>not only SQL (NoSQL)</em> data.</p>
<p>A data serialization language defines semi-structured data. In data classification, <em>serialization</em> is the process of converting data into a format that can be transmitted or stored.</p>
<p>Software developers use data serialization languages to write data stored in memory to a file, which can then be sent to another system, parsed, and read. The sender and receiver don't need to know details about the other system. Both systems can understand the data if using the same serialization language.  </p>
<h4 id="common-serialization-languages"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#common-serialization-languages">Common serialization languages</a></h4>
<p>Three common serialization languages are XML, JSON, and YAML.</p>
<h5 id="xml"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#xml">XML</a></h5>
<p><em>Extensible Markup Language (XML)</em> was one of the first data languages to be widely used. XML is text-based, which makes it easily human-readable and machine-readable. XML parsers are available for almost all popular development platforms.</p>
<p>You can use XML to express relationships. XML has standards for schema, transformation, and even displaying on the web.</p>
<p>Here's an example of a person's name, age, and hobbies expressed in XML:</p>
<p>XMLCopy</p>
<div class="highlight"><pre><span></span><code>&lt;Person Age=&quot;23&quot;&gt;
    &lt;FirstName&gt;Quinn&lt;/FirstName&gt;
    &lt;LastName&gt;Anderson&lt;/LastName&gt;
    &lt;Hobbies&gt;
        &lt;Hobby Type=&quot;Sports&quot;&gt;Golf&lt;/Hobby&gt;
        &lt;Hobby Type=&quot;Leisure&quot;&gt;Reading&lt;/Hobby&gt;
        &lt;Hobby Type=&quot;Leisure&quot;&gt;Guitar&lt;/Hobby&gt;
   &lt;/Hobbies&gt;
&lt;/Person&gt;
</code></pre></div>
<p>XML expresses the shape of the data by using <em>tags</em> that are defined inside angle braces. The tags come in two forms: <em>elements</em> such as <code>&lt;FirstName&gt;</code> and <em>attributes</em> that can be expressed in text like <code>Age="23"</code>. Elements can have child elements to express relationships. For example, the <code>&lt;Hobbies&gt;</code> tag expresses a collection of <code>Hobby</code> elements.</p>
<p>XML is flexible and can express complex data easily. However, it tends to be more verbose, which makes it larger to store, process, and pass over a network. As a result, other formats have become more popular.</p>
<h5 id="json"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#json">JSON</a></h5>
<p><em>JavaScript Object Notation (JSON)</em> has a lightweight specification and uses curly braces to indicate data structure. Compared to XML, JSON is less verbose, and it's easier for humans to read. JSON frequently is used by web services to return data.</p>
<p>Here's the same person's name, age, and hobbies expressed in JSON:</p>
<p>JSONCopy</p>
<div class="highlight"><pre><span></span><code>{
    &quot;firstName&quot;: &quot;Quinn&quot;,
    &quot;lastName&quot;: &quot;Anderson&quot;,
    &quot;age&quot;: &quot;23&quot;,
    &quot;hobbies&quot;: [
        { &quot;type&quot;: &quot;Sports&quot;, &quot;value&quot;: &quot;Golf&quot; },
        { &quot;type&quot;: &quot;Leisure&quot;, &quot;value&quot;: &quot;Reading&quot; },
        { &quot;type&quot;: &quot;Leisure&quot;, &quot;value&quot;: &quot;Guitar&quot; }
    ]
}
</code></pre></div>
<p>The JSON format isn't as formal as XML. It's closer to a key/value pair model than to a formal data expression. As you might guess from the name, the JavaScript programming language has built-in support for this format, so it's popular for web development. Like XML, other languages have parsers you can use to work with this data format. The downside of JSON is that it tends to be more programmer-oriented, so it's harder for non-technical people to read and modify.</p>
<h5 id="yaml"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#yaml">YAML</a></h5>
<p><em>YAML Ain't Markup Language (YAML)</em> is a more recently developed data serialization language. One of the benefits of using YAML is that it's easier for humans to read than some other languages. Line separation and indentation define the data structure. The YAML format reduces the dependency on structural characters like parentheses, commas, and brackets.</p>
<p>Here's the same data expressed in YAML:</p>
<p>YAMLCopy</p>
<div class="highlight"><pre><span></span><code>firstName: Quinn
lastName: Anderson
age: 23
hobbies:
    - type: Sports
      value: Golf
    - type: Leisure
      value: Reading
    - type: Leisure
      value: Guitar
</code></pre></div>
<p>This format is more readable than JSON. Configuration files that people write but programs parse is a common use for it. YAML is the newest of these data formats.</p>
<p>It's often used for configuration files written by people but parsed by programs.</p>
<h4 id="what-is-semi-structured-or-nosql-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#what-is-semi-structured-or-nosql-data">What is semi-structured or NoSQL data?</a></h4>
<p>The following video describes semi-structured data and NoSQL data storage options:  </p>
<h4 id="unstructured-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#unstructured-data">Unstructured data</a></h4>
<p>The organization of unstructured data is undefined. Unstructured data is often delivered in file format, such as in photo or video files. The video file itself might have an overall structure and come with semi-structured metadata, but the data that forms the video itself is unstructured. Therefore, photos, videos, and other similar files are classified as unstructured data.</p>
<p>Examples of unstructured data include:</p>
<ul>
<li>Media files, like photos, videos, and audio files.</li>
<li>Microsoft 365 files, like Word documents.</li>
<li>Text files.</li>
<li>Log files.</li>
</ul>
<h3 id="data-classification-evaluate-your-data-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#data-classification-evaluate-your-data-types">Data classification: Evaluate your data types</a></h3>
<p>You can classify data in one of three ways: structured, semi-structured, and unstructured. Understanding the differences so that you can classify your data helps you choose the correct storage solution.</p>
<p>Structured data is organized data that neatly fits into tables or columns of data. Semi-structured data is still organized and has clear properties and values, but there's variety to the data. Unstructured data doesn't fit neatly into tables or columns, and it doesn't have a uniform schema.</p>
<p>Let's look at the datasets used in an online retail business and classify them.</p>
<h4 id="product-catalog-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#product-catalog-data">Product catalog data</a></h4>
<p>Product catalog data for an online retail business is semi-structured in nature. Each product has a product SKU, a description, a quantity, a price, size options, color options, a photo, and possibly a video. This data appears relational to begin with because it all has the same structure. However, as you introduce new products or different kinds of products, you might want to add data fields. For example, new tennis shoes you carry are Bluetooth-enabled to relay sensor data from the shoe to a fitness app on the user's phone. This feature appears to be a growing trend, and you want to give customers the option to filter on "Bluetooth-enabled" shoes. You don't want to update all your existing shoe data with a Bluetooth-enabled property. You want to add this new property only to new shoes.</p>
<p>With the addition of the Bluetooth-enabled property, your shoe data is no longer homogenous. You've introduced differences in the schema. If this change is the only exception you expect to encounter, you can normalize the existing data so that all products included a "Bluetooth-enabled" field to maintain a structured, relational organization. However, if it's just one of many specialty fields that you envision supporting in the future, the classification of the data is semi-structured. Tags organize the data, but each product in the catalog can contain unique fields.</p>
<p>The classification for product catalog data is <em>semi-structured</em>.</p>
<h4 id="photos-and-videos"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#photos-and-videos">Photos and videos</a></h4>
<p>The photos and videos displayed on product pages are unstructured data. Although the media file might contain metadata, the body of the media file is unstructured.</p>
<p>The data classification for photos and videos is <em>unstructured</em>.</p>
<h4 id="business-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#business-data">Business data</a></h4>
<p>Business analysts want to implement business intelligence to perform inventory pipeline evaluations and sales data reviews. To perform these operations, data from multiple months needs to be aggregated and then queried. Because of the need to aggregate similar data, this data must be structured, so that one month can be compared to the next.</p>
<p>The classification for business data is <em>structured</em>.</p>
<h2 id="determine-operational-needs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#determine-operational-needs">Determine operational needs</a></h2>
<p>After you've identified the kind of data you want to store (structured, semi-structured, or unstructured), the next step is to determine how you'll use the data. For example, as an online retailer, you know that customers need quick access to product data, and business users need to run complex analytical queries. As you work through these requirements, taking your data classification into account, you can begin to plan your data storage solution.</p>
<p>Here, you'll answer some questions to help you determine what to do with your data.</p>
<h3 id="operations-and-latency"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#operations-and-latency">Operations and latency</a></h3>
<p>What are the main operations you'll be completing on each data type, and what are the performance requirements for the data?</p>
<p>Ask these questions about your data:</p>
<ul>
<li>Will you be doing simple lookups by using an ID field?</li>
<li>Do you need to query the database for one or more fields?</li>
<li>How many create, update, and delete operations do you expect to run?</li>
<li>Do you need to run complex analytical queries?</li>
<li>How quickly do these operations need to process?</li>
</ul>
<p>The answers to these questions will help you decide on the best storage solution for your data.</p>
<h3 id="operations-and-latency-evaluate-your-data-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#operations-and-latency-evaluate-your-data-types">Operations and latency: Evaluate your data types</a></h3>
<p>Let's walk through each of the datasets with these questions in mind and discuss the requirements.</p>
<h4 id="product-catalog-data_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#product-catalog-data_1">Product catalog data</a></h4>
<p>For product catalog data in an online retail scenario, customer needs are the highest priority. Customers will want to query the product catalog to find an item or category they have in mind. For example, a customer might query all tennis shoes, then tennis shoes on sale, and then tennis shoes on sale in a particular size. Customer needs might require many read operations, and they must be able to query on specific fields.</p>
<p>When a customer places an order, the application must update product quantities. The update operations need to happen as quickly as the read operations so that users don't put an item in their shopping carts when that item just sold out. The application must support not only a large number of read operations, but it also requires increased write operations for product catalog data. Be sure to determine the priorities for all the users of the database, not only the primary users.</p>
<h4 id="photos-and-videos_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#photos-and-videos_1">Photos and videos</a></h4>
<p>Photos and videos that are displayed on product pages have different requirements. They need fast retrieval times so that they're displayed on the site at the same time as product catalog data, but they don't need to be queried independently. Instead, you can rely on the results of the product query, and include the video ID or URL as a property on the product data. You need to retrieve photos and videos using their IDs only.</p>
<p>Customers won't make updates to existing photos or videos, but they can add new photos for product reviews. For example, a customer might upload an image of them wearing their new shoes.</p>
<p>As an employee, you also upload and delete product photos that are provided by your product vendor. But those updates don't need to happen as quickly as your other product data updates.</p>
<p>In summary, you can query photos and videos by ID to return the entire file. However, create and update operations are less frequent and have lower priority.</p>
<h4 id="business-data_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#business-data_1">Business data</a></h4>
<p>For data analysis, the company uses only historical data. No original data is updated based on the analysis, so business data is read-only. Users don't expect their complex analytics to run instantly, so it's acceptable to have some latency in the results.</p>
<p>Business data is stored in multiple datasets. Not all business analysts need write access to all datasets, but all business analysts can read from all datasets.</p>
<h2 id="group-multiple-operations-in-a-transaction"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#group-multiple-operations-in-a-transaction">Group multiple operations in a transaction</a></h2>
<p>If a change to one piece of data must result in a change to another piece of data, an application needs to group together a series of data updates. You can use <em>transactions</em> to group these updates. In a transaction, if one event in a series of updates fails, the entire series can be rolled back or undone.</p>
<p>An example is an online retailer that uses a transaction to place an order, verify payment, and update the product inventory. Grouping the related events ensures that you don't reduce your inventory levels until you receive an approved form of payment.</p>
<p>Next, learn about transactions and whether they're required for your data.</p>
<h3 id="what-is-a-transaction"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#what-is-a-transaction">What is a transaction?</a></h3>
<p>A transaction is a logical group of database operations that run together.</p>
<p>Here's the question to ask yourself regarding whether you need to use transactions in your application: Will a change to one piece of data in your dataset affect another piece of data? If the answer is yes, you'll need support for transactions in your database service.</p>
<p><em>ACID guarantees</em> define transactions by ensuring a set of four requirements are met. ACID is an acronym for <em>atomicity</em>, <em>consistency</em>, <em>isolation</em>, and <em>durability</em>.</p>
<ul>
<li><em>Atomicity</em> means a transaction must run exactly once, and it must be atomic. Either all of the work is done or none of it is. Operations within a transaction usually share a common intent and are interdependent.</li>
<li><em>Consistency</em> ensures that the data is consistent both before and after the transaction.</li>
<li><em>Isolation</em> ensures that each transaction is unaffected by other transactions.</li>
<li><em>Durability</em> means that changes made as a result of a transaction are permanently saved in the system. The system saves data that's committed so even in the event of a failure and system restart, the data is available in its correct state.</li>
</ul>
<p>When a database offers ACID guarantees, these principles are consistently applied to each transaction.</p>
<h4 id="oltp-vs-olap"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#oltp-vs-olap">OLTP vs. OLAP</a></h4>
<p>Transactional databases are often called <em>online transaction processing (OLTP)</em> systems. OLTP systems commonly support many users, have quick response times, and handle large volumes of data. They also are highly available, which means they have minimal downtime. OLTP systems typically handle small transactions or relatively simple transactions.</p>
<p>An example of an Azure service that supports OLTP is Azure SQL Database.</p>
<p><em>Online analytical processing (OLAP)</em> systems commonly support fewer users, have longer response times, can be less available, and typically handle large transactions or complex transactions.</p>
<p>An example of an Azure service that supports OLAP is Azure Analysis Services.</p>
<p>The terms OLTP and OLAP aren't used as frequently as they used to be, but understanding them makes it easier to categorize the needs of your application.</p>
<h3 id="transactions-evaluate-your-data-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#transactions-evaluate-your-data-types">Transactions: Evaluate your data types</a></h3>
<p>Ensuring that your data is in the correct state isn't always an easy task. Transactions can help by enforcing data integrity requirements on your data. If your data benefits from ACID principles, choose a storage solution that supports transactions.</p>
<p>Let's walk through each of the datasets in the online retail scenario and determine the need for transactions.</p>
<h4 id="product-catalog-data_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#product-catalog-data_2">Product catalog data</a></h4>
<p>Product catalog data should be stored in a transactional database. When a user places an order and the payment is verified, the item inventory should be updated. Likewise, if the customer's credit card is declined, the order should be rolled back and the inventory shouldn't be updated. These relationships require transactions.</p>
<h4 id="photos-and-videos_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#photos-and-videos_2">Photos and videos</a></h4>
<p>Photos and videos in a product catalog don't require transactional support. These files are changed only when an update is made or new files are added. Even though there's a relationship between the image and the actual product data, it's not transactional in nature.</p>
<h4 id="business-data_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#business-data_2">Business data</a></h4>
<p>Because business data is historical and unchanging, transactional support isn't required. Business analysts who work with the data also have unique query needs. They often work with aggregates in their queries, so they can work with the totals of other smaller data points.</p>
<h2 id="choose-a-storage-solution-on-azure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#choose-a-storage-solution-on-azure">Choose a storage solution on Azure</a></h2>
<p>Choosing the correct storage solution can lead to better performance, cost savings, and improved manageability. Each type of data has different storage requirements. It's your job to determine which storage solution is best for the types of data your company uses. Always consider the type of data, the operations required, expected latency, and the need for transactional support.</p>
<p>Here, you apply what you've learned about the data in your online retail scenario and find the best Azure service for each dataset.</p>
<h3 id="product-catalog-data_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#product-catalog-data_3">Product catalog data</a></h3>
<p><strong>Data classification</strong>: Semi-structured because of the need to extend or modify the schema for new products.</p>
<p><strong>Operations</strong>: Customers require a high number of read operations, with the ability to query many fields within the database. Also, the business requires a high number of write operations to track its constantly changing inventory.</p>
<p><strong>Latency and throughput</strong>: High throughput and low latency.</p>
<p><strong>Transactional support</strong>: Because product data is tied to payment and inventory, transactional support is required.</p>
<h4 id="recommended-service-azure-cosmos-db"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#recommended-service-azure-cosmos-db">Recommended service: Azure Cosmos DB</a></h4>
<p>Azure Cosmos DB supports semi-structured or NoSQL data by design. So, supporting new fields like the "Bluetooth-enabled" field or any new fields you need in the future is something you can do with Azure Cosmos DB.</p>
<p>Azure Cosmos DB supports SQL for queries, and every property is indexed by default. You can create queries so that your customers can filter on any property in the catalog.</p>
<p>Azure Cosmos DB is also ACID-compliant, so you can be assured that your transactions are completed according to those strict requirements. An OLTP connector is available for Azure Cosmos DB.</p>
<p>As an added plus, you also can use Azure Cosmos DB to easily replicate your data anywhere in the world. If your e-commerce site has users concentrated in the US, France, and England, you can replicate your data to datacenters in those regions. Latency is reduced because you've physically moved the data closer to your users.</p>
<p>Even with data that's replicated around the world, you can choose from one of five consistency levels. By choosing the right consistency level, you can determine the tradeoffs to make between consistency, availability, latency, and throughput. You can scale up to handle higher customer demand during peak shopping times or scale down during slower times to conserve on cost.</p>
<h5 id="why-not-other-azure-services"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#why-not-other-azure-services">Why not other Azure services?</a></h5>
<p>Azure SQL Database would be an excellent choice for this dataset if you could identify the subset of properties that are common for most of the products and the variable properties that might not exist in some products. You can use Azure SQL Database to combine structured data in the columns and semi-structured data stored as JSON columns that can be easily extended. Azure SQL Database can provide many of the same benefits of Azure Cosmos DB. However, it provides little benefit if the structure of your data is changing in different entities, and you can't predefine a set of common properties that are repeated in most of the entities. Unlike Azure Cosmos DB, which indexes every property in the documents, Azure SQL Database needs to explicitly define what properties in semi-structured documents should be indexed. Azure Cosmos DB is a better choice for highly unstructured and variable data in which you can't predict what properties should be indexed. Azure SQL Database supports OLTP.</p>
<p>Other Azure services, like Azure Table storage, Apache HBase in Azure HDInsight, and Azure Cache for Redis, can also store NoSQL data. In this scenario, users will want to query on multiple fields, so Azure Cosmos DB is a better fit. Azure Cosmos DB indexes every field by default, whereas other Azure services are limited in the data they index. Querying on non-indexed fields results in reduced performance.</p>
<h3 id="photos-and-videos_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#photos-and-videos_3">Photos and videos</a></h3>
<p><strong>Data classification</strong>: Unstructured.</p>
<p><strong>Operations</strong>: Retrieve only by ID, customers require a high number of read operations with low latency, and create operations and update operations will be less frequent and can have higher latency than read operations.</p>
<p><strong>Latency and throughput</strong>: Retrievals by ID need to support low latency and high throughput. Create operations and update operations can have higher latency than read operations.</p>
<p><strong>Transactional support</strong>: Not required.</p>
<h4 id="recommended-service-azure-blob-storage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#recommended-service-azure-blob-storage">Recommended service: Azure Blob Storage</a></h4>
<p>Azure Blob Storage supports storing files like photos and videos. It also works with Azure Content Delivery Network by caching the most frequently used content, and then storing it on edge servers. Azure Content Delivery Network reduces latency when serving those images to your users.</p>
<p>In Azure Blob Storage, you can also move images from the hot storage tier to the cool storage tier or archive storage tier. This helps reduce costs and focus throughput on the most frequently viewed images and videos.</p>
<h5 id="why-not-other-azure-services_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#why-not-other-azure-services_1">Why not other Azure services?</a></h5>
<p>You could upload your images to Azure App Service, so that the same server running your app serves up your images. This solution would work if you didn't have many files. But if you have lots of files and a global audience, you'll get better performance by using Azure Blob Storage with Azure Content Delivery Network.</p>
<h3 id="business-data_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#business-data_3">Business data</a></h3>
<p><strong>Data classification</strong>: Structured.</p>
<p><strong>Operations</strong>: Read-only, complex analytical queries across multiple databases.</p>
<p><strong>Latency and throughput</strong>: Some latency in the results is expected based on the complex nature of the queries.</p>
<p><strong>Transactional support</strong>: Not required.</p>
<h4 id="recommended-service-azure-sql-database"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#recommended-service-azure-sql-database">Recommended service: Azure SQL Database</a></h4>
<p>Business analysts most likely will query business data using SQL, as they are more knowledgeable in this query language than any other. You can use Azure SQL Database as a solution by itself. However, if you pair it with Azure Analysis Services, data analysts can create a semantic model over the data in Azure SQL Database. Data analysts can then share the model with business users, who need only to connect to the model from any business intelligence (BI) tool to immediately explore the data and gain insights. Azure Analysis Services supports OLAP.</p>
<h5 id="why-not-other-azure-services_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Implement%20and%20Manage%20storage%20in%20azure/#why-not-other-azure-services_2">Why not other Azure services?</a></h5>
<p>Azure Synapse Analytics supports OLAP solutions and SQL queries, but your business analysts will need to perform cross-database queries, which Azure Synapse Analytics doesn't support.</p>
<p>Azure Stream Analytics is a great way to analyze data and transform it into actionable insights, but its focus is on real-time data that is streaming in. In this scenario, the business analysts are looking at historical data only.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-11-14 00:00:00">November 14, 2024</time></li>
        
        
          
          <li class="md-meta__item">
            
              87 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="microsoft-entra-id"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/">Microsoft Entra ID</a></h2>
<h2 id="examine-microsoft-entra-id"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#examine-microsoft-entra-id">Examine Microsoft Entra ID</a></h2>
<p>Students should be familiar with Active Directory Domain Services (AD DS or traditionally called just "Active Directory"). AD DS is a directory service that provides the methods for storing directory data, such as user accounts and passwords, and makes this data available to network users, administrators, and other devices and services. It runs as a service on Windows Server, referred to as a domain controller.</p>
<p>Microsoft Entra ID is part of the platform as a service (PaaS) offering and operates as a Microsoft-managed directory service in the cloud. It’s not a part of the core infrastructure that customers own and manage, nor is it an Infrastructure as a service offering. While this implies that you have less control over its implementation, it also means that you don’t have to dedicate resources to its deployment or maintenance.</p>
<p>With Microsoft Entra ID, you also have access to a set of features that aren’t natively available in AD DS, such as support for multi-factor authentication, identity protection, and self-service password reset.</p>
<p>You can use Microsoft Entra ID to provide more secure access to cloud-based resources for organizations and individuals by:</p>
<ul>
<li>Configuring access to applications</li>
<li>Configuring single sign-on (SSO) to cloud-based SaaS applications</li>
<li>Managing users and groups</li>
<li>Provisioning users</li>
<li>Enabling federation between organizations</li>
<li>Providing an identity management solution</li>
<li>Identifying irregular sign-in activity</li>
<li>Configuring multi-factor authentication</li>
<li>Extending existing on-premises Active Directory implementations to Microsoft Entra ID</li>
<li>Configuring Application Proxy for cloud and local applications</li>
<li>Configuring Conditional Access for users and devices</li>
</ul>
<p><img alt="Diagram that shows the Microsoft Entra Connect Stack." src="https://learn.microsoft.com/en-us/training/wwl-azure/understand-azure-active-directory/media/azure-active-directory-connect-stack-f1aae359.png" /></p>
<p>Microsoft Entra constitutes a separate Azure service. Its most elementary form, which any new Azure subscription includes automatically, doesn't incur any extra cost and is referred to as the Free tier. If you subscribe to any Microsoft Online business services (for example, Microsoft 365 or Microsoft Intune), you automatically get Microsoft Entra ID with access to all the Free features.</p>
<p>Note</p>
<p>By default, when you create a new Azure subscription by using a Microsoft account, the subscription automatically includes a new Microsoft Entra tenant named Default Directory.</p>
<p>Some of the more advanced identity management features require paid versions of Microsoft Entra ID, offered in the form of Basic and Premium tiers. Some of these features are also automatically included in Microsoft Entra instances generated as part of Microsoft 365 subscriptions. Differences between Microsoft Entra versions are discussed later in this module.</p>
<p>Implementing Microsoft Entra ID isn't the same as deploying virtual machines in Azure, adding AD DS, and then deploying some domain controllers for a new forest and domain. Microsoft Entra ID is a different service, much more focused on providing identity management services to web-based apps, unlike AD DS, which is more focused on on-premises apps.</p>
<h4 id="microsoft-entra-tenants"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#microsoft-entra-tenants">Microsoft Entra tenants</a></h4>
<p>Unlike AD DS, Microsoft Entra ID is multi-tenant by design and is implemented specifically to ensure isolation between its individual directory instances. It’s the world’s largest multi-tenant directory, hosting over a million directory services instances, with billions of authentication requests per week. The term tenant in this context typically represents a company or organization that signed up for a subscription to a Microsoft cloud-based service such as Microsoft 365, Intune, or Azure, each of which uses Microsoft Entra ID. However, from a technical standpoint, the term tenant represents an individual Microsoft Entra instance. Within an Azure subscription, you can create multiple Microsoft Entra tenants. Having multiple Microsoft Entra tenants might be convenient if you want to test Microsoft Entra functionality in one tenant without affecting the others.</p>
<p>At any given time, an Azure subscription must be associated with one, and only one, Microsoft Entra tenant. This association allows you to grant permissions to resources in the Azure subscription (via RBAC) to users, groups, and applications that exist in that particular Microsoft Entra tenant.</p>
<p>Note</p>
<p>You can associate the same Microsoft Entra tenant with multiple Azure subscriptions. This allows you to use the same users, groups, and applications to manage resources across multiple Azure subscriptions.</p>
<p>Each Microsoft Entra tenant is assigned the default Domain Name System (DNS) domain name, consisting of a unique prefix. The prefix, derived from the name of the Microsoft account you use to create an Azure subscription or provided explicitly when creating a Microsoft Entra tenant, is followed by the <strong>onmicrosoft.com</strong> suffix. Adding at least one custom domain name to the same Microsoft Entra tenant is possible and common. This name utilizes the DNS domain namespace that the corresponding company or organization owns. The Microsoft Entra tenant serves as the security boundary and a container for Microsoft Entra objects such as users, groups, and applications. A single Microsoft Entra tenant can support multiple Azure subscriptions.</p>
<h4 id="microsoft-entra-schema"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#microsoft-entra-schema">Microsoft Entra schema</a></h4>
<p>The Microsoft Entra schema contains fewer object types than that of AD DS. Most notably, it doesn't include a definition of the computer class, although it does include the device class. The process of joining devices to Microsoft Entra differs considerably from the process of joining computers to AD DS. The Microsoft Entra schema is also easily extensible, and its extensions are fully reversible.</p>
<p>The lack of support for the traditional computer domain membership means that you can't use Microsoft Entra ID to manage computers or user settings by using traditional management techniques, such as Group Policy Objects (GPOs). Instead, Microsoft Entra ID and its services define a concept of modern management. Microsoft Entra ID’s primary strength lies in providing directory services; storing and publishing user, device, and application data; and handling the authentication and authorization of the users, devices, and applications. The effectiveness and efficiency of these features are apparent based on existing deployments of cloud services such as Microsoft 365, which rely on Microsoft Entra ID as their identity provider and support millions of users.</p>
<p>Microsoft Entra ID doesn't include the organizational unit (OU) class, which means that you can't arrange its objects into a hierarchy of custom containers, which is frequently used in on-premises AD DS deployments. However, this isn't a significant shortcoming, because OUs in AD DS are used primarily for Group Policy scoping and delegation. You can accomplish equivalent arrangements by organizing objects based on their group membership.</p>
<p>Objects of the Application and servicePrincipal classes represent applications in Microsoft Entra ID. An object in the Application class contains an application definition and an object in the servicePrincipal class constitutes its instance in the current Microsoft Entra tenant. Separating these two sets of characteristics allows you to define an application in one tenant and use it across multiple tenants by creating a service principal object for this application in each tenant. Microsoft Entra ID creates the service principal object when you register the corresponding application in that Microsoft Entra tenant.</p>
<hr />
<h2 id="compare-microsoft-entra-id-and-active-directory-domain-services"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#compare-microsoft-entra-id-and-active-directory-domain-services">Compare Microsoft Entra ID and Active Directory Domain Services</a></h2>
<p>You could view Microsoft Entra ID simply as the cloud-based counterpart of AD DS; however, while Microsoft Entra ID and AD DS share some common characteristics, there are several significant differences between them.</p>
<h4 id="characteristics-of-ad-ds"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#characteristics-of-ad-ds">Characteristics of AD DS</a></h4>
<p>AD DS is the traditional deployment of Windows Server-based Active Directory on a physical or virtual server. Although AD DS is commonly considered being primarily a directory service, it’s only one component of the Windows Active Directory suite of technologies, which also includes Active Directory Certificate Services (AD CS), Active Directory Lightweight Directory Services (AD LDS), Active Directory Federation Services (AD FS), and Active Directory Rights Management Services (AD RMS).</p>
<p>When comparing AD DS with Microsoft Entra ID, it’s important to note the following characteristics of AD DS:</p>
<ul>
<li>AD DS is a true directory service, with a hierarchical X.500-based structure.</li>
<li>AD DS uses Domain Name System (DNS) for locating resources such as domain controllers.</li>
<li>You can query and manage AD DS by using Lightweight Directory Access Protocol (LDAP) calls.</li>
<li>AD DS primarily uses the Kerberos protocol for authentication.</li>
<li>AD DS uses OUs and GPOs for management.</li>
<li>AD DS includes computer objects, representing computers that join an Active Directory domain.</li>
<li>AD DS uses trusts between domains for delegated management.</li>
</ul>
<p>You can deploy AD DS on an Azure virtual machine to enable scalability and availability for an on-premises AD DS. However, deploying AD DS on an Azure virtual machine doesn't make any use of Microsoft Entra ID.</p>
<p>Note</p>
<p>Deploying AD DS on an Azure virtual machine requires one or more extra Azure data disks because you shouldn't use drive C for AD DS storage. These disks are needed to store the AD DS database, logs, and the sysvol folder. The Host Cache Preference setting for these disks must be set to None.</p>
<h4 id="characteristics-of-microsoft-entra-id"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#characteristics-of-microsoft-entra-id">Characteristics of Microsoft Entra ID</a></h4>
<p>Although Microsoft Entra ID has many similarities to AD DS, there are also many differences. It’s important to realize that using Microsoft Entra isn’t the same as deploying an Active Directory domain controller on an Azure virtual machine and adding it to your on-premises domain.</p>
<p>When comparing Microsoft Entra ID with AD DS, it’s important to note the following characteristics of Microsoft Entra ID:</p>
<ul>
<li>Microsoft Entra ID is primarily an identity solution, and it’s designed for internet-based applications by using HTTP (port 80) and HTTPS (port 443) communications.</li>
<li>Microsoft Entra ID is a multi-tenant directory service.</li>
<li>Microsoft Entra users and groups are created in a flat structure, and there are no OUs or GPOs.</li>
<li>You can't query Microsoft Entra ID by using LDAP; instead, Microsoft Entra ID uses the REST API over HTTP and HTTPS.</li>
<li>Microsoft Entra ID doesn't use Kerberos authentication; instead, it uses HTTP and HTTPS protocols such as SAML, WS-Federation, and OpenID Connect for authentication, and uses OAuth for authorization.</li>
<li>Microsoft Entra ID includes federation services, and many third-party services such as Facebook are federated with and trust Microsoft Entra ID.</li>
</ul>
<hr />
<h2 id="examine-microsoft-entra-id-as-a-directory-service-for-cloud-apps"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#examine-microsoft-entra-id-as-a-directory-service-for-cloud-apps">Examine Microsoft Entra ID as a directory service for cloud apps</a></h2>
<p>When you deploy cloud services such as Microsoft 365 or Intune, you also need to have directory services in the cloud to provide authentication and authorization for these services. Because of this, each cloud service that needs authentication will create its own Microsoft Entra tenant. When a single organization uses more than one cloud service, it’s much more convenient for these cloud services to use a single cloud directory instead of having separate directories for each service.</p>
<p>It’s now possible to have one identity service that covers all Microsoft cloud-based services, such as Microsoft 365, Azure, Microsoft Dynamics 365, and Intune. Microsoft Entra ID provides developers with centralized authentication and authorization for applications in Azure by using other identity providers or on-premises AD DS. Microsoft Entra ID can provide users with an SSO experience when using applications such as Facebook, Google services, Yahoo, or Microsoft cloud services.</p>
<p>The process of implementing Microsoft Entra ID support for custom applications is rather complex and beyond the scope of this course. However, the Azure portal and Microsoft Visual Studio 2013 and later make the process of configuring such support more straightforward.</p>
<p>In particular, you can enable Microsoft Entra authentication for the Web Apps feature of Azure App Service directly from the Authentication/Authorization blade in the Azure portal. By designating the Microsoft Entra tenant, you can ensure that only users with accounts in that directory can access the website. It’s possible to apply different authentication settings to individual deployment slots.</p>
<p>For more information, see <a href="https://learn.microsoft.com/en-us/azure/app-service/configure-authentication-provider-aad">Configure your App Service app to use Microsoft Entra login</a>.</p>
<hr />
<h2 id="compare-microsoft-entra-id-p1-and-p2-plans"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#compare-microsoft-entra-id-p1-and-p2-plans">Compare Microsoft Entra ID P1 and P2 plans</a></h2>
<p>The Microsoft Entra ID P1 or P2 tier provides extra functionality as compared to the Free and Office 365 editions. However, premium versions require additional cost per user provisioning. Microsoft Entra ID P1 or P2 comes in two versions P1 and P2. You can procure it as an extra license or as a part of the Microsoft Enterprise Mobility + Security, which also includes the license for Azure Information Protection and Intune.</p>
<p>Microsoft provides a free trial period that can be used to experience the full functionality of the Microsoft Entra ID P2 edition. The following features are available with the Microsoft Entra ID P1 edition:</p>
<ul>
<li><strong>Self-service group management</strong>. It simplifies the administration of groups where users are given the rights to create and manage the groups. End users can create requests to join other groups, and group owners can approve requests and maintain their groups’ memberships.</li>
<li><strong>Advanced security reports and alerts</strong>. You can monitor and protect access to your cloud applications by viewing detailed logs that show advanced anomalies and inconsistent access pattern reports. Advanced reports are machine learning based and can help you gain new insights to improve access security and respond to potential threats.</li>
<li><strong>Multi-factor authentication</strong>. Full multi-factor authentication (MFA) works with on-premises applications (using virtual private network [VPN], RADIUS, and others), Azure, Microsoft 365, Dynamics 365, and third-party Microsoft Entra gallery applications. It doesn't work with non-browser off-the-shelf apps, such as Microsoft Outlook. Full multi-factor authentication is covered in more detail in the following units in this lesson.</li>
<li><strong>Microsoft Identity Manager (MIM) licensing</strong>. MIM integrates with Microsoft Entra ID P1 or P2 to provide hybrid identity solutions. MIM can bridge multiple on-premises authentication stores such as AD DS, LDAP, Oracle, and other applications with Microsoft Entra ID. This provides consistent experiences to on-premises line-of-business (LOB) applications and SaaS solutions.</li>
<li><strong>Enterprise SLA of 99.9%</strong>. You're guaranteed at least 99.9% availability of the Microsoft Entra ID P1 or P2 service. The same SLA applies to Microsoft Entra Basic.</li>
<li><strong>Password reset with writeback</strong>. Self-service password reset follows the Active Directory on-premises password policy.</li>
<li><strong>Cloud App Discovery feature of Microsoft Entra ID</strong>. This feature discovers the most frequently used cloud-based applications.</li>
<li><strong>Conditional Access based on device, group, or location</strong>. This lets you configure conditional access for critical resources, based on several criteria.</li>
<li><strong>Microsoft Entra Connect Health</strong>. You can use this tool to gain operational insight into Microsoft Entra ID. It works with alerts, performance counters, usage patterns, and configuration settings, and presents the collected information in the Microsoft Entra Connect Health portal.</li>
</ul>
<p>In addition to these features, the Microsoft Entra ID P2 license provides extra functionalities:</p>
<ul>
<li><strong>Microsoft Entra ID Protection</strong>. This feature provides enhanced functionalities for monitoring and protecting user accounts. You can define user risk policies and sign-in policies. In addition, you can review users’ behavior and flag users for risk.</li>
<li><strong>Microsoft Entra Privileged Identity Management</strong>. This functionality lets you configure additional security levels for privileged users such as administrators. With Privileged Identity Management, you define permanent and temporary administrators. You also define a policy workflow that activates whenever someone wants to use administrative privileges to perform some task.</li>
</ul>
<p>Note</p>
<p>Plans change frequently. Check Microsoft's website for the current plans and capabilities.</p>
<hr />
<h2 id="examine-microsoft-entra-domain-services"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#examine-microsoft-entra-domain-services">Examine Microsoft Entra Domain Services</a></h2>
<p>In most organizations today, line-of-business (LOB) applications are deployed on computers and devices that are domain members. These organizations use AD DS–based credentials for authentication, and Group Policy manages them. When you consider moving these apps to run in Azure, one key issue is how to provide authentication services to these apps. To satisfy this need, you can choose to implement a site-to-site virtual private network (VPN) between your local infrastructure and the Azure IaaS, or you can deploy replica domain controllers from your local AD DS as virtual machines (VMs) in Azure. These approaches can entail additional costs and administrative effort. Additionally, the difference between these two approaches is that with the first option, authentication traffic will cross the VPN, while in the second option, replication traffic will cross the VPN and authentication traffic stays in the cloud.</p>
<p>Microsoft provides Microsoft Entra Domain Services as an alternative to these approaches. This service, which runs as part of the Microsoft Entra ID P1 or P2 tier, provides domain services such as Group Policy management, domain joining, and Kerberos authentication to your Microsoft Entra tenant. These services are fully compatible with locally deployed AD DS, so you can use them without deploying and managing additional domain controllers in the cloud.</p>
<p><img alt="Diagram that shows the Microsoft Entra Domain Services Overview." src="https://learn.microsoft.com/en-us/training/wwl-azure/understand-azure-active-directory/media/azure-active-directory-virtual-network-340081c4.png" /></p>
<p>Because Microsoft Entra ID can integrate with your local AD DS, when you implement Microsoft Entra Connect, users can utilize organizational credentials in both on-premises AD DS and in Microsoft Entra Domain Services. Even if you don’t have AD DS deployed locally, you can choose to use Microsoft Entra Domain Services as a cloud-only service. This enables you to have similar functionality of locally deployed AD DS without having to deploy a single domain controller on-premises or in the cloud. For example, an organization can choose to create a Microsoft Entra tenant and enable Microsoft Entra Domain Services, and then deploy a virtual network between its on-premises resources and the Microsoft Entra tenant. You can enable Microsoft Entra Domain Services for this virtual network so that all on-premises users and services can use domain services from Microsoft Entra ID.</p>
<p>Microsoft Entra Domain Services provides several benefits for organizations, such as:</p>
<ul>
<li>Administrators don't need to manage, update, and monitor domain controllers.</li>
<li>Administrators don't need to deploy and manage Active Directory replication.</li>
<li>There’s no need to have Domain Admins or Enterprise Admins groups for domains that Microsoft Entra ID manages.</li>
</ul>
<p>If you choose to implement Microsoft Entra Domain Services, you need to be aware of the service's current limitations. These include:</p>
<ul>
<li>Only the base computer Active Directory object is supported.</li>
<li>It’s not possible to extend the schema for the Microsoft Entra Domain Services domain.</li>
<li>The organizational unit (OU) structure is flat and nested OUs aren't currently supported.</li>
<li>There’s a built-in Group Policy Object (GPO), and it exists for computer and user accounts.</li>
<li>It’s not possible to target OUs with built-in GPOs. Additionally, you can't use Windows Management Instrumentation filters or security-group filtering.</li>
</ul>
<p>By using Microsoft Entra Domain Services, you can freely migrate applications that use LDAP, NTLM, or the Kerberos protocols from your on-premises infrastructure to the cloud. You can also use applications such as Microsoft SQL Server or Microsoft SharePoint Server on VMs or deploy them in the Azure IaaS, without needing domain controllers in the cloud or a VPN to local infrastructure.</p>
<p>You can enable Microsoft Entra Domain Services by using the Azure portal. This service charges per hour based on the size of your directory.</p>
<hr />
<hr />
<h2 id="configure-user-and-group-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#configure-user-and-group-accounts">Configure User and Group accounts</a></h2>
<h2 id="introduction"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#introduction">Introduction</a></h2>
<p>Access to Azure resources is controlled through user accounts and identities that are defined in Microsoft Entra ID. Microsoft Entra ID supports group accounts to help you organize user accounts for easier administration.</p>
<p>In this module, your company wants to take advantage of the user and group account features in Microsoft Entra ID. You need to understand the concepts of user accounts and group accounts. You're looking for information about how to create, configure, and manage these accounts. Your organization needs support for bulk configuration of settings, group account organization, and managing accounts across multiple directories.</p>
<p>In this module, you learn about user accounts and group accounts. You learn about an administrator shortcut for bulk creation of user accounts. You learn about controlling administrator access through administrative units. You also simulate user and group creation in the Azure portal.</p>
<p>The goal of this module is to successfully create and manage user and group accounts.</p>
<h2 id="create-user-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-user-accounts">Create user accounts</a></h2>
<p>Every user who wants access to Azure resources needs an Azure user account. A user account has all the information required to authenticate the user during the sign-in process. Microsoft Entra ID supports three types of user accounts. The types indicate where the user is defined (in the cloud or on-premises), and whether the user is internal or external to your Microsoft Entra organization.</p>
<h4 id="things-to-know-about-user-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-user-accounts">Things to know about user accounts</a></h4>
<p>The following table describes the user accounts supported in Microsoft Entra ID. As you review these options, consider what types of user accounts suit your organization.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>User account</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cloud identity</strong></td>
<td>A user account with a <em>cloud identity</em> is defined only in Microsoft Entra ID. This type of user account includes administrator accounts and users who are managed as part of your organization. A cloud identity can be for user accounts defined in your Microsoft Entra organization, and also for user accounts defined in an external Microsoft Entra instance. When a cloud identity is removed from the primary directory, the user account is deleted.</td>
</tr>
<tr>
<td><strong>Directory-synchronized identity</strong></td>
<td>User accounts that have a <em>directory-synchronized identity</em> are defined in an on-premises Active Directory. A synchronization activity occurs via Microsoft Entra Connect to bring these user accounts in to Azure. The source for these accounts is Windows Server Active Directory.</td>
</tr>
<tr>
<td><strong>Guest user</strong></td>
<td><em>Guest user</em> accounts are defined outside Azure. Examples include user accounts from other cloud providers, and Microsoft accounts like an Xbox LIVE account. The source for guest user accounts is Invited user. Guest user accounts are useful when external vendors or contractors need access to your Azure resources.</td>
</tr>
</tbody>
</table>
<h4 id="things-to-consider-when-choosing-user-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-choosing-user-accounts">Things to consider when choosing user accounts</a></h4>
<ul>
<li>
<p><strong>Consider where users are defined</strong>. Determine where your users are defined. Are all your users defined within your Microsoft Entra organization, or are some users defined in external Microsoft Entra instances? Do you have users who are external to your organization? It's common for businesses to support two or more account types in their infrastructure.</p>
</li>
<li>
<p><strong>Consider support for external contributors</strong>. Allow external contributors to access Azure resources in your organization by supporting the <strong>Guest user</strong> account type. When the external contributor no longer requires access, you can remove the user account and their access privileges.</p>
</li>
<li>
<p><strong>Consider a combination of user accounts</strong>. Implement the user account types that enable your organization to satisfy their business requirements. Support directory-synchronized identity user accounts for users defined in Windows Server Active Directory. Support cloud identities for users defined in your internal Microsoft Entra structure or for user defined in an external Microsoft Entra instance.</p>
</li>
</ul>
<h2 id="manage-user-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#manage-user-accounts">Manage user accounts</a></h2>
<p>There are several ways to add cloud identity user accounts in Microsoft Entra ID. A common approach is by using the Azure portal. User accounts can also be added to Microsoft Entra ID through Microsoft 365 Admin Center, Microsoft Intune admin console, and the Azure CLI.</p>
<h4 id="things-to-know-about-cloud-identity-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-cloud-identity-accounts">Things to know about cloud identity accounts</a></h4>
<p>Let's review how cloud identity user accounts are defined in Microsoft Entra ID. Here's an example of the new <strong>User</strong> page in the Azure portal. The administrator can <strong>Create</strong> a user within the organization or <strong>Invite</strong> a guest user to provide access to organization resources:</p>
<p><img alt="Screenshot of the User page in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-user-group-accounts/media/add-user-accounts-133b7dbf.png" /></p>
<ul>
<li>
<p>A new user account must have a display name and an associated user account name. An example display name is <code>Aran Sawyer-Miller</code> and the associated user account name could be <code>asawmill@contoso.com</code>.</p>
</li>
<li>
<p>Information and settings that describe a user are stored in the user account profile.</p>
</li>
<li>
<p>The profile can have other settings like a user's job title, and their contact email address.</p>
</li>
<li>
<p>A user with Global administrator or User administrator privileges can preset profile data in user accounts, such as the main phone number for the company.</p>
</li>
<li>
<p>Non-admin users can set some of their own profile data, but they can't change their display name or account name.</p>
</li>
</ul>
<h4 id="things-to-consider-when-managing-cloud-identity-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-managing-cloud-identity-accounts">Things to consider when managing cloud identity accounts</a></h4>
<p>There are several points to consider about managing user accounts. As you review this list, consider how you can add cloud identity user accounts for your organization.</p>
<ul>
<li>
<p><strong>Consider user profile data</strong>. Allow users to set their profile information for their accounts, as needed. User profile data, including the user's picture, job, and contact information is optional. You can also supply certain profile settings for each user based on your organization's requirements.</p>
</li>
<li>
<p><strong>Consider restore options for deleted accounts</strong>. Include restore scenarios in your account management plan. Restore operations for a deleted account are available up to 30 days after an account is removed. After 30 days, a deleted user account can't be restored.</p>
</li>
<li>
<p><strong>Consider gathered account data</strong>. Collect sign-in and audit log information for user accounts. Microsoft Entra ID lets you gather this data to help you analyze and improve your infrastructure.</p>
</li>
</ul>
<h2 id="create-bulk-user-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-bulk-user-accounts">Create bulk user accounts</a></h2>
<p>Microsoft Entra ID supports several bulk operations, including bulk create and delete for user accounts. The most common approach for these operations is to use the Azure portal. Azure PowerShell can be used for bulk upload of user accounts.</p>
<h4 id="things-to-know-about-bulk-account-operations"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-bulk-account-operations">Things to know about bulk account operations</a></h4>
<p>Let's examine some characteristics of bulk operations in the Azure portal. Here's an example that shows the <strong>Bulk create user</strong> option for new user accounts in Microsoft Entra ID:</p>
<p><img alt="Screenshot that shows the Bulk create user option for new user accounts in Azure AD." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-user-group-accounts/media/bulk-user-accounts-224ad1b7.png" /></p>
<ul>
<li>
<p>Only Global administrators or User administrators have privileges to create and delete user accounts in the Azure portal.</p>
</li>
<li>
<p>To complete bulk create or delete operations, the admin fills out a comma-separated values (CSV) template of the data for the user accounts.</p>
</li>
<li>
<p>Bulk operation templates can be downloaded from the Microsoft Entra admin center.</p>
</li>
<li>
<p>Bulk lists of user accounts can be downloaded.</p>
</li>
</ul>
<h4 id="things-to-consider-when-creating-user-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-creating-user-accounts">Things to consider when creating user accounts</a></h4>
<p>Here are some design considerations for creating and deleting user accounts. Think about what user account conventions and processes might be required by your organization.</p>
<ul>
<li>
<p><strong>Consider naming conventions</strong>. Establish or implement a naming convention for your user accounts. Apply conventions to user account names, display names, and user aliases for consistency across the organization. Conventions for names and aliases can simplify the bulk create process by reducing areas of uniqueness in the CSV file. A convention for user names could begin with the user's last name followed by a period, and end with the user's first name, as in <code>Sawyer-Miller.Aran@contoso.com</code>.</p>
</li>
<li>
<p><strong>Consider using initial passwords</strong>. Implement a convention for the initial password of a newly created user. Design a system to notify new users about their passwords in a secure way. You might generate a random password and email it to the new user or their manager.</p>
</li>
<li>
<p><strong>Consider strategies for minimizing errors</strong>. View and address any errors, by downloading the results file on the <strong>Bulk operation results</strong> page in the Azure portal. The results file contains the reason for each error. An error might be a user account that's already been created or an account that's duplicated. Generally, it's easier to upload and troubleshoot smaller groups of user accounts.</p>
</li>
</ul>
<h2 id="create-group-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-group-accounts">Create group accounts</a></h2>
<p>Microsoft Entra ID allows your organization to define two different types of group accounts. <strong>Security groups</strong> are used to manage member and computer access to shared resources for a group of users. You can create a security group for a specific security policy and apply the same permissions to all members of a group. <strong>Microsoft 365 groups</strong> provide collaboration opportunities. Group members have access to a shared mailbox, calendar, files, SharePoint site, and more.</p>
<h4 id="things-to-know-about-creating-group-accounts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-creating-group-accounts">Things to know about creating group accounts</a></h4>
<p>Review the following characteristics of group accounts in Microsoft Entra ID. The following screenshot shows a list of groups in the Azure portal:</p>
<p><img alt="Screenshot that shows a list of groups in the Azure portal, and their group and membership types." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-user-group-accounts/media/group-accounts-378b3e22.png" /></p>
<ul>
<li>
<p>Use security groups to set permissions for all group members at the same time, rather than adding permissions to each member individually.</p>
</li>
<li>
<p>Add Microsoft 365 groups to enable group access for guest users outside your Microsoft Entra organization.</p>
</li>
<li>
<p>Security groups can be implemented only by a Microsoft Entra administrator.</p>
</li>
<li>
<p>Normal users and Microsoft Entra admins can both use Microsoft 365 groups.</p>
</li>
</ul>
<h4 id="things-to-consider-when-adding-group-members"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-adding-group-members">Things to consider when adding group members</a></h4>
<p>When you add members to a group, there are different ways you can assign member access rights. As you read through these options, consider which groups are needed to support your organization, and what access rights should be applied to group members.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Access rights</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Assigned</strong></td>
<td>Add specific users as members of a group, where each user can have unique permissions.</td>
</tr>
<tr>
<td><strong>Dynamic user</strong></td>
<td>Use dynamic membership rules to automatically add and remove group members. When member attributes change, Azure reviews the dynamic group rules for the directory. If the member attributes meet the rule requirements, the member is added to the group. If the member attributes no longer meet the rule requirements, the member is removed.</td>
</tr>
<tr>
<td><strong>Dynamic device</strong></td>
<td>(<em>Security groups only</em>) Apply dynamic group rules to automatically add and remove devices in security groups. When device attributes change, Azure reviews the dynamic group rules for the directory. If the device attributes meet the rule requirements, the device is added to the security group. If the device attributes no longer meet the rule requirements, the device is removed.</td>
</tr>
</tbody>
</table>
<h2 id="create-administrative-units"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-administrative-units">Create administrative units</a></h2>
<p>As you design your strategy for managing identities and governance in Azure, planning for comprehensive management of your Microsoft Entra infrastructure is critical. It can be useful to restrict administrative scope by using administrative units for your organization. The division of roles and responsibilities is especially helpful for organizations that have many independent divisions.</p>
<p>Consider the management tasks for a large university that's composed of several different schools like Business, Engineering, and Medicine. The university has administrative offices, academic buildings, social buildings, and student dormitories. For security purposes, each business office has its own internal network for resources like servers, printers, and fax machines. Each academic building is connected to the university network, so both instructors and students can access their accounts. The network is also available to students and deans in the dormitories and social buildings. Across the university, guest users require access to the internet via the university network.</p>
<p>The university has a team of IT admins who work together to control resource access, manage users, and set policies for the school. Some admins have greater privileges than others depending on the scope of their responsibilities. A central authority is needed to plan, manage, and oversee the complete structure. In this scenario, you can assign administrative units to make it easier to manage the organization.</p>
<p><img alt="Diagram of administrative units for each university department." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-user-group-accounts/media/admin-unit-overview.png" /></p>
<h4 id="things-to-think-about-administrative-units"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-think-about-administrative-units">Things to think about administrative units</a></h4>
<p>Consider how a central admin role can use administrative units to support the Engineering department in our scenario:</p>
<ul>
<li>
<p>Create a role that has administrative permissions for only Microsoft Entra users in the Engineering department administrative unit.</p>
</li>
<li>
<p>Create an administrative unit for the Engineering department.</p>
</li>
<li>
<p>Populate the administrative unit with only the Engineering department students, staff, and resources.</p>
</li>
<li>
<p>Add the Engineering department IT team to the role, along with its scope.</p>
</li>
</ul>
<h4 id="things-to-consider-when-working-with-administrative-units"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-working-with-administrative-units">Things to consider when working with administrative units</a></h4>
<p>Think about how you can implement administrative units in your organization. Here are some considerations:</p>
<ul>
<li>
<p><strong>Consider management tools</strong>. Review your options for managing AUs. You can use the Azure portal, PowerShell cmdlets and scripts, or Microsoft Graph.</p>
</li>
<li>
<p><strong>Consider role requirements in the Azure portal</strong>. Plan your strategy for administrative units according to role privileges. In the Azure portal, only the Global Administrator or Privileged Role Administrator users can manage AUs.</p>
</li>
<li>
<p><strong>Consider scope of administrative units</strong>. Recognize that the scope of an administrative unit applies only to <em>management</em> permissions. Members and admins of an administrative unit can exercise their default <em>user</em> permissions to browse other users, groups, or resources outside of their administrative unit.</p>
</li>
</ul>
<h2 id="summary-and-resources"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#summary-and-resources">Summary and resources</a></h2>
<p>Azure Administrators must be familiar with configuring user and group accounts in Microsoft Entra ID.</p>
<p>In this module, you learned that every user who wants access to Azure resources needs an Azure user account. Microsoft Entra ID supports access to your organization's resources by assigning access rights to users and groups. You discovered how user and group accounts are created in Microsoft Entra ID. You explored how to configure and manage user and group accounts, including bulk configuration. You reviewed how your organization can support group account organization, and manage accounts across multiple directories.</p>
<p>The main takeaways for this module are:</p>
<ul>
<li>
<p>Microsoft Entra ID supports three types of user accounts: cloud identities, directory-synchronized identities, and guest user identities.</p>
</li>
<li>
<p>Cloud identities have profile information such as job title and office location. This information can be customized for your organization's needs.</p>
</li>
<li>
<p>You can bulk create user and group accounts. The process uses a template file managed through the portal.</p>
</li>
<li>
<p>There are two types of group accounts: Security and Microsoft 365.</p>
</li>
<li>
<p>Administrative units help you control administrator access to resources.</p>
</li>
</ul>
<h3 id="learn-more-with-azure-documentation"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learn-more-with-azure-documentation">Learn more with Azure documentation</a></h3>
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/entra/identity/users/">Enterprise user management documentation</a>. This collection of articles that covers various topics related to user authentication in Microsoft Entra. You learn how to use groups, domain names, and licenses to manage user access to apps and resources3.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/entra/fundamentals/how-to-manage-groups">Manage Microsoft Entra groups and group membership</a>. This article explains how to create, edit, and delete groups in Microsoft Entra. You also learn how to add or remove members and owners, assign roles, and use dynamic rules for group membership2.</p>
</li>
</ul>
<h3 id="learn-more-with-self-paced-training"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learn-more-with-self-paced-training">Learn more with self-paced training</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/">Manage users and groups in Microsoft Entra ID</a>. This training module covers the basic principles of user and groups.</li>
</ul>
<hr />
<h2 id="configure-subscriptions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#configure-subscriptions">Configure Subscriptions</a></h2>
<h2 id="introduction_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#introduction_1">Introduction</a></h2>
<p>This module provides an overview of Azure subscriptions and their importance in managing costs for organizations.</p>
<p>You work for a multinational company that has recently decided to migrate its infrastructure to the cloud. As part of this migration, you have been tasked with managing the costs associated with the company's Azure resources. You need to understand how Azure subscriptions work and how they can help you effectively manage and optimize costs.</p>
<p>The goal of this module is to equip you with the knowledge and skills to successfully manage Azure subscriptions and control costs for your organization. You learn how Azure subscriptions work and use cost management tools and techniques. You optimize resource usage, prevent overspending, and make informed decisions to achieve cost savings.</p>
<h3 id="learning-objectives"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learning-objectives">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>
<p>Determine the correct region to locate Azure services.</p>
</li>
<li>
<p>Review features and use cases for Azure subscriptions.</p>
</li>
<li>
<p>Obtain an Azure subscription.</p>
</li>
<li>
<p>Understand billing and features for different Azure subscriptions.</p>
</li>
<li>
<p>Use Microsoft Cost Management and Billing for cost analysis.</p>
</li>
<li>
<p>Discover when to use Azure resource tagging.</p>
</li>
<li>
<p>Identify ways to reduce costs.</p>
</li>
</ul>
<h3 id="skills-measured"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#skills-measured">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/credentials/certifications/exams/az-104/">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#prerequisites">Prerequisites</a></h3>
<ul>
<li>Familiarity with cloud computing and Azure cloud services.</li>
<li>Familiarity with cloud service billing models and subscription methods.</li>
<li>Familiarity with cost management techniques such as reports and budgets.</li>
</ul>
<h2 id="identify-azure-regions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#identify-azure-regions">Identify Azure regions</a></h2>
<p>Microsoft Azure is made up of datacenters located around the globe. These datacenters are organized and made available to end users by region. A <a href="https://azure.microsoft.com/global-infrastructure/regions/">region</a> is a geographical area on the planet containing at least one, but potentially multiple datacenters. The datacenters are in close proximity and networked together with a low-latency network. A few examples of regions are West US, Canada Central, West Europe, Australia East, and Japan West.</p>
<h4 id="things-to-know-about-regions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-regions">Things to know about regions</a></h4>
<p>Here are some points to consider about regions:</p>
<ul>
<li>
<p>Azure is generally available in more than 60 regions in 140 countries.</p>
</li>
<li>
<p>Azure has more global regions than any other cloud provider.</p>
</li>
<li>
<p>Regions provide you with the flexibility and scale needed to bring applications closer to your users.</p>
</li>
<li>
<p>Regions preserve data residency and offer comprehensive compliance and resiliency options for customers.</p>
</li>
</ul>
<h4 id="things-to-know-about-regional-pairs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-regional-pairs">Things to know about regional pairs</a></h4>
<p>Most Azure regions are paired with another region within the same geography to make a <em>regional pair</em> (or <em>paired regions</em>). Regional pairs help to support always-on availability of Azure resources used by your infrastructure. The following table describes some prominent characteristics of paired regions:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Characteristic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Physical isolation</strong></td>
<td>Azure prefers at least 300 miles of separation between datacenters in a regional pair. This principle isn't practical or possible in all geographies. Physical datacenter separation reduces the likelihood of natural disasters, civil unrest, power outages, or physical network outages affecting both regions at once.</td>
</tr>
<tr>
<td><strong>Platform-provided replication</strong></td>
<td>Some services like Geo-Redundant Storage provide automatic replication to the paired region.</td>
</tr>
<tr>
<td><strong>Region recovery order</strong></td>
<td>During a broad outage, recovery of one region is prioritized out of every pair. Applications that are deployed across paired regions are guaranteed to have one of the regions recovered with priority.</td>
</tr>
<tr>
<td><strong>Sequential updates</strong></td>
<td>Planned Azure system updates are rolled out to paired regions sequentially (not at the same time). Rolling updates minimizes downtime, reduces bugs, and logical failures in the rare event of a bad update.</td>
</tr>
<tr>
<td><strong>Data residency</strong></td>
<td>Regions reside within the same geography as their enabled set (except for the Brazil South and Singapore regions).</td>
</tr>
</tbody>
</table>
<h4 id="things-to-consider-when-using-regions-and-regional-pairs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-using-regions-and-regional-pairs">Things to consider when using regions and regional pairs</a></h4>
<p>You've reviewed the important considerations about regions and regional pairs. Now think about how you might implement regions in your organization.</p>
<ul>
<li>
<p><strong>Consider resource and region deployment</strong>. Plan the regions where you want to deploy your resources. For most Azure services, when you deploy a resource in Azure, you choose the region where you want your resource to be deployed.</p>
</li>
<li>
<p><strong>Consider service support by region</strong>. Research region and service availability. Some services or Azure Virtual Machines features are available only in certain regions, such as specific Virtual Machines sizes or storage types.</p>
</li>
<li>
<p><strong>Consider services that don't require regions</strong>. Identify services that don't need region support. Some global Azure services that don't require you to select a region. These services include Microsoft Entra ID, Microsoft Azure Traffic Manager, and Azure DNS.</p>
</li>
<li>
<p><strong>Consider exceptions to region pairing</strong>. Check the Azure website for current region availability and exceptions. If you plan to support the Brazil South region, note this region is paired with a region outside its geography. The Singapore region also has an exception to standard regional pairing.</p>
</li>
<li>
<p><strong>Consider benefits of data residency</strong>. Take advantage of the benefits of data residency offered by regional pairs. This feature can help you meet requirements for tax and law enforcement jurisdiction purposes.</p>
</li>
</ul>
<h3 id="find-regions-for-your-business-geography"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#find-regions-for-your-business-geography">Find regions for your business geography</a></h3>
<p>Visit the Azure global infrastructure website to find supported regions for your business geography. You can search by country/region name or by Microsoft product. A list of supported region pairs and exceptions is also available.</p>
<p><img alt="Screenshot of the Azure global infrastructure and Azure geographies website." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/azure-geographies.png" /></p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>By geography</th>
<th>By product</th>
<th>Paired regions</th>
</tr>
</thead>
<tbody>
<tr>
<td>Search <a href="https://azure.microsoft.com/global-infrastructure/geographies/#geographies">Azure regions</a> by geography.</td>
<td>Search <a href="https://azure.microsoft.com/global-infrastructure/services/">Azure products</a> by region or geography.</td>
<td>Search for <a href="https://learn.microsoft.com/en-us/azure/best-practices-availability-paired-regions#azure-cross-region-replication-pairings-for-all-geographies">paired regions</a> and exceptions.</td>
</tr>
<tr>
<td><a href="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/regions-select-by-geography-expanded.png#lightbox"><img alt="Screenshot that shows how to search for available regions by geographic location." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/regions-select-by-geography.png" /></a></td>
<td><a href="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/regions-select-by-product-expanded.png#lightbox"><img alt="Screenshot that shows how to find products available according to region or geographic location." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/regions-select-by-product.png" /></a></td>
<td><a href="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/search-region-pairs-expanded.png#lightbox"><img alt="Screenshot that shows how to search for regional pairs." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/search-region-pairs.png" /></a></td>
</tr>
</tbody>
</table>
<h2 id="implement-azure-subscriptions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#implement-azure-subscriptions">Implement Azure subscriptions</a></h2>
<p>An Azure subscription is a logical unit of Azure services that's linked to an Azure account. An Azure account is an identity in Microsoft Entra ID or a directory that's trusted by Microsoft Entra ID, such as a work or school account. Subscriptions help you organize access to Azure cloud service resources, and help you control how resource usage is reported, billed, and paid.</p>
<p><img alt="Diagram that shows the relationship between an Azure subscription and an Azure account, which is an identity in Microsoft Entra ID." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/azure-subscriptions-e855533e.png" /></p>
<h4 id="things-to-know-about-subscriptions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-subscriptions">Things to know about subscriptions</a></h4>
<p>As you think about the subscriptions to implement for your company, consider the following points:</p>
<ul>
<li>
<p>Every Azure cloud service belongs to a subscription.</p>
</li>
<li>
<p>Each subscription can have a different billing and payment configuration.</p>
</li>
<li>
<p>Multiple subscriptions can be linked to the same Azure account.</p>
</li>
<li>
<p>More than one Azure account can be linked to the same subscription.</p>
</li>
<li>
<p>Billing for Azure services is done on a per-subscription basis.</p>
</li>
<li>
<p>If your Azure account is the only account associated with a subscription, you're responsible for the billing requirements.</p>
</li>
<li>
<p>Programmatic operations for a cloud service might require a subscription ID.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-subscriptions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-using-subscriptions">Things to consider when using subscriptions</a></h4>
<p>Consider how many subscriptions your organization needs to support the business scenarios. As you plan, think about how you can organize your resources into resource groups.</p>
<ul>
<li>
<p><strong>Consider the types of Azure accounts required</strong>. Determine the types of Azure accounts your users will link with Azure subscriptions. You can use a Microsoft Entra account or a directory that's trusted by Microsoft Entra ID like a work or school account. If you don't belong to one of these organizations, you can sign up for an Azure account by using your Microsoft Account, which is also trusted by Microsoft Entra ID.</p>
</li>
<li>
<p><strong>Consider multiple subscriptions</strong>. Set up different subscriptions and payment options according to your company's departments, projects, regional offices, and so on. A user can have more than one subscription linked to their Azure account, where each subscription pertains to resources, access privileges, limits, and billing for a specific project.</p>
</li>
<li>
<p><strong>Consider a dedicated shared services subscription</strong>. Plan for how users can share resources allocated in a single subscription. Use a shared services subscription to ensure all common network resources are billed together and isolated from other workloads. Examples of shared services subscriptions include Azure ExpressRoute and Virtual WAN.</p>
</li>
<li>
<p><strong>Consider access to resources</strong>. Every Azure subscription can be associated with a Microsoft Entra ID. Users and services authenticate with Microsoft Entra ID before they access resources.</p>
</li>
</ul>
<h2 id="obtain-an-azure-subscription"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#obtain-an-azure-subscription">Obtain an Azure subscription</a></h2>
<p>To use Azure, you must have an Azure subscription. There are several ways to procure an Azure subscription. You can obtain an Azure subscription as part of an Enterprise agreement, or through a Microsoft reseller or Microsoft partner. Users can also open a personal free account for a trial subscription.</p>
<h4 id="things-to-know-about-obtaining-an-azure-subscription"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-obtaining-an-azure-subscription">Things to know about obtaining an Azure subscription</a></h4>
<p>Review the following ways to obtain an Azure subscription and consider which options would work for your organization.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Procurement option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="" src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/enterprise-icon.png" /></td>
<td><strong>Enterprise agreement</strong>  <br>  <br>Any <a href="https://azure.microsoft.com/pricing/enterprise-agreement/">Enterprise Agreement</a> customer can add Azure to their agreement by making an upfront monetary commitment to Azure. The commitment is consumed throughout the year by using any combination of the wide variety of cloud services Azure offers.</td>
</tr>
<tr>
<td><img alt="" src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/resellers-icon.png" /></td>
<td><strong>Microsoft reseller</strong>  <br>  <br>Buy Azure through the <a href="https://www.microsoft.com/licensing/licensing-programs/open-license.aspx">Open Licensing program</a>, which provides a simple, flexible way to purchase cloud services from your Microsoft reseller. If you already purchased an Azure in Open license key, <a href="https://azure.microsoft.com/offers/ms-azr-0111p/">activate a new subscription or add more credits now</a>.</td>
</tr>
<tr>
<td><img alt="" src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/partners-icon.png" /></td>
<td><strong>Microsoft partner</strong>  <br>  <br>Find a <a href="https://azure.microsoft.com/partners/directory/">Microsoft partner</a> who can design and implement your Azure cloud solution. These partners have the business and technology expertise to recommend solutions that meet the unique needs of your business.</td>
</tr>
<tr>
<td><img alt="" src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/personal-icon.png" /></td>
<td><strong>Personal free account</strong>  <br>  <br>Any user can sign up for a <a href="https://azure.microsoft.com/free/">free trial account</a>. You can get started using Azure right away, and you won't be charged until you choose to upgrade.</td>
</tr>
</tbody>
</table>
<h2 id="identify-azure-subscription-usage"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#identify-azure-subscription-usage">Identify Azure subscription usage</a></h2>
<p>We reviewed the ways you can obtain an Azure subscription. Now let's look at the types of Azure subscriptions that are available.</p>
<p>Azure offers free and paid subscription options to meet different needs and requirements. The most common subscriptions are <strong>Free</strong>, <strong>Pay-As-You-Go</strong>, <strong>Enterprise Agreement</strong>, and <strong>Student</strong>. For your organization, you can choose a combination of procurement options and subscription choices to meet your business scenarios.</p>
<h4 id="things-to-consider-when-choosing-azure-subscriptions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-choosing-azure-subscriptions">Things to consider when choosing Azure subscriptions</a></h4>
<p>As you think about which types of Azure subscriptions would work for your organization, consider these scenarios:</p>
<ul>
<li>
<p><strong>Consider trying Azure for free</strong>. An Azure free subscription includes a monetary credit to spend on any service for the first 30 days. You get free access to the most popular Azure products for 12 months, and access to more than 25 products that are always free. An Azure free subscription is an excellent way for new users to get started.</p>
<ul>
<li>To set up a free subscription, you need a phone number, a credit card, and a Microsoft account.</li>
<li>The credit card information is used for identity verification only. You aren't charged for any services until you upgrade to a paid subscription.</li>
<li><strong>Consider paying monthly for used services</strong>. A Pay-As-You-Go (PAYG) subscription charges you monthly for the services you used in that billing period. This subscription type is appropriate for a wide range of users, from individuals to small businesses, and many large organizations as well.</li>
</ul>
</li>
<li>
<p><strong>Consider using an Azure Enterprise Agreement</strong>. An Enterprise Agreement provides flexibility to buy cloud services and software licenses under one agreement. The agreement comes with discounts for new licenses and Software Assurance. This type of subscription targets enterprise-scale organizations.</p>
</li>
<li>
<p><strong>Consider supporting Azure for students</strong>. An Azure for Students subscription includes a monetary credit that can be used within the first 12 months.</p>
<ul>
<li>Students can select free services without providing a credit card during the sign-up process.</li>
<li>You must verify your student status through your organizational email address.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>For a complete list of Azure subscription options, see the current <a href="https://azure.microsoft.com/support/legal/offer-details/">Microsoft Azure offers</a>.</p>
<h2 id="implement-microsoft-cost-management"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#implement-microsoft-cost-management">Implement Microsoft Cost Management</a></h2>
<p>With Azure products and services, you pay only for what you use. As you create and use Azure resources, you're charged for the resources.</p>
<p>Microsoft Cost Management provides support for administrative billing tasks and helps you manage billing access to costs. You can use the product to monitor and control Azure spending, and optimize your Azure resource usage.</p>
<p><img alt="Screenshot of the Microsoft Cost Management dashboard showing service name and location costs, and billing forecasts." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/cost-management-67750831.png" /></p>
<h4 id="things-to-know-about-microsoft-cost-management"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-microsoft-cost-management">Things to know about Microsoft Cost Management</a></h4>
<p>Your organization is interested in the benefits of using Microsoft Cost Management to monitor their subscription billing and resource usage. As you plan for your implementation, review the following product characteristics and features:</p>
<ul>
<li>
<p>Microsoft Cost Management shows organizational cost and usage patterns with advanced analytics. Costs are based on negotiated prices and factor in reservation and Azure Hybrid Benefit discounts. Predictive analytics are also available.</p>
</li>
<li>
<p>Reports in Microsoft Cost Management show the usage-based costs consumed by Azure services and third-party Marketplace offerings. Collectively, the reports show your internal and external costs for usage and Azure Marketplace charges. The reports help you understand your spending and resource use, and can help find spending anomalies. Charges, such as reservation purchases, support, and taxes might not be visible in reports.</p>
</li>
<li>
<p>The product uses Azure management groups, budgets, and recommendations to show clearly how your expenses are organized and how you might reduce costs.</p>
</li>
<li>
<p>You can use the Azure portal or various APIs for export automation to integrate cost data with external systems and processes. Automated billing data export and scheduled reports are also available.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-microsoft-cost-management"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-using-microsoft-cost-management">Things to consider when using Microsoft Cost Management</a></h4>
<p>Microsoft Cost Management can help you plan for and control your organization costs. Consider how the product features can be implemented to support your business scenarios:</p>
<ul>
<li>
<p><strong>Consider cost analysis</strong>. Take advantage of Microsoft Cost Management cost analysis features to explore and analyze your organizational costs. You can view aggregated costs by organization to understand where costs are accrued, and to identify spending trends. Monitor accumulated costs over time to estimate monthly, quarterly, or even yearly cost trends against a budget.</p>
</li>
<li>
<p><strong>Consider budget options</strong>. Use Microsoft Cost Management features to establish and maintain budgets. The product helps you plan for and meet financial accountability in your organization. Budgets help prevent cost thresholds or limits from being surpassed. You can utilize analysis data to inform others about their spending to proactively manage costs. The budget features help you see how company spending progresses over time.</p>
</li>
<li>
<p><strong>Consider recommendations</strong>. Review the Microsoft Cost Management recommendations to learn how you can optimize and improve efficiency by identifying idle and underutilized resources. Recommendations can reveal less expensive resource options. When you act on the recommendations, you change the way you use your resources to save money. Using recommendations is an easy process:</p>
<ol>
<li>View cost optimization recommendations to see potential usage inefficiencies.</li>
<li>Act on a recommendation to modify your Azure resource use and implement a more cost-effective option.</li>
<li>Verify the new action to make sure the change has the desired effect.</li>
<li>
<p><strong>Consider exporting cost management data</strong>. Microsoft Cost Management helps you work with your billing information. If you use external systems to access or review cost management data, you can easily export the data from Azure.</p>
</li>
<li>
<p>Set a daily scheduled export in comma-separated-value (CSV) format and store the data files in Azure storage.</p>
</li>
<li>Access your exported data from your external system.</li>
</ol>
</li>
</ul>
<h2 id="apply-resource-tagging"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#apply-resource-tagging">Apply resource tagging</a></h2>
<p>You can apply tags to your Azure resources to logically organize them by categories. Tags are useful for sorting, searching, managing, and doing analysis on your resources.</p>
<p>Each resource tag consists of a name and a value. You could have the tag name <code>Server</code> and the value <code>Production</code> or <code>Development</code>, and then apply the tag/value pair to your Engineering computer resources.</p>
<p>Here's an example that shows how to add tags for a resource group in the Azure portal:</p>
<p><img alt="Screenshot that shows how to add tags for a resource group in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/resource-tags-357b5e1a.png" /></p>
<h4 id="things-to-know-about-resource-tags"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-resource-tags">Things to know about resource tags</a></h4>
<p>As you plan your Azure subscriptions, resources, and services, review these characteristics of Azure resource tags:</p>
<ul>
<li>
<p>Each resource tag has a name and a value.</p>
</li>
<li>
<p>The tag name remains constant for all resources that have the tag applied.</p>
</li>
<li>
<p>The tag value can be selected from a defined set of values, or unique for a specific resource instance.</p>
</li>
<li>
<p>A resource or resource group can have a maximum of 50 tag name/value pairs.</p>
</li>
<li>
<p>Tags applied to a resource group aren't inherited by the resources in the resource group.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-resource-tags"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-using-resource-tags">Things to consider when using resource tags</a></h4>
<p>Here are a few things you can do with resource tags:</p>
<ul>
<li>
<p><strong>Consider searching on tag data</strong>. Search for resources in your subscription by querying on the tag name and value.</p>
</li>
<li>
<p><strong>Consider finding related resources</strong>. Retrieve related resources from other resource groups by searching on the tag name or value.</p>
</li>
<li>
<p><strong>Consider grouping billing data</strong>. Group resources like virtual machines by cost center and production environment. When you download the resource usage comma-separated values (CSV) file for your services, the tags appear in the <code>Tags</code> column.</p>
</li>
<li>
<p><strong>Consider creating tags with PowerShell or the Azure CLI</strong>. Create many resource tags programmatically by using Azure PowerShell or the Azure CLI.</p>
</li>
</ul>
<h4 id="how-to-keep-your-azure-subscription-clean"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#how-to-keep-your-azure-subscription-clean">How to keep your Azure subscription clean</a></h4>
<p><img alt="https://youtu.be/EigjR891PIM" src="https://youtu.be/EigjR891PIM" /></p>
<h2 id="apply-cost-savings"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#apply-cost-savings">Apply cost savings</a></h2>
<p>Azure has several options that can help you gain significant cost savings for your organization. As you prepare your implementation plan for Azure subscriptions, services, and resources, consider the following cost saving advantages.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Cost saving</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Reservations</strong></td>
<td>Save money by paying ahead. You can pay for one year or three years of virtual machine, SQL Database compute capacity, Azure Cosmos DB throughput, or other Azure resources. Pre-paying allows you to get a discount on the resources you use. Reservations can significantly reduce your virtual machine, SQL database compute, Azure Cosmos DB, or other resource costs up to 72% on pay-as-you-go prices. Reservations provide a billing discount and don't affect the runtime state of your resources.</td>
</tr>
<tr>
<td><strong>Azure Hybrid Benefits</strong></td>
<td>Access pricing benefits if you have a license that includes <em>Software Assurance</em>. Azure Hybrid Benefits helps maximize the value of existing on-premises Windows Server or SQL Server license investments when migrating to Azure. There's an Azure Hybrid Benefit Savings Calculator to help you determine your savings.</td>
</tr>
<tr>
<td><strong>Azure Credits</strong></td>
<td>Use the monthly credit benefit to develop, test, and experiment with new solutions on Azure. As a Visual Studio subscriber, you could use Microsoft Azure at no extra charge. With your monthly Azure credit, Azure is your personal sandbox for development and testing.</td>
</tr>
<tr>
<td><strong>Azure regions</strong></td>
<td>Compare pricing across regions. Pricing can vary from one region to another, even in the US. Double check the pricing in various regions to see if you can save by selecting a different region for your subscription.</td>
</tr>
<tr>
<td><strong>Budgets</strong></td>
<td>Apply the budgeting features in Microsoft Cost Management to help plan and drive organizational accountability. With budgets, you can account for the Azure services you consume or subscribe to during a specific period. Monitor spending over time and inform others about their spending to proactively manage costs. Use budgets to compare and track spending as you analyze costs.</td>
</tr>
<tr>
<td><strong>Pricing Calculator</strong></td>
<td>The <a href="https://azure.microsoft.com/pricing/calculator/">Pricing Calculator</a> provides estimates in all areas of Azure, including compute, networking, storage, web, and databases.</td>
</tr>
</tbody>
</table>
<p>The following image shows a scenario for using the Pricing Calculator. The customer has an instance of a D1 series VM on Windows. The instance is running in the West US region at the standard tier level.</p>
<p><img alt="Screenshot of the Pricing Calculator with estimates for an instance of a D1 series VM on Windows. The instance is running in the West US region at the standard tier level." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-subscriptions/media/pricing-calculator-c1cb80d5.png" /></p>
<h2 id="summary-and-resources_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#summary-and-resources_1">Summary and resources</a></h2>
<p>Azure Administrators commonly obtain and manage Azure subscriptions. Azure subscriptions help you effectively identify and manage costs for your organization, so you can provide services and resources for specific scenarios.</p>
<p>In this module, you learned about supported Azure regions, and how to locate Azure services. You reviewed the features and use cases for Azure subscriptions, and how to obtain subscriptions. You explored features and billing for different types of Azure subscriptions, and how to apply resource tagging. You discovered how Microsoft Cost Management can be used for cost analysis. You learned how to identify ways you can reduce your billing costs.</p>
<p>The main takeaways from this module are:</p>
<ul>
<li>
<p>Azure regions provide flexibility, data residency, compliance, and resiliency options.</p>
</li>
<li>
<p>Azure subscriptions are essential for managing access to Azure resources and billing.</p>
</li>
<li>
<p>Azure offers various subscription options such as Free, Pay-As-You-Go, Enterprise Agreement, and Student.</p>
</li>
<li>
<p>Azure offers cost-saving options such as reservations, Azure Hybrid Benefits and Azure credits.</p>
</li>
<li>
<p>Resource tagging allows for organizing and analyzing resources in Azure.</p>
</li>
<li>
<p>Microsoft Cost Management helps monitor and control Azure spending.</p>
</li>
<li>
<p>The Pricing Calculator provides billing estimates for different usage cases.</p>
</li>
</ul>
<h3 id="learn-more-with-azure-documentation_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learn-more-with-azure-documentation_1">Learn more with Azure documentation</a></h3>
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/cost-management-billing/#cost-management">Cost management</a>. This collection of articles covers pricing, reporting, analytics, monitoring and optimizing costs.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/cost-management-billing/#billing---subscriptions">Billing and subscriptions management</a>. This collection of articles covers managing your account, subscriptions, bills, and payments.</p>
</li>
<li>
<p><a href="https://azure.microsoft.com/pricing/calculator/">Pricing calculator</a>. This tool estimates the hourly or monthly costs for using Azure.</p>
</li>
</ul>
<h3 id="learn-more-with-self-paced-training_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learn-more-with-self-paced-training_1">Learn more with self-paced training</a></h3>
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/training/paths/control-spending-manage-bills/">Control Azure spending and manage bills with Microsoft Cost Management + Billing</a>. Learn how to monitor and control your Azure spending and optimize the use of Azure resources.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/training/modules/analyze-costs-create-budgets-azure-cost-management/">Introduction to analyzing costs and creating budgets with Microsoft Cost Management (exercise, subscription required)</a>. Learn how to use cost analysis to understand how your costs accrue each month. Use this understanding to create an Azure budget to monitor and alert on your costs.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/training/modules/describe-cost-management-azure/">Describe cost management in Azure (exercise, subscription required)</a>. Explore methods to estimate, track, and manage costs in Azure.</p>
</li>
</ul>
<hr />
<h2 id="configure-azure-policy"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#configure-azure-policy">Configure Azure Policy</a></h2>
<p>Learn how to configure Azure Policy to implement compliance requirements.</p>
<h3 id="learning-objectives_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learning-objectives_1">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Create management groups to target policies and spending budgets.</li>
<li>Implement Azure Policy with policy and initiative definitions.</li>
<li>Scope Azure policies and determine compliance.</li>
</ul>
<h2 id="introduction_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#introduction_2">Introduction</a></h2>
<p><a href="https://azure.microsoft.com/services/azure-policy/">Azure Policy</a> is a service in Azure that enables you to create, assign, and manage policies to control or audit your resources. These policies enforce different rules over your resource configurations so the configurations stay compliant with corporate standards.</p>
<p>Your company is subject to many regulations and compliance rules. Your company wants to ensure each department implements and deploys resources correctly. You're responsible for investigating how to use Azure Policy and management groups to implement compliance measures.</p>
<p>In this module, you learn how to implement Azure policies. The content includes examples of policy definitions and initiative definitions. You learn how to scope your policies and identify noncompliant resources. You also learn the benefits and usage of management groups.</p>
<p>The goal to this module is to ensure Administrators can use Azure policy to ensure resource compliance.</p>
<h3 id="learning-objectives_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learning-objectives_2">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>
<p>Implement Azure Policy with policy and initiative definitions.</p>
</li>
<li>
<p>Scope Azure policies and determine compliance.</p>
</li>
<li>
<p>Create management groups to target policies and spending budgets.</p>
</li>
</ul>
<h3 id="skills-measured_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#skills-measured_1">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#prerequisites_1">Prerequisites</a></h3>
<ul>
<li>Basic understanding of Azure concepts, such as subscriptions, resource groups, and resources.</li>
<li>Working knowledge of governance concepts, such as compliance and reporting.</li>
<li>Familiarity with Azure Resource Manager and how to use it to deploy and manage resources.</li>
<li>Knowledge of JSON syntax so you can create policy definitions and policy assignments.</li>
</ul>
<h2 id="create-management-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-management-groups">Create management groups</a></h2>
<p>Organizations that use multiple subscriptions need a way to efficiently manage access, policies, and compliance. Azure management groups provide a level of scope and control above your subscriptions. You can use management groups as containers to manage access, policy, and compliance across your subscriptions.</p>
<p>Things to know about management groups
Consider the following characteristics of Azure management groups:</p>
<p>By default, all new subscriptions are placed under the top-level management group, or root group.</p>
<p>All subscriptions within a management group automatically inherit the conditions applied to that management group.</p>
<p>A management group tree can support up to six levels of depth.</p>
<p>Azure role-based access control authorization for management group operations isn't enabled by default.</p>
<p>The following diagram shows how Azure management groups can be used to organize subscriptions in a hierarchy of unified policy and access management. In this scenario, the organization has a single top-level management group. Every directory under the root group is folded into the top-level group.</p>
<p><img alt="" src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/management-groups-aa92c04a.png" /></p>
<p>Things to consider when using management groups
Review the following ways you can use management groups in Azure Policy to manage your subscriptions:</p>
<ul>
<li>
<p><strong>Consider custom hierarchies and groups</strong>. Align your Azure subscriptions by using custom hierarchies and grouping that meet your company's organizational structure and business scenarios. You can use management groups to target policies and spending budgets across subscriptions.</p>
</li>
<li>
<p><strong>Consider policy inheritance</strong>. Control the hierarchical inheritance of access and privileges in policy definitions. All subscriptions within a management group inherit the conditions applied to the management group. You can apply policies to a management group to limit the regions available for creating virtual machines (VMs). The policy can be applied to all management groups, subscriptions, and resources under the initial management group, to ensure VMs are created only in the specified regions.</p>
</li>
<li>
<p><strong>Consider compliance rules</strong>. Organize your subscriptions into management groups to help meet compliance rules for individual departments and teams.</p>
</li>
<li>
<p><strong>Consider cost reporting</strong>. Use management groups to do cost reporting by department or for specific business scenarios. You can use management groups to report on budget details across subscriptions.</p>
</li>
</ul>
<h2 id="create-management-groups_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-management-groups_1">Create management groups</a></h2>
<p>You can create a management group with Azure Policy by using the Azure portal, PowerShell, or the Azure CLI. Here's an example of what you see in the Azure portal:</p>
<p><img alt="" src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/create-management-groups-66ff9f21.png" /></p>
<p>A management group has a directory unique identifier (ID) and a display name. The ID is used to submit commands on the management group. The ID value can't be changed after it's created because it's used throughout the Azure system to identify the management group. The display name for the management group is optional and can be changed at any time.</p>
<h2 id="implement-azure-policies"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#implement-azure-policies">Implement Azure policies</a></h2>
<p>Azure Policy is a service in Azure that you can use to create, assign, and manage policies. You can use policies to enforce rules on your resources to meet corporate compliance standards and service level agreements. Azure Policy runs evaluations and scans on your resources to make sure they're compliant.</p>
<h4 id="things-to-know-about-azure-policy"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-know-about-azure-policy">Things to know about Azure Policy</a></h4>
<p>The main advantages of Azure Policy are in the areas of enforcement and compliance, scaling, and remediation. Azure Policy is also important for teams that run an environment that requires different forms of governance.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Advantage</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Enforce rules and compliance</strong></td>
<td>Enable built-in policies, or build custom policies for all resource types. Support real-time policy evaluation and enforcement, and periodic or on-demand compliance evaluation.</td>
</tr>
<tr>
<td><strong>Apply policies at scale</strong></td>
<td>Apply policies to a management group with control across your entire organization. Apply multiple policies and aggregate policy states with policy initiative. Define an exclusion scope.</td>
</tr>
<tr>
<td><strong>Perform remediation</strong></td>
<td>Conduct real-time remediation, and remediation on your existing resources.</td>
</tr>
<tr>
<td><strong>Exercise governance</strong></td>
<td>Implement governance tasks for your environment:  <br>- Support multiple engineering teams (deploying to and operating in the environment)  <br>- Manage multiple subscriptions  <br>- Standardize and enforce how cloud resources are configured  <br>- Manage regulatory compliance, cost control, security, and design consistency</td>
</tr>
</tbody>
</table>
<h4 id="things-to-consider-when-using-azure-policy"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#things-to-consider-when-using-azure-policy">Things to consider when using Azure Policy</a></h4>
<p>Review the following scenarios for using Azure Policy. Consider how you can implement the service in your organization.</p>
<ul>
<li>
<p><strong>Consider deployable resources</strong>. Specify the resource types that your organization can deploy by using Azure Policy. You can specify the set of virtual machine SKUs that your organization can deploy.</p>
</li>
<li>
<p><strong>Consider location restrictions</strong>. Restrict the locations your users can specify when deploying resources. You can choose the geographic locations or regions that are available to your organization.</p>
</li>
<li>
<p><strong>Consider rules enforcement</strong>. Enforce compliance rules and configuration options to help manage your resources and user options. You can enforce a required tag on resources and define the allowed values.</p>
</li>
<li>
<p><strong>Consider inventory audits</strong>. Use Azure Policy with Azure Backup service on your VMs and run inventory audits.</p>
</li>
</ul>
<h2 id="create-azure-policies"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-azure-policies">Create Azure policies</a></h2>
<p>Azure Administrators use Azure Policy to create policies that define conventions for resources. A <em>policy definition</em> describes the compliance conditions for a resource, and the actions to complete when the conditions are met. One or more policy definitions are grouped into an <em>initiative definition</em>, to control the scope of your policies and evaluate the compliance of your resources.</p>
<p><img alt="Diagram that shows an initiative definition for a group of policy definitions that are applied to resources." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/implement-azure-policy-b4a4a47c.png" /></p>
<p>There are four basic steps to create and work with policy definitions in Azure Policy.</p>
<h4 id="step-1-create-policy-definitions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#step-1-create-policy-definitions">Step 1: Create policy definitions</a></h4>
<p>A policy definition expresses a condition to evaluate and the actions to perform when the condition is met. You can create your own policy definitions, or choose from built-in definitions in Azure Policy. You can create a policy definition to prevent VMs in your organization from being deployed, if they're exposed to a public IP address.</p>
<h4 id="step-2-create-an-initiative-definition"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#step-2-create-an-initiative-definition">Step 2: Create an initiative definition</a></h4>
<p>An initiative definition is a set of policy definitions that help you track your resource compliance state to meet a larger goal. You can create your own initiative definitions, or use built-in definitions in Azure Policy. You can use an initiative definition to ensure resources are compliant with security regulations.</p>
<h4 id="step-3-scope-the-initiative-definition"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#step-3-scope-the-initiative-definition">Step 3: Scope the initiative definition</a></h4>
<p>Azure Policy lets you control how your initiative definitions are applied to resources in your organization. You can limit the scope of an initiative definition to specific management groups, subscriptions, or resource groups.</p>
<h4 id="step-4-determine-compliance"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#step-4-determine-compliance">Step 4: Determine compliance</a></h4>
<p>After you assign an initiative definition, you can evaluate the state of compliance for all your resources. Individual resources, resource groups, and subscriptions within a scope can be exempted from having the policy rules affect it. Exclusions are handled individually for each assignment.</p>
<h2 id="create-policy-definitions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-policy-definitions">Create policy definitions</a></h2>
<p>Azure Policy offers built-in policy definitions to help you quickly configure control conditions for your resources. In addition to the built-in policies, you can also create your own definitions, or import definitions from other sources.</p>
<h3 id="access-built-in-policy-definitions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#access-built-in-policy-definitions">Access built-in policy definitions</a></h3>
<p>You can sort the <a href="https://learn.microsoft.com/en-us/azure/governance/policy/samples/built-in-policies">list of built-in definitions</a> by category to search for policies that meet your business needs.</p>
<p><img alt="Screenshot that shows a list of built-in policy definitions in Azure Policy." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/policy-definition-3ce7a058.png" /></p>
<p>Here are some examples of built-in policy definitions:</p>
<ul>
<li>
<p><strong>Allowed virtual machine size SKUs</strong>: Specify a set of VM size SKUs that your organization can deploy. This policy is located under the Compute category.</p>
</li>
<li>
<p><strong>Allowed locations</strong>: Restrict the locations users can specify when deploying resources. Use this policy to enforce your geo-compliance requirements. This policy is located under the General category.</p>
</li>
<li>
<p><strong>Configure Azure Device Update for IoT Hub accounts to disable public network access</strong>: Disable public network access for your Device Update for IoT Hub resources. This policy is located under the Internet of Things category.</p>
</li>
</ul>
<h3 id="add-new-policy-definitions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#add-new-policy-definitions">Add new policy definitions</a></h3>
<p>If you don't find a built-in policy to meet your business needs, you can add or create a new definition. Policy definitions can also be imported into Azure Policy from <a href="https://github.com/Azure/azure-policy/tree/master/samples">GitHub</a>. New policy definitions are added to the samples repository almost daily.</p>
<p><img alt="Screenshot that shows how to add a new policy definition, and the option to import a sample policy definition from GitHub." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/new-policy-definition-46cb3ecb.png" /></p>
<p>Note</p>
<p>When you add or create a policy definition, be sure the definition uses the specific JSON format required by Azure. For more information, see <a href="https://learn.microsoft.com/en-us/azure/governance/policy/concepts/definition-structure">Azure Policy definition structure</a>.</p>
<h2 id="create-an-initiative-definition"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-an-initiative-definition">Create an initiative definition</a></h2>
<p>After you determine your policy definitions, the next step is to create an initiative definition for your policies. An initiative definition has one or more policy definitions. One example for using initiative definitions is to ensure your resources are compliant with security regulations.</p>
<blockquote>
<p>Tip</p>
<p>Even if you have only a few policy definitions in your organization, we recommend creating and applying an initiative definition.</p>
</blockquote>
<h3 id="add-a-new-initiative-definition"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#add-a-new-initiative-definition">Add a new initiative definition</a></h3>
<p>When you create an initiative definition, be sure the definition uses the specific JSON format required by Azure. For more information, see <a href="https://learn.microsoft.com/en-us/azure/governance/policy/concepts/initiative-definition-structure">Azure Policy initiative definition structure</a>.</p>
<p>Here's an example of how to create a new initiative definition in the Azure portal:</p>
<p><img alt="Screenshot that shows how to create a new initiative definition." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/create-initiative-definition-e1198a51.png" /></p>
<h3 id="use-a-built-in-initiative-definition"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#use-a-built-in-initiative-definition">Use a built-in initiative definition</a></h3>
<p>You can create your own initiative definitions, or use built-in definitions in Azure Policy. You can sort the <a href="https://learn.microsoft.com/en-us/azure/governance/policy/samples/built-in-initiatives">list of built-in initiatives</a> by category to search for definitions for your organization.</p>
<p>Here are some examples of built-in initiative definitions:</p>
<ul>
<li>
<p><strong>Audit machines with insecure password security settings</strong>: Use this initiative to deploy an audit policy to specified resources in your organization. The definition evaluates the resources to check for insecure password security settings. This initiative is located in the Guest Configuration category.</p>
</li>
<li>
<p><strong>Configure Windows machines to run Azure Monitor Agent and associate them to a Data Collection Rule</strong>: Use this initiative to monitor and secure your Windows VMs, Virtual Machine Scale Sets, and Arc machines. The definition deploys the Azure Monitor Agent extension and associates the resources with a specified Data Collection Rule. This initiative is located in the Monitoring category.</p>
</li>
<li>
<p><strong>Configure Azure Defender to be enabled on SQL servers</strong>: Enable Azure Defender on your Azure SQL Servers to detect anomalous activities indicating unusual and potentially harmful attempts to access or exploit databases. This initiative is located in the SQL category.</p>
</li>
</ul>
<h2 id="scope-the-initiative-definition"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#scope-the-initiative-definition">Scope the initiative definition</a></h2>
<p>After you create your initiative definition, the next step is to assign the initiative to establish the scope for the policies. The scope determines what resources or grouping of resources are affected by the conditions of the policies.</p>
<p>Here's an example that shows how to configure the scope assignment:</p>
<p><img alt="Screenshot that shows how to assign an initiative definition to resources or groups or resources to establish the scope." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/assign-definition-87bc203c.png" /></p>
<p>To establish the scope, you select the affected subscriptions. As an option, you can also choose the affected resource groups.</p>
<p>The following example shows how to apply the scope:</p>
<p><img alt="Screenshot that shows how a scope is applied to a subscription, and optionally applied to a resource group." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/scope-initiative-9fbf59d5.png" /></p>
<h2 id="determine-compliance"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#determine-compliance">Determine compliance</a></h2>
<p>You have your policies defined, your initiative definition created, and your policies assigned to affected resources. The last step is to evaluate the state of compliance for your scoped resources.</p>
<p>The following example shows how you can use the <strong>Compliance</strong> feature to look for non-compliant initiatives, policies, and resources.</p>
<p><img alt="Screenshot that shows how to use the compliance feature to look for non-compliant initiatives, policies, and resources." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/determine-compliance-c198f4ba.png" /></p>
<p>Your policy conditions are evaluated against your existing scoped resources. Although the Azure portal doesn't show the evaluation logic, the compliance state results are shown. The compliance state result is either compliant or non-compliant.</p>
<h2 id="interactive-lab-simulation"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#interactive-lab-simulation">Interactive lab simulation</a></h2>
<h3 id="lab-scenario"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#lab-scenario">Lab scenario</a></h3>
<p>Your organization is piloting a new infrastructure project. The CTO wants to know which Azure resources are being used on the new project. Your specific tasks are:</p>
<ul>
<li>Create a way to tag the project resources.</li>
<li>Don't allow resources to be created without the resource tag.</li>
<li>If a resource is created without the tag, automatically add the tag.</li>
</ul>
<h3 id="architecture-diagram"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#architecture-diagram">Architecture diagram</a></h3>
<p><img alt="Architecture diagram as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/lab-02b.png" /></p>
<h3 id="objectives"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#objectives">Objectives</a></h3>
<ul>
<li><strong>Task 1</strong>: Create and assign tags via the Azure portal.<ul>
<li>For testing purposes, identify the Cloud Shell resource group.</li>
<li>Add a tag to the resource group. Assign the value of the tag.</li>
<li>Verify the storage account in the resource group doesn't have the tag.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Enforce tagging by using an Azure policy.<ul>
<li>Locate the <strong>Require a tag and its value on resources</strong> built-in policy and review the definition.</li>
<li>Assign the policy to the resource group.</li>
<li>Configure the required tag: <strong>Role</strong> with a value of <strong>Infra</strong>.</li>
<li>Create a new storage account in the resource group and verify without the tag you can't create the resource.</li>
</ul>
</li>
<li><strong>Task 3</strong>: Automatically apply tagging by using an Azure policy.<ul>
<li>Assign the <strong>Inherit a tag from the resource group if missing</strong> built-in policy to the resource group.</li>
<li>Configure remediation to automatically add the <strong>Role</strong> tag if it is missing from a new resource.</li>
<li>Create a new storage account and verify the tag and value are added.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Click on the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%203"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-policy/media/simulation-policy-thumbnail.jpg" /></a></p>
<h2 id="summary-and-resources_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#summary-and-resources_2">Summary and resources</a></h2>
<p>Azure Policy is a service in Azure that enables you to create, assign, and manage policies. Azure Policy helps you define and implement your governance strategy by using policies to control and audit your resources.</p>
<p>In this module, you have learned about Azure Policy and how it allows you to control and audit your resources. You explored how to implement Azure policy definitions and initiatives for your corporate departments. You learned how to create management groups, scope policies, and manage spending budgets. You reviewed how Azure policies can be scoped to meet compliance regulations.</p>
<p>The main takeaways from this module are:</p>
<ul>
<li>Azure Policy is a powerful service in Azure that enables you to enforce rules and ensure compliance with corporate standards and service level agreements.</li>
<li>Management groups provide a way to efficiently manage access, policies, and compliance across multiple subscriptions, allowing for unified policy and access management.</li>
<li>Creating policy definitions and initiative definitions allows you to define conventions for resources and control the scope of policies, ensuring resource compliance.</li>
<li>The Compliance feature in Azure Policy helps you determine the compliance state of your resources and evaluate whether they're compliant or non-compliant.</li>
</ul>
<h3 id="learn-more-with-azure-documentation_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learn-more-with-azure-documentation_2">Learn more with Azure documentation</a></h3>
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/governance/policy/">Azure Policy documentation</a>. This collection of articles is your starting point for all things Azure policy.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/governance/policy/samples/built-in-policies">Azure Policy built-in policy definitions</a>. This page is an index of Azure Policy built-in policy definitions.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/governance/policy/samples/built-in-initiatives">Azure built-in policy initiatives</a>. This page is an index of Azure Policy built-in initiative definitions.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/governance/policy/assign-policy-portal">Quickstart: Create a policy assignment to identify noncompliant resources</a>. This quickstart steps you through the process of creating a policy assignment to identify virtual machines that aren't using managed disks.</p>
</li>
</ul>
<h3 id="learn-more-with-self-paced-training_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learn-more-with-self-paced-training_2">Learn more with self-paced training</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-policy/">Introduction to Azure Policy</a>. This module introduces you to Azure Policy and describes its characteristics, capabilities, and use cases.</li>
</ul>
<hr />
<h2 id="manage-users-and-groups-in-microsoft-entra-id"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#manage-users-and-groups-in-microsoft-entra-id">Manage users and groups in Microsoft Entra ID</a></h2>
<p>In this module, you'll learn to manage users and groups in Microsoft Entra ID.</p>
<h3 id="learning-objectives_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learning-objectives_3">Learning objectives</a></h3>
<p>In this module, you will:</p>
<ul>
<li>Learn the difference between Microsoft Entra ID and Windows Server Active Directory.</li>
<li>Understand tenants, subscriptions, and users.</li>
<li>Create a new Microsoft Entra ID.</li>
<li>Add users and groups to a Microsoft Entra ID.</li>
<li>Manage roles in a Microsoft Entra ID.</li>
<li>Learn how to create a hybrid identity solution with Microsoft Entra Connect.</li>
</ul>
<h2 id="introduction_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#introduction_3">Introduction</a></h2>
<p>Transitioning workloads to the cloud involves more than just moving servers, websites, and data. Companies need to think about how to secure those resources, identify authorized users, and ensure that the data accessed, services created, and operations performed by those users is permitted. Security is a complex area, and it's easy to get wrong, as shown by the multitude of successful attacks on big companies in the news.</p>
<p>We need to control user access to company data centrally, provide a definitive identity for each user that a company uses for each service, and ensure employees and vendors have <em>just enough access</em> to do their job. When an employee leaves or a vendor's contract is over, ensuring that their access is removed is even more important.</p>
<p>Azure tries to make these sorts of problems easier to solve with Microsoft Entra ID. Microsoft Entra ID is Microsoft's cloud-based identity and access-management service, which provides single sign-on and multifactor authentication to help protect your users from 99.9 percent of cybersecurity attacks.</p>
<h3 id="learning-objectives_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learning-objectives_4">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Learn the difference between Microsoft Entra ID and Windows Server Active Directory.</li>
<li>Understand tenants, subscriptions, and users.</li>
<li>Create a new Microsoft Entra ID.</li>
<li>Add users and groups to a Microsoft Entra ID.</li>
<li>Manage roles in a Microsoft Entra ID.</li>
<li>Learn how to create a hybrid identity solution with Microsoft Entra Connect.</li>
</ul>
<h3 id="prerequisites_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#prerequisites_2">Prerequisites</a></h3>
<ul>
<li>Basic understanding of identity and role-based access control</li>
<li>Experience using the Azure portal</li>
</ul>
<h2 id="what-is-microsoft-entra-id"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#what-is-microsoft-entra-id">What is Microsoft Entra ID?</a></h2>
<p>Though they once shared a similar name, Microsoft Entra ID is <em>not</em> a cloud version of Windows Server Active Directory. It's also not intended as a complete replacement for an on-premises Active Directory. Instead, if you're already using a Windows AD server, you can connect it to Microsoft Entra ID to extend your directory into Azure. This approach allows users to use the same credentials to access local and cloud-based resources.</p>
<p><img alt="Conceptual art showing Windows AD and Microsoft Entra ID controlling resources." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/2-azure-vs-windows-ad.png" /></p>
<p>A user can also use Microsoft Entra ID independently of Windows AD. Smaller companies can use Microsoft Entra ID as their only directory service to control access to their applications and SaaS products, such as Microsoft 365, Salesforce, and Dropbox.</p>
<p>Note</p>
<p>Keep in mind that this approach doesn't provide a completely centralized administrative model; for example, local Windows machines would authenticate using local credentials. Users can write applications to use Microsoft Entra ID and provide authentication and authorization to be administered by a user in a single place.</p>
<h3 id="directories-subscriptions-and-users"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#directories-subscriptions-and-users">Directories, subscriptions, and users</a></h3>
<p>Microsoft offers several cloud-based offerings today, all of which can use Microsoft Entra ID to identify users and control access:</p>
<ul>
<li>Microsoft Azure</li>
<li>Microsoft 365</li>
<li>Microsoft Intune</li>
<li>Microsoft Dynamics 365</li>
</ul>
<p>When a company or organization signs up to use one of these offerings, they're assigned a default <em>directory</em>, an instance of Microsoft Entra ID. This directory holds the users and groups that will have access to each of the services the company has purchased. You can refer to this default directory as a <em>tenant</em>. A tenant represents the organization and the default directory assigned to it.</p>
<p><strong>A <em>subscription</em> in Azure is both a billing entity and a security boundary</strong>. Resources such as virtual machines, websites, and databases are associated with a single subscription. Each subscription also has a single account <em>owner</em> responsible for any charges incurred by resources in that subscription. If your organization wants a subscription billed to another account, you can transfer the subscription. <code>A subscription is associated with a **single Microsoft Entra directory**</code>. Multiple subscriptions can trust the same directory, but a subscription can only trust one directory.</p>
<p>You can add users and groups to multiple subscriptions. This allows the user to create, control, and access resources in the subscription. When you add a user to a subscription, the user must be known to the associated directory, as shown in the following image:</p>
<p><img alt="Conceptual art showing users, directories, and subscriptions in Azure." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/2-users-subs-and-directories.png" /></p>
<p>If you belong to multiple directories, you can switch the current directory in which you're working through the <strong>Directory + subscription</strong> button in the Azure portal header.</p>
<p><img alt="Screenshot showing the Directory selection dialog in Azure portal." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/2-directory-and-subscription.png" /></p>
<p>You can also decide how the default directory is selected: last visited or a specific directory. You can also set the default filter for displayed subscriptions. Default filters are useful if you have access to several subscriptions, but typically only work in a few of them.</p>
<h3 id="create-a-new-directory"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-a-new-directory">Create a new directory</a></h3>
<p>An organization (tenant) has one associated default Microsoft Entra directory. However, owners can create additional directories to support development or testing purposes, or because they want to have separate directories to synchronize with their local Windows Server AD forests.</p>
<p>Important</p>
<p>The steps to create a new directory follow; however, unless you're an owner of your Azure account, this option won't be available to you. The Azure Sandbox doesn't allow you to create new Microsoft Entra directories.</p>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/">Azure portal</a>.</p>
</li>
<li>
<p>On the Azure home page, under <strong>Azure services</strong>, select <strong>Create a resource</strong>.</p>
</li>
<li>
<p>In the left menu pane, select <strong>Identity</strong>, and then search for and select <strong>Microsoft Entra ID</strong>.</p>
</li>
<li>
<p>Select <strong>Create</strong>.</p>
</li>
<li>
<p>Select <strong>Microsoft Entra ID</strong> for the tenant type, then select <strong>Next : Configuration</strong>.</p>
</li>
<li>
<p>Enter the following values for each setting.</p>
<ul>
<li>
<p><strong>Organization name</strong>: Enter a name for the directory to help distinguish it from your other directories. The directory to be created will be used in production; provide a name that your users will recognize as your organization's name. You can change the name later if you want.</p>
</li>
<li>
<p><strong>Initial domain name</strong>: Enter a domain name associated with your organization. Azure will give a validation error unless the domain isn't known. The default domain name will always have the suffix <code>.onmicrosoft.com</code>. You can't change the default domain. If you choose to, you can add a custom domain owned by your organization so defined users can use a traditional company email, such as <code>john@contoso.com</code>.</p>
</li>
<li>
<p><strong>Country or region</strong>: Select the country/region in which the directory should reside. The country/region will identify the region and data center where the Microsoft Entra instance will live; you can't change it later.</p>
</li>
</ul>
<p><img alt="Screenshot showing the AD creation process." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/2-create-directory.png" /></p>
</li>
<li>
<p>Select <strong>Create</strong> to create the new directory. A free tier directory will be created where you can add users, create roles, register apps and devices, and control licenses.</p>
</li>
</ol>
<p>After you've created the directory, select <strong>Click here to manage your new tenant</strong> to go to the Overview dashboard that lets you control all directory aspects.</p>
<p><img alt="Screenshot of the Microsoft Entra dashboard." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/2-aad-dashboard.png" /></p>
<p>Let's explore one of the primary elements you'll work with in Microsoft Entra ID: <strong>users</strong>.</p>
<h2 id="create-and-manage-users"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-and-manage-users">Create and manage users</a></h2>
<p>Every user who needs access to Azure resources needs an Azure user account. Your user account contains all the information needed to authenticate you during the sign-in process. Once authenticated, Microsoft Entra ID builds an access token to authorize you, determine what resources you can access, and determine what you can do with those resources.</p>
<p>You can use the <strong>Microsoft Entra ID</strong> dashboard in the Azure portal to work with user objects. Keep in mind that you can only work with a single directory at a time, but you can use the <strong>Directory + Subscription</strong> pane to switch directories. The dashboard also has a <strong>Manage tenants</strong> button in the toolbar, which makes it easy to view all your directories and switch to another available directory.</p>
<h3 id="view-users"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#view-users">View users</a></h3>
<p>To view the Microsoft Entra users, in the left menu pane, under <strong>Manage</strong>, select <strong>Users</strong>. The <strong>All Users</strong> pane appears. Notice the <strong>User type</strong> and <strong>Identities</strong> columns, as shown in the following screenshot:</p>
<p><img alt="Screenshot that depicts the All users pane, with the User type and Identities columns noted." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/m1-aad-users.png" /></p>
<p>Typically, Microsoft Entra ID defines users in three ways:</p>
<ul>
<li>
<p><strong>Cloud identities</strong>: These users exist only in Microsoft Entra ID. Examples are administrator accounts and users that you manage yourself. Their source is <strong>Microsoft Entra ID</strong> or <strong>External Microsoft Entra ID</strong> if the user is defined in another Microsoft Entra instance, but needs access to subscription resources controlled by this directory. When these accounts are removed from the primary directory, they are deleted.</p>
</li>
<li>
<p><strong>Directory-synchronized identities</strong>: These users exist in an on-premises Active Directory. A synchronization activity that occurs via <strong>Microsoft Entra Connect</strong> brings these users in to Azure. Their source is <strong>Windows Server AD</strong>.</p>
</li>
<li>
<p><strong>Guest users</strong>: These users exist outside Azure. Examples are accounts from other cloud providers and Microsoft accounts, such as an Xbox LIVE account. Their source is <strong>Invited user</strong>. This type of account is useful when external vendors or contractors need access to your Azure resources. Once their help is no longer necessary, you can remove the account and all of their access.</p>
</li>
</ul>
<h3 id="add-users"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#add-users">Add users</a></h3>
<p>You can add cloud identities to Microsoft Entra ID in multiple ways:</p>
<ul>
<li>Syncing an on-premises Windows Server Active Directory</li>
<li>Using the Azure portal</li>
<li>Using the command line</li>
<li>Other options</li>
</ul>
<h4 id="sync-an-on-premises-windows-server-active-directory"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#sync-an-on-premises-windows-server-active-directory">Sync an on-premises Windows Server Active Directory</a></h4>
<p>Microsoft Entra Connect is a separate service that allows you to synchronize a traditional Active Directory with your Microsoft Entra instance. This is how most enterprise customers add users to the directory. The advantage to this approach is users can use single sign-on (SSO) to access local and cloud-based resources.</p>
<h4 id="use-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#use-the-azure-portal">Use the Azure portal</a></h4>
<p>You can manually add new users through the Azure portal. This is the easiest way to add a small set of users. You need to be in the <strong>User Administrator</strong> role to perform this function.</p>
<ol>
<li>
<p>To add a new user with the Azure portal, in the top menu bar, select <strong>New user</strong>, then select <strong>Create new user</strong>.</p>
<p><img alt="Screenshot showing the New User button highlighted in the Microsoft Entra admin center." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/2-new-user-all-users-pane.png" /></p>
</li>
<li>
<p>In addition to <strong>Name</strong> and <strong>User name</strong>, you can add profile information, like <strong>Job Title</strong> and <strong>Department</strong>, on the <strong>Properties</strong> tab.</p>
<p><img alt="Screenshot showing the New user dialog." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/2-new-user-user-pane.png" /></p>
<p>The default behavior is to create a new user in the organization. The user will have a username with the default domain name assigned to the directory such as alice@staracoustics.onmicrosoft.com.</p>
</li>
<li>
<p>You can also <em>invite</em> a user into the directory. In this case, an email is sent to a known email address, and an account is created and associated with that email address if the user accepts the invitation.</p>
<p><img alt="Screenshot showing the invite screen." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/3-new-user-invite.png" /></p>
<p>The invited user will need to create an associated Microsoft account (MSA) if that specific email address isn't associated with one, and the account will be added to the Microsoft Entra ID as a guest user.</p>
</li>
</ol>
<h4 id="use-the-command-line"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#use-the-command-line">Use the command line</a></h4>
<p>If you have a lot of users to add, a better option is to use a command-line tool. You can run the <a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.users/new-mguser">New-MgUser</a> PowerShell command to add cloud-based users.</p>
<p>PowerShellCopy</p>
<div class="highlight"><pre><span></span><code># Create a password profile value
$PasswordProfile = @{ Password = &quot;&lt;Password&gt;&quot; }

# Create the new user
New-MgUser -DisplayName &quot;Abby Brown&quot; -PasswordProfile $PasswordProfile -MailNickName &quot;AbbyB&quot; -UserPrincipalName &quot;AbbyB@contoso.com&quot; -AccountEnabled 
</code></pre></div>
<p>The command will return the new user object you created.</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>DisplayName Id                                    UserPrincipalName
----------- --                                    -----------------
Abby Brown  f36634c8-8a93-4909-9248-0845548bc515  AbbyB@contoso.com
</code></pre></div>
<p>If you prefer a more standard command-line interface, you can use the Azure CLI:</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az ad user create --display-name &quot;Abby Brown&quot; \
                  --password &quot;&lt;password&gt;&quot; \
                  --user-principal-name &quot;AbbyB@contoso.com&quot; \
                  --force-change-password-next-login true \
                  --mail-nickname &quot;AbbyB&quot;
</code></pre></div>
<p>Command-line tools allow you to add users in bulk through scripting. The most common approach for this is to use a comma-separated values (CSV) file. You can either manually create this file or export the file from an existing data source.</p>
<p>If you're planning to use a CSV, here are some things to think about:</p>
<ul>
<li>
<p><strong>Naming conventions</strong>: Establish or implement a naming convention for usernames, display names, and aliases. For example, a username might consist of the last name, followed by a period (.), followed by the first name; for example, Smith.John@contoso.com.</p>
</li>
<li>
<p><strong>Passwords</strong>: Implement a convention for the initial password of a newly created user. Determine how new users will receive their passwords in a security-enhanced way. A commonly used method is generating a random password and then emailing it to the new user or their manager.</p>
</li>
</ul>
<p>To use a CSV with Azure PowerShell:</p>
<ol>
<li>
<p>Run the <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/authentication-commands#using-connect-mggraph">Connect-MgGraph</a> command to create a PowerShell connection to your directory. Connect with an admin account that has privileges on your directory.</p>
</li>
<li>
<p>Create new password profiles for the new users. The passwords for the new users need to conform to the password-complexity rules you have set for your directory.</p>
</li>
<li>
<p>Use <code>Import-CSV</code> to import the CSV. You need to specify the path and file name of the CSV.</p>
</li>
<li>
<p>Loop through the users in the file, constructing the user parameters needed for each user. Example parameters are User Principal Name, Display Name, Given Name, Department, and Job Title.</p>
</li>
<li>
<p>Run the <code>New-MgUser</code> command to create each user. Be sure to enable each account.</p>
</li>
</ol>
<h4 id="other-options"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#other-options">Other options</a></h4>
<p>You can also add users to Microsoft Entra ID programmatically using the Microsoft Graph API, or through the Microsoft 365 Admin Center and the Microsoft Intune Admin console if you're sharing the same directory.</p>
<h2 id="create-and-manage-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-and-manage-groups">Create and manage groups</a></h2>
<p>A Microsoft Entra group helps organize users, which makes it easier to manage permissions. Using groups lets the resource owner (or Microsoft Entra directory owner), assign a set of access permissions to all the group members instead of having to provide the rights one by one. Groups allow you to define a security boundary, then add and remove specific users to grant or deny access with a minimum amount of effort. Even better, Microsoft Entra ID supports the ability to define membership based on rules, such as what department a user works in or the job title they have.</p>
<p>Microsoft Entra ID allows you to define two different types of groups.</p>
<ol>
<li>
<p><strong>Security groups</strong>: These are the most common, and are used to manage member and computer access to shared resources for a group of users. For example, you can create a security group for a specific security policy. By doing it this way, you can give a set of permissions to all the members at once instead of having to add permissions to each member individually. This option requires a Microsoft Entra administrator.</p>
</li>
<li>
<p><strong>Microsoft 365 groups</strong>: These groups provide collaboration opportunities by giving members access to a shared mailbox, calendar, files, SharePoint site, and more. This option also lets you give people outside of your organization access to the group. This option is available to users as well as admins.</p>
</li>
</ol>
<h3 id="view-available-groups"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#view-available-groups">View available groups</a></h3>
<p>You can view all groups by selecting <strong>Groups</strong> under the <strong>Manage</strong> section from the Microsoft Entra dashboard. A new Microsoft Entra ID install won't have any groups defined.</p>
<p><img alt="Screenshot that depicts all the existing groups." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/m1-groups1.png" /></p>
<h3 id="add-groups-to-microsoft-entra-id"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#add-groups-to-microsoft-entra-id">Add groups to Microsoft Entra ID</a></h3>
<p>The same options we saw with users are available to create groups in Microsoft Entra ID. The Azure portal is the easiest way to create groups. You must select the group type (Security or Microsoft 365), assign a unique group name, description and a <em>membership type</em>.</p>
<p><img alt="Screenshot of the Create Group feature in the Azure portal." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/4-add-group-portal.png" /></p>
<p>The membership type field can be one of three values:</p>
<ol>
<li>
<p><strong>Assigned (static)</strong>. The group will contain specific users or groups that you select.</p>
</li>
<li>
<p><strong>Dynamic user</strong>. You can create rules based on characteristics to enable attribute-based dynamic memberships for groups. For example, if a user’s department is Sales, that user will be dynamically assigned to the Sales group.</p>
<p>You can use security groups for either devices or users, but you can only use Microsoft 365 Groups for user groups. If the user's department changes in the future, they're automatically removed from the group. This feature requires a Microsoft Entra ID P1 license.</p>
</li>
<li>
<p><strong>Dynamic device</strong>. You can create rules based on characteristics to enable attribute-based dynamic memberships for groups. For example, if a user’s device is associated with the Service department, that device will be dynamically assigned to the Service group.</p>
<p>You can use security groups for either devices or users, but you can only use Microsoft 365 Groups for user groups. If the device's association with a particular department changes in the future, it's automatically removed from the group. This feature requires a Microsoft Entra ID P1 license.</p>
</li>
</ol>
<p>Finally, you can select group owner(s) that can administer the group and member(s) that will belong to the group. Both of these can contain other groups as well as individual users.</p>
<h4 id="script-group-creation"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#script-group-creation">Script group creation</a></h4>
<p>You can also use Microsoft Graph PowerShell to add a group using the <a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.groups/new-mggroup">New-MgGroup</a> command as shown here:</p>
<p>PowerShellCopy</p>
<div class="highlight"><pre><span></span><code>New-MgGroup -Description &quot;Marketing&quot; -DisplayName &quot;Marketing&quot; -MailNickName &quot;Marketing&quot; -SecurityEnabled -MailEnabled:$False
</code></pre></div>
<h3 id="change-membership-for-a-group"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#change-membership-for-a-group">Change membership for a group</a></h3>
<p>Once a group is created, you can add or remove users (or groups) from it by editing the group membership. Select the group and use the options in the <strong>Manage</strong> section.</p>
<p><img alt="Screenshot showing the group-management options." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/4-edit-group-membership.png" /></p>
<h2 id="use-roles-to-control-resource-access"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#use-roles-to-control-resource-access">Use roles to control resource access</a></h2>
<h3 id="built-in-roles-for-azure-resources-uses-powershell"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#built-in-roles-for-azure-resources-uses-powershell">Built-in roles for Azure Resources (uses PowerShell)</a></h3>
<p>Azure provides several <em>built-in roles</em> to cover the most common security scenarios. To understand how the roles work, let's examine three roles that apply to all resource types:</p>
<ul>
<li><strong>Owner</strong>: Has full access to all resources, including the right to delegate access to others.</li>
<li><strong>Contributor</strong>: Can create and manage all types of Azure resources, but can’t grant access to others.</li>
<li><strong>Reader</strong>: Can view existing Azure resources.</li>
</ul>
<h3 id="role-definitions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#role-definitions">Role definitions</a></h3>
<p>Each role is a set of properties defined in a JavaScript Object Notation (JSON) file. This role definition includes a <strong>Name</strong>, <strong>ID</strong>, and <strong>Description</strong>. It also includes the allowable permissions (<strong>Actions</strong>), denied permissions (<strong>NotActions</strong>), and scope (for example, read access) for the role.</p>
<p>For the Owner role, that means all actions, indicated by an asterisk (*); no denied actions; and all scopes, indicated by a forward slash (/).</p>
<p>You can get this information using the PowerShell <code>Get-AzRoleDefinition Owner</code> cmdlet.</p>
<p>PowerShellCopy</p>
<div class="highlight"><pre><span></span><code>Get-AzRoleDefinition Owner
</code></pre></div>
<p>This code should produce the following output:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Name             : Owner
Id               : 8e3af657-a8ff-443c-a75c-2fe8c4bcb635
IsCustom         : False
Description      : Lets you manage everything, including access to resources.
Actions          : {*}
NotActions       : {}
DataActions      : {}
NotDataActions   : {}
AssignableScopes : {/}
</code></pre></div>
<p>Try the same for the <strong>Contributor</strong> and <strong>Reader</strong> roles to see the actions allowed and denied.</p>
<h3 id="examine-the-built-in-roles"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#examine-the-built-in-roles">Examine the built-in roles</a></h3>
<p>Next, let's explore some of the other built-in roles.</p>
<ol>
<li>
<p>Open the <a href="https://portal.azure.com/">Azure portal</a>.</p>
</li>
<li>
<p>On the Azure home page, select <strong>Resource groups</strong> in the left-hand menu.</p>
</li>
<li>
<p>Select a resource group. Your <em>Resource group</em> pane appears.</p>
</li>
<li>
<p>In the left menu pane, select the <strong>Access control (IAM)</strong>. The <strong>Access control (IAM)</strong> pane appears for your resource group.</p>
</li>
<li>
<p>On the interior menu bar, select the <strong>Roles</strong> tab as follows to see the list of available roles.</p>
<p><img alt="Screenshot showing the roles in the Azure portal." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/5-list-roles.png" /></p>
</li>
</ol>
<h3 id="whats-a-role-definition"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#whats-a-role-definition">What's a role definition?</a></h3>
<p>A role definition is a collection of permissions. A role definition lists the operations the role can perform, such as <strong>read, write, and delete</strong>. It can also list the operations that can't be performed or operations related to underlying data.</p>
<p>As previously described, a role definition has the following structure:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Id</code></td>
<td>Unique identifier for the role, assigned by Azure</td>
</tr>
<tr>
<td><code>IsCustom</code></td>
<td>True if a custom role, False if a built-in role</td>
</tr>
<tr>
<td><code>Description</code></td>
<td>A readable description of the role</td>
</tr>
<tr>
<td><code>Actions []</code></td>
<td>Allowed permissions; <code>*</code> indicates all</td>
</tr>
<tr>
<td><code>NotActions []</code></td>
<td>Denied permissions</td>
</tr>
<tr>
<td><code>DataActions []</code></td>
<td>Specific allowed permissions as applied to data, for example <code>Microsoft.Storage/storageAccounts/blobServices/containers/blobs/read</code></td>
</tr>
<tr>
<td><code>NotDataActions []</code></td>
<td>Specific denied permissions as applied to data.</td>
</tr>
<tr>
<td><code>AssignableScopes []</code></td>
<td>Scopes where this role applies; <code>/</code> indicates global, but can reach into a hierarchical tree</td>
</tr>
</tbody>
</table>
<p>This structure is represented as JSON when used in role-based access control (RBAC) or from the underlying API. For example, here's the <strong>Contributor</strong> role definition in JSON format.</p>
<p>JSONCopy</p>
<div class="highlight"><pre><span></span><code>{
  &quot;Name&quot;: &quot;Contributor&quot;,
  &quot;Id&quot;: &quot;b24988ac-6180-42a0-ab88-20f7382dd24c&quot;,
  &quot;IsCustom&quot;: false,
  &quot;Description&quot;: &quot;Lets you manage everything except access to resources.&quot;,
  &quot;Actions&quot;: [
    &quot;*&quot;
  ],
  &quot;NotActions&quot;: [
    &quot;Microsoft.Authorization/*/Delete&quot;,
    &quot;Microsoft.Authorization/*/Write&quot;,
    &quot;Microsoft.Authorization/elevateAccess/Action&quot;
  ],
  &quot;DataActions&quot;: [],
  &quot;NotDataActions&quot;: [],
  &quot;AssignableScopes&quot;: [
    &quot;/&quot;
  ]
}
</code></pre></div>
<h4 id="actions-and-notactions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#actions-and-notactions">Actions and NotActions</a></h4>
<p>You can tailor the <code>Actions</code> and <code>NotActions</code> properties to grant and deny the exact permissions you need. These properties are always in the format: <code>{Company}.{ProviderName}/{resourceType}/{action}</code>.</p>
<p>As an example, here are the actions for the three roles we looked at previously:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Built-in Role</th>
<th>Actions</th>
<th>NotActions</th>
</tr>
</thead>
<tbody>
<tr>
<td>Owner (allow all actions)</td>
<td><code>*</code></td>
<td>-</td>
</tr>
<tr>
<td>Contributor (allow all actions except writing or deleting role assignments)</td>
<td><code>*</code></td>
<td><code>Microsoft.Authorization/*/Delete, Microsoft.Authorization/*/Write, Microsoft.Authorization/elevateAccess/Action</code></td>
</tr>
<tr>
<td>Reader (allow all read actions)</td>
<td><code>*/read</code></td>
<td>-</td>
</tr>
</tbody>
</table>
<p>The wildcard (<code>*</code>) operation under <code>Actions</code> indicates that the principal assigned to this role can perform all actions; or in other words, this role can manage everything, including actions defined in the future, as Azure adds new resource types. With the <strong>Reader</strong> role, only the <code>read</code> action is allowed.</p>
<p>The operations under <code>NotActions</code> are subtracted from <code>Actions</code>. With the <strong>Contributor</strong> role, <code>NotActions</code> removes this role's ability to manage access to resources, and also removes assigning access to resources.</p>
<h4 id="dataactions-and-notdataactions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#dataactions-and-notdataactions">DataActions and NotDataActions</a></h4>
<p>Data operations are specified in the <code>DataActions</code> and <code>NotDataActions</code> properties. You can specify data operations separately from the management operations. This prevents current role assignments with wildcards (<code>*</code>) from suddenly having access to data. Here are some data operations that you can specify in <code>DataActions</code> and <code>NotDataActions</code>:</p>
<ul>
<li>Read a list of blobs in a container</li>
<li>Write a storage blob in a container</li>
<li>Delete a message in a queue</li>
</ul>
<p>You can only add data operations to the <code>DataActions</code> and <code>NotDataActions</code> properties. Resource providers identify which operations are data operations by setting the <code>isDataAction</code> property to <code>true</code>. Roles that don't have data operations can omit these properties from the role definition.</p>
<p>These actions work exactly like their management cousins. You can specify the actions you want to allow (or <code>*</code> for all), then provide a list of specific actions to remove in the <code>NotDataActions</code> collection. Here are some examples; you can find the <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations">full list of actions and data actions in the resource provider documentation</a>:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Data operation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Microsoft.Storage/storageAccounts/blobServices/containers/blobs/delete</code></td>
<td>Delete blob data</td>
</tr>
<tr>
<td><code>Microsoft.Compute/virtualMachines/login/action</code></td>
<td>Log in to a VM as a regular user</td>
</tr>
<tr>
<td><code>Microsoft.EventHub/namespaces/messages/send/action</code></td>
<td>Send messages on an event hub</td>
</tr>
<tr>
<td><code>Microsoft.Storage/storageAccounts/fileServices/fileshares/files/read</code></td>
<td>Return a file/folder or list of files/folders</td>
</tr>
<tr>
<td><code>Microsoft.Storage/storageAccounts/queueServices/queues/messages/read</code></td>
<td>Read a message from a queue</td>
</tr>
</tbody>
</table>
<h4 id="assignable-scopes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#assignable-scopes">Assignable Scopes</a></h4>
<p>Defining the <strong>Actions</strong> and <strong>NotActions</strong> properties is not enough to fully implement a role. You also need to properly scope your role.</p>
<p>The <strong>AssignableScopes</strong> property of the role specifies the scopes (subscriptions, resource groups, or resources) within which the role is available for assignment. You can make the custom role available for assignment just in the subscriptions or resource groups that need it, thus avoiding cluttering the user experience for the rest of the subscriptions or resource groups.</p>
<p>Here are some examples:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>To</th>
<th>Use Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td>Restrict to a subscription</td>
<td><code>"/subscriptions/{sub-id}"</code></td>
</tr>
<tr>
<td>Restrict to a specific resource group on a specific subscription</td>
<td><code>"/subscriptions/{sub-id}/resourceGroups/{rg-name}"</code></td>
</tr>
<tr>
<td>Restrict to a specific resource</td>
<td><code>"/subscriptions/{sub-id}/resourceGroups/{rg-name}/{resource-name}"</code></td>
</tr>
<tr>
<td>Make a role available for assignment in two subscriptions</td>
<td><code>"/subscriptions/{sub-id}", "/subscriptions/{sub-id}"</code></td>
</tr>
</tbody>
</table>
<h3 id="create-roles"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-roles">Create roles</a></h3>
<p>Microsoft Entra ID comes with built-in roles that are likely to cover 99% of what you'll ever want to do. It's preferable to use a built-in role if possible. However, you can create custom roles if you find it necessary.</p>
<p>Note</p>
<p>Custom role creation requires Microsoft Entra ID P1 or P2; you can't create custom roles in the free tier.</p>
<p>You can create a new role through several mechanisms:</p>
<ul>
<li>
<p><strong>Azure portal</strong>: You can use the Azure portal to create a custom role by selecting <strong>Microsoft Entra ID</strong> &gt; <strong>Roles and administrators</strong> &gt; <strong>New custom role</strong>.</p>
</li>
<li>
<p><strong>Azure PowerShell</strong>: You can use the <code>New-AzRoleDefinition</code> cmdlet to define a new role.</p>
</li>
<li>
<p><strong>Azure Graph API</strong>: You can use a REST call to the Graph API to programmatically create a new role.</p>
</li>
</ul>
<p>This module's Summary section includes a link to the documentation for all three approaches.</p>
<h2 id="connect-active-directory-to-microsoft-entra-id-with-microsoft-entra-connect"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#connect-active-directory-to-microsoft-entra-id-with-microsoft-entra-connect">Connect Active Directory to Microsoft Entra ID with Microsoft Entra Connect</a></h2>
<p>Companies that use an on-premises Windows Server Active Directory solution can integrate their existing users and groups with Microsoft Entra ID with <strong>Microsoft Entra Connect</strong>. This is a free tool you can download and install to synchronize your local AD with your Azure directory.</p>
<p>With Microsoft Entra Connect, you can provide your users with a common identity for Microsoft 365, Azure, and SaaS applications integrated with Microsoft Entra ID in a hybrid identity environment.</p>
<p><img alt="A diagram of Microsoft Entra Connect synchronizing an on-premises Active Directory with Microsoft Entra ID." src="https://learn.microsoft.com/en-us/training/modules/manage-users-and-groups-in-aad/media/m1-aad-connect1.png" /></p>
<h3 id="whats-included-in-microsoft-entra-connect"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#whats-included-in-microsoft-entra-connect">What's included in Microsoft Entra Connect?</a></h3>
<p>Microsoft Entra Connect provides several components that you can install to create a hybrid identity system.</p>
<ul>
<li><strong>Sync services</strong>: This component is responsible for creating users, groups, and other objects. It also makes sure that identity information for your on-premises users and groups matches that in the cloud.</li>
<li><strong>Health monitoring</strong>: Microsoft Entra Connect Health supplies robust monitoring and a central location in the Azure portal for viewing this activity.</li>
<li><strong>AD FS</strong>: Federation is an optional part of Microsoft Entra Connect that you can use to configure a hybrid environment via an on-premises AD FS infrastructure. Organizations can use this to address complex deployments such as domain join SSO, enforcement of the Active Directory sign-in policy, and smart card or third-party multifactor authentication.</li>
<li><strong>Password hash synchronization</strong>: This feature is a sign-in method that synchronizes a hash of a user’s on-premises Active Directory password with Microsoft Entra ID.</li>
<li><strong>Pass-through authentication</strong>: This allows users to sign in to both on-premises and cloud-based applications using the same passwords. This reduces IT helpdesk costs, because users are less likely to forget how to sign in. This feature provides an alternative to <strong>Password hash synchronization</strong> that allows organizations to enforce their security and password complexity policies.</li>
</ul>
<h3 id="benefits"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#benefits">Benefits</a></h3>
<p>Integrating your on-premises directories with Microsoft Entra ID makes your users more productive by supplying a common identity for accessing both cloud and on-premises resources. Users and organizations get the following advantages:</p>
<ul>
<li>Users can use a single identity to access both on-premises applications and cloud services such as Microsoft 365.</li>
<li>A single tool provides an easy deployment experience for synchronization and sign-in.</li>
<li>Integration provides the newest capabilities for your scenarios. Microsoft Entra Connect replaces older versions of identity integration tools such as DirSync and Azure AD Sync.</li>
</ul>
<h3 id="installing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#installing">Installing</a></h3>
<p>Installing and configuring Microsoft Entra Connect is not a trivial task, and requires some initial planning and decisions before you begin. Microsoft has a full <a href="https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-install-roadmap">Installation guide</a> to help you prepare, install, configure and test your AD Connect setup.</p>
<h2 id="summary"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#summary">Summary</a></h2>
<p>Microsoft Entra ID is the hub for user management in the cloud. It provides a single-sign on capability that makes it easier to onboard new employees and ensure you remove access from previous employees. It integrates tightly with your on-premises Windows Server Active Directory so you have a seamless login experience across all your local and cloud-based resources, and it integrates with other cloud environments like Salesforce, Microsoft 365, Dropbox, or Google. Finally, it can reduce your IT burden through its centralized management portal, support for self-service password resets, multifactor authentication for increased security, high reliability, and support for managing users and groups with roles.</p>
<h3 id="further-reading"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#further-reading">Further reading</a></h3>
<p>To learn more about some of the topics explored in this module, check out the following references.</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles">Azure built-in roles</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/identity/conditional-access/overview">Secure your Azure resources with Conditional Access</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles">Create custom roles for Azure resources</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/identity/hybrid/">Hybrid identity with Microsoft Entra ID</a></li>
<li><a href="https://www.microsoft.com/download/details.aspx?id=47594">Microsoft Entra Connect</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/billing/billing-subscription-transfer">Transfer billing ownership of an Azure subscription to another account</a></li>
</ul>
<hr />
<h2 id="secure-your-azure-resources-with-azure-role-based-access-control-azure-rbac"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#secure-your-azure-resources-with-azure-role-based-access-control-azure-rbac">Secure your Azure resources with Azure role-based access control (Azure RBAC)</a></h2>
<h2 id="introduction_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#introduction_4">Introduction</a></h2>
<p>For any organization using the cloud, securing your Azure resources such as virtual machines, websites, networks, and storage is a critical function. You want to ensure that your data and assets are protected, but still grant your employees and partners the access they need to perform their jobs. Azure RBAC is an authorization system in Azure that helps you manage who has access to Azure resources, what they can do with those resources, and where they have access.</p>
<p>Suppose you work for First Up Consultants, which is an engineering firm that specializes in circuit and electrical design. They've moved their workloads and assets to Azure to make collaboration easier across several offices and other companies. You work in the IT department at First Up Consultants. You're responsible for keeping the company's assets secure, but still allowing users to access the resources they need. You've heard that Azure RBAC can help you manage resources in Azure.</p>
<p>In this module, you'll learn how to use Azure RBAC to manage access to resources in Azure.</p>
<h3 id="learning-objectives_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learning-objectives_5">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Verify access to resources for yourself and others.</li>
<li>Grant access to resources.</li>
<li>View activity logs of Azure RBAC changes.</li>
</ul>
<h2 id="what-is-azure-rbac"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#what-is-azure-rbac">What is Azure RBAC?</a></h2>
<p>When it comes to identity and access, most organizations that are considering using the public cloud are concerned about two things:</p>
<ol>
<li>Ensuring that when people leave the organization, they lose access to resources in the cloud.</li>
<li>Striking the right balance between autonomy and central governance. For example, giving project teams the ability to create and manage virtual machines in the cloud, while centrally controlling the networks those VMs use to communicate with other resources.</li>
</ol>
<p>Microsoft Entra ID and Azure RBAC work together to make it simple to carry out these goals.</p>
<h3 id="azure-subscriptions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#azure-subscriptions">Azure subscriptions</a></h3>
<p>First, remember that each Azure subscription is associated with a single Microsoft Entra directory. Users, groups, and applications in that directory can manage resources in the Azure subscription. The subscriptions use Microsoft Entra ID for single sign-on (SSO) and access management. You can extend your on-premises Active Directory to the cloud by using <strong>Microsoft Entra Connect</strong>. This feature allows your employees to manage their Azure subscriptions by using their existing work identities. When you disable an on-premises Active Directory account, it automatically loses access to all Azure subscriptions connected with Microsoft Entra ID.</p>
<h3 id="whats-azure-rbac"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#whats-azure-rbac">What's Azure RBAC?</a></h3>
<p>Azure RBAC is an authorization system built on Azure Resource Manager that provides fine-grained access management for resources in Azure. With Azure RBAC, you can grant the exact access that users need to do their jobs. For example, you can use Azure RBAC to let one employee manage virtual machines in a subscription, while another manages SQL databases within the same subscription.</p>
<p>The following video describes Azure RBAC in detail:</p>
<p><img alt="" src="https://www.microsoft.com/en-us/videoplayer/embed/RE2yEvk?postJsllMsg=true" /></p>
<p>You can grant access by assigning the appropriate Azure role to users, groups, and applications at a certain scope. The scope of a role assignment can be a management group, subscription, a resource group, or a single resource. A role assigned at a parent scope also grants access to the child scopes contained within it. For example, a user with access to a resource group can manage all the resources it contains like websites, virtual machines, and subnets. The Azure role that you assign dictates what resources the user, group, or application can manage within that scope.</p>
<p>The following diagram depicts how the classic subscription administrator roles, Azure roles, and Microsoft Entra roles are related at a high level. Child scopes, such as service instances, inherit roles assigned at a higher scope, like an entire subscription.</p>
<p><img alt="Diagram that depicts how the classic subscription administrator roles, Azure roles, and Microsoft Entra roles are related at a high level." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/2-azuread-and-azure-roles.png" /></p>
<p>In the preceding diagram, a subscription is associated with only one Microsoft Entra tenant. Also note that a resource group can have multiple resources, but it's associated with only one subscription. Although it's not obvious from the diagram, a resource can be bound to only one resource group.</p>
<h3 id="what-can-i-do-with-azure-rbac"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#what-can-i-do-with-azure-rbac">What can I do with Azure RBAC?</a></h3>
<p>Azure RBAC allows you to grant access to Azure resources that you control. Suppose you need to manage access to resources in Azure for the development, engineering, and marketing teams. You’ve started to receive access requests, and you need to quickly learn how access management works for Azure resources.</p>
<p>Here are some scenarios you can implement with Azure RBAC:</p>
<ul>
<li>Allow one user to manage virtual machines in a subscription and another user to manage virtual networks.</li>
<li>Allow a database administrator group to manage SQL databases in a subscription.</li>
<li>Allow a user to manage all resources in a resource group, such as virtual machines, websites, and subnets.</li>
<li>Allow an application to access all resources in a resource group.</li>
</ul>
<h3 id="azure-rbac-in-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#azure-rbac-in-the-azure-portal">Azure RBAC in the Azure portal</a></h3>
<p>In several areas in the Azure portal, you'll see a pane named <strong>Access control (IAM)</strong>, also known as <em>identity and access management</em>. On this pane, you can see who has access to that area and their role. Using this same pane, you can grant or remove access.</p>
<p>The following shows an example of the Access control (IAM) pane for a resource group. In this example, Alain has been assigned the Backup Operator role for this resource group.</p>
<p><img alt="Screenshot of the Azure portal showing the Access control Role assignment pane with the Backup operator section highlighted." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/2-resource-group-access-control.png" /></p>
<h3 id="how-does-azure-rbac-work"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#how-does-azure-rbac-work">How does Azure RBAC work?</a></h3>
<p>You can control access to resources using Azure RBAC by creating role assignments, which control how permissions are enforced. To create a role assignment, you need three elements: a security principal, a role definition, and a scope. You can think of these elements as <em>who</em>, <em>what</em>, and <em>where</em>.</p>
<h4 id="1-security-principal-who"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#1-security-principal-who">1. Security principal (who)</a></h4>
<p>A <em>security principal</em> is just a fancy name for a user, group, or application to which you want to grant access.</p>
<p><img alt="An illustration showing security principal including user, group, and service principal." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/2-rbac-security-principal.png" /></p>
<h4 id="2-role-definition-what"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#2-role-definition-what">2. Role definition (what)</a></h4>
<p>A <em>role definition</em> is a collection of permissions. It's sometimes just called a role. A role definition lists the permissions the role can perform such as read, write, and delete. Roles can be high-level, like Owner, or specific, like Virtual Machine Contributor.</p>
<p><img alt="An illustration listing different built-in and custom roles with zoom-in on the definition for the contributor role." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/2-rbac-role-definition.png" /></p>
<p>Azure includes several built-in roles that you can use. The following lists four fundamental built-in roles:</p>
<ul>
<li><strong>Owner</strong>: Has full access to all resources, including the right to delegate access to others.</li>
<li><strong>Contributor</strong>: Can create and manage all types of Azure resources, but can’t grant access to others.</li>
<li><strong>Reader</strong>: Can view existing Azure resources.</li>
<li><strong>User Access Administrator</strong>: Lets you manage user access to Azure resources.</li>
</ul>
<p>If the built-in roles don't meet the specific needs of your organization, you can create your own custom roles.</p>
<h4 id="3-scope-where"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#3-scope-where">3. Scope (where)</a></h4>
<p><em>Scope</em> is the level where the access applies. This is helpful if you want to make someone a Website Contributor but only for one resource group.</p>
<p>In Azure, you can specify a scope at multiple levels: management group, subscription, resource group, or resource. Scopes are structured in a parent-child relationship. When you grant access at a parent scope, the child scopes automatically inherit those permissions. For example, if a group is assigned the Contributor role at the subscription scope, it will inherit the role for all resource groups and resources within the subscription.</p>
<p><img alt="An illustration showing a hierarchical representation of different Azure levels to apply scope. The hierarchy, starting with the highest level, is in this order: Management group, subscription, resource group, and resource." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/2-rbac-scope.png" /></p>
<h4 id="role-assignment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#role-assignment">Role assignment</a></h4>
<p>Once you have determined the who, what, and where, you can combine those elements to grant access. A <em>role assignment</em> is the process of binding a role to a security principal at a particular scope for the purpose of granting access. To grant access, you'll create a role assignment. To revoke access, you'll remove a role assignment.</p>
<p>The following example shows how the Marketing group has been assigned the Contributor role at the sales resource group scope.</p>
<p><img alt="An illustration showing a sample role assignment process for Marketing group, which is a combination of security principal, role definition, and scope. The Marketing group falls under the Group security principal and has a Contributor role assigned for the Resource group scope." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/2-rbac-overview.png" /></p>
<h3 id="azure-rbac-is-an-allow-model"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#azure-rbac-is-an-allow-model">Azure RBAC is an allow model</a></h3>
<p>Azure RBAC is an <em>allow</em> model. This means that when you're assigned a role, Azure RBAC allows you to perform certain actions such as read, write, or delete. If one role assignment grants you read permissions to a resource group, and a different role assignment grants you write permissions to the same resource group, then you'll have read and write permissions on that resource group.</p>
<p>Azure RBAC has something called <code>NotActions</code> permissions. You can use <code>NotActions</code> to create a set of not allowed permissions. The access a role grants—the <em>effective permissions</em>—is computed by subtracting the <code>NotActions</code> operations from the <code>Actions</code> operations. For example, the <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#contributor">Contributor</a> role has both <code>Actions</code> and <code>NotActions</code>. The wildcard (*) in <code>Actions</code> indicates that it can perform all operations on the control plane. You'd then subtract the following operations in <code>NotActions</code> to compute the effective permissions:</p>
<ul>
<li>Delete roles and role assignments</li>
<li>Create roles and role assignments</li>
<li>Grant the caller User Access Administrator access at the tenant scope</li>
<li>Create or update any blueprint artifacts</li>
<li>Delete any blueprint artifacts</li>
</ul>
<h2 id="exercise-list-access-using-azure-rbac-and-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#exercise-list-access-using-azure-rbac-and-the-azure-portal">Exercise - List access using Azure RBAC and the Azure portal</a></h2>
<p>At First Up Consultants, you've been granted access to a resource group for the marketing team. You want to familiarize yourself with the Azure portal and see what roles are currently assigned.</p>
<p>You need an Azure subscription to complete the exercises. If you don't have an Azure subscription, create a <a href="https://azure.microsoft.com/free/">free account</a> and add a subscription before you begin. If you're a student, you can take advantage of the <a href="https://azure.microsoft.com/free/students/">Azure for students</a> offer.</p>
<h3 id="list-role-assignments-for-yourself"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#list-role-assignments-for-yourself">List role assignments for yourself</a></h3>
<p>Follow these steps to see what roles are currently assigned to you.</p>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/">Azure portal</a>.</p>
</li>
<li>
<p>On the <strong>Profile</strong> menu, select the ellipsis (<strong>...</strong>) to see more links.</p>
<p><img alt="Screenshot of user menu with My permissions highlighted." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/4-my-permissions-menu.png" /></p>
</li>
<li>
<p>Select <strong>My permissions</strong> to open the <strong>My permissions</strong> pane.</p>
<p><img alt="Screenshot of the My permissions pane." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/4-my-permissions-pane.png" /></p>
<p>You'll find the roles that you've been assigned and the scope. Your list will look different.</p>
</li>
</ol>
<h3 id="list-role-assignments-for-a-resource-group"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#list-role-assignments-for-a-resource-group">List role assignments for a resource group</a></h3>
<p>Follow these steps to see what roles are assigned at the resource group scope.</p>
<ol>
<li>
<p>In the Search box at the top, search for and select <strong>Resource groups</strong>.</p>
<p><img alt="Screenshot of the Azure portal that shows how to search for resource groups." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/4-resource-groups.png" /></p>
</li>
<li>
<p>In the list of resource groups, select a resource group.</p>
<p>These steps use a resource group named <strong>example-group</strong>, but your resource group's name will be different.</p>
</li>
<li>
<p>On the left menu pane, select <strong>Access control (IAM)</strong>.</p>
<p><img alt="Screenshot showing Access control (IAM) option on the resource group pane." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/4-resource-group-access-control.png" /></p>
</li>
<li>
<p>Select the <strong>Role assignments</strong> tab.</p>
<p>This tab shows who has access to the resource group. Notice that some roles are scoped to <strong>This resource</strong>, while others are <strong>(Inherited)</strong> from a parent scope.</p>
<p><img alt="Screenshot showing Role assignments tab for the selected resource group." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/4-resource-group-role-assignment.png" /></p>
</li>
</ol>
<h3 id="list-roles"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#list-roles">List roles</a></h3>
<p>As you learned in the previous unit, a role is a collection of permissions. Azure has more than 70 built-in roles that you can use in your role assignments. To list the roles:</p>
<ul>
<li>
<p>In the menu bar at the top of the pane, select the <strong>Roles</strong> tab to list of all the built-in and custom roles.</p>
<p>Select a role's <strong>View</strong> link in the <strong>Details</strong> column, then select the <strong>Assignments</strong> tab to display the number of users and groups assigned to that role.</p>
<p><img alt="Screenshot showing a list of Roles and users and groups assigned to each role." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/4-roles-list.png" /></p>
</li>
</ul>
<p>In this unit, you learned how to list the role assignments for yourself in the Azure portal. You also learned how to list the role assignments for a resource group.</p>
<h2 id="exercise-grant-access-using-azure-rbac-and-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#exercise-grant-access-using-azure-rbac-and-the-azure-portal">Exercise - Grant access using Azure RBAC and the Azure portal</a></h2>
<p>A coworker named Alain at First Up Consultants needs permission to create and manage virtual machines for a project on which they're working. Your manager has asked that you handle this request. Using the best practice to grant users the least privileges to get their work done, you decide to assign Alain the Virtual Machine Contributor role for a resource group.</p>
<h3 id="grant-access"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#grant-access">Grant access</a></h3>
<p>Follow this procedure to assign the Virtual Machine Contributor role to a user at the resource group scope.</p>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/">Azure portal</a> as an administrator that has permissions to assign roles, such as <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#user-access-administrator">User Access Administrator</a> or <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#owner">Owner</a>.</p>
</li>
<li>
<p>In the Search box at the top, search for <strong>Resource groups</strong>.</p>
<p><img alt="Screenshot of the Azure portal that shows how to search for resource groups." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/5-resource-groups.png" /></p>
</li>
<li>
<p>In the list of resource groups, select a resource group.</p>
<p>These steps use a resource group named <strong>example-group</strong>, but your resource group's name will be different.</p>
</li>
<li>
<p>On the left menu pane, select <strong>Access control (IAM)</strong>.</p>
</li>
<li>
<p>Select the <strong>Role assignments</strong> tab to display the current list of role assignments at this scope.</p>
<p><img alt="Screenshot showing Role assignments tab for the selected resource group." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/5-resource-group-role-assignment.png" /></p>
</li>
<li>
<p>Select <strong>Add</strong> &gt; <strong>Add role assignment</strong>.</p>
<p>If you don't have permissions to assign roles, the <strong>Add role assignment</strong> option will be disabled.</p>
<p><img alt="Screenshot that shows Add role assignment menu." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/5-resource-group-add-role-assignment.png" /></p>
<p>The <strong>Add role assignment</strong> page opens.</p>
</li>
<li>
<p>On the <strong>Role</strong> tab, search for and select <strong>Virtual Machine Contributor</strong>.</p>
<p><img alt="Screenshot that shows Add role assignment and list of roles." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/5-select-role.png" /></p>
</li>
<li>
<p>Select <strong>Next</strong>.</p>
</li>
<li>
<p>On the <strong>Members</strong> tab, select <strong>Select members</strong>.</p>
</li>
<li>
<p>Search for and select a user.</p>
<p><img alt="Screenshot of the add role assignment page that shows the select members option." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/5-select-members-option.png" /></p>
</li>
<li>
<p>Select <strong>Select</strong> to add the user to the Members list.</p>
</li>
<li>
<p>Select <strong>Next</strong>.</p>
</li>
<li>
<p>On the <strong>Review + assign</strong> tab, review the role assignment settings.</p>
</li>
<li>
<p>Select <strong>Review + assign</strong> to assign the role.</p>
<p>After a few moments, the user is assigned the Virtual Machine Contributor role at the resource group scope. The user can now create and manage virtual machines just within this resource group.</p>
<p><img alt="Screenshot that shows the Virtual Machine Contributor role assigned to a user." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/5-vm-contributor-assignment.png" /></p>
</li>
</ol>
<h3 id="remove-access"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#remove-access">Remove access</a></h3>
<p>In Azure RBAC, you can remove a role assignment to remove access.</p>
<ol>
<li>
<p>In the list of role assignments, select <strong>View Assignments</strong>.</p>
</li>
<li>
<p>Search for and check the box for the user with the Virtual Machine Contributor role.</p>
</li>
<li>
<p>Select <strong>Remove</strong>.</p>
<p><img alt="Screenshot that shows the Remove role assignment message." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/5-remove-role-assignment.png" /></p>
</li>
<li>
<p>In the <strong>Remove role assignments</strong> message that appears, select <strong>Yes</strong>.</p>
</li>
</ol>
<p>In this unit, you learned how to grant a user access to create and manage virtual machines in a resource group using the Azure portal.</p>
<h2 id="exercise-view-activity-logs-for-azure-rbac-changes"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#exercise-view-activity-logs-for-azure-rbac-changes">Exercise - View activity logs for Azure RBAC changes</a></h2>
<p>First Up Consultants reviews Azure RBAC changes quarterly for auditing and troubleshooting purposes. You know that changes get logged in the <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log">Azure Activity Log</a>. Your manager has asked if you can generate a report of the role assignment and custom role changes for the last month.</p>
<h3 id="view-activity-logs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#view-activity-logs">View activity logs</a></h3>
<p>The easiest way to get started is to view the activity logs with the Azure portal.</p>
<ol>
<li>
<p>Select <strong>All services</strong>, then search for <strong>Activity log</strong>.</p>
<p><img alt="Screenshot of the Azure portal showing the location of Activity logs option." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/6-all-services-activity-log.png" /></p>
</li>
<li>
<p>Select <strong>Activity log</strong> to open the activity log.</p>
<p><img alt="Screenshot of the Azure portal showing the Activity logs." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/6-activity-log-portal.png" /></p>
</li>
<li>
<p>Set the <strong>Timespan</strong> filter to <strong>Last month</strong>.</p>
</li>
<li>
<p>Add an <strong>Operation</strong> filter and type <strong>role</strong> to filter the list.</p>
</li>
<li>
<p>Select the following Azure RBAC operations:</p>
<ul>
<li>Create role assignment (roleAssignments)</li>
<li>Delete role assignment (roleAssignments)</li>
<li>Create or update custom role definition (roleDefinitions)</li>
<li>Delete custom role definition (roleDefinitions)</li>
</ul>
<p><img alt="Screenshot showing a list of Operation filter with the four filters selected." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/6-operation-filter.png" /></p>
<p>After a moment, you'll get a list of all the role assignment and role definition operations for the last month. There's also a button at the top of the screen to download the activity log as a CSV file.</p>
</li>
<li>
<p>Select one of the operations to get the activity log details.</p>
<p><img alt="Screenshot showing the details for an activity log." src="https://learn.microsoft.com/en-us/training/modules/secure-azure-resources-with-rbac/media/6-activity-log-details.png" /></p>
</li>
</ol>
<p>In this unit, you learned how to use Azure Activity Log to list Azure RBAC changes in the portal and generate a simple report.</p>
<hr />
<h2 id="allow-users-to-reset-their-password-with-microsoft-entra-self-service-password-reset"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#allow-users-to-reset-their-password-with-microsoft-entra-self-service-password-reset">Allow users to reset their password with Microsoft Entra self-service password reset</a></h2>
<h2 id="introduction_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#introduction_5">Introduction</a></h2>
<p>Suppose you're an IT administrator for a large retail organization. Your organization has started using Microsoft Entra ID to allow employees to securely sign in and use software as a service (SaaS) apps and access the organization's resources in Microsoft 365. You're overwhelmed with password-reset requests because you currently reset employees' passwords manually. To get these employees back to being productive quickly and reduce your workload, you decide to evaluate and set up self-service password reset in Microsoft Entra ID.</p>
<p>In this module, you'll learn how Azure supports this feature and how to set it up. Note that only paid subscriptions can leverage this, while free and pay-as-you-go can't.</p>
<p>By the end of this module, you'll be able to configure self-service password reset in Microsoft Entra ID.</p>
<h3 id="learning-objectives_6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learning-objectives_6">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Decide whether to implement self-service password reset.</li>
<li>Implement self-service password reset to meet your requirements.</li>
<li>Configure self-service password reset to customize the experience.</li>
</ul>
<h3 id="prerequisites_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#prerequisites_3">Prerequisites</a></h3>
<ul>
<li>Basic understanding of Microsoft Entra ID</li>
</ul>
<h2 id="what-is-self-service-password-reset-in-microsoft-entra-id"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#what-is-self-service-password-reset-in-microsoft-entra-id">What is self-service password reset in Microsoft Entra ID?</a></h2>
<p>You've been asked to assess ways to reduce help-desk costs in your retail organization. You've noticed that the support staff spends a lot of their time resetting passwords for users. Users often complain about delays with this process, and these delays impact their productivity. You want to understand how you can configure Azure to allow users to manage their own passwords.</p>
<p>In this unit, you'll learn how self-service password reset (SSPR) works in Microsoft Entra ID.</p>
<h3 id="why-use-sspr"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#why-use-sspr">Why use SSPR?</a></h3>
<p>In Microsoft Entra ID, any user can change their password if they're already signed in. But if they're not signed in, forgot their password, or it's expired, they'll need to reset their password. With SSPR, users can reset their passwords in a web browser or from a Windows sign-in screen to regain access to Azure, Microsoft 365, and any other application that uses Microsoft Entra ID for authentication.</p>
<p>SSPR reduces the load on administrators because users can fix password problems themselves without having to call the help desk. Also, it minimizes the productivity impact of a forgotten or expired password. Users don't have to wait until an administrator is available to reset their password.</p>
<h3 id="how-sspr-works"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#how-sspr-works">How SSPR works</a></h3>
<p>The user initiates a password reset either by going directly to the password-reset portal, or by selecting the <strong>Can't access your account</strong> link on a sign-in page. The reset portal takes these steps:</p>
<ol>
<li><strong>Localization</strong>: The portal checks the browser's locale setting and renders the SSPR page in the appropriate language.</li>
<li><strong>Verification</strong>: The user enters their username and passes a CAPTCHA to ensure that it's a user and not a bot.</li>
<li><strong>Authentication</strong>: The user enters the required data to authenticate their identity. They might enter a code or answer security questions.</li>
<li><strong>Password reset</strong>: If the user passes the authentication tests, they can enter a new password and confirm it.</li>
<li><strong>Notification</strong>: A message is sent to the user to confirm the reset.</li>
</ol>
<p>There are several ways you can customize the SSPR user experience. For example, you can add your company logo to the sign-in page so users know they're in the right place to reset their password.</p>
<h3 id="authenticate-a-password-reset"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#authenticate-a-password-reset">Authenticate a password reset</a></h3>
<p>It's critical to verify a user's identity before you allow a password reset. Malicious users might exploit any weakness in the system to impersonate that user. Azure supports six different ways to authenticate reset requests.</p>
<p>As an administrator, you can choose the methods to use when you configure SSPR. Enable two or more of these methods so that users can choose the ones they can easily use. The methods are:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Authentication method</th>
<th>How to register</th>
<th>How to authenticate for a password reset</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mobile app notification</td>
<td>Install the Microsoft Authenticator app on your mobile device, then register it on the multifactor authentication setup page.</td>
<td>Azure sends a notification to the app, which you can either verify or deny.</td>
</tr>
<tr>
<td>Mobile app code</td>
<td>This method also uses the Authenticator app, and you install and register it in the same way.</td>
<td>Enter the code from the app.</td>
</tr>
<tr>
<td>Email</td>
<td>Provide an email address that's external to Azure and Microsoft 365.</td>
<td>Azure sends a code to the address, which you enter in the reset wizard.</td>
</tr>
<tr>
<td>Mobile phone</td>
<td>Provide a mobile phone number.</td>
<td>Azure sends a code to the phone in an SMS message, which you enter in the reset wizard. You can also choose to get an automated call.</td>
</tr>
<tr>
<td>Office phone</td>
<td>Provide a nonmobile phone number.</td>
<td>You receive an automated call to this number and press #.</td>
</tr>
<tr>
<td>Security questions</td>
<td>Select questions such as "In what city was your mother born?" and save their responses.</td>
<td>Answer the questions.</td>
</tr>
</tbody>
</table>
<p>In free and trial Microsoft Entra organizations, phone call options aren't supported.</p>
<h4 id="require-the-minimum-number-of-authentication-methods"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#require-the-minimum-number-of-authentication-methods">Require the minimum number of authentication methods</a></h4>
<p>You can specify the minimum number of methods that the user must set up, either one or two. For example, you might enable the mobile app code, email, office phone, and security questions methods and specify a minimum of two methods. Users can then choose the two methods they prefer, like mobile app code and email.</p>
<p>For the security-question method, you can specify a minimum number of questions the user must set up to register for this method. You also can specify a minimum number of questions they must answer correctly to reset their password.</p>
<p>After your users register the required information for the minimum number of methods you've specified, they're considered registered for SSPR.</p>
<h4 id="recommendations"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#recommendations">Recommendations</a></h4>
<ul>
<li>Enable two or more of the authentication reset request methods.</li>
<li>Use the mobile app notification or code as the primary method. But also enable the email or office phone methods to support users without mobile devices.</li>
<li>The mobile phone method isn't a recommended method, because it's possible to send fraudulent SMS messages.</li>
<li>The security-question option is the least recommended method, because the answers to the security questions might be known to other people. Only use the security-question method in combination with at least one other method.</li>
</ul>
<h4 id="accounts-associated-with-administrator-roles"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#accounts-associated-with-administrator-roles">Accounts associated with administrator roles</a></h4>
<ul>
<li>A strong, two-method authentication policy is always applied to accounts with an administrator role, regardless of your configuration for other users.</li>
<li>The security-question method isn't available to accounts associated with an administrator role.</li>
</ul>
<h3 id="configure-notifications"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#configure-notifications">Configure notifications</a></h3>
<p>Administrators can choose how users are notified of password changes. There are two options you can enable:</p>
<ul>
<li><strong>Notify users on password resets</strong>: The user who resets their own password is notified to their primary and secondary email addresses. If the reset was done by a malicious user, this notification alerts the user, who can take mitigation steps.</li>
<li><strong>Notify all admins when other admins reset their password</strong>: All administrators are notified when another administrator resets their password.</li>
</ul>
<h3 id="license-requirements"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#license-requirements">License requirements</a></h3>
<p>There are three editions of Microsoft Entra ID: free, Premium P1, and Premium P2. The password-reset functionality you can use depends on your edition.</p>
<p>Any user who is signed in can change their password, regardless of the edition of Microsoft Entra ID.</p>
<p>What if you're not signed in, and you've forgotten your password or your password has expired? In this case, you can use SSPR in Microsoft Entra ID P1 or P2. It's also available with Microsoft 365 Apps for business or Microsoft 365.</p>
<p>In a hybrid situation, where you have Active Directory on-premises and Microsoft Entra ID in the cloud, any password change in the cloud must be written back to the on-premises directory. This writeback support is available in Microsoft Entra ID P1 or P2. It's also available with Microsoft 365 Apps for business.</p>
<h3 id="sspr-deployment-options"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#sspr-deployment-options">SSPR deployment options</a></h3>
<p>You can deploy SSPR with password writeback by using <a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-sspr-writeback">Microsoft Entra Connect</a> or <a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-cloud-sync-sspr-writeback">cloud sync</a>, depending on user needs. You can deploy each option side-by-side in different domains to target different sets of users. This helps existing users on-premises to write back password changes, while adding an option for users in disconnected domains because of a company merger or split. Users from an existing on-premises domain can use Microsoft Entra Connect, while new users from a merger can use cloud sync in another domain.</p>
<p>Cloud sync can also provide higher availability, because it doesn't rely on a single instance of Microsoft Entra Connect. For a feature comparison between the two deployment options, see <a href="https://learn.microsoft.com/en-us/azure/active-directory/cloud-sync/what-is-cloud-sync#how-is-azure-ad-connect-cloud-sync-different-from-azure-ad-connect-sync">Comparison between Microsoft Entra Connect and cloud sync</a>.</p>
<h2 id="implement-microsoft-entra-self-service-password-reset"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#implement-microsoft-entra-self-service-password-reset">Implement Microsoft Entra self-service password reset</a></h2>
<p>You've decided to implement self-service password reset (SSPR) in Microsoft Entra ID for your organization. You want to start using SSPR for a group of 20 users in the marketing department as a trial deployment. If everything works well, you'll enable SSPR for your whole organization.</p>
<p>In this unit, you'll learn how to enable SSPR in Microsoft Entra ID.</p>
<h3 id="prerequisites_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#prerequisites_4">Prerequisites</a></h3>
<p>Before you start to configure SSPR, you need a:</p>
<ul>
<li><strong>Microsoft Entra organization</strong>: This organization must have at least a trial license enabled.</li>
<li><strong>Microsoft Entra account with Global Administrator privileges</strong>: You'll use this account to set up SSPR.</li>
<li><strong>Non-administrative user account</strong>: You'll use this account to test SSPR. It's important that this account isn't an administrator, because Microsoft Entra imposes extra requirements on administrative accounts for SSPR. This user, and all user accounts, must have a valid license to use SSPR.</li>
<li><strong>Security group with which to test the configuration</strong>: The non-administrative user account must be a member of this group. You'll use this security group to limit who you roll SSPR out to.</li>
</ul>
<p>If you don't already have a Microsoft Entra organization that you can use for this module, we'll set one up in the next unit.</p>
<h3 id="scope-of-sspr-rollout"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#scope-of-sspr-rollout">Scope of SSPR rollout</a></h3>
<p>There are three settings for the <strong>Self-service password reset enabled</strong> property:</p>
<ul>
<li><strong>None</strong>: No users in the Microsoft Entra organization can use SSPR. This value is the default.</li>
<li><strong>Selected</strong>: Only the members of the specified security group can use SSPR. You can use this option to enable SSPR for a targeted group of users who can test it and verify that it works as expected. When you're ready to roll it out broadly, set the property to <strong>Enabled</strong> so that all users have access to SSPR.</li>
<li><strong>All</strong>: All users in the Microsoft Entra organization can use SSPR.</li>
</ul>
<h3 id="configure-sspr"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#configure-sspr">Configure SSPR</a></h3>
<p>** Here are the high-level steps to configure SSPR:</p>
<ol>
<li>
<p>Go to the <a href="https://portal.azure.com/">Azure portal</a>, then to <strong>Microsoft Entra ID</strong> &gt; <strong>Manage</strong> &gt; <strong>Password reset</strong>.</p>
</li>
<li>
<p><strong>Properties</strong>:</p>
<ul>
<li>Enable SSPR.</li>
<li>You can enable it for all users in the Microsoft Entra organization or for selected users.</li>
<li>To enable for selected users, you must specify the security group. Members of this group can use SSPR.</li>
</ul>
<p><img alt="Screenshot of the Password Reset configuration panel. Properties option is selected allowing user to enable self service password resets." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/3-enable-sspr.png" /></p>
</li>
<li>
<p><strong>Authentication methods</strong>:</p>
<ul>
<li>Choose whether to require one or two authentication methods.</li>
<li>Choose the authentication methods that the users can use.</li>
</ul>
<p><img alt="Screenshot of the Password Reset panel's Authentication methods option selected displaying panel with authentication options." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/3-auth-methods.png" /></p>
</li>
<li>
<p><strong>Registration</strong>:</p>
<ul>
<li>Specify whether users are required to register for SSPR when they next sign in.</li>
<li>Specify how often users are asked to reconfirm their authentication information.</li>
</ul>
<p><img alt="Screenshot of the Password Reset panel's Registration option selected displaying panel with registration options." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/3-registration-options.png" /></p>
</li>
<li>
<p><strong>Notifications</strong>: Choose whether to notify users and administrators of password resets.</p>
<p><img alt="Screenshot of the Password Reset panel's Notification option selected displaying panel with notification options." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/3-notification-settings.png" /></p>
</li>
<li>
<p><strong>Customization</strong>: Provide an email address or web page URL where your users can get help.</p>
<p><img alt="Screenshot of the Password Reset panel's Customization option selected displaying panel with helpdesk options." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/3-customization-settings.png" /></p>
</li>
</ol>
<h2 id="exercise-set-up-self-service-password-reset"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#exercise-set-up-self-service-password-reset">Exercise - Set up self-service password reset</a></h2>
<p>In this unit, you'll configure and test self-service password reset (SSPR) by using your mobile phone. You'll need to use your mobile phone to complete the password-reset process in this exercise.</p>
<h3 id="create-a-microsoft-entra-organization"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-a-microsoft-entra-organization">Create a Microsoft Entra organization</a></h3>
<p>For this step, you'll want to create a new directory and sign up for trial Premium subscription for Microsoft Entra ID.</p>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/">Azure portal</a>.</p>
</li>
<li>
<p>Select <strong>Create a resource</strong> &gt; <strong>Identity</strong> &gt; <strong>Microsoft Entra ID</strong>.</p>
<p><img alt="Screenshot that shows Microsoft Entra ID in the Azure Marketplace." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/4-create-active-directory.png" /></p>
</li>
<li>
<p>Select <strong>Microsoft Entra ID</strong>, then select <strong>Next : Configuration</strong>.</p>
</li>
<li>
<p>On the <strong>Create tenant</strong> page, use the following values. Then select <strong>Review + Create</strong>, followed by <strong>Create</strong>.</p>
<p>Expand table</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Organization name</td>
<td>Choose any organization name.</td>
</tr>
<tr>
<td>Initial domain name</td>
<td>Choose a domain name that's unique within <strong>.onmicrosoft.com</strong>. Make a note of the domain you choose.</td>
</tr>
<tr>
<td>Country or region</td>
<td>United States.</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>Complete the CAPTCHA, then select <strong>Submit</strong>.</p>
</li>
<li>
<p>After you create the organization, select the F5 key to refresh the page. Select your user account and then select <strong>Switch directory</strong>.</p>
</li>
<li>
<p>Select the organization you just created.</p>
</li>
</ol>
<h3 id="create-a-microsoft-entra-id-p2-trial-subscription"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-a-microsoft-entra-id-p2-trial-subscription">Create a Microsoft Entra ID P2 trial subscription</a></h3>
<p>Now activate a trial Premium subscription for the organization so that you can test SSPR.</p>
<ol>
<li>Go to <strong>Microsoft Entra ID</strong> &gt; <strong>Manage</strong> &gt; <strong>Password reset</strong>.</li>
<li>Select <strong>Get a free Premium trial to use this feature</strong>.</li>
<li>Under <strong>Microsoft Entra ID P2</strong>, expand <strong>Free trial</strong>, and select <strong>Activate</strong>.</li>
<li>Refresh the browser to see the <strong>Password reset - Properties</strong> page. You might need to refresh a few times.</li>
</ol>
<h3 id="create-a-group"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-a-group">Create a group</a></h3>
<p>You want to roll out SSPR to a limited set of users first to make sure your SSPR configuration works as expected. Let's begin by creating a security group for the limited rollout.</p>
<ol>
<li>
<p>In the Microsoft Entra organization you created, under <strong>Manage</strong>, select <strong>Groups</strong>.</p>
</li>
<li>
<p>Select <strong>New Group</strong>.</p>
</li>
<li>
<p>Enter the following values:</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Group type</td>
<td>Security</td>
</tr>
<tr>
<td>Group name</td>
<td>SSPRTesters</td>
</tr>
<tr>
<td>Group description</td>
<td>Members are testing the rollout of SSPR</td>
</tr>
<tr>
<td>Membership type</td>
<td>Assigned</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>Select <strong>Create</strong>.</p>
<p><img alt="Screenshot that shows new group form filled out and the create button highlighted." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/4-create-group.png" /></p>
</li>
</ol>
<h3 id="create-a-user-account"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#create-a-user-account">Create a user account</a></h3>
<p>To test your configuration, create an account that's not associated with an administrator role. You'll also assign the account to the group you created.</p>
<ol>
<li>
<p>In your Microsoft Entra organization, under <strong>Manage</strong>, select <strong>Users</strong>.</p>
</li>
<li>
<p>Select <strong>+ New user</strong>, select <strong>Create new user</strong> in the drop-down, and use the following values:</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>User name</td>
<td>balas</td>
</tr>
<tr>
<td>Name</td>
<td>Bala Sandhu</td>
</tr>
<tr>
<td>Password</td>
<td>Select the <strong>Copy</strong> icon next to the autogenerated password, then paste the password to a text editor like Notepad.</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>Select the <strong>Assignments</strong> tab.</p>
</li>
<li>
<p>Select <strong>Add group</strong>, check the box for the <strong>SSPRTesters</strong> group, and then the <strong>Select</strong> button.</p>
</li>
<li>
<p>Select <strong>Review + create</strong> and then select <strong>Create</strong>.</p>
</li>
</ol>
<h3 id="enable-sspr"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#enable-sspr">Enable SSPR</a></h3>
<p>Now, you're ready to enable SSPR for the group.</p>
<ol>
<li>
<p>In your Microsoft Entra organization, under <strong>Manage</strong>, select <strong>Password reset</strong>.</p>
</li>
<li>
<p>If the <strong>Password reset</strong> page still displays the message <strong>Get a free Premium trial to use this feature</strong>, wait for a few minutes and then refresh the page.</p>
</li>
<li>
<p>On the <strong>Properties</strong> page, select <strong>Selected</strong>. Select the <strong>No groups selected</strong> link, select the box next to the <strong>SSPRTesters</strong> group, and then the <strong>Select</strong> button.</p>
</li>
<li>
<p>Select <strong>Save</strong>.</p>
<p><img alt="Screenshot of the Password Reset properties panel wwith SSPR enabled and selected group set to SSPRTesters." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/4-choose-sspr-group.png" /></p>
</li>
<li>
<p>Under <strong>Manage</strong>, select the <strong>Authentication methods</strong>, <strong>Registration</strong>, and <strong>Notifications</strong> pages to review the default values.</p>
</li>
<li>
<p>Select <strong>Customization</strong>.</p>
</li>
<li>
<p>Select <strong>Yes</strong>, and then in the <strong>Custom helpdesk email or URL</strong> text box, enter <strong>admin@organization-domain-name.onmicrosoft.com</strong>. Replace "organization-domain-name" with the domain name of the Microsoft Entra organization you created. If you've forgotten the domain name, hover over your profile in the Azure portal.</p>
</li>
<li>
<p>Select <strong>Save</strong>.</p>
</li>
</ol>
<h3 id="register-for-sspr"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#register-for-sspr">Register for SSPR</a></h3>
<p>Now that the SSPR configuration is complete, register a mobile phone number for the user you created.</p>
<p>Note</p>
<p>If you get a message that says "The administrator has not enabled this feature," use private/incognito mode in your web browser.</p>
<ol>
<li>
<p>In a new browser window, go to <a href="https://aka.ms/ssprsetup">https://aka.ms/ssprsetup</a>.</p>
</li>
<li>
<p>Sign in with the user name <strong>balas@organization-domain-name.onmicrosoft.com</strong> and the password that you noted earlier. Remember to replace "organization-domain-name" with the domain name of the Microsoft Entra organization you created.</p>
</li>
<li>
<p>If you're asked to update your password, enter a new password of your choice. Make sure you note the new password.</p>
</li>
<li>
<p>Select the <strong>Security info</strong> tab, and then select <strong>+ Add sign-in method</strong>.</p>
</li>
<li>
<p>In the <strong>Add a method</strong> box, select <strong>Phone</strong>.</p>
</li>
<li>
<p>Enter your mobile phone details.</p>
<p><img alt="Screenshot that shows mobile phone registration form for SSPR." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/4-register-mobile-phone.png" /></p>
</li>
<li>
<p>Select the <strong>Text me a code</strong> radio button, and then select <strong>Next</strong>.</p>
</li>
<li>
<p>When you receive the code on your mobile phone, enter the code in the text box and select <strong>Next</strong>.</p>
</li>
<li>
<p>Select <strong>Done</strong>.</p>
</li>
</ol>
<h3 id="test-sspr"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#test-sspr">Test SSPR</a></h3>
<p>Now, let's test whether the user can reset their password.</p>
<ol>
<li>
<p>In a new browser window, go to <a href="https://aka.ms/sspr">https://aka.ms/sspr</a>.</p>
</li>
<li>
<p>For <strong>User ID</strong>, type <strong>balas@organization-domain-name.onmicrosoft.com</strong>. Replace "organization-domain-name" with the domain you used for your Microsoft Entra organization.</p>
<p><img alt="Screenshot that shows the password reset dialog." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/4-start-password-reset.png" /></p>
</li>
<li>
<p>Complete the CAPTCHA and select <strong>Next</strong>.</p>
</li>
<li>
<p>Enter your mobile phone number, then select <strong>Text</strong>.</p>
</li>
<li>
<p>When the text arrives, in the <strong>Enter your verification code</strong> text box, enter the code you were sent. Select <strong>Next</strong>.</p>
</li>
<li>
<p>Enter a new password, and then select <strong>Finish</strong>. Make sure you note the new password.</p>
</li>
<li>
<p>Close the browser window.</p>
</li>
</ol>
<h2 id="exercise-customize-directory-branding"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#exercise-customize-directory-branding">Exercise - Customize directory branding</a></h2>
<p>Suppose you've been asked to display your retail organization's branding on the Azure sign-in page to reassure users that they're passing credentials to a legitimate system. Here, you'll learn how to configure this custom branding.</p>
<p>To complete this exercise, you must have two image files:</p>
<ul>
<li>A page background image. This must be a PNG or JPG file, 1920 x 1080 pixels, and smaller than 300 KB.</li>
<li>A company logo image. This must be a PNG or JPG file, 32 x 32 pixels, and smaller than 5 KB.</li>
</ul>
<h3 id="customize-microsoft-entra-organization-branding"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#customize-microsoft-entra-organization-branding">Customize Microsoft Entra organization branding</a></h3>
<p>Let's use Microsoft Entra ID to set up the custom branding.</p>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/">Azure portal</a>.</p>
</li>
<li>
<p>Go to your Microsoft Entra organization by selecting <strong>Microsoft Entra ID</strong>. If you're not in the right Microsoft Entra organization, go to your Azure profile, and select <strong>Switch directory</strong> to find your organization.</p>
</li>
<li>
<p>Under <strong>Manage</strong>, select <strong>Company branding</strong>. Then select the <strong>Customize</strong> button in the center of the screen.</p>
</li>
<li>
<p>Next to <strong>Favicon</strong>, select <strong>Browse</strong>. Select your logo image.</p>
</li>
<li>
<p>Next to <strong>Background image</strong>, select <strong>Browse</strong>. Select your page background image.</p>
</li>
<li>
<p>Select a <strong>Page background color</strong> or accept the default.</p>
<p><img alt="Screenshot that shows the configure company branding form." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/5-customize-ui.png" /></p>
</li>
<li>
<p>Select <strong>Review + Create</strong>, and then select <strong>Create</strong>.</p>
</li>
</ol>
<h3 id="test-the-organizations-branding"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#test-the-organizations-branding">Test the organization's branding</a></h3>
<p>Now, let's use the account that we created in the last exercise to test the branding.</p>
<ol>
<li>
<p>In a new browser window, go to <a href="https://login.microsoft.com/">https://login.microsoft.com</a>.</p>
</li>
<li>
<p>Select the account for <strong>Bala Sandhu</strong>. Your custom branding is displayed.</p>
<p><img alt="Screenshot that shows the customized sign-in page." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/5-custom-login-page.png" /></p>
</li>
<li>
<p>Select <strong>Forgot my password</strong>.</p>
<p><img alt="Screenshot that shows organization logo on password reset page." src="https://learn.microsoft.com/en-us/training/modules/allow-users-reset-their-password/media/5-forgot-password-branding.png" /></p>
</li>
</ol>
<h2 id="summary_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#summary_1">Summary</a></h2>
<p>In this module, you've learned how you can use SSPR in Microsoft Entra ID to allow users to reset their forgotten or expired passwords. An administrator doesn't have to do the password reset. SSPR is secured by authentication methods of your choice. These methods can include a mobile authentication app, a code sent to you by an SMS text message, or security questions.</p>
<p>SSPR helps reduce the amount of work required from administrators. It also minimizes the productivity impact for users when they forget their password.</p>
<h3 id="clean-up"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#clean-up">Clean up</a></h3>
<p>Remember to clean up after you've finished.</p>
<ul>
<li><strong>Delete the user you created in Microsoft Entra ID</strong>: Go to <strong>Microsoft Entra ID</strong> &gt; <strong>Manage</strong> &gt; <strong>Users</strong>. Check the box next to the user and select <strong>Delete</strong>. Select <strong>OK</strong>.</li>
<li><strong>Delete the group you created in Microsoft Entra ID</strong>: Go to <strong>Microsoft Entra ID</strong> &gt; <strong>Manage</strong> &gt; <strong>Groups</strong>. Check the box next to the group and select <strong>Delete</strong>. Select <strong>OK</strong>.</li>
<li><strong>Turn off self-service password reset</strong>: Go to <strong>Microsoft Entra ID</strong> &gt; <strong>Manage</strong> &gt; <strong>Password reset</strong>. Under <strong>Self service password reset enabled</strong>, select <strong>None</strong>. Select <strong>Save</strong>.</li>
</ul>
<p>If you created a Premium trial Microsoft Entra tenant for this module, you can delete the tenant 30 days after the trial has expired.</p>
<h3 id="learn-more"><a class="toclink" href="2024/11/14/Az%20104%20-%20Managed%20Identities%20Governance/#learn-more">Learn more</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/entra/identity/authentication/tutorial-enable-sspr">Tutorial: Enable users to unlock their account or reset passwords using Microsoft Entra self-service password reset</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/identity/authentication/concept-sspr-howitworks">How it works: Microsoft Entra self-service password reset</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/external-id/customers/how-to-enable-password-reset-customers">Enable self-service password reset</a></li>
</ul>
<hr />
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-11-14 00:00:00">November 14, 2024</time></li>
        
        
          
          <li class="md-meta__item">
            
              87 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="introduction-to-azure-backup"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/">Introduction to Azure Backup</a></h2>
<h2 id="introduction"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction">Introduction</a></h2>
<p>Information technology workers understand the importance of data to the organization. The need to protect that data drives decisions around storage, backups, and security. Many companies implement policies that dictate backup specifications for frequency, duration of backup storage, and restore policies.</p>
<p>For on-premises scenarios, backup solutions might have included local redundant storage solutions or off-site storage. Scenarios using backup to tape drives and storing offsite come with the resulting delay in restoring the data (because of the need to transport the tapes back to the server rooms and from performing the restore operation). This can result in significant downtime.</p>
<p>These backup solutions might not always address some of the most important considerations, such as security of the backups, the potential for the company to be impacted by a ransomware attack, or human error in the backup and restore operations. An ideal solution would be cost-effective, simple to use, and secure. This is where Azure Backup comes in.</p>
<p><img alt="Diagram of a backup scenario with a company's servers and workstations on the left, with files and folders, using the Backup Agent to back up the data to Microsoft Azure storage." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/architecture-on-premises-mars.png" /></p>
<p>Azure Backup can also address scenarios for your Azure environments, with support for:</p>
<ul>
<li>Azure VMs</li>
<li>Azure Managed Disks</li>
<li>Azure Files</li>
<li>SQL Server in Azure VMs</li>
<li>SAP HANA databases in Azure VMs</li>
<li>Azure Database for PostgreSQL servers</li>
<li>Azure Blobs</li>
<li>Azure Database for PostgreSQL - Flexible servers</li>
<li>Azure Database for MySQL - Flexible servers</li>
<li>Azure Kubernetes cluster</li>
</ul>
<h3 id="example-scenario"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#example-scenario">Example scenario</a></h3>
<p>You're running an application powered by SQL Server. The database is running in an always-on availability group across three Azure VMs. You want to back up the databases using an Azure native backup service. You're looking to store the backup for 10 years in cheaper storage for your audit and compliance needs. You'd like to monitor the backup jobs daily for all such databases.</p>
<p><img alt="Diagram of an application using a SQL Server backend database and Azure Backup for data backup scenarios." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/scenario.png" /></p>
<h3 id="what-will-we-be-doing"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#what-will-we-be-doing">What will we be doing?</a></h3>
<p>We'll evaluate the features and capabilities of Azure Backup to help decide if:</p>
<ul>
<li>Azure Backup can offer a solution for your backup needs.</li>
<li>You can back up and restore the data you need for your organization.</li>
<li>Azure Backup offers secure storage of your data.</li>
</ul>
<h3 id="what-is-the-main-goal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#what-is-the-main-goal">What is the main goal?</a></h3>
<p>By the end of this session, you'll be able to decide if Azure Backup is the right solution to consider for your data-protection needs.</p>
<h2 id="what-is-azure-backup"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#what-is-azure-backup">What is Azure Backup?</a></h2>
<p>Let's start by defining Azure Backup and taking a quick tour of the core features. This overview should help you decide whether Azure Backup might be a good fit for your data-protection needs.</p>
<h3 id="what-is-azure-backup_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#what-is-azure-backup_1">What is Azure Backup?</a></h3>
<p>The Azure Backup service provides simple, secure, and cost-effective solutions to back up your data and recover it from the Microsoft Azure cloud.</p>
<p><img alt="Diagram of the Azure Backup service implementing backup agents in the on-premises environment to the cloud. Middle section displays the components of Azure Backup for security and scalability with an underlying bar indicating central management." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/azure-backup-overview.png" /></p>
<h3 id="azure-backup-definition"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#azure-backup-definition">Azure Backup definition</a></h3>
<p>Azure Backup is an Azure service that provides cost effective, secure, and zero-infrastructure backup solutions for all Azure-managed data assets.</p>
<p>The centralized management interface makes it easy to define backup policies and protect a wide range of enterprise workloads, including Azure Virtual Machines, Azure Disks, SQL and SAP databases, Azure file shares, and blobs.</p>
<p><img alt="Diagram of Azure Backup architecture displaying workloads at the bottom, feeding upwards into the data plane, and tying into the management plane. Management contains backup policies, Azure policies, Azure Monitor, and Azure Lighthouse services." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/azure-backup-architecture.png" /></p>
<h3 id="when-to-use-azure-backup"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#when-to-use-azure-backup">When to use Azure Backup</a></h3>
<p>As the IT admin of your organization, you're responsible for meeting the compliance needs for all the data assets of the firm, and backup is a critical aspect. There are also various application admins in your company who need to do self-service backup and restore to take care of issues like data corruption or rogue-admin scenarios. You're looking for an enterprise-class backup solution to protect all your workloads and manage them from a central place.</p>
<p>Azure Backup can provide backup services for the following data assets:</p>
<ul>
<li>On-premises files, folders, and system state</li>
<li>Azure Virtual Machines (VMs)</li>
<li>Azure Managed Disks</li>
<li>Azure Files Shares</li>
<li>SQL Server in Azure VMs</li>
<li>SAP HANA (High-performance Analytic Appliance) databases in Azure VMs</li>
<li>Azure Database for PostgreSQL servers</li>
<li>Azure Blobs</li>
<li>Azure Database for PostgreSQL - Flexible servers</li>
<li>Azure Database for MySQL - Flexible servers</li>
<li>Azure Kubernetes cluster</li>
</ul>
<p><img alt="Screenshot of Azure Backup center displaying a list of backup jobs. The list displays the backup instance, data source, operation type, and status." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/backup-center-jobs.png" /></p>
<h3 id="key-features"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#key-features">Key features</a></h3>
<p>Let's look at some key features of Azure Backup.</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zero-infrastructure backup solution</td>
<td>Unlike conventional backup solutions, no backup server or infrastructure is needed. Similarly, no backup storage needs to be deployed, because Azure Backup automatically manages and scales it.</td>
<td>Zero-infrastructure solution eliminates capital expenses and reduces operational expenses. It increases ease of use by automating storage management.</td>
</tr>
<tr>
<td>At-scale management</td>
<td>Natively manage your entire backup estate from a central console called Backup Center. Use APIs, PowerShell, and Azure CLI to automate Backup policy and security configurations.</td>
<td>Backup center simplifies data protection management at-scale by enabling you to discover, govern, monitor, operate, and optimize backup management from one unified console, which helps you to drive operational efficiency with Azure.</td>
</tr>
<tr>
<td>Security</td>
<td>Azure Backup provides built-in security to your backup environment, both when your data is in transit and at rest by using capabilities encryption, private endpoints, alerts, and so on.</td>
<td>Your backups are automatically secured against ransomware, malicious admins, and accidental deletions.</td>
</tr>
</tbody>
</table>
<h3 id="how-do-recovery-time-objective-and-recovery-point-objective-work"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#how-do-recovery-time-objective-and-recovery-point-objective-work">How do Recovery Time Objective and Recovery Point Objective work?</a></h3>
<p>Recovery Time Objective (RTO) is the target time within which a business process must be restored after a disaster occurs to avoid unacceptable consequences. For instance, if a critical application goes down due to a server failure and the business can only tolerate a maximum of four hours of downtime, then the RTO is four hours.</p>
<p>Recovery Point Objective (RPO) is the maximum amount of data loss, measured in time, that your organization can sustain during an event.</p>
<p>The following example scenario describes both the RPO and RTO concepts:</p>
<p>Your organization has an RPO of one hour for your customer database, which means you perform backups every hour. If a data-loss incident occurs, you lose not more than one hour of data. When you set RTO to three hours, then if a system failure occurs, you aim to restore access to the database within three hours to minimize the impact on operations.</p>
<h2 id="how-azure-backup-works"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#how-azure-backup-works">How Azure Backup works</a></h2>
<p>Let's take a look at how Azure Backup works to provide the data protection you need. Particularly, let's look at how the different aspects of the backup service make it easy to back up various types of data, and how it offers security for your backups as well. In this unit, we cover the following aspects of the Azure Backup Service:</p>
<ul>
<li><strong>Workload integration layer - Backup Extension</strong>: Integration with the actual workload, such as Azure virtual machines (VMs) or Azure Blobs, happens at this layer.</li>
<li><strong>Data Plane - Access Tiers</strong>: There are three access tiers where the backups could be stored:<ul>
<li>Snapshot tier</li>
<li>Standard tier</li>
<li>Archive tier</li>
</ul>
</li>
<li><strong>Data Plane - Availability and Security</strong>: The backup data is replicated across zones or regions, based on the redundancy the user specifies.</li>
<li><strong>Management Plane – Recovery Services vault/Backup vault and Backup center</strong>: The vault provides an interface for the user to interact with the backup service.</li>
</ul>
<h3 id="what-data-is-backed-up-and-how"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#what-data-is-backed-up-and-how">What data is backed up and how?</a></h3>
<p>The simplest explanation of Azure Backup is that it backs up data, machine state, and workloads running on on-premises machines and VM instances to the Azure cloud. Azure Backup stores the backed-up data in Recovery Services vaults and Backup vaults.</p>
<p>For <strong>on-premises</strong> Windows machines, you can back up directly to Azure with the <strong>Azure Backup Microsoft Azure Recovery Services (MARS) agent</strong>. Alternatively, you can back up these Windows machines to a backup server, perhaps a <strong>System Center Data Protection Manager (DPM) or Microsoft Azure Backup Server (MABS).</strong> You can then back that server up to a Recovery Services vault in Azure.</p>
<p>If you're using <strong>Azure VMs</strong>, you can back them up <strong>directly</strong>. <strong>Azure Backup</strong> installs a backup extension to the Azure VM agent that's running on the VM, which allows you to back up the entire VM. If you only want to back up the files and folders on the VM, you can do so by running the <strong>MARS agent.</strong></p>
<p>Azure Backup stores backed-up data in vaults: Recovery Services vaults and Backup vaults. A vault is an online-storage entity in Azure that's used to hold data such as backup copies, recovery points, and backup policies.</p>
<h4 id="supported-backup-types"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#supported-backup-types">Supported backup types</a></h4>
<p>Azure Backup supports full backups and incremental backups. Your initial backup is a full backup. The incremental backup is used by DPM/MABS use the incremental backup for disk backups, and used in all backups to Azure. As the name suggests, incremental backups only focus on the blocks of data that changed since the previous backup.</p>
<p>Azure Backup also supports SQL Server backup types. The following table outlines the support for SQL Server type backups:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Full</td>
<td>A full database backup backs up the entire database. It contains all the data in a specific database or in a set of filegroups or files. A full backup also contains enough logs to recover that data.</td>
<td>At most, you can trigger one full backup per day. You can choose to make a full backup on a daily or weekly interval.</td>
</tr>
<tr>
<td>Differential</td>
<td>A differential backup is based on the most recent full-data backup. It captures only the data that changed since the full backup.</td>
<td>At most, you can trigger one differential backup per day. You can't configure a full backup and a differential backup on the same day.</td>
</tr>
<tr>
<td>Multiple backups per day</td>
<td>Back up Azure VMs hourly with a minimum recovery point objective (RPO) of 4 hours and a maximum of 24 hours.</td>
<td>You can use Enhanced backup policy to set the backup schedule to 4, 6, 8, 12, and 24 hours (respectively) for new Azure offerings, such as Trusted Launch VM.</td>
</tr>
<tr>
<td>Selective disk backup</td>
<td>Selectively back up a subset of the data disks that are attached to your VM, then restore a subset of the disks that are available in a recovery point, both from instant restore and vault tier. Selective disk backup helps you manage critical data in a subset of the VM disks and use database backup solutions when you want to back up only their OS disk to reduce cost.</td>
<td>Azure Backup provides Selective Disk backup and restore capability using Enhanced backup policy.</td>
</tr>
<tr>
<td>Transaction Log</td>
<td>A log backup enables point-in-time restoration up to a specific second.</td>
<td>At most, you can configure transactional log backups every 15 minutes.</td>
</tr>
</tbody>
</table>
<h3 id="workload-integration-layer-backup-extension"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#workload-integration-layer-backup-extension">Workload integration layer - Backup Extension</a></h3>
<p>A backup extension specific to each workload is installed on the source VM or a worker VM. At the time of backup (as defined by the user in the Backup Policy) the backup extension generates the backup, which could be:</p>
<ul>
<li>
<p><strong>Storage</strong>: Snapshots when using an Azure VM or Azure Files.</p>
</li>
<li>
<p><strong>Stream backup</strong>: For databases like SQL or High-performance Analytic Appliance (HANA) running in VMs.</p>
</li>
</ul>
<p>The backup data is eventually transferred to Azure Backup managed storage in the data plane by using secure Azure networks Network Security Groups (NSG), Firewalls, or more sophisticated private endpoints.</p>
<h3 id="data-plane-access-tiers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#data-plane-access-tiers">Data Plane - Access Tiers</a></h3>
<p>There are three access tiers where the backups can be stored:</p>
<ul>
<li>
<p><strong>Snapshot tier</strong>: (Workload-specific term) In the first phase of a virtual machine backup, the snapshot is taken and stored along with the disk. This form of storage is referred to as a snapshot tier. Restoring a snapshot tier is faster than restoring from a vault, because it eliminates the wait time for snapshots to be copied from the vault before triggering the restore operation. The snapshots of the VM/Azure Files/Azure Blobs/and so on are retained in the customer's subscription in a specified resource group. This container ensures that restores are quick, because the backup/snapshot is available locally to the customer.</p>
</li>
<li>
<p><strong>Vault-standard tier</strong>: Backup data for all workloads supported by Azure Backup is stored in vaults, which hold backup storage, an autoscaling set of storage accounts managed by Azure Backup. The Vault-standard tier is an online storage tier that allows you to store an isolated copy of backup data in a Microsoft-managed tenant, thus creating an extra layer of protection. For workloads where snapshot tier is supported, there's a copy of the backup data in both the snapshot tier and the Vault-standard tier. The Vault-standard tier ensures that backup data is available even if the data source being backed up is deleted or compromised.</p>
</li>
<li>
<p><strong>Archive tier</strong>: Customers rely on Azure Backup for storing backup data, including their Long-Term Retention (LTR) backup data, with retention needs defined in the organization's compliance rules. In most cases, the older backup data is rarely accessed and is only stored for compliance needs.</p>
<p>Azure Backup supports backup of long-term retention points in the archive tier.</p>
</li>
</ul>
<p>All tiers offer different recovery time objectives (RTO) and are priced differently.</p>
<p><img alt="Diagram of the various workloads such as on-premises server, Azure VMs, Azure files, etc. feeding into the data plane where the access tiers are located." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/data-plane.png" /></p>
<h3 id="data-plane-availability-and-security"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#data-plane-availability-and-security">Data Plane - Availability and Security</a></h3>
<p>The backup data is replicated across zones or regions, based on the redundancy you specify. You can choose from locally redundant storage (LRS), Geo-redundant storage (GRS), or zone-redundant storage (ZRS). These options provide you with highly available data storage capabilities.</p>
<p>The data is kept safe by encrypting it and implementing Azure role-based access control (RBAC). You choose who can perform backup and restore operations. Azure Backup also provides protection against malicious deletion of your backup by using soft-delete operations. A deleted backup is stored for 14 days, free of charge, which allows you to recover the backup if needed.</p>
<p>Azure Backup also supports a backup data lifecycle-management scenario that allows you to comply with retention policies.</p>
<p><img alt="Graphic displaying the three security options of Azure RBAC, encryption, and soft delete as icons." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/built-in-security.png" /></p>
<h3 id="management-plane-recovery-services-vaultbackup-vault-and-backup-center"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#management-plane-recovery-services-vaultbackup-vault-and-backup-center">Management Plane – Recovery Services vault/Backup vault and Backup center</a></h3>
<p>Azure Backup uses Recovery Services vaults and Backup vaults to orchestrate and manage backups. It also uses vaults to store backed-up data. The vault provides an interface for the user to interact with the backup service. Azure Backup Policies within each vault define when the backups should get triggered and how long they need to be retained.</p>
<p>You can use a single vault or multiple vaults to organize and manage your backup. If you manage your workloads with a single subscription and single resource, you can use a single vault to monitor and manage your backup estate. If your workloads are spread across multiple subscriptions, you can create multiple vaults with one or more vaults per subscription.</p>
<p><img alt="Diagram of the management plane. The recovery services vault shows the options for backup policies and management with the portal, SDK, or the Command-line interface (CLI)." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/backup-vaults.png" /></p>
<p>Backup center allows you to have a single pane of glass to manage all tasks related to backups. Backup center is designed to function well across a large and distributed Azure environment. You can use Backup center to efficiently manage backups spanning multiple workload types, vaults, subscriptions, regions, and Azure Lighthouse tenants.</p>
<p><img alt="Screenshot of the Backup center user interface in the Azure portal displaying backup information for Azure Virtual machines related to jobs and backup instances." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/backup-center.png" /></p>
<h2 id="when-to-use-azure-backup_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#when-to-use-azure-backup_1">When to use Azure Backup</a></h2>
<p>Here, we'll discuss how you can decide if Azure Backup is the right choice for your data-protection needs. We'll highlight common backup scenarios where Azure Backup provides benefits, such as:</p>
<ul>
<li>Ensuring availability of your data.</li>
<li>Protecting your Azure workloads.</li>
<li>Securing your data.</li>
</ul>
<h3 id="decision-criteria"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#decision-criteria">Decision criteria</a></h3>
<p>Azure Backup is an Azure service that provides secure and zero-infrastructure backup solutions for all Azure-managed data assets. It protects a wide range of enterprise workloads, including Azure Virtual Machines, Azure Disks, SQL and SAP databases, and Azure file shares and blobs.</p>
<p>The main criteria that we're evaluating are outlined in the following table. The table contains some key areas where Azure Backup can provide services to you for data protection.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Criteria</th>
<th>Consideration</th>
</tr>
</thead>
<tbody>
<tr>
<td>Azure workloads</td>
<td>Azure VMs, Azure Disks, SQL Server or SAP HANA databases running in Azure VMs, Azure Blobs, Azure Disks, Azure Database for PostgreSQL.</td>
</tr>
<tr>
<td>Compliance</td>
<td>Customer-defined backup policy with long-term retention across multiple zones or regions.</td>
</tr>
<tr>
<td>Operational recoveries</td>
<td>With self-service backup and restores, the application administrator can take care of issues that might arise such as accidental deletion or data corruption.</td>
</tr>
</tbody>
</table>
<h3 id="apply-the-criteria"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#apply-the-criteria">Apply the criteria</a></h3>
<p>In the introduction, we presented a scenario where your organization might have an application that relies on data from a back-end SQL Server installation. SQL Server is running on three Azure VMs. The data in the backup must be retained for up to 10 years to meet compliance requirements. You also want to be able to monitor the backups.</p>
<p>Before we dive into how Azure Backup can help meet these needs, it's important to understand what's not currently supported. If your three Azure VMs are deployed across multiple subscriptions or regions, you should be aware that Azure Backup doesn’t support cross-region backup for most workloads. However, it does support cross-region restore in a paired secondary region.</p>
<h4 id="can-azure-backup-protect-the-azure-vms-hosting-the-sql-server-instances"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#can-azure-backup-protect-the-azure-vms-hosting-the-sql-server-instances">Can Azure Backup protect the Azure VMs hosting the SQL Server instances?</a></h4>
<p>Azure Backup is able to back up entire Windows and Linux VMs using backup extensions. As a result, you can back up the entire VM that hosts SQL Server. If you only want to back up the files, folders, and system state on the Azure VMs, you can use the Microsoft Azure Recovery Services (MARS) agent.</p>
<p>If your main concern is to only back up the SQL Server data, Azure Backup provides support for that as well. Azure Backup offers a stream-based, specialized solution to back up SQL Servers running in Azure VMs. This solution aligns with Azure Backup's benefits of zero-infrastructure backup, long-term retention, and central management.</p>
<p>Additionally, Azure Backup provides the following advantages specifically for SQL Server:</p>
<ul>
<li>Workload aware backups that support all backup types: full, differential, and log</li>
<li>15-minute recovery point objective (RPO) with frequent log backups</li>
<li>Point-in-time recovery up to a second</li>
<li>Individual database-level backup and restore</li>
</ul>
<p><img alt="Diagram of SQL Server hosted on an Azure VM backed up to a Recovery Services Vaults in Azure Backup. Displayed are also a data path and controls arrow depicting two-way flow for the data path and control path flow from Azure Backup to the backup extension on the VM." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/azure-backup-sql-overview.png" /></p>
<h4 id="does-azure-backup-help-with-compliance"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#does-azure-backup-help-with-compliance">Does Azure Backup help with compliance?</a></h4>
<p>You can implement required access-control mechanisms for your backups. Vaults (Recovery Services and Backup vaults) provide the management capabilities and are accessible via the Azure portal, Backup Center, Vault dashboards, SDK, CLI, and even REST APIs. It's also an Azure role-based access control (Azure RBAC) boundary, providing you with the option to restrict access to backups only to authorized Backup Admins.</p>
<p>Short-term retention can be <em>minutes</em> or <em>daily</em>. Retention for <em>weekly</em>, <em>monthly</em>, or <em>yearly</em> backup points is referred to as <em>Long-term retention</em>.</p>
<p>Long-term retention can be:</p>
<ul>
<li><strong>Planned (compliance requirements)</strong>: If you know in advance that data is required years from the current time, use Long-term retention.</li>
<li><strong>Unplanned (on-demand requirement)</strong>: If you don't know in advance, then you can use on-demand backup with specific custom retention settings (these custom retention settings aren't impacted by policy settings).</li>
<li><strong>On-demand backup with custom retention</strong>: If you need to take a backup not scheduled via backup policy, then you can use an on-demand backup. It can be useful for taking backups that don’t fit your scheduled backup or for taking granular backup (for example, multiple IaaS VM backups per day since scheduled backup permits only one backup per day). It's important to note that the retention policy defined in scheduled policy doesn't apply to on-demand backups.</li>
</ul>
<p>You can also implement policy management to help with compliance. Azure Backup Policies within each vault define when the backups should be triggered and how long they need to be retained. You can also manage these policies and apply them across multiple items.</p>
<h4 id="does-azure-backup-simplify-monitoring-and-administration"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#does-azure-backup-simplify-monitoring-and-administration">Does Azure Backup simplify monitoring and administration?</a></h4>
<p>For monitoring and reporting, Azure Backup integrates with Log Analytics and provides the ability to see reports via Workbooks.</p>
<p>Azure Backup provides in-built job monitoring for operations such as configuring backup, backing up, restoring, deleting backups, and so on. It's scoped to the vault and ideal for monitoring a single vault.</p>
<p>If you need to monitor operational activities at scale, Backup Explorer provides an aggregated view of your entire backup estate, enabling detailed drill-down analysis and troubleshooting. It's a built-in Azure Monitor workbook that provides a single, central location to help you monitor operational activities across the entire backup estate on Azure, spanning tenants, locations, subscriptions, resource groups, and vaults.</p>
<hr />
<h2 id="configure-azure-monitor"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#configure-azure-monitor">Configure Azure Monitor</a></h2>
<h2 id="introduction_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_1">Introduction</a></h2>
<p>Azure Monitor is a comprehensive solution that collects, analyzes, and responds to telemetry data from both on-premises and cloud environments.</p>
<p>Suppose you work for a large e-commerce company that relies heavily on its online platform to generate revenue. During a major sales event, your website experiences a sudden increase in traffic, causing performance issues and impacting customer experience. As a result, customers are unable to complete their purchases. Poor customer experience led to lost sales and had a negative impact on the company's reputation. To prevent this from happening again, you need a tool that can monitor the availability and performance of your applications and services in real-time. With this tool you can quickly identify and resolve issues. Azure Monitor is the solution that can help you achieve this.</p>
<p>In this module, you will learn about the features and usage cases of Azure Monitor. You learn how to configure and interpret metrics and logs. You review the different components and data types in Azure Monitor. You also learn how to access and query the activity log.</p>
<p>The goal of this module is to equip you with the knowledge and skills to effectively use Azure Monitor.</p>
<h3 id="learning-objectives"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify the features and usage cases for Azure Monitor.</li>
<li>Configure and interpret metrics and logs.</li>
<li>Identify the Azure Monitor components and data types.</li>
<li>Configure the Azure Monitor activity Log.</li>
</ul>
<h3 id="skills-measured"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#skills-measured">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#prerequisites">Prerequisites</a></h3>
<ul>
<li>Familiarity with basic monitoring, evaluation, and reporting concepts.</li>
<li>Knowledge of Azure resources and services that benefit from monitoring activities.</li>
<li>Knowledge of the Azure portal so you can implement monitoring techniques.</li>
</ul>
<h2 id="describe-azure-monitor-key-capabilities"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#describe-azure-monitor-key-capabilities">Describe Azure Monitor key capabilities</a></h2>
<p>Azure Monitor provides you with a comprehensive solution for collecting, analyzing, and responding to telemetry data from your on-premises and cloud environments. The service features help you understand how your applications are performing. You can use Azure Monitor to proactively identify issues that affect your apps and resources, and take action to maximize their availability and performance.</p>
<h4 id="things-to-know-about-azure-monitor"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-azure-monitor">Things to know about Azure Monitor</a></h4>
<p>Azure Monitor provides features and capabilities in three areas:</p>
<ul>
<li>
<p><strong>Monitor and visualize metrics</strong>: Azure Monitor gathers numerical metric values from your Azure resources according to your preferences. Azure Monitor offers different methods for viewing your metric data to help you understand the health, operation, and performance of your system.</p>
</li>
<li>
<p><strong>Query and analyze logs</strong>: Azure Monitor Logs (Log Analytics) generates activity logs, diagnostic logs, and telemetry information from your monitoring solutions. The service provides analytics queries that you can use to help with troubleshooting and visualizations of your log data.</p>
</li>
<li>
<p><strong>Set up alerts and actions</strong>: Azure Monitor lets you set up alerts for your gathered data to notify you when critical conditions arise. You can configure actions based on the alert conditions, and take automated corrective steps based on triggers from your metrics or logs.</p>
</li>
</ul>
<h2 id="describe-azure-monitor-components"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#describe-azure-monitor-components">Describe Azure Monitor components</a></h2>
<p>Monitoring is the act of collecting and analyzing data. The data can be used to determine the performance, health, and availability of your business applications and the resources they depend on.</p>
<p>An effective monitoring strategy helps you understand the detailed operation of the components of your applications. Monitoring also helps you increase your uptime by proactively notifying you of critical issues. You can then resolve the issues before they become severe.</p>
<p>Azure includes multiple services that individually perform a specific role or task in the monitoring space. Together, these services deliver a comprehensive solution for collecting, analyzing, and acting on data from your applications and the Azure resources that support them. The services also work to monitor critical on-premises resources to provide a hybrid monitoring environment. Understanding the tools and data that are available is the first step in developing a complete monitoring strategy for your application.</p>
<h4 id="things-to-know-about-monitoring-with-azure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-monitoring-with-azure">Things to know about monitoring with Azure</a></h4>
<p>Let's take a look at the various Azure components that support Azure Monitor capabilities. The following diagram provides a high-level view of how Azure and Azure Monitor work together to provide you with a robust monitoring and diagnostics solution.</p>
<p><img alt="Diagram that shows the different monitoring and diagnostic services available in Azure as described in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/monitor-service-d0bdfd6d.png" /></p>
<ul>
<li>
<p>The monitoring and diagnostic services offered in Azure are divided into broad <strong>categories</strong> such as Core, Application, Infrastructure, and Shared Capabilities.</p>
</li>
<li>
<p><strong>Data stores</strong> in Azure Monitor hold your metrics and logs. <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/data-platform-metrics">Azure Monitor Metrics</a> and <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/data-platform-logs">Azure Monitor Logs</a> are the two base types of data used by the service.</p>
</li>
<li>
<p>Various <strong>monitoring sources</strong> provide Azure Monitor with the metrics and logs data to analyze. These sources can include your Azure subscription and tenant, your Azure service instances, your Azure resources, data from your applications, and more.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/azure-monitor/insights/insights-overview">Azure Monitor Insights</a> performs different functions with the collected data, including analysis, alerting, and streaming to external systems.</p>
<ul>
<li>
<p><strong>Get insights</strong>: Access the Azure Application Insights extension to Azure Monitor to use the Application Performance Monitoring (APM) features. You can use APM tools to monitor your application performance and gather trace logging data. Application Insights are available for many Azure services, such as Azure Virtual Machines and Azure Virtual Machine Scale Sets, Azure Container Instances, Azure Cosmos DB, and Azure IoT Edge.</p>
</li>
<li>
<p><strong>Visualize</strong>: Utilize the many options in Azure Monitor for viewing and interpreting your gathered metrics and logs. You can use Power BI with the Azure Workbooks feature of Azure Monitor and access configurable dashboards and views.</p>
</li>
<li>
<p><strong>Analyze</strong>: Work with Azure Monitor Logs (Log Analytics) in the Azure portal to write log queries for your data. You can interactively analyze your log data by using Azure Monitor Metrics and the powerful analysis engine.</p>
</li>
<li>
<p><strong>Respond</strong>: Set up log alert rules in Azure Monitor to receive notifications about your application performance. You can configure the service to take automated action when the results of your queries and alerts match certain conditions or results.</p>
</li>
<li>
<p><strong>Integrate</strong>: Ingest and export log query results from the Azure CLI, Azure PowerShell cmdlets, and various APIs. Set up automated export of your log data to your Azure Storage account or Azure Event Hubs. Build workflows to retrieve your log data and copy to external locations with Azure Logic Apps.</p>
</li>
</ul>
</li>
</ul>
<h2 id="define-metrics-and-logs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#define-metrics-and-logs">Define metrics and logs</a></h2>
<p>All data collected by Azure Monitor fits into one of two fundamental types, <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/platform/data-collection">metrics and logs</a>:</p>
<p><strong>Metrics</strong> are numerical values that describe some aspect of a system at a particular point in time. Metrics are lightweight and capable of supporting near real-time scenarios.</p>
<p><strong>Logs</strong> contain different kinds of data organized into records with different sets of properties for each type. Data like events and traces are stored as logs along with performance data so all the data can be combined for analysis.</p>
<h4 id="things-to-know-about-azure-monitor-metrics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-azure-monitor-metrics">Things to know about Azure Monitor metrics</a></h4>
<p>Let's examine how to work with Azure Monitor metrics in the Azure portal.</p>
<ul>
<li>
<p>For many Azure resources, the metrics data collected by Azure Monitor is displayed on the <strong>Overview</strong> page for the resource in the Azure portal. Consider the overview for an Azure virtual machine that has several charts that show performance metrics.</p>
</li>
<li>
<p>You can use Azure Monitor <strong>metrics explorer</strong> to view the metrics for your Azure services and resources.</p>
</li>
<li>
<p>In the Azure portal, select any graph for a resource to open the associated metrics data in metrics explorer. The tool lets you chart the values of multiple metrics over time. You can work with the charts interactively or pin them to a dashboard to view them with other visualizations.</p>
</li>
</ul>
<p><img alt="Illustration that depicts Azure Monitor metrics data graphs providing information to Metric Analytics in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/monitor-data-platform-7dbebda9.png" /></p>
<h4 id="things-to-know-about-azure-monitor-logs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-azure-monitor-logs">Things to know about Azure Monitor Logs</a></h4>
<p>You can also work with Azure Monitor Logs (Log Analytics) in the Azure portal. Let's review the details.</p>
<ul>
<li>
<p>In the Azure portal, log data collected by Azure Monitor is stored in Log Analytics.</p>
</li>
<li>
<p>Log Analytics includes a <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/log-query/log-query-overview">rich query language</a> to help you quickly retrieve, consolidate, and analyze your collected data.</p>
</li>
<li>
<p>You can work with Log Analytics to create and test queries. Use the query results to directly analyze the data, save your queries, visualize the data, and create alert rules.</p>
</li>
<li>
<p>Azure Monitor uses a version of the <a href="https://learn.microsoft.com/en-us/azure/kusto/query/">Data Explorer</a> query language. The language is suitable for simple log queries, but also includes advanced functionality like aggregations, joins, and smart analytics. You can quickly learn the query language by completing several available lessons. Particular guidance is provided for users familiar with SQL and Splunk.</p>
</li>
</ul>
<p><img alt="Illustration that depicts an Azure Monitor Logs database providing information to Log Analytics in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/log-data-32e50eae.png" /></p>
<h2 id="identify-monitoring-data-and-tiers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#identify-monitoring-data-and-tiers">Identify monitoring data and tiers</a></h2>
<p>Azure Monitor can collect data from various sources. You can think of the collected data as being categorized by tier. Tiers can include data collected from many sources, such as:</p>
<ul>
<li>Your application</li>
<li>The operating system</li>
<li>Services and resources used by your application</li>
<li>The platform that supports your application</li>
</ul>
<h4 id="things-to-know-about-data-collection"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-data-collection">Things to know about data collection</a></h4>
<p>Review the following details about how Azure Monitor collects different categories of data.</p>
<ul>
<li>
<p>Azure Monitor begins collecting data as soon as you create your Azure subscription and add resources.</p>
</li>
<li>
<p>When you create or modify resources, this data is stored in Azure Monitor activity logs.</p>
</li>
<li>
<p>Performance data about resources, along with the amount of resources consumed, is stored as Azure Monitor metrics.</p>
</li>
<li>
<p>Extend the data you're collecting by enabling diagnostics and adding Azure Monitor Agent to compute resources. By extending your data sources, you can collect data for the internal operation of the resources.</p>
</li>
<li>
<p>Azure Monitor Agent also lets you configure different data sources to collect logs and metrics from Windows and Linux guest operating systems.</p>
</li>
<li>
<p>Azure Monitor can collect log data from any REST client by using the Data Collector API. The Data Collector API lets you create custom monitoring scenarios and extend monitoring to resources that don't expose data through other sources.</p>
</li>
</ul>
<h5 id="monitoring-data-tiers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#monitoring-data-tiers">Monitoring data tiers</a></h5>
<p>The following table summarizes the tiers of monitoring data that are collected by Azure Monitor.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Data tier</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Application</strong></td>
<td>The Application tier contains monitoring data about the performance and functionality of your application code. This data is collected regardless of your platform.</td>
</tr>
<tr>
<td><strong>Guest OS</strong></td>
<td>Monitoring data about the operating system on which your application is running is organized into the Guest OS tier. Your application can run in Azure, another cloud, or on-premises.</td>
</tr>
<tr>
<td><strong>Azure resource</strong></td>
<td>The Azure resource tier holds monitoring data about the operation of any Azure resource you utilize, including consumption details for the resource.</td>
</tr>
<tr>
<td><strong>Azure subscription</strong></td>
<td>The Azure subscription tier contains monitoring data about the operation and management of your Azure subscription. The tier also contains data about the health and operation of Azure itself.</td>
</tr>
<tr>
<td><strong>Azure tenant</strong></td>
<td>Data about the operation of your tenant-level Azure services, such as Microsoft Entra ID, is organized into the Azure tenant tier.</td>
</tr>
</tbody>
</table>
<h2 id="describe-activity-log-events"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#describe-activity-log-events">Describe activity log events</a></h2>
<p>The Azure Monitor activity log is a subscription log that provides insight into subscription-level events that occur in Azure. Events can include a range of data from Azure Resource Manager operational data to updates on Azure service health events.</p>
<h4 id="how-to-use-the-azure-activity-log"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#how-to-use-the-azure-activity-log">How to use the Azure Activity Log</a></h4>
<p><img alt="" src="https://youtu.be/ACVpH6C_NL8" /></p>
<h4 id="things-to-know-about-activity-logs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-activity-logs">Things to know about activity logs</a></h4>
<p>Let's examine some details about working with activity logs in Azure Monitor.</p>
<ul>
<li>
<p>You can use the information in activity logs to understand the status of resource operations and other relevant properties.</p>
</li>
<li>
<p>Activity logs can help you determine the "what, who, and when" for any write operation (PUT, POST, DELETE) performed on resources in your subscription.</p>
</li>
<li>
<p>Activity logs are kept for 90 days.</p>
</li>
<li>
<p>You can query for any range of dates in an activity log, as long as the starting date isn't more than 90 days in the past.</p>
</li>
<li>
<p>You can retrieve events from your activity logs by using the Azure portal, the Azure CLI, PowerShell cmdlets, and the Azure Monitor REST API.</p>
</li>
</ul>
<p><img alt="Diagram that shows how Azure Monitor activity logs gather information from compute and non-compute resources in Azure." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/activity-log-7d1913ad.png" /></p>
<h5 id="business-scenarios"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#business-scenarios">Business scenarios</a></h5>
<p>Activity logs can help you monitor your configuration and get details for many scenarios, such as:</p>
<p><em>What operations happened on resources in my subscription?</em></p>
<p><em>Who initiated the operations?</em></p>
<p><em>When did the operations occur?</em></p>
<p><em>What's the current status of the operations?</em></p>
<p><em>What are the values of other properties that can help with my analysis of the resources and operations?</em></p>
<h2 id="query-the-activity-log"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#query-the-activity-log">Query the activity log</a></h2>
<p>In the Azure portal, you can filter your Azure Monitor activity logs so you can view specific information. The filters enable you to review only the activity log data that meets your criteria. You might set filters to review monitoring data about critical events for your primary subscription and production virtual machine during peak business hours.</p>
<p><img alt="Screenshot that shows filter options for activity logs in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/query-activity-log-a92271d9.png" /></p>
<h4 id="things-to-know-about-activity-log-filters"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-activity-log-filters">Things to know about activity log filters</a></h4>
<p>Let's review some of the filters you can set to control what data to review in your activity log:</p>
<ul>
<li>
<p><strong>Subscription</strong>: Show the data for one or more specified Azure subscription names.</p>
</li>
<li>
<p><strong>Timespan</strong>: Show data for a specified time by choosing the start and end time for events, such as a six-hour period.</p>
</li>
<li>
<p><strong>Event Severity</strong>: Show events at the selected severity levels, including <em>Informational</em>, <em>Warning</em>, <em>Error</em>, or <em>Critical</em>.</p>
</li>
<li>
<p><strong>Resource group</strong>: Show data for one or more specified resource groups within your specified subscriptions.</p>
</li>
<li>
<p><strong>Resource (name)</strong>: Show data for the specified resources.</p>
</li>
<li>
<p><strong>Resource type</strong>: Show data for resources of a specified type, such as <code>Microsoft.Compute/virtualmachines</code>.</p>
</li>
<li>
<p><strong>Operation name</strong>: Show data for a selected Azure Resource Manager operation, such as <code>Microsoft.SQL/servers/Write</code>.</p>
</li>
<li>
<p><strong>Event initiated by</strong>: Show operation data for a specified user who performed the operation, referred to as the "caller."</p>
</li>
</ul>
<p>After you define a set of filters, you can pin the filter set to the Azure Monitor dashboard. You can also download your activity log search results as a CSV file.</p>
<p>In addition to the filters, you can enter a text string in the <strong>Search</strong> box. Azure Monitor tries to match your search string against data returned for all fields in all events that corresponds to your filter settings.</p>
<h4 id="things-to-know-about-event-categories"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-event-categories">Things to know about event categories</a></h4>
<p>The following table summarizes the categories of events that you can review in your activity logs. The information displayed for events is based on your other filter settings.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Event category</th>
<th>Event data</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Administrative</strong></td>
<td>All create, update, delete, and action operations performed through Azure Resource Manager, and any changes to role-based access control (RBAC) in your filtered subscriptions</td>
<td><code>create virtual machine</code>  <br>  <br><code>delete network security group</code></td>
</tr>
<tr>
<td><strong>Service Health</strong></td>
<td>All service health events for Azure services and resources connected with your filtered subscriptions, including <em>Action Required</em>, <em>Assisted Recovery</em>, <em>Incident</em>, <em>Maintenance</em>, <em>Information</em>, or <em>Security</em></td>
<td><code>SQL Azure in East US is experiencing downtime</code>  <br>  <br><code>Azure SQL Data Warehouse Scheduled Maintence Complete</code></td>
</tr>
<tr>
<td><strong>Resource Health</strong></td>
<td>All resource health events for your filtered Azure resources, including <em>Available</em>, <em>Unavailable</em>, <em>Degraded</em>, or <em>Unknown</em>, and identified as <em>Platform Initiated</em> or <em>User Initiate</em></td>
<td><code>Virtual Machine health status changed to unavailable</code>  <br>  <br><code>Web App health status changed to available</code></td>
</tr>
<tr>
<td><strong>Alert</strong></td>
<td>All activations of Azure alerts for your filtered subscriptions and resources</td>
<td><code>CPU % on devVM001 has been over 80 for the past 5 minutes</code>  <br>  <br><code>Disk read LessThan 100000 in the last 5 minutes</code></td>
</tr>
<tr>
<td><strong>Autoscale</strong></td>
<td>All events related to the operation of the autoscale engine based on any autoscale settings defined for your filtered subscriptions</td>
<td><code>Autoscale scale up action failed</code></td>
</tr>
<tr>
<td><strong>Recommendation</strong></td>
<td>Recommendation events for certain Azure resource types, such as web sites and SQL servers, based on your filtered subscriptions and resources</td>
<td><em>Recommendations for how to better utilize your resources</em></td>
</tr>
<tr>
<td><strong>Security</strong></td>
<td>All alerts generated by Microsoft Defender for Cloud affecting your filtered subscriptions and resources</td>
<td><code>Suspicious double extension file executed</code></td>
</tr>
<tr>
<td><strong>Policy</strong></td>
<td>All effect action operations performed by Azure Policy for your filtered subscriptions and resources, where every action taken by Azure Policy is modeled as an operation on a resource</td>
<td><code>Audit</code> and <code>Deny</code></td>
</tr>
</tbody>
</table>
<h2 id="interactive-lab-simulation"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#interactive-lab-simulation">Interactive lab simulation</a></h2>
<h3 id="lab-scenario"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#lab-scenario">Lab scenario</a></h3>
<p>Your organization wants insight into the performance and configuration of Azure resources. As the Azure Administrator you need to:</p>
<ul>
<li>Explore Azure virtual machine monitoring capabilities, including available metrics.</li>
<li>Explore alerts and notification features.</li>
<li>Review logs by using Azure Monitor Logs (Log Analytics) queries.</li>
</ul>
<h3 id="architecture-diagram"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#architecture-diagram">Architecture diagram</a></h3>
<p><img alt="Architecture diagram as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/lab-11.png" /></p>
<h3 id="objectives"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#objectives">Objectives</a></h3>
<ul>
<li><strong>Task 1</strong>: Provision the lab environment.<ul>
<li>Review an <a href="https://github.com/MicrosoftLearning/AZ-104-MicrosoftAzureAdministrator/blob/master/Allfiles/Labs/11/az104-11-vm-template.json">Azure Resource Manager (ARM) template</a>.</li>
<li>Use the ARM template to deploy a virtual machine to use to test monitoring scenarios.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Register the Microsoft Insights and Microsoft Alerts Management resource providers.<ul>
<li>Create a Log Analytics workspace in the same region as the virtual machines.</li>
<li>Create an Azure Automation Account and associate it with the Azure Monitor Logs (Log Analytics) workspace.</li>
<li>Enable update management.</li>
</ul>
</li>
<li><strong>Task 3</strong>: Create and configure an Azure Monitor Logs (Log Analytics) workspace and Azure Automation-based solutions.<ul>
<li>Review Azure virtual machine monitoring options.</li>
<li>Review the list of available metrics.</li>
</ul>
</li>
<li><strong>Task 4</strong>: Review default monitoring settings of Azure virtual machines.</li>
<li><strong>Task 5</strong>: Configure Azure virtual machine diagnostic settings.<ul>
<li>Review the Azure virtual machine monitoring settings and enable guest-level monitoring.</li>
<li>Enable Azure Monitor Agent and available metrics.</li>
</ul>
</li>
<li><strong>Task 6</strong>: Review Azure Monitor functionality.<ul>
<li>Configure Azure Monitor metrics.</li>
<li>Create an alert rule based on average percentage CPU.</li>
<li>Configure notifications for an action group.</li>
<li>Trigger increased CPU utilization and review alert notifications.</li>
</ul>
</li>
<li><strong>Task 7</strong>: Review Azure Monitor Logs (Log Analytics) functionality.<ul>
<li>Create a log query to chart the virtual machine's available memory over the last hour.</li>
<li>Run the log query and preview the data.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Select the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2017"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/simulation-monitor-thumbnail.jpg" /></a></p>
<hr />
<h2 id="configure-log-analytics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#configure-log-analytics">Configure Log Analytics</a></h2>
<h2 id="introduction_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_2">Introduction</a></h2>
<p>Log Analytics is a tool in Azure Monitor that allows you to edit and run log queries for data collected in Azure Monitor Logs. It offers query features and tools, supports the Kusto Query Language (KQL), and allows for detailed analysis and problem-solving.</p>
<p>Imagine you're an Azure Administrator working for a large e-commerce company. Your company recently experienced a major security breach, and you need to investigate the root cause and prevent future incidents. You have access to logs from various Azure services, but manually analyzing them would be time-consuming and inefficient.</p>
<p>By using Log Analytics, you can easily query and analyze the logs to identify any suspicious activities, track changes, and ensure compliance with security standards. With Log Analytics, you can quickly assess update requirements and time-to-complete, track changes, and identify access issues in your systems. It helps meet strict SLAs for businesses and provides a single interface for analyzing data from multiple sources.</p>
<p>The goal of this module is to provide you with the knowledge and skills to effectively use Log Analytics in Azure Monitor.</p>
<h3 id="learning-objectives_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives_1">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify the features and usage cases for Log Analytics in Azure Monitor.</li>
<li>Structure and create a Log Analytics workspace in the Azure portal.</li>
<li>Use KQL to query a Log Analytics workspace and review results.</li>
</ul>
<h3 id="skills-measured_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#skills-measured_1">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#prerequisites_1">Prerequisites</a></h3>
<ul>
<li>Working knowledge of Azure Monitor including data sources and collected data.</li>
<li>Experience with the Azure portal including navigating and locating resources.</li>
<li>Familiarity with structuring and executing data queries.</li>
</ul>
<h2 id="determine-log-analytics-uses"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#determine-log-analytics-uses">Determine Log Analytics uses</a></h2>
<p>Log Analytics is a tool for Azure Monitor that's available in the Azure portal. You can use Log Analytics to edit and run log queries for the data collected in Azure Monitor Logs. Log queries help you to search for patterns and identify issues.</p>
<p><img alt="Screenshot that shows an example of Azure Monitor Logs in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-log-analytics/media/log-analytics-38112dc9.png" /></p>
<h4 id="things-to-know-about-log-analytics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-log-analytics">Things to know about Log Analytics</a></h4>
<p>Let's examine some characteristics of Log Analytics in Azure Monitor.</p>
<ul>
<li>
<p>Log Analytics in Azure Monitor offers query features and tools that help you answer virtually any question about your monitored configuration.</p>
</li>
<li>
<p>Log Analytics supports the Kusto Query Language (KQL). You can create simple or complex queries with KQL, including:</p>
<ul>
<li>Search and sort by value, time, property state, and more</li>
<li>Join data from multiple tables</li>
<li>Aggregate large sets of data</li>
<li>Perform intricate operations with minimal code</li>
<li>When your Azure Monitor Logs contain sufficient collected data, and you understand how to construct the appropriate query, you can use Log Analytics to complete detailed analysis and problem solving.</li>
</ul>
</li>
</ul>
<h4 id="things-to-consider-when-using-log-analytics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-consider-when-using-log-analytics">Things to consider when using Log Analytics</a></h4>
<p>Some features in Azure Monitor, such as insights and solutions, process log data without exposing you to the underlying queries. To use other Azure Monitor features, you need to understand how to construct queries and apply them to interactively analyze data in Azure Monitor Logs. The following business scenarios showcase the advantages of querying Azure Monitor Logs with Log Analytics.</p>
<h5 id="business-scenario-assess-update-requirements-and-time-to-complete"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#business-scenario-assess-update-requirements-and-time-to-complete">Business scenario: Assess update requirements and time-to-complete</a></h5>
<p>An important daily task for IT admins is to assess system update requirements and plan for configuration patches. Accurate scheduling is critical because the patching process relates to SLAs to the business and can negatively affect business functions.</p>
<p>In the past, administrators had to schedule a patch update with only limited knowledge of how long it might take to complete the process. With an Azure subscription, admins can access benefits of the Microsoft Azure platform. Azure collects data from all customers performing patches. Azure uses the gathered data to provide an average patching time for specific updates.</p>
<p>This use of "crowd-sourced" data is unique to cloud systems. It's a great example of how Log Analytics in Azure Monitor can you help meet strict SLAs for your business.</p>
<h5 id="business-scenario-track-changes-and-identify-access-issues"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#business-scenario-track-changes-and-identify-access-issues">Business scenario: Track changes and identify access issues</a></h5>
<p>Troubleshooting an operational incident is a complex process that requires access to multiple data streams. By monitoring your systems from the Azure platform, you can easily perform analysis from multiple angles. You have access to data from a wide variety of sources through a single interface for correlation of information.</p>
<p>By tracking changes across the Azure environment, Log Analytics in Azure Monitor can help you easily identify common issues, such as:</p>
<ul>
<li>Abnormal behavior from a specific account</li>
<li>Users installing unapproved software</li>
<li>Unexpected system reboots or shutdowns</li>
<li>Evidence of security breaches</li>
<li>Specific problems in loosely coupled applications</li>
</ul>
<h2 id="create-a-log-analytics-workspace"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-log-analytics-workspace">Create a Log Analytics workspace</a></h2>
<p>When you capture logs and data in Azure Monitor, Azure stores the collected information in a Log Analytics workspace. Your Log Analytics workspace is the basic management environment for Azure Monitor Logs.</p>
<h4 id="how-to-define-your-log-analytics-scope"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#how-to-define-your-log-analytics-scope">How to define your Log Analytics scope</a></h4>
<p><img alt="" src="https://youtu.be/34IrPO1Xh2o" /></p>
<h4 id="things-to-know-about-the-log-analytics-workspace"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-the-log-analytics-workspace">Things to know about the Log Analytics workspace</a></h4>
<p>To get started with Log Analytics in Azure Monitor, you need to create your workspace. Each workspace has a unique workspace ID and resource ID. After you create your workspace, you configure your data sources and solutions to store their data in your workspace.</p>
<p><img alt="Screenshot that shows how to create a Log Analytics workspace in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-log-analytics/media/create-workspace-f37a5b11.png" /></p>
<p>To create your Log Analytics workspace, configure the following parameters:</p>
<ul>
<li>
<p><strong>Name</strong>: Provide a name for your new Log Analytics workspace. The name for your workspace must be unique within your resource group.</p>
</li>
<li>
<p><strong>Subscription</strong>: Specify the Azure Subscription to associate with your workspace.</p>
</li>
<li>
<p><strong>Resource Group</strong>: Specify the resource group to associate with your workspace. You can choose an existing resource group or create a new one. The resource group must contain at least one Azure Virtual Machines instance.</p>
</li>
<li>
<p><strong>Region</strong>: Select the region where you deploy your virtual machines.</p>
<p>Note</p>
<p>The region must support Log Analytics. You can review the <a href="https://azure.microsoft.com/explore/global-infrastructure/products-by-region/">regions that support Log Analytics</a>. In the <strong>Search for a product</strong> box, enter "Azure Monitor."</p>
</li>
<li>
<p><strong>Pricing</strong>: The default pricing tier for a new workspace is <em>pay-as-you-go</em>. Charges incur only after you start collecting data.</p>
<p>Each Log Analytics workspace in Azure Monitor can have a different pricing tier. You can change the pricing tier for a workspace and also track the changes.</p>
</li>
</ul>
<h2 id="create-kusto-queries"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-kusto-queries">Create Kusto queries</a></h2>
<p>Log Analytics in Azure Monitor supports the Kusto Query Language (KQL). The KQL syntax helps you quickly and easily create simple or complex queries to retrieve and consolidate your monitoring data in the repository.</p>
<h3 id="write-kusto-query-language-log-queries-for-azure-monitor"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#write-kusto-query-language-log-queries-for-azure-monitor">Write Kusto Query Language log queries for Azure Monitor</a></h3>
<p>Watch the following video to learn how to write log queries with Log Analytics in Azure Monitor. The video covers the following concepts:</p>
<ul>
<li>View table data in the Azure Monitor Logs repository</li>
<li>Create simple and complex queries</li>
<li>Filter and summarize search results</li>
<li>Add visualizations for search results</li>
</ul>
<p>In the next unit, we take a closer look at how to structure a log query.</p>
<h4 id="things-to-consider-when-using-log-queries"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-consider-when-using-log-queries">Things to consider when using log queries</a></h4>
<p>Here are some of the many things you can accomplish with log queries in Log Analytics:</p>
<ul>
<li>
<p>Create and save searches of your data stored in the Azure Monitor Logs repository.</p>
</li>
<li>
<p>Use your saved log searches to directly analyze your data in the Azure portal.</p>
</li>
<li>
<p>Configure your saved log searches to run automatically.</p>
</li>
<li>
<p>Configure your saved log searches to produce notification alerts.</p>
</li>
<li>
<p>Add visualizations for your saved log searches to see graphical views of your environment health.</p>
</li>
<li>
<p>Export your data from the repository into analytical tools like Power BI or Excel.</p>
</li>
</ul>
<h2 id="structure-log-analytics-queries"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#structure-log-analytics-queries">Structure Log Analytics queries</a></h2>
<p>Administrators build Log Analytics queries from data stored in dedicated tables in a Log Analytics workspace. Some common dedicated tables include Event, Syslog, Heartbeat, and Alert. When you build a Kusto Query Language (KQL) query, you begin by determining which tables in the Azure Monitor Logs repository have the data you're looking for.</p>
<p>The following illustration highlights how KQL queries use the dedicated table data for your monitored services and resources.</p>
<p><img alt="Illustration that shows how to build Log Analytics queries from data in dedicated tables in a Log Analytics workspace." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-log-analytics/media/query-tables-f3872e3a.png" /></p>
<h4 id="things-to-know-about-kql-query-structure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-kql-query-structure">Things to know about KQL query structure</a></h4>
<p>Let's take a closer look at dedicated table data and how to structure a KQL log query.</p>
<ul>
<li>
<p>Each of your selected data sources and solution stores its data in dedicated tables in your Log Analytics workspace.</p>
</li>
<li>
<p>Documentation for each data source and solution includes the name of the data type that it creates and a description of each of its properties.</p>
</li>
<li>
<p>The basic structure of a query is a source table followed by a series of commands (referred to as <em>operators</em>).</p>
</li>
<li>
<p>A query can have a chain of multiple operators to refine your data and perform advanced functions.</p>
</li>
<li>
<p>Each operator in a query chain begins with a pipe character <code>|</code>.</p>
</li>
<li>
<p>Many queries require data from a single table only, but other queries can use various options and include data from multiple tables.</p>
</li>
</ul>
<h4 id="kql-log-query-examples"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#kql-log-query-examples">KQL log query examples</a></h4>
<p>Let's review some common KQL log query operators and example syntax.</p>
<p>We can build queries to search for data in the <code>StormEvent</code> table that has five entries:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>type</th>
<th>event</th>
<th>severity</th>
<th>start</th>
<th>duration</th>
<th>region</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Water</code></td>
<td><code>Freezing rain</code></td>
<td><code>1</code></td>
<td><code>6:00 AM 01-27-2023</code></td>
<td><code>3 hours</code></td>
<td><code>1, 2</code></td>
</tr>
<tr>
<td><code>Wind</code></td>
<td><code>High winds</code></td>
<td><code>1</code></td>
<td><code>8:00 AM 01-27-2023</code></td>
<td><code>12 hours</code></td>
<td><code>1, 2, 4, 5</code></td>
</tr>
<tr>
<td><code>Temperature</code></td>
<td><code>Below freezing</code></td>
<td><code>2</code></td>
<td><code>11:00 PM 01-26-2023</code></td>
<td><code>10 hours</code></td>
<td><code>1, 2, 4, 5</code></td>
</tr>
<tr>
<td><code>Water</code></td>
<td><code>Snow</code></td>
<td><code>3</code></td>
<td><code>4:00 PM 01-26-2023</code></td>
<td><code>10 hours</code></td>
<td><code>1, 2, 4, 5</code></td>
</tr>
<tr>
<td><code>Water</code></td>
<td><code>Flood warning</code></td>
<td><code>2</code></td>
<td><code>9:00 AM 01-26-2023</code></td>
<td><code>10 hours</code></td>
<td><code>3</code></td>
</tr>
</tbody>
</table>
<p>To find other operators and examples, review: <a href="https://learn.microsoft.com/en-us/training/paths/analyze-monitoring-data-with-kql/">Analyze monitoring data with Kusto Query Language - Training | Microsoft Learn</a>.</p>
<h5 id="count-number-of-items"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#count-number-of-items">Count number of items</a></h5>
<p>Use the <code>count</code> operator to discover the number of records in an input record set.</p>
<p>The following example returns the number of records in the <code>StormEvent</code> table. The query results reveal the <code>StormEvent</code> table has five entries.</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>StormEvent | count
</code></pre></div>
<p>Query results:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>count</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>5</code></td>
</tr>
</tbody>
</table>
<h5 id="return-first-number-of-items"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#return-first-number-of-items">Return first number of items</a></h5>
<p>Use the <code>top</code> operator to see the first N records of your input record set, sorted by your specified columns. The columns correspond to data properties defined in the dedicated table.</p>
<p>The following example returns the first three data records for <code>StormEvent</code>. The results table shows the storm <code>event</code> name, the severity, and the forecasted duration.</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>StormEvent | top 3 by event severity duration
</code></pre></div>
<p>Query results:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>event</th>
<th>severity</th>
<th>duration</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Freezing rain</code></td>
<td><code>1</code></td>
<td><code>3 hours</code></td>
</tr>
<tr>
<td><code>High winds</code></td>
<td><code>1</code></td>
<td><code>12 hours</code></td>
</tr>
<tr>
<td><code>Below freezing</code></td>
<td><code>2</code></td>
<td><code>10 hours</code></td>
</tr>
</tbody>
</table>
<h5 id="find-matching-items"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#find-matching-items">Find matching items</a></h5>
<p>Use the <code>where</code> operator to filter your table to the subset of rows that match the supplied predicate value. The predicate value indicates what to search for in the table, as in <code>where=="find-this"</code>.</p>
<p>The following example filters the data records for <code>StormEvent</code> to use only records that match "snow."</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>StormEvent | where event==&quot;snow&quot;
</code></pre></div>
<p>Your query filters to one row in the <code>StormEvent</code> table:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>type</th>
<th>event</th>
<th>severity</th>
<th>start</th>
<th>duration</th>
<th>region</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Water</code></td>
<td><code>Snow</code></td>
<td><code>3</code></td>
<td><code>4:00 PM 01-26-2023</code></td>
<td><code>10 hours</code></td>
<td><code>1, 2, 4, 5</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="configure-network-watcher"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#configure-network-watcher">Configure Network Watcher</a></h2>
<h2 id="introduction_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_3">Introduction</a></h2>
<p>Azure Network Watcher is a powerful tool that allows you to monitor, diagnose, and manage resources in an Azure virtual network.</p>
<p>Imagine you're an IT administrator for a large e-commerce company. Your company relies heavily on its Azure virtual network to host its website and handle customer transactions. One day, you receive reports from customers that they're unable to access the website or complete their purchases. You need to quickly identify the cause of the connectivity issues and resolve them to minimize the impact on your business.</p>
<p>Your organization plans to use Network Watcher. Network Watcher's monitoring and diagnostic capabilities let you easily pinpoint the root cause of the problem and take appropriate actions. By using features such as <strong>IP flow verification, next hop analysis, and connection troubleshooting</strong>, you can ensure that your virtual network is functioning optimally.</p>
<p>In this module, you learn about the various features and use cases of Azure Network Watcher. The topics covered include IP flow verification, next hop analysis, and the topology tool. The module guides you on how to diagnose network configuration issues, such as broken security rules.</p>
<p>The goal of this module is to provide you with a comprehensive understanding of Azure Network Watcher and its capabilities. By the end of this module, you effectively monitor, diagnose, and manage your Azure virtual network using Network Watcher.</p>
<h2 id="describe-azure-network-watcher-features"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#describe-azure-network-watcher-features">Describe Azure Network Watcher features</a></h2>
<p>Azure Network Watcher provides tools to monitor, diagnose, view metrics, and enable or disable logs for resources in an Azure virtual network. Network Watcher is a regional service that enables you to monitor and diagnose conditions at a network scenario level.</p>
<p><img alt="Screenshot of the Network Watcher Get Started page in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-watcher/media/network-watcher-861659e0.png" /></p>
<h4 id="things-to-know-about-network-watcher"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-network-watcher">Things to know about Network Watcher</a></h4>
<p>Let's review some of the prominent features of Network Watcher.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
<th>Scenarios</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>IP flow verify</strong></td>
<td>Quickly diagnose connectivity issues from or to the internet, and from or to your on-premises environment.</td>
<td><em>Identify if a security rule blocks ingress or egress traffic to or from a virtual machine</em>  <br>  <br><em>Troubleshoot issues to determine if other exploration is required</em></td>
</tr>
<tr>
<td><strong>Next hop</strong></td>
<td>View the next connection point (or <em>next hop</em>) in your network route, and analyze your network routing configuration.</td>
<td><em>Determine if there's a next hop, and view the next hop target, type, and route table</em>  <br>  <br><em>Confirm traffic reaches an intended target destination</em></td>
</tr>
<tr>
<td><strong>VPN troubleshoot</strong></td>
<td>Diagnose and troubleshoot the health of your virtual network gateway or connection with gathered data. View connection statistics, CPU and memory information, IKE security errors, packet drops, and buffers and events.</td>
<td><em>View summary diagnostics in the Azure portal</em>  <br>  <br><em>Review detailed diagnostics in generated log files stored in your Azure storage account</em>  <br>  <br><em>Simultaneously troubleshoot multiple gateways or connections</em></td>
</tr>
<tr>
<td><strong>NSG diagnostics</strong></td>
<td>Use flow logs to map IP traffic through a network security group (NSG). A common implementation for NSG flow logs is to meet security compliance regulations and auditing requirements.</td>
<td><em>Define prescriptive NSG rules for your organization, and conduct periodic compliance audits</em>  <br>  <br><em>Compare your prescriptive NSG rules against the effective rules for each virtual machine in your network</em></td>
</tr>
<tr>
<td><strong>Connection troubleshoot</strong></td>
<td>Azure Network Watcher Connection Troubleshoot is a more recent addition to the Network Watcher suite of networking tools and capabilities. Check a direct TCP or ICMP connection from a virtual machine, application gateway, or Azure Bastion host to a virtual machine.</td>
<td><em>Troubleshoot your network performance and connectivity issues in Azure</em>  <br>  <br><em>Troubleshoot connection issues for a virtual machine, application gateway, or Azure Bastion host</em></td>
</tr>
</tbody>
</table>
<p>Note</p>
<p>To use Network Watcher, you must be an Owner, Contributor, or Network Contributor. If you create a custom role, the role must be able to read, write, and delete the Network Watcher service.</p>
<h4 id="things-to-consider-when-using-network-watcher"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-consider-when-using-network-watcher">Things to consider when using Network Watcher</a></h4>
<p>Azure Network Watcher supports many Azure monitoring tasks and scenarios. As you review these features, think about how Network Watcher can support your Azure monitoring requirements.</p>
<ul>
<li>
<p><strong>Consider remote monitoring</strong>. Automate remote network monitoring with packet capture. You can monitor and diagnose networking issues without logging in to your virtual machines.</p>
</li>
<li>
<p><strong>Consider alert notifications</strong>. Set alerts to trigger packet capture, and access real-time performance information at the packet level. When you observe an issue, you can investigate in detail for better diagnoses.</p>
</li>
<li>
<p><strong>Consider NSG flow log diagnosis</strong>. Use NSG flow logs to gain insight into your network traffic. Build a deeper understanding of your network traffic pattern by using NSG flow logs. Information provided by flow logs helps you gather data for compliance, auditing, and monitoring your network security profile.</p>
</li>
<li>
<p><strong>Consider log analysis</strong>. Diagnose your most common Azure VPN Gateway and connections issues. You can identify issues and use the generated detailed logs to assist your analysis.</p>
</li>
</ul>
<h2 id="review-ip-flow-verify-diagnostics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#review-ip-flow-verify-diagnostics">Review IP flow verify diagnostics</a></h2>
<p>The <strong>IP flow verify</strong> feature in Azure Network Watcher checks connectivity from or to the internet, and from or to your on-premises environment. This feature helps you identify if a security rule is blocking traffic to or from your virtual machine or the internet.</p>
<p><img alt="Screenshot of the IP flow verify feature in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-watcher/media/flow-verify-d136d78d.png" /></p>
<h4 id="things-to-know-about-ip-flow-verify"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-ip-flow-verify">Things to know about IP flow verify</a></h4>
<p>Let's examine the configuration details and functionality of the IP flow verify feature in Azure Network Watcher.</p>
<ul>
<li>
<p>You configure the IP flow verify feature with the following properties in the Azure portal:</p>
<ul>
<li>Virtual machine and network interface</li>
<li>Local (source) port number</li>
<li>Remote (destination) IP address, and remote port number</li>
<li>Communication protocol (TCP or UDP)</li>
<li>Traffic direction (Inbound or Outbound)</li>
<li>The feature tests communication for a target virtual machine with associated network security group (NSG) rules by running inbound and outbound packets to and from the machine.</li>
</ul>
</li>
<li>
<p>After the test runs complete, the feature informs you whether communication with the machine succeeds (allows access) or fails (denies access).</p>
</li>
<li>
<p>If the target machine denies the packet because of an NSG, the feature returns the name of the controlling security rule.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-ip-flow-verify"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-consider-when-using-ip-flow-verify">Things to consider when using IP flow verify</a></h4>
<p>The IP flow verify feature is ideal for helping to ensure correct application of your security rules.</p>
<p>When you deploy a virtual machine, Azure applies several default security rules to your machine. The security rules allow or deny traffic to or from your virtual machine. You can override Azure's default rules or create other rules.</p>
<p>At some point, your virtual machine might be unable to communicate with other resources because of a security rule. You can use the IP flow verify feature to troubleshoot your NSG rules.</p>
<p>If test runs fail, but the IP flow verify feature doesn't indicate the issue is related to your NSG rules, you need to explore other areas, such as firewall restrictions.</p>
<h2 id="review-next-hop-diagnostics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#review-next-hop-diagnostics">Review next hop diagnostics</a></h2>
<p>The <strong>next hop</strong> feature in Azure Network Watcher checks if traffic is being directed to the intended destination. This feature lets you view the next connection point (or <em>next hop</em>) in your network route, and helps you verify a correct network configuration.</p>
<p><img alt="Screenshot of the next hop feature in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-watcher/media/next-hop-d7dde5f6.png" /></p>
<h4 id="things-to-know-about-next-hop"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-next-hop">Things to know about next hop</a></h4>
<p>Let's review the configuration properties and summary of the next hop feature in Azure Network Watcher.</p>
<ul>
<li>
<p>You configure the next hop feature with the following properties in the Azure portal:</p>
<ul>
<li>Your subscription and resource group</li>
<li>Virtual machine and network interface</li>
<li>Source IP address</li>
<li>Destination IP address (If you want to confirm a specified target is reachable)</li>
<li>The feature tests the next connection point in your network route configuration.</li>
</ul>
</li>
<li>
<p>The next hop test returns three items:</p>
<ul>
<li>Next hop type</li>
<li>IP address of the next hop (If available)</li>
<li>Route table for the next hop (If available)</li>
<li>Examples of a next hop are <em>Internet</em>, <em>Virtual Network</em>, and <em>Virtual Network Service Endpoint</em>.</li>
</ul>
</li>
<li>
<p>If the next hop is a user-defined route (UDR), the process returns the UDR route. Otherwise, next hop returns the system route.</p>
</li>
<li>
<p>If the next hop is of type <em>None</em>, there might be a valid system route to the destination IP address, but no next hop exists to route the traffic to the target.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-next-hop"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-consider-when-using-next-hop">Things to consider when using next hop</a></h4>
<p>The next hop feature is ideal for identifying unresponsive virtual machines or broken routes in your network.</p>
<p>When you create a virtual network, Azure creates several default outbound routes for network traffic. Outbound traffic from all resources (such as virtual machines) deployed in the virtual network is routed based on Azure's default routes. You can override Azure's default routes or create other routes.</p>
<p>You might find that a virtual machine can no longer communicate with other resources connected by a specific route. You can use the next hop feature to examine a specific source and destination IP address in your configuration.</p>
<p>Next hop tests the communication between the source and destination, and reports the type of next hop in the traffic route. You can then remove, change, or add a route, to resolve routing issues.</p>
<h2 id="visualize-the-network-topology"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#visualize-the-network-topology">Visualize the network topology</a></h2>
<p>Administrators sometimes need to troubleshoot virtual networks that they didn't help to create. They might not be fully aware of all the aspects of the infrastructure and configuration.</p>
<p>Azure Network Watcher provides a network monitoring <strong>topology</strong> tool to help administrators visualize and understand infrastructure. The following image shows an example topology diagram for a virtual network in Network Watcher.</p>
<p><img alt="Screenshot of the Network Watcher Topology page in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-watcher/media/monitor-visualization-1fb7bd5c.png" /></p>
<h4 id="things-to-know-about-the-topology-tool"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-the-topology-tool">Things to know about the topology tool</a></h4>
<p>Review the following characteristics of the network topology capability in Azure Network Watcher.</p>
<ul>
<li>
<p>The Network Watcher Topology tool generates a visual diagram of the resources in a virtual network.</p>
</li>
<li>
<p>The graphical display shows the resources in the network, their interconnections, and their relationships with each other.</p>
</li>
<li>
<p>You can view subnets, virtual machines, network interfaces, public IP addresses, network security groups, route tables, and more.</p>
</li>
<li>
<p>To generate a topology, you need an Azure Network Watcher instance in the same region as the virtual network.</p>
</li>
</ul>
<hr />
<h2 id="improve-incident-response-with-azure-monitor-alerts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#improve-incident-response-with-azure-monitor-alerts">Improve incident response with Azure Monitor alerts</a></h2>
<h2 id="introduction_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_4">Introduction</a></h2>
<p>Microsoft Azure provides a robust alerting and monitoring solution called Azure Monitor. You can use Azure Monitor to configure notifications and alerts for your key systems and applications. These alerts ensure that the correct team knows when a problem arises.</p>
<p>You work for a large shipping company that recently deployed several web applications to the Azure platform. Due to a configuration error, the customer-facing order tracker was offline. The issue wasn't identified until customers started complaining that they couldn't track their orders. As a consequence, customer satisfaction with your service dropped.</p>
<p>As your company's Azure solution architect, you need to find a solution that detects problems in your environments in real time. The solution should notify the correct team so it can resolve any problems before your customers notice.</p>
<h3 id="learning-objectives_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives_2">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Explore alerts by using Azure Monitor.</li>
<li>Understand when to use metric, log, and activity log events.</li>
<li>Create and use metric alerts, log search alerts, and activity log alerts.</li>
<li>Use action groups to determine what kind of notifications are sent and to whom.</li>
<li>Learn how to use alert-processing rules to override the normal behavior of action groups when needed.</li>
</ul>
<h3 id="prerequisites_2"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#prerequisites_2">Prerequisites</a></h3>
<ul>
<li>Knowledge of Azure Monitor</li>
</ul>
<h2 id="explore-the-different-alert-types-that-azure-monitor-supports"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#explore-the-different-alert-types-that-azure-monitor-supports">Explore the different alert types that Azure Monitor supports</a></h2>
<p>Azure Monitor is a powerful reporting and analytics tool. You can use it for insights into the behavior and running of your environment and applications. You can then respond proactively to faults in your system.</p>
<p>After the downtime that your customers faced, you set up monitoring on your key resources in Azure. With the monitoring in place, you want to make sure the right people are being alerted at the right level.</p>
<p>In this unit, you learn how Azure Monitor receives resource data, what makes up an alert, and how and when to use an alert. Finally, you learn how to create and manage your own alerts.</p>
<h3 id="data-types-in-azure-monitor"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#data-types-in-azure-monitor">Data types in Azure Monitor</a></h3>
<p>Azure Monitor receives data from target resources like applications, operating systems, Azure resources, Azure subscriptions, and Azure tenants. The nature of the resource defines which data types are available. A data type can be a <em>metric</em>, a <em>log</em>, or both a metric and a log:</p>
<ul>
<li>The focus for <em>metric</em>-based data types is the numerical time-sensitive values that represent some aspect of the target resource.</li>
<li>The focus for <em>log</em>-based data types is the querying of content data held in structured, record-based log files that are relevant to the target resource.</li>
</ul>
<p><img alt="Diagram that represents the target resources feeding into Azure Monitor and the two principal signal types: metrics and logs." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/2-azure-resource-signal-types.svg" /></p>
<p>There are three signal types that you can use to monitor your environment:</p>
<ul>
<li><strong>Metric</strong> alerts provide an alert trigger when a specified threshold is exceeded. For example, a metric alert can notify you when CPU usage is greater than 95 percent.</li>
<li><strong>Activity log</strong> alerts notify you when Azure resources change state. For example, an activity log alert can notify you when a resource is deleted.</li>
<li><strong>Log</strong> alerts are based on things written to log files. For example, a log search alert can notify you when a web server returns a particular number of 404 or 500 responses.</li>
</ul>
<h3 id="composition-of-an-alert-rule"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#composition-of-an-alert-rule">Composition of an alert rule</a></h3>
<p>Every alert or notification available in Azure Monitor is the product of a rule. Some of these rules are built into the Azure platform. You can use alert rules to create custom alerts and notifications. No matter which target resource or data source you use, the composition of an alert rule remains the same.</p>
<ul>
<li><strong>RESOURCE</strong><ul>
<li>The <em>target resource</em> for the alert rule. You can assign multiple target resources to a single alert rule. The type of resource defines the available signal types.</li>
</ul>
</li>
<li><strong>CONDITION</strong><ul>
<li>The <em>signal type</em> used to assess the rule. The signal type can be a metric, an activity log, or logs. There are others, but this module doesn't cover them.</li>
<li>The <em>alert logic</em> applied to the data that's being supplied via the signal type. The structure of the alert logic changes depending on the signal type.</li>
</ul>
</li>
<li><strong>ACTIONS</strong><ul>
<li>The <em>action</em>, like sending an email, sending a Short Message Service (SMS) message, or using a webhook.</li>
<li>An <em>action group</em>, which typically contains a unique set of recipients for the action.</li>
</ul>
</li>
<li><strong>ALERT DETAILS</strong><ul>
<li>An <em>alert name</em> and an <em>alert description</em> that specify the alert's purpose.</li>
<li>The <em>severity</em> of the alert if the criteria or logic test evaluates <code>true</code>. The five severity levels are:<ul>
<li><strong>0</strong>: Critical</li>
<li><strong>1</strong>: Error</li>
<li><strong>2</strong>: Warning</li>
<li><strong>3</strong>: Informational</li>
<li><strong>4</strong>: Verbose</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img alt="Screenshot of the Create rule page in the Azure Monitor portal." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/2-creating-an-alert.png" /></p>
<h3 id="scope-of-alert-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#scope-of-alert-rules">Scope of alert rules</a></h3>
<p>You can get monitoring data from across most of the Azure services and report on it by using the Azure Monitor pipeline. In the Azure Monitor pipeline, you can create alert rules for these items and more:</p>
<ul>
<li>Metric values</li>
<li>Log search queries</li>
<li>Activity log events</li>
<li>Health of the underlying Azure platform</li>
<li>Tests for website availability</li>
</ul>
<h3 id="manage-alert-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#manage-alert-rules">Manage alert rules</a></h3>
<p>Not every alert rule that you create needs to run forever. With Azure Monitor, you can specify one or more alert rules and enable or disable them, as needed.</p>
<p>As an Azure solution architect, you want to use Azure Monitor to enable tightly focused and specific alerts before any application change. Then, disable the alerts after a successful deployment.</p>
<h3 id="alert-summary-view"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#alert-summary-view">Alert summary view</a></h3>
<p>The alert page shows a summary of all alerts. You can apply filters to the view by using one or more of the following categories: subscriptions, alert condition, severity, or time ranges. The view includes only alerts that match these criteria.</p>
<p><img alt="Screenshot of Azure Monitor alerts page in the Azure Monitor portal." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/2-alerts-page.png" /></p>
<h4 id="alert-condition"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#alert-condition">Alert condition</a></h4>
<p>The system sets the alert condition.</p>
<ul>
<li>When an alert fires, the alert's monitor condition is set to <strong>Fired</strong>.</li>
<li>After the underlying condition that caused the alert to fire clears, the monitor condition is set to <strong>Resolved</strong>.</li>
</ul>
<h2 id="use-metric-alerts-for-alerts-about-performance-issues-in-your-azure-environment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-metric-alerts-for-alerts-about-performance-issues-in-your-azure-environment">Use metric alerts for alerts about performance issues in your Azure environment</a></h2>
<p>Azure Monitor can use thresholds to monitor specific resources. In an organization, it's far more useful to be notified when the free disk space on a server is less than five percent, instead of being alerted every time a file is saved.</p>
<p>As a solution architect, you want to implement regular threshold monitoring for many of your target resources and instances. Monitoring helps to head off potential issues before they can affect your customers.</p>
<p>In this unit, you investigate the different kinds of metric alerts that Azure Monitor supports.</p>
<h3 id="when-would-you-use-metric-alerts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#when-would-you-use-metric-alerts">When would you use metric alerts?</a></h3>
<p>In Azure Monitor, you can use metric alerts to achieve regular threshold monitoring of Azure resources. Azure Monitor runs metric alert trigger conditions at regular intervals. When the evaluation is true, Azure Monitor sends a notification. Metric alerts are stateful, and Azure Monitor sends a notification only when the prerequisite conditions are met.</p>
<p>Metric alerts can be useful if, for instance, you need to know when your server CPU utilization is reaching a critical threshold of 90 percent. You can receive alerts when your database storage is getting too low, or when network latency is about to reach unacceptable levels.</p>
<h3 id="composition-of-a-metric-alert"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#composition-of-a-metric-alert">Composition of a metric alert</a></h3>
<p>As you learned in the previous unit, all alerts are the product of the rules that govern them. For metric alerts, there's another factor to define: the condition type. It can be static or dynamic.</p>
<p>You must define the type of statistical analysis to be used with either static or dynamic metric alerts. Example types are minimum, maximum, average, and total. In this example, you define the period of data to be assessed: the last 10 minutes. Finally, you set the frequency by which the alert conditions are checked: every two minutes.</p>
<h4 id="use-static-threshold-metric-alerts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-static-threshold-metric-alerts">Use static threshold metric alerts</a></h4>
<p>Static metric alerts are based on simple static conditions and thresholds that you define. With static metrics, you specify the threshold used to trigger the alert or notification.</p>
<p>In the previously defined scenario, a static alert with a threshold of 85 percent CPU utilization checks the rule every two minutes. It evaluates the last 10 minutes of CPU utilization data to assess if it rises above the threshold. If the evaluation is true, the alert triggers the actions associated with the action group.</p>
<h4 id="use-dynamic-threshold-metric-alerts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-dynamic-threshold-metric-alerts">Use dynamic threshold metric alerts</a></h4>
<p>Dynamic metric alerts use machine-learning tools that Azure provides to automatically improve the accuracy of the thresholds defined by the initial rule.</p>
<p>There's no hard threshold in dynamic metrics. However, you need to define two more parameters:</p>
<ul>
<li>
<p>The <em>look-back period</em> defines how many previous periods need to be evaluated. For example, if you set the look-back period to three, then in the example used here, the assessed data range would be 30 minutes (three sets of 10 minutes).</p>
</li>
<li>
<p>The <em>number of violations</em> expresses how many times the logic condition has to deviate from the expected behavior before the alert rule fires a notification. In this example, if you set the number of violations to two, the alert would be triggered after two deviations from the calculated threshold.</p>
</li>
</ul>
<h3 id="understand-dimensions"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#understand-dimensions">Understand dimensions</a></h3>
<p>Until now, the assessed metric alerts we discussed, focused on a single target instance. Azure Monitor supports dimensions, which enable monitoring data to be supplied from multiple target instances.</p>
<p>You can use dimensions to define one metric alert rule and apply it to multiple related instances. For example, you can monitor CPU utilization across all the servers running your app. You can then receive an individual notification for each server instance when the rule conditions are triggered.</p>
<p>You can define the dimensions by naming each target instance specifically, or you can define the dimensions by using the asterisk (*) wildcard, which uses all available instances.</p>
<h3 id="scale-metric-alerts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#scale-metric-alerts">Scale metric alerts</a></h3>
<p>Azure Monitor supports creating metric alerts that, like dimensions, monitor multiple resources. Scaling is currently limited to Azure virtual machines. However, a single metric alert can monitor resources in one Azure region.</p>
<p>Creating scaling metric alert rules to monitor multiple resources is no different than creating any other metric alert rule; you just select all the resources that you want to monitor.</p>
<p>Like dimensions, a scaling metric alert is individual to the resource that triggered it.</p>
<h2 id="exercise-use-metric-alerts-to-alert-on-performance-issues-in-your-azure-environment"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#exercise-use-metric-alerts-to-alert-on-performance-issues-in-your-azure-environment">Exercise - Use metric alerts to alert on performance issues in your Azure environment</a></h2>
<p>The shipping company you work for wants to avoid any future issues with updates to its applications on the Azure platform. To improve the alert capabilities in Azure, you made the choice to use Azure metric alerts.</p>
<p>In this exercise, you create a Linux virtual machine (VM). This VM runs an app that runs the CPU at 100 percent utilization. You create monitoring rules in the Azure portal and in the Azure CLI to alert you about high CPU usage.</p>
<h3 id="create-the-vm"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-the-vm">Create the VM</a></h3>
<p>This VM runs a specific configuration that stresses the CPU and generates the metric monitoring data needed to trigger an alert.</p>
<ol>
<li>
<p>Start by creating the configuration script. To create the <code>cloud-init.txt</code> file with the configuration for the VM, run the following command in Azure Cloud Shell:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cat &lt;&lt;EOF &gt; cloud-init.txt
#cloud-config
package_upgrade: true
packages:
- stress
runcmd:
- sudo stress --cpu 1
EOF
</code></pre></div>
</li>
<li>
<p>To set up an Ubuntu Linux VM, run the following <code>az vm create</code> command. This command uses the <code>cloud-init.txt</code> file that you created in the previous step to configure the newly created Ubuntu Linux VM.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name vm1 \
    --location eastUS \
    --image Ubuntu2204 \
    --custom-data cloud-init.txt \
    --generate-ssh-keys
</code></pre></div>
</li>
</ol>
<h3 id="create-the-metric-alert-using-the-azure-portal"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-the-metric-alert-using-the-azure-portal">Create the metric alert using the Azure portal</a></h3>
<p>Note</p>
<p>Wait until the VM is successfully created before proceeding with the exercise. The VM creation process is complete when you get the completed JSON output in the Azure Cloud Shell window.</p>
<p>You can use either the Azure portal or the CLI to create a metric alert. In this exercise, we cover both, starting with the Azure portal.</p>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> using the same account that you used to activate the sandbox.</p>
</li>
<li>
<p>On the Azure portal menu, search for and select <strong>Monitor</strong>. On the <strong>Monitor Overview</strong> page, select <strong>Alerts</strong>.</p>
</li>
<li>
<p>Open the <strong>+ Create</strong> menu, and select <strong>Alert rule</strong></p>
</li>
<li>
<p>On the <strong>Select a resource</strong> pane, set the scope for your alert rule. You can filter by subscription, resource type, or resource location.</p>
</li>
<li>
<p>In the <strong>Resource types</strong> drop-down, start to type "virtual machines", and select <strong>Virtual machines</strong>.</p>
</li>
<li>
<p>Check the box next to <strong>vm1</strong>, then select <strong>Apply</strong> at the bottom of the pane.</p>
<p><img alt="Screenshot that shows the 'Select a resource' pane, with vm1 selected." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/4-select-resource-scope.png" /></p>
</li>
<li>
<p>Select <strong>Next:Condition</strong> at the bottom of the page.</p>
</li>
<li>
<p>In the <strong>Signal name</strong> drop-down, select <strong>Percentage CPU</strong>.</p>
</li>
<li>
<p>In the <strong>Alert logic</strong> section, enter (or confirm) the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Alert logic</strong></td>
<td></td>
</tr>
<tr>
<td>Threshold</td>
<td>Static</td>
</tr>
<tr>
<td>Aggregation type</td>
<td>Maximum</td>
</tr>
<tr>
<td>Operator</td>
<td>Greater than</td>
</tr>
<tr>
<td>Threshold value</td>
<td>90</td>
</tr>
<tr>
<td><strong>When to evaluate</strong></td>
<td></td>
</tr>
<tr>
<td>Check every</td>
<td>1 minute</td>
</tr>
<tr>
<td>Lookback period</td>
<td>1 minute</td>
</tr>
</tbody>
</table>
<pre><code>![Screenshot that shows the settings for metric condition logic.](https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/4-metric-alert-logic.png)
</code></pre>
<ol>
<li>Select the <strong>Details</strong> tab at the top of the page. In the <strong>Alert rule details</strong> section, enter the following values for each setting.</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Severity</td>
<td>2 - Warning</td>
</tr>
<tr>
<td>Alert rule name</td>
<td>Cpu90PercentAlert</td>
</tr>
<tr>
<td>Description</td>
<td>Virtual machine is running at or greater than 90% CPU utilization</td>
</tr>
</tbody>
</table>
<ol>
<li>Expand the <strong>Advanced options</strong> section and confirm the following values for each setting.</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enable upon creation</td>
<td>Yes (checked)</td>
</tr>
<tr>
<td>Automatically resolve alerts</td>
<td>Yes (checked)</td>
</tr>
</tbody>
</table>
<pre><code>[![Screenshot that shows the completed settings for the Alert rule details section.](https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/4-metric-alert-details.png)](https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/4-metric-alert-details.png#lightbox)
</code></pre>
<ol>
<li>Select <strong>Review + create</strong> to validate your input, and then select <strong>Create</strong>.</li>
</ol>
<p>You successfully created a metric alert rule that triggers an alert when the CPU percentage on the VM exceeds 90 percent. The rule checks every minute and reviews one minute of data. It can take up to 10 minutes for a metric alert rule to become active.</p>
<h3 id="create-the-metric-alert-through-the-cli"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-the-metric-alert-through-the-cli">Create the metric alert through the CLI</a></h3>
<p>You can also set up metric alerts by using the CLI. This process can be quicker than using the portal, especially if you're planning to set up more than one alert.</p>
<p>Let's create a new metric alert similar to the one you set up in the Azure portal.</p>
<ol>
<li>
<p>Run the following command in Cloud Shell to obtain the resource ID of the virtual machine you previously created:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>VMID=$(az vm show \
        --resource-group &quot;[sandbox resource group name]&quot; \
        --name vm1 \
        --query id \
        --output tsv)
</code></pre></div>
</li>
<li>
<p>Run the following command to create a new metric alert. The alert is triggered when the VM CPU is greater than 80 percent.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az monitor metrics alert create \
    -n &quot;Cpu80PercentAlert&quot; \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --scopes $VMID \
    --condition &quot;max percentage CPU &gt; 80&quot; \
    --description &quot;Virtual machine is running at or greater than 80% CPU utilization&quot; \
    --evaluation-frequency 1m \
    --window-size 1m \
    --severity 3
</code></pre></div>
</li>
</ol>
<h3 id="view-your-metric-alerts-in-azure-monitor"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-your-metric-alerts-in-azure-monitor">View your metric alerts in Azure Monitor</a></h3>
<p>In this exercise, you set up an Ubuntu VM and configured it to stress test the CPU. You also created a metric rule to detect when the maximum CPU percentage exceeds 80 percent and 90 percent.</p>
<p>Note</p>
<p>It might take 10 minutes before you see the alerts show up in the Azure portal.</p>
<ol>
<li>
<p>Return to the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a>.</p>
</li>
<li>
<p>On the Azure portal menu, select <strong>Monitor</strong>, and then select <strong>Alerts</strong> in the left menu pane.</p>
<p>This step presents the Alert summary pane, where you can see the count of the number of alerts. If you don't see your alerts listed, wait a few minutes and select <strong>Refresh</strong>.</p>
<p><img alt="Screenshot that shows the alert summary pane.' pane." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/4-alert-summary-pane.png" /></p>
</li>
<li>
<p>You configured your metric alerts with severities of 2 and 3. Select one of the alerts to view the severity level.</p>
</li>
<li>
<p>Select one of the alerts to show the alert details.</p>
</li>
</ol>
<h2 id="use-log-search-alerts-to-alert-on-events-in-your-application"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-log-search-alerts-to-alert-on-events-in-your-application">Use log search alerts to alert on events in your application</a></h2>
<p>You can use Azure Monitor to capture important information from log files. Applications, operating systems, other hardware, or Azure services can create these log files.</p>
<p>As a solution architect, you want to explore ways that monitoring log data can detect issues before they become issues for your customers. You know that Azure Monitor supports the use of log data.</p>
<p>In this unit, you understand how using log data can improve resilience in your system.</p>
<h3 id="when-to-use-log-search-alerts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#when-to-use-log-search-alerts">When to use log search alerts</a></h3>
<p>Log search alerts use log data to assess the rule logic and, if necessary, trigger an alert. This data can come from any Azure resource: server logs, application server logs, or application logs.</p>
<p>By its nature, log data is historical, so usage is focused on analytics and trends.</p>
<p>You can use these types of logs to assess if any of your servers exceeded their CPU utilization by a given threshold during the last 30 minutes. Or, you could evaluate response codes issued on your web application server in the last hour.</p>
<h3 id="how-log-search-alerts-work"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#how-log-search-alerts-work">How log search alerts work</a></h3>
<p>Log search alerts behave in a slightly different way than other alert mechanisms. The first part of a log search alert defines the log search rule. The rule defines how often it should run, the time period under evaluation, and the query to be run.</p>
<p>When a log search evaluates as positive, it creates an alert record and triggers any associated actions.</p>
<h3 id="composition-of-log-search-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#composition-of-log-search-rules">Composition of log search rules</a></h3>
<p>Every log search alert has an associated search rule with the following composition:</p>
<ul>
<li><strong>Log query</strong>: Query that runs every time the alert rule fires.</li>
<li><strong>Time period</strong>: Time range for the query.</li>
<li><strong>Frequency</strong>: How often the query should run.</li>
<li><strong>Threshold</strong>: Trigger point for an alert to be created.</li>
</ul>
<p>Log search results are one of two types: <em>number of records</em> or <em>metric measurement</em>.</p>
<h4 id="number-of-records"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#number-of-records">Number of records</a></h4>
<p>Consider using the number-of-records type of log search when you're working with an event or event-driven data. Examples are syslog and web-app responses.</p>
<p>This type of log search returns a single alert when the number of records in a search result reaches or exceeds the value for the number of records (threshold). For example, when the threshold for the search rule is greater or equal to five, the query results have to return five or more rows of data before the alert is triggered.</p>
<h4 id="metric-measurement"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#metric-measurement">Metric measurement</a></h4>
<p>Metric measurement logs offer the same basic functionality as metric alert logs.</p>
<p>Unlike number-of-records search logs, metric measurement logs require further criteria to be set:</p>
<ul>
<li><strong>Aggregate function</strong>: The calculation to be made against the result data. An example is count or average. The result of the function is called <strong>AggregatedValue</strong>.</li>
<li><strong>Group field</strong>: Indicates how the result should be grouped. This criterion is used with the aggregated value. For example, you might specify that you want the average grouped by computer.</li>
<li><strong>Interval</strong>: The time interval by which data is aggregated. For example, if you specify 10 minutes, an alert record is created for each aggregated block of 10 minutes.</li>
<li><strong>Threshold</strong>: A point defined by an aggregated value and the total number of breaches.</li>
</ul>
<p>Consider using this type of alert when you need to add a level of tolerance to the results found. One use for this type of alert is to respond if a particular trend or pattern is found. For example, if the number of breaches is five, and any server in your group exceeds 85 percent CPU utilization more than five times within the given time period, an alert fires.</p>
<p>As you can see, metric measurements greatly reduce the volume of alerts that are produced. Still, give careful consideration when you're setting the threshold parameters to avoid missing critical alerts.</p>
<h3 id="stateless-nature-of-log-search-alerts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#stateless-nature-of-log-search-alerts">Stateless nature of log search alerts</a></h3>
<p>One of the primary considerations when you're evaluating the use of log search alerts is that they're stateless (stateful log search alerts are <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-types#log-alerts">currently in preview</a>). A stateless log search alert generates new alerts every time the rule criteria are triggered, regardless of whether the alert was previously recorded.</p>
<h2 id="use-activity-log-alerts-to-alert-on-events-within-your-azure-infrastructure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-activity-log-alerts-to-alert-on-events-within-your-azure-infrastructure">Use activity log alerts to alert on events within your Azure infrastructure</a></h2>
<p>Activity log alerts allow you to be notified when a specific event happens on some Azure resource. For example, you can be notified when someone creates a new virtual machine (VM) in a subscription.</p>
<p>An activity log can also include alerts for Azure service health. A company can get notifications when service issues or planned maintenance happens on the Azure platform.</p>
<p>As an Azure solution architect, you want to explore the capability to monitor selected Azure resources within your subscription. You want to understand how you can use the resources to improve your team's responsiveness and the stability of your systems.</p>
<p>In this unit, you explore the two different kinds of activity log alerts. Now that you're aware of the different kinds of alerts you can use in Azure Monitor, you want to know how you can trigger actions for your alerts. Actions might include sending an email or creating an IT Service Management (ITSM) support ticket.</p>
<h3 id="when-to-use-activity-log-alerts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#when-to-use-activity-log-alerts">When to use activity log alerts</a></h3>
<p>So far, you learned about two different types of alerts supported in Azure Monitor. <em>Metric alerts</em> are ideally suited to monitoring for threshold breaches or spotting trends; <em>Log search alerts</em> allow for greater analytical monitoring of historical data.</p>
<p><em>Activity log alerts</em> are designed to work with Azure resources. Typically, you create this type of log to receive notifications when specific changes occur on a resource within your Azure subscription.</p>
<p>There are two types of activity log alerts:</p>
<ul>
<li><strong>Specific operations</strong>: Applies to resources within your Azure subscription, and often has a scope with specific resources or a resource group. You use this type when you need to receive an alert that reports a change to an aspect of your subscription. For example, you can receive an alert if a VM is deleted or new roles are assigned to a user.</li>
<li><strong>Service health events</strong>: Include notice of incidents and maintenance of target resources.</li>
</ul>
<h3 id="composition-of-an-activity-log-alert"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#composition-of-an-activity-log-alert">Composition of an activity log alert</a></h3>
<p>It's important to note that activity log alerts monitor events only in the subscription where the alert was created.</p>
<p>Activity log alerts are based on events. The best approach for defining them is to use Azure Monitor to filter all the events in your subscription until you find the one that you want. To begin the creation process, you then select <strong>Add activity log alert</strong>.</p>
<p>Like the previous alerts, activity log alerts have their own attributes:</p>
<ul>
<li><strong>Category</strong>: Administrative, service health, autoscale, policy, or recommendation</li>
<li><strong>Scope</strong>: Resource level, resource group level, or subscription level</li>
<li><strong>Resource group</strong>: Where the alert rule is saved</li>
<li><strong>Resource type</strong>: Namespace for the target of the alert</li>
<li><strong>Operation name</strong>: Operation name</li>
<li><strong>Level</strong>: Verbose, informational, warning, error, or critical</li>
<li><strong>Status</strong>: Started, failed, or succeeded</li>
<li><strong>Event initiated by</strong>: Email address or Microsoft Entra identifier (known as the "caller") for the user</li>
</ul>
<h4 id="create-a-resource-specific-log-alert"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-resource-specific-log-alert">Create a resource-specific log alert</a></h4>
<p>When you create your activity log alert, you select <strong>Activity Log</strong> for the signal type. You then see all the available alerts for the resource you select. The following image shows all the administrative alerts for Azure VMs. In this example, an alert is triggered when a VM is powered off.</p>
<p>Changing the monitor service enables you to reduce the list of options. Selecting <strong>Administrative</strong> filters all the signals to show only admin-related signals.</p>
<p><img alt="Screenshot of the signal logic for activity log alerts related to VMs." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/6-example-activity-log-alert.png" /></p>
<h4 id="create-a-service-health-alert"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-service-health-alert">Create a service health alert</a></h4>
<p>Service health alerts aren't like all the other alert types you learned about in this module so far. To create a new alert, search for and select <strong>Service Health</strong> in the Azure portal. Next, select <strong>Health alerts</strong>. After you select <strong>Create service health alert</strong>, the steps to create the alert are similar to the steps used to create other alerts.</p>
<p><img alt="Screenshot that shows how to create a new service health alert." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/6-service-health-alerts.png" /></p>
<p>The only difference is that you no longer need to select a resource, because the alert is for a whole region in Azure. What you can select is the kind of health event on which you want to be alerted. You can select service issues, planned maintenance, health advisories, or choose all of the events. The remaining steps of performing actions and naming the alerts are the same.</p>
<h2 id="use-action-groups-and-alert-processing-rules-to-send-notifications-when-an-alert-is-fired"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-action-groups-and-alert-processing-rules-to-send-notifications-when-an-alert-is-fired">Use action groups and alert processing rules to send notifications when an alert is fired</a></h2>
<p>Azure Monitor, Azure Service Health, and Azure Advisor use <em>action groups</em> to notify users about the alert, and to take an action when an alert is fired. An action group is a collection of notification preferences and actions that are executed when the alert is fired. You can run one or more actions for each triggered alert.</p>
<p>Azure Monitor can perform any of the following actions:</p>
<ul>
<li>Send an email</li>
<li>Send a Short Message Service (SMS) message</li>
<li>Create an Azure app push notification</li>
<li>Make a voice call to a number</li>
<li>Call an Azure function</li>
<li>Trigger a logic app</li>
<li>Send a notification to a webhook</li>
<li>Create an IT Service Management (ITSM) ticket</li>
<li>Use a runbook (to restart a virtual machine (VM) or scale a VM up or down)</li>
</ul>
<p>Once you create an action group, you can reuse that action group as often as you want. For example, after you create an action to email your company's operations team, you can add that action group to all service-health events.</p>
<p>While you're creating the alert rule, you can either create a new action group or add an existing action group to the alert rule. You can also edit an existing alert to add an action group.</p>
<h3 id="alert-processing-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#alert-processing-rules">Alert processing rules</a></h3>
<p>Use alert processing rules to override the normal behavior of a fired alert by adding or suppressing an action group. You can use alert processing rules to add action groups or remove (suppress) action groups from your fired alerts. Alert processing rules are different from alert rules. Alert rules trigger alerts when a condition is met in your monitored resources. Alert processing rules modify the alerts as they're being fired.</p>
<p>You can use alert processing rules to:</p>
<ul>
<li>Suppress notifications during planned maintenance windows.</li>
<li>Implement management at scale, by specifying commonly used logic in a single rule, instead of having to set it consistently in all your alert rules.</li>
<li>Add an action group to all alert types.</li>
</ul>
<p>You can apply alert processing rules to different resource scopes, from a single resource, or to an entire subscription. You can also use them to apply various filters or have the rule work on a predefined schedule.</p>
<p>You can control when the alert processing rule applies. By default the rule is always active. But, you can select a one-time window for this rule to apply, or you can set a recurrence such as a weekly recurrence.</p>
<h2 id="exercise-use-an-activity-log-alert-and-an-action-group-to-notify-users-about-events-in-your-azure-infrastructure"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#exercise-use-an-activity-log-alert-and-an-action-group-to-notify-users-about-events-in-your-azure-infrastructure">Exercise -Use an activity log alert and an action group to notify users about events in your Azure infrastructure</a></h2>
<p>The shipping company for which you work wants to avoid any future issues with updates to its applications on the Azure platform. To improve the alerting capabilities within Azure, you can create activity log alerts.</p>
<p>Your goal is to set up a Linux virtual machine (VM) and create an activity log monitoring rule to detect when a VM is deleted. Then, delete the VM to trigger this alert.</p>
<h3 id="create-the-azure-activity-log-monitor"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-the-azure-activity-log-monitor">Create the Azure activity log monitor</a></h3>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> with the same account you used to activate the sandbox.</p>
</li>
<li>
<p>On the Azure portal resource menu or under <strong>Azure services</strong>, select <strong>Monitor</strong>. The <strong>Overview</strong> pane for Monitor appears.</p>
</li>
<li>
<p>In the Monitor menu, select <strong>Alerts</strong>. The <strong>Monitor | Alerts</strong> pane appears.</p>
</li>
<li>
<p>On the command bar, select <strong>Create +</strong> and select <strong>Alert rule</strong>. The <strong>Create an alert rule</strong> pane appears with the <strong>Scope</strong> section open and the <strong>Select a resource</strong> pane open on the right-hand side of your screen.</p>
</li>
<li>
<p>In the <strong>Resource type</strong> dropdown list, search for and select <strong>Virtual machines</strong>.</p>
</li>
<li>
<p>You want an alert when any virtual machine in your resource group is deleted. Select the box for the <strong>[sandbox resource group name]</strong> resource group, then select <strong>Apply</strong>.</p>
<p><img alt="Screenshot that shows the Select a scope pane with the sandbox resource group selected." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/7-alert-select-resource.png" /></p>
</li>
<li>
<p>The <strong>Create an alert rule</strong> pane reappears with the Scope target resource showing <strong>All Virtual machines</strong>. Select the <strong>Condition</strong> tab. The <strong>Select a signal</strong> pane appears.</p>
</li>
<li>
<p>Select the <strong>See all signals</strong> link, then search for and select <strong>Delete Virtual Machine (Virtual Machines)</strong>. Select <strong>Apply</strong></p>
</li>
<li>
<p>The <strong>Create an alert rule</strong> pane reappears. You want to receive alerts of all types, so leave <strong>Alert logic</strong> settings at their default of <strong>All selected</strong>. Leave the <strong>Create an alert rule</strong> pane open for the next section.</p>
</li>
</ol>
<h3 id="add-an-email-alert-action"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#add-an-email-alert-action">Add an email alert action</a></h3>
<p>For the previous Azure Monitor alert, you didn't add any actions. You just viewed triggered alerts in the Azure portal. Actions let you send an email for notifications, to trigger an Azure function, or to call a webhook. In this exercise, we're adding an email alert when VMs are deleted.</p>
<ol>
<li>
<p>On the <strong>Create an alert rule</strong> pane, select the <strong>Next: Actions</strong> button, and select <strong>Use action groups</strong>.</p>
</li>
<li>
<p>Select <strong>Create action group</strong> in the <strong>Select action group</strong> pane. The <strong>Create an action group</strong> pane appears.</p>
</li>
<li>
<p>On the <strong>Basics</strong> tab, enter the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Project details</strong></td>
<td></td>
</tr>
<tr>
<td>Subscription</td>
<td><strong>Concierge Subscription</strong></td>
</tr>
<tr>
<td>Resource group</td>
<td>From the dropdown list, select your sandbox resource group</td>
</tr>
<tr>
<td>Region</td>
<td><strong>Global</strong> (default)</td>
</tr>
<tr>
<td><strong>Instance details</strong></td>
<td></td>
</tr>
<tr>
<td>Action group name</td>
<td><strong>Alert the operations team</strong></td>
</tr>
<tr>
<td>Display name</td>
<td><strong>AlertOps</strong></td>
</tr>
</tbody>
</table>
<ol>
<li>Select <strong>Next: Notifications</strong>, and enter the following values for each setting.</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Notification type</td>
<td>Select <strong>Email/SMS message/Push/Voice</strong></td>
</tr>
<tr>
<td>Name</td>
<td><strong>VM was deleted</strong></td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>The <strong>Email/SMS message/Push/Voice</strong> pane appears automatically. If it didn't, select the <strong>Edit</strong> pencil icon.</p>
</li>
<li>
<p>Select <strong>Email</strong>, and in the <strong>Email</strong> box, enter your email address, and then select <strong>OK</strong>.</p>
</li>
<li>
<p>Select <strong>Review + create</strong> to validate your input.</p>
</li>
<li>
<p>Select <strong>Create</strong>.</p>
</li>
<li>
<p>The <strong>Create an alert rule</strong> pane reappears. Select <strong>Next: Details</strong> and enter the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alert rule name</td>
<td><strong>VM was deleted</strong></td>
</tr>
<tr>
<td>Description</td>
<td><strong>A VM in your resource group was deleted</strong></td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>Expand the <strong>Advanced options</strong> section and confirm that <strong>Enable alert rule upon creation</strong> is selected.</p>
<p><img alt="Screenshot that shows a completed alert details section." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/7-all-vm-alert-details.png" /></p>
</li>
<li>
<p>Select <strong>Review + create</strong> to validate your input, then select <strong>Create</strong>.</p>
</li>
</ol>
<p>Recipients added to the configured action group (operations team) receive a notification:</p>
<ul>
<li>When they're added to the action group</li>
<li>When the alert is activated</li>
<li>When the alert is triggered</li>
</ul>
<p>It can take up to five minutes for an activity log alert rule to become active. In this exercise, if you delete the virtual machine before the rule deploys, the alert rule might not be triggered. Because of this delay, you might not see the same results in the following steps after you delete the VM.</p>
<h3 id="delete-your-virtual-machine"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#delete-your-virtual-machine">Delete your virtual machine</a></h3>
<p>To trigger an alert, you need to delete the Linux VM that you created in the previous exercise.</p>
<ol>
<li>
<p>On the Azure portal menu or from the <strong>Home</strong> page, select <strong>Virtual machines</strong>.</p>
</li>
<li>
<p>Check the box for the <strong>vm1</strong> virtual machine.</p>
</li>
<li>
<p>Select <strong>Delete</strong> from the menu bar.</p>
</li>
<li>
<p>Enter <em>delete</em> to confirm deletion and select <strong>Delete</strong>.</p>
</li>
<li>
<p>In the title bar, select the <strong>Notifications</strong> icon and wait until <strong>vm1</strong> is successfully deleted.</p>
</li>
</ol>
<h3 id="view-your-activity-log-alerts-in-azure-monitor"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-your-activity-log-alerts-in-azure-monitor">View your activity log alerts in Azure Monitor</a></h3>
<p>In the exercise, you set up an Ubuntu VM and created an activity log rule to detect when the VM was deleted. You then deleted a VM from your resource group. Let's check whether an alert was triggered.</p>
<ol>
<li>
<p>You should receive a notification email that reads, <strong>Important notice: Azure Monitor alert VM was deleted was activated...</strong> If not, open your email program and look for an email from azure-noreply@microsoft.com.</p>
<p><img alt="Screenshot of alert email." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/7-alert-email.png" /></p>
</li>
<li>
<p>On the Azure portal resource menu, select <strong>Monitor</strong>, and then select <strong>Alerts</strong> in the menu on the left.</p>
</li>
<li>
<p>You should have three verbose alerts that were generated by deleting <strong>vm1</strong>.</p>
<p><img alt="Screenshot that shows all alerts with Name, Severity, Alert condition, User response and Fired time." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/7-vm-rg-deleted-alert.png" /></p>
</li>
<li>
<p>Select the name of one of the alerts (For example, <strong>VM was deleted</strong>). An <strong>Alert details</strong> pane appears that shows more details about the event.</p>
</li>
</ol>
<h3 id="add-an-alert-processing-rule-to-the-alert"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#add-an-alert-processing-rule-to-the-alert">Add an alert processing rule to the alert</a></h3>
<p>We're going to schedule a one-time, overnight, planned maintenance. It starts in the evening and continues until the next morning.</p>
<ol>
<li>
<p>In the Azure portal resource menu, select <strong>Monitor</strong>, select <strong>Alerts</strong> in the menu on the left, and select <strong>Alert processing rules</strong> in the menu bar.</p>
</li>
<li>
<p>Select <strong>+ Create</strong>.</p>
</li>
<li>
<p>Check the box for your sandbox resource group as the scope of the alert processing rule, then select <strong>Apply</strong>.</p>
</li>
<li>
<p>Select <strong>Next: Rule settings</strong>, then select <strong>Suppress notifications</strong>.</p>
</li>
<li>
<p>Select <strong>Next: Scheduling</strong>.</p>
</li>
<li>
<p>By default, the rule works all the time, unless you disable it. We're going to define the rule to suppress notifications for a one-time overnight planned maintenance. Enter these settings for the scheduling of the alert processing rule:</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Apply the rule</td>
<td>At a specific time</td>
</tr>
<tr>
<td>Start</td>
<td>Enter today's date at 10pm.</td>
</tr>
<tr>
<td>End</td>
<td>Enter tomorrow's date at 7am.</td>
</tr>
<tr>
<td>Time zone</td>
<td>Select the local timezone.</td>
</tr>
</tbody>
</table>
<p><img alt="Screenshot of the scheduling section of an alert processing rule." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/8-alert-processing-rule-schedule.png" /><a href="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/8-alert-processing-rule-schedule.png#lightbox">https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/8-alert-processing-rule-schedule.png#lightbox</a></p>
<ol>
<li>Select <strong>Next: Details</strong> and enter these settings:</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Resource group</td>
<td>Select your sandbox resource group.</td>
</tr>
<tr>
<td>Rule name</td>
<td><strong>Planned Maintenance</strong></td>
</tr>
<tr>
<td>Description</td>
<td><strong>Suppress notifications during planned maintenance.</strong></td>
</tr>
</tbody>
</table>
<ol>
<li>Select <strong>Review + create</strong> to validate your input, then select <strong>Create</strong>.</li>
</ol>
<hr />
<h2 id="analyze-your-azure-infrastructure-by-using-azure-monitor-logs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#analyze-your-azure-infrastructure-by-using-azure-monitor-logs">Analyze your Azure infrastructure by using Azure Monitor logs</a></h2>
<h2 id="introduction_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_5">Introduction</a></h2>
<p>Logging and monitoring the health of your services is a vital component of production applications. You need to be able to determine the causes of failures. You also need to identify any problems before they occur.</p>
<p>Azure Monitor is an important tool to help you in this process. It allows you to gather monitoring and diagnostic information about the health of your services. You can use this information to visualize and analyze the causes of problems that might occur in your app.</p>
<p>Suppose that you work for a large organization's operations team. The organization is running large-scale production apps in the cloud. The team wants to consolidate its log data in a single service to improve visibility across services and simplify its logging strategy.</p>
<p>The team began implementing Azure Monitor logs. It wants to fully understand how the logs work. It also wants to know the service's capabilities to query and evaluate the log data that's fed into it.</p>
<h3 id="learning-objectives_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives_3">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Identify the features and capabilities of Azure Monitor logs.</li>
<li>Create basic Azure Monitor log queries to extract information from log data.</li>
</ul>
<h2 id="features-of-azure-monitor-logs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#features-of-azure-monitor-logs">Features of Azure Monitor logs</a></h2>
<p>Azure Monitor is a service for collecting and analyzing telemetry. It helps you get maximum performance and availability for your cloud applications and for your on-premises resources and applications. It shows how your applications are performing and identifies any issues with them.</p>
<h3 id="data-collection-in-azure-monitor"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#data-collection-in-azure-monitor">Data collection in Azure Monitor</a></h3>
<p>Azure Monitor collects two fundamental types of data: metrics and logs. Metrics tell you how a resource is performing and the other resources that it's consuming. Logs contain records that show when resources are created or modified.</p>
<p>The following diagram gives a high-level view of Azure Monitor. On the left are the data-monitoring sources: Azure, operating systems, and custom sources. At the center of the diagram are the data stores for metrics and logs. On the right are the functions that Azure Monitor performs with this collected data, such as analysis, alerting, and streaming to external systems.</p>
<p><img alt="Diagram of Azure Monitor's architecture, displaying the sources of monitoring data, the data stores, and functions performed on the data." src="https://learn.microsoft.com/en-us/training/modules/analyze-infrastructure-with-azure-monitor-logs/media/2-azure-monitor.svg" /></p>
<p>Azure Monitor collects data automatically from a range of components. For example:</p>
<ul>
<li><strong>Application data</strong>: Data that relates to your custom application code.</li>
<li><strong>Operating-system data</strong>: Data from the Windows or Linux virtual machines that host your application.</li>
<li><strong>Azure resource data</strong>: Data that relates to the operations of an Azure resource, such as a web app or a load balancer.</li>
<li><strong>Azure subscription data</strong>: Data that relates to your subscription, including data about Azure health and availability.</li>
<li><strong>Azure tenant data</strong>: Data about your Azure organization-level services, such as Microsoft Entra ID.</li>
</ul>
<p>Because Azure Monitor is an automatic system, it begins to collect data from these sources as soon as you create Azure resources like virtual machines and web apps. You can extend the data that Azure Monitor collects by:</p>
<ul>
<li><strong>Enabling diagnostics</strong>: For some resources, such as Azure SQL Databases, you'll receive full information about a resource only after you've enabled diagnostic logging for it. You can use the Azure portal, the Azure CLI, or PowerShell to enable diagnostics.</li>
<li><strong>Adding an agent</strong>: For virtual machines, you can install the Log Analytics agent and configure it to send data to a Log Analytics workspace. This agent increases the amount of information that's sent to Azure Monitor.</li>
</ul>
<p>Your developers might also want to send data to Azure Monitor from custom code such as a web app, an Azure function, or a mobile app. They send data by calling the Data Collector API. You can communicate with this REST interface through HTTP. This interface is compatible with various development frameworks such as .NET Framework, Node.js, and Python. Developers can choose their favorite language and framework to log data in Azure Monitor.</p>
<h4 id="logs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#logs">Logs</a></h4>
<p>Logs contain time-stamped information about resource changes. The type of information recorded varies by log source. The log data is organized into records, with different sets of properties for each type of record. The logs can include numeric values like Azure Monitor metrics, but most include text data rather than numeric values.</p>
<p>The most common type of log entry records an event. Events can occur sporadically rather than at fixed intervals or according to a schedule. Applications and services create events and provide the event context. You can store metric data in logs to combine them with other monitoring data for analysis.</p>
<p>You can log data from Azure Monitor in a Log Analytics workspace. Azure provides an analysis engine and a rich query language. The logs show the context of any problems, and they're useful for identifying root causes.</p>
<p><img alt="Screenshot of an example query against Azure logs with the query text on top and a graph displaying the results below." src="https://learn.microsoft.com/en-us/training/modules/analyze-infrastructure-with-azure-monitor-logs/media/2-azure-logs-query-example.png" /></p>
<h4 id="metrics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#metrics">Metrics</a></h4>
<p>Metrics are numerical values that describe some aspect of a system at a point in time. Azure Monitor can capture metrics in near-real time. The metrics are collected at regular intervals, and they're useful for alerting because of their frequent sampling. You can use various algorithms to compare a metric to other metrics and observe trends over time.</p>
<p>Metrics are stored in a time-series database. This data store is most effective for analyzing time-stamped data. Metrics are suited for alerting and fast detection of issues. They can tell you about system performance. If needed, you can combine them with logs to identify the root cause of issues.</p>
<p><img alt="Screenshot of an example chart in Azure Metrics displaying average CPU percentage." src="https://learn.microsoft.com/en-us/training/modules/analyze-infrastructure-with-azure-monitor-logs/media/2-azure-monitor-metrics.png" /></p>
<h3 id="analyzing-logs-by-using-kusto"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#analyzing-logs-by-using-kusto">Analyzing logs by using Kusto</a></h3>
<p>To retrieve, consolidate, and analyze data, you can specify a query to run in Azure Monitor logs. You can write a log query with the Kusto query language, which Azure Data Explorer also uses.</p>
<p>You can test log queries in the Azure portal so you can work with them interactively. You'll typically start with basic queries, then progress to more advanced functions as your requirements become more complex.</p>
<p>In the Azure portal, you can create custom dashboards, which are targeted displays of resources and data. You can build each dashboard from a set of tiles. Each tile might show a set of resources, a chart, a data table, or some custom text. Azure Monitor provides tiles that you can add to dashboards; for example, you might use a tile to display a Kusto query's results in a dashboard.</p>
<p>In the example scenario, the operations team can consolidate its monitoring data by visualizing it in charts and tables. These tools are effective for summarizing data and presenting it to different audiences.</p>
<p>By using Azure dashboards, you can combine various kinds of data—including both logs and metrics—into a single pane in the Azure portal. For example, you might want to create a dashboard that combines tiles that show a graph of metrics, a table of activity logs, charts from Azure Monitor, and a log query's output.</p>
<h2 id="create-basic-azure-monitor-log-queries-to-extract-information-from-log-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-basic-azure-monitor-log-queries-to-extract-information-from-log-data">Create basic Azure Monitor log queries to extract information from log data</a></h2>
<p>You can use Azure Monitor log queries to extract information from log data. Querying is an important part of examining the log data that Azure Monitor captures.</p>
<p>In the example scenario, the operations team uses Azure Monitor log queries to examine the health of its system.</p>
<h3 id="write-azure-monitor-log-queries-by-using-log-analytics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#write-azure-monitor-log-queries-by-using-log-analytics">Write Azure Monitor log queries by using Log Analytics</a></h3>
<p>You can find the Log Analytics tool in the Azure portal and use it to run sample queries or to create your own queries:</p>
<ol>
<li>
<p>In the Azure portal, in the left menu pane, select <strong>Monitor</strong>.</p>
<p>The Azure Monitor page appears along with more options, including <strong>Activity Log</strong>, <strong>Alerts</strong>, <strong>Metrics</strong>, and <strong>Logs</strong>.</p>
</li>
<li>
<p>Select <strong>Logs</strong>.</p>
<p>Here, you can enter your query and see the output.</p>
<p><img alt="Screenshot of Azure Monitor with a new query tab opened." src="https://learn.microsoft.com/en-us/training/modules/analyze-infrastructure-with-azure-monitor-logs/media/3-azure-monitor-portal-query-pane.png" /></p>
</li>
</ol>
<h3 id="write-queries-by-using-the-kusto-language"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#write-queries-by-using-the-kusto-language">Write queries by using the Kusto language</a></h3>
<p>You can use the Kusto Query Language to query log information for your services running in Azure. A Kusto query is a read-only request to process data and return results. You'll state the query in plain text by using a data-flow model that's designed to make the syntax easy to read, write, and automate. The query uses schema entities that are organized in a hierarchy similar to that of Azure SQL Database: databases, tables, and columns.</p>
<p>A Kusto query consists of a sequence of query statements delimited by a semicolon (<code>;</code>). At least one statement is a tabular expression statement. A tabular expression statement formats the data arranged as a table of columns and rows.</p>
<p>A tabular expression statement's syntax has a tabular data flow from one tabular query operator to another, starting with a data source. A data source might be a table in a database or an operator that produces data. The data then flows through a set of data-transformation operators that are bound together with the pipe (<code>|</code>) delimiter.</p>
<p>For example, the following Kusto query has a single tabular expression statement. The statement starts with a reference to a table called <code>Events</code>. The database that hosts this table is implicit here, and is part of the connection information. The data for that table, stored in rows, is filtered by the value of the <code>StartTime</code> column. The data is filtered further by the value of the <code>State</code> column. The query then returns the count of the resulting rows.</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>Events
| where StartTime &gt;= datetime(2018-11-01) and StartTime &lt; datetime(2018-12-01)
| where State == &quot;FLORIDA&quot;  
| count
</code></pre></div>
<p>Note</p>
<p>The Kusto query language that Azure Monitor uses is case-sensitive. Language keywords are typically written in lowercase. When you're using names of tables or columns in a query, make sure to use the correct case.</p>
<p>Events captured from the event logs of monitored computers are just one type of data source. Azure Monitor provides many other types of data sources. For example, the <code>Heartbeat</code> data source reports the health of all computers that report to your Log Analytics workspace. You can also capture data from performance counters and update management records.</p>
<p>The following example retrieves the most recent heartbeat record for each computer. The computer is identified by its IP address. In this example, the <code>summarize</code> aggregation with the <code>arg_max</code> function returns the record with the most recent value for each IP address.</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>Heartbeat
| summarize arg_max(TimeGenerated, *) by ComputerIP
</code></pre></div>
<h2 id="exercise-create-basic-azure-monitor-log-queries-to-extract-information-from-log-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#exercise-create-basic-azure-monitor-log-queries-to-extract-information-from-log-data">Exercise - Create basic Azure Monitor log queries to extract information from log data</a></h2>
<p>The operations team doesn't currently have enough information about its system behavior to diagnose and resolve problems effectively. To address this issue, the team has configured an Azure Monitor workspace with the company's Azure services. It runs Kusto queries to get the system's status and attempts to identify the causes of any problems that might occur.</p>
<p>In particular, the team is interested in monitoring security events to check for possible attempts to break into the system. An attacker might try to manipulate the applications running on the system, so the team also wants to gather application data for further analysis. An attacker might also try to halt the computers that compose the system, so the team wants to examine how and when machines are stopped and restarted.</p>
<p>In this exercise, you'll practice performing Azure log queries against a demo project that contains sample data in tables, logs, and queries.</p>
<h3 id="create-basic-azure-monitor-log-queries-to-extract-information-from-log-data_1"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-basic-azure-monitor-log-queries-to-extract-information-from-log-data_1">Create basic Azure Monitor log queries to extract information from log data</a></h3>
<p>Let's use the <strong>Azure Demo Logs pane</strong> to practice writing queries. The demo project workspace is prepopulated with sample data. Azure offers an optimized SQL-like query with visualization options of its data in a language called KQL (Kusto Query Language.)</p>
<ol>
<li>
<p>Open the <a href="https://portal.azure.com/learn.docs.microsoft.com/#blade/Microsoft_Azure_Monitoring_Logs/DemoLogsBlade?azure-portal=true">Logs demo environment</a>. In the top-left corner, under <strong>New Query 1</strong>, you'll find <strong>Demo</strong>, which identifies the query's workspace (or scope). The left side of this pane contains several tabs: <strong>Tables</strong>, <strong>Queries</strong>, and <strong>Functions</strong>. The right side has a scratchpad for creating or editing queries.</p>
</li>
<li>
<p>On the <strong>New Query 1</strong> tab, enter a basic query on the first line of the scratchpad. This query retrieves the details of the 10 most recent security events.</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>SecurityEvent
    | take 10
</code></pre></div>
</li>
<li>
<p>In the command bar, select <strong>Run</strong> to execute the query and view the results. You can expand each row in the results pane for more information.</p>
</li>
<li>
<p>Sort the data by time by adding a filter to your query:</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>SecurityEvent
    | top 10 by TimeGenerated
</code></pre></div>
</li>
<li>
<p>Add a filter clause and a time range. Run this query to fetch records that are more than 30 minutes old and that have a level of 10 or more:</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>SecurityEvent
    | where TimeGenerated &lt; ago(30m)
    | where toint(Level) &gt;= 10
</code></pre></div>
</li>
<li>
<p>Run the following query to search the <code>AppEvents</code> table for records of the <code>Clicked Schedule Button</code> event being invoked in the last 24 hours:</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>AppEvents 
    | where TimeGenerated &gt; ago(24h)
    | where Name == &quot;Clicked Schedule Button&quot;
</code></pre></div>
</li>
<li>
<p>Run the following query to display the number of different computers that generated heartbeat events each week for the last three weeks. The results appear as a bar chart:</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>Heartbeat
    | where TimeGenerated &gt;= startofweek(ago(21d))
    | summarize dcount(Computer) by endofweek(TimeGenerated) | render barchart kind=default
</code></pre></div>
</li>
</ol>
<h3 id="use-predefined-azure-log-queries-to-extract-information-from-log-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-predefined-azure-log-queries-to-extract-information-from-log-data">Use predefined Azure log queries to extract information from log data</a></h3>
<p>In addition to writing queries from scratch, the operations team can also take advantage of predefined queries in Azure Logs that answer common questions related to their resources' health, availability, usage, and performance.</p>
<ol>
<li>
<p>Use the <strong>Time Range</strong> parameter in the command bar to set a custom range. Select the month, year, and day to a range from January to today. You can set and apply a custom time to any query.</p>
</li>
<li>
<p>On the left toolbar, select <strong>Queries</strong>. In the drop-down list in the left menu, you can view a list of the sample queries grouped by <em>Category</em>, <em>Query type</em>, <em>Resource type</em>, <em>Solution</em>, or <em>Topic</em>.</p>
<p><img alt="Screenshot of Group By dropdown options under Queries tab in side pane." src="https://learn.microsoft.com/en-us/training/modules/analyze-infrastructure-with-azure-monitor-logs/media/4-azure-queries-category-groupby.png" /></p>
</li>
<li>
<p>Select <strong>Category</strong> in the drop-down list, then select <strong>IT &amp; Management Tools</strong>.</p>
</li>
<li>
<p>In the search box, enter <em>Distinct missing updates cross computers</em>. Double-click the query in the left pane, then select <strong>Run</strong>. The <strong>Logs</strong> pane reappears, with the query returning a list of Windows updates missing from virtual machines that are sending logs to the workspace.</p>
<p>Note</p>
<p>You can also run this same query from the <strong>Logs</strong> pane. In the left pane, select the <strong>Queries</strong> tab, then select <strong>Category</strong> in the <strong>Group by</strong> dropdown list. Now scroll down the list, expand <strong>IT &amp; Management Tools</strong>, and double-click <strong>Distinct missing updates cross computers</strong>. Select <strong>Run</strong> to run the query. When you select a predefined query in the left pane, the query code is appended to whatever query exists in the scratchpad. Remember to clear the scratchpad before opening or adding a new query to run.</p>
</li>
<li>
<p>In the left pane, clear the search box. Select <strong>Queries</strong>, then select <strong>Category</strong> in the <strong>Group by</strong> dropdown list. Expand <strong>Azure Monitor</strong> and double-click <strong>Computers availability today</strong>. Select <strong>Run</strong>. This query creates a time series chart with the number of unique IP addresses sending logs into the workspace each hour for the last day.</p>
</li>
<li>
<p>Select <strong>Topic</strong> in the <strong>Group by</strong> dropdown list, scroll down to expand <strong>Function App</strong>, and then double-click <strong>Show application logs from Function Apps</strong>. Select <strong>Run</strong>. This query returns a list of application logs, sorted by time with the latest logs shown first.</p>
</li>
</ol>
<p>You'll notice that from the Kusto queries you used here, it's easy to target a query to a specific time window, event level, or event log type. The security team can easily examine heartbeats to identify when servers are unavailable, which might indicate a denial-of-service attack. If the team spots the time when a server was unavailable, it can query for events in the security log around that time to diagnose whether an attack caused the interruption. Additionally, predefined queries can also evaluate VM availability, identify missing Windows updates, and review firewall logs to view denied network flows intended for the VMs of interest.</p>
<hr />
<h2 id="monitor-your-azure-virtual-machines-with-azure-monitor"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#monitor-your-azure-virtual-machines-with-azure-monitor">Monitor your Azure virtual machines with Azure Monitor</a></h2>
<h2 id="introduction_6"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_6">Introduction</a></h2>
<p>Suppose you're the IT administrator for a musical group's website hosted on Azure virtual machines (VMs). The website runs mission-critical services for the group, including ticket booking, venue information, and tour updates. The website must respond quickly and remain accessible during frequent updates and spikes in traffic.</p>
<p>You need to maintain sufficient VM size and memory to effectively host the website without incurring unnecessary costs. You also need to proactively prevent and quickly respond to any access, security, and performance issues. To help achieve these objectives, you want to quickly and easily monitor your VMs' traffic, health, performance, and events.</p>
<p>Azure Monitor provides built-in and customizable monitoring abilities. You can use these to track the health, performance, and behavior of the VM host and the operating system, workloads, and applications running on your VM. This learning module shows you how to view VM host monitoring data, set up recommended alert rules, and use VM insights and custom data collection rules (DCRs) to collect and analyze monitoring data from inside your VMs.</p>
<h3 id="prerequisites_3"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#prerequisites_3">Prerequisites</a></h3>
<p>To complete this module, you need the following prerequisites:</p>
<ul>
<li>Familiarity with virtualization, Azure portal navigation, and Azure VMs.</li>
<li>Access to an Azure subscription with at least <strong>Contributor</strong> role. If you don't have an Azure subscription, create a <a href="https://azure.microsoft.com/free/">free account</a> and add a subscription before you begin. If you're a student, you can take advantage of the <a href="https://azure.microsoft.com/free/students/">Azure for students</a> offer.</li>
</ul>
<h3 id="learning-objectives_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives_4">Learning objectives</a></h3>
<ul>
<li>Understand which monitoring data you need to collect from your VM.</li>
<li>Enable and view recommended alerts and diagnostics.</li>
<li>Use Azure Monitor to collect and analyze VM host data.</li>
<li>Use Azure Monitor Agent to collect VM client performance metrics and event logs.</li>
</ul>
<h2 id="introduction_7"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_7">Introduction</a></h2>
<p>Suppose you're the IT administrator for a musical group's website hosted on Azure virtual machines (VMs). The website runs mission-critical services for the group, including ticket booking, venue information, and tour updates. The website must respond quickly and remain accessible during frequent updates and spikes in traffic.</p>
<p>You need to maintain sufficient VM size and memory to effectively host the website without incurring unnecessary costs. You also need to proactively prevent and quickly respond to any access, security, and performance issues. To help achieve these objectives, you want to quickly and easily monitor your VMs' traffic, health, performance, and events.</p>
<p>Azure Monitor provides built-in and customizable monitoring abilities. You can use these to track the health, performance, and behavior of the VM host and the operating system, workloads, and applications running on your VM. This learning module shows you how to view VM host monitoring data, set up recommended alert rules, and use VM insights and custom data collection rules (DCRs) to collect and analyze monitoring data from inside your VMs.</p>
<h3 id="prerequisites_4"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#prerequisites_4">Prerequisites</a></h3>
<p>To complete this module, you need the following prerequisites:</p>
<ul>
<li>Familiarity with virtualization, Azure portal navigation, and Azure VMs.</li>
<li>Access to an Azure subscription with at least <strong>Contributor</strong> role. If you don't have an Azure subscription, create a <a href="https://azure.microsoft.com/free/">free account</a> and add a subscription before you begin. If you're a student, you can take advantage of the <a href="https://azure.microsoft.com/free/students/">Azure for students</a> offer.</li>
</ul>
<h3 id="learning-objectives_5"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives_5">Learning objectives</a></h3>
<ul>
<li>Understand which monitoring data you need to collect from your VM.</li>
<li>Enable and view recommended alerts and diagnostics.</li>
<li>Use Azure Monitor to collect and analyze VM host data.</li>
<li>Use Azure Monitor Agent to collect VM client performance metrics and event logs.</li>
</ul>
<h2 id="monitoring-for-azure-vms"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#monitoring-for-azure-vms">Monitoring for Azure VMs</a></h2>
<p>In this unit, you explore Azure monitoring capabilities for VMs, and the types of monitoring data you can collect and analyze with Azure Monitor. Azure Monitor is a comprehensive monitoring solution for collecting, analyzing, and responding to monitoring data from Azure and non-Azure resources, including VMs. Azure Monitor has two main monitoring features: Azure Monitor Metrics and Azure Monitor Logs.</p>
<p>Metrics are numerical values collected at predetermined intervals to describe some aspect of a system. Metrics can measure VM performance, resource utilization, error counts, user responses, or any other aspect of the system that you can quantify. Azure Monitor Metrics automatically monitors a predefined set of metrics for every Azure VM, and retains the data for 93 days with some exceptions.</p>
<p>Logs are recorded system events that contain a timestamp and different types of structured or free-form data. Azure automatically records activity logs for all Azure resources. This data is available at the resource level. Azure Monitor doesn't collect logs by default, but you can configure Azure Monitor Logs to collect from any Azure resource. Azure Monitor Logs stores log data in a Log Analytics workspace for querying and analysis.</p>
<h3 id="vm-monitoring-layers"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#vm-monitoring-layers">VM monitoring layers</a></h3>
<p>Azure VMs have several layers that require monitoring. Each of the following layers has a distinct set of telemetry and monitoring requirements.</p>
<ul>
<li>Host VM</li>
<li>Guest operating system (OS)</li>
<li>Client workloads</li>
<li>Applications that run on the VM</li>
</ul>
<p><img alt="Diagram that shows fundamental VM architecture." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/monitoring-layers.png" /></p>
<h3 id="host-vm-monitoring"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#host-vm-monitoring">Host VM monitoring</a></h3>
<p>The VM host represents the compute, storage, and network resources that Azure allocates to the VM.</p>
<h4 id="vm-host-metrics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#vm-host-metrics">VM host metrics</a></h4>
<p>VM host metrics measure technical aspects of the VM such as processor utilization and whether the machine is running. You can use VM host metrics to:</p>
<ul>
<li>Trigger an alert when your VM is reaching its disk or CPU limits.</li>
<li>Identify trends or patterns.</li>
<li>Control your operational costs by sizing VMs according to usage and demand.</li>
</ul>
<p>Azure automatically collects basic metrics for VM hosts. On the VM's <strong>Overview</strong> page in the Azure portal, you can see built-in graphs for the following important VM host metrics.</p>
<ul>
<li>VM availability</li>
<li>CPU usage percentage (average)</li>
<li>OS disk usage (total)</li>
<li>Network operations (total)</li>
<li>Disk operations per second (average)</li>
</ul>
<p>You can use Azure Monitor Metrics Explorer to plot more metrics graphs, investigate changes, and visually correlate metrics trends for your VMs. With Metrics Explorer you can:</p>
<ul>
<li>Plot multiple metrics on a graph to see how much traffic hits your VM and how the VM performs.</li>
<li>Track the same metric over multiple VMs in a resource group or other scope, and use splitting to show each VM on the graph.</li>
<li>Select flexible time ranges and granularity.</li>
<li>Specify many other settings such as chart type and value ranges.</li>
<li>Send graphs to workbooks or pin them to dashboards for quickly viewing health and performance.</li>
<li>Group metrics by time intervals, geographic regions, server clusters, or application components.</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/2-vm-metrics-screenshot.png#lightbox"><img alt="Screenshot showing CPU percentage usage and inbound flow chart." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/2-vm-metrics-screenshot.png" /></a></p>
<h4 id="recommended-alert-rules"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#recommended-alert-rules">Recommended alert rules</a></h4>
<p>Alerts proactively notify you of specified occurrences and patterns in your VM host metrics. <em>Recommended alert rules</em> are a predefined set of alert rules based on commonly monitored host metrics. These rules define recommended CPU, memory, disk, and network usage levels to alert on. The rules also include VM availability, which alerts you when the VM stops running.</p>
<p>You can quickly enable and configure recommended alert rules when you create an Azure VM, or afterwards from the VM's portal page. You can also view, configure, and create custom alerts by using Azure Monitor Alerts.</p>
<h4 id="activity-logs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#activity-logs">Activity logs</a></h4>
<p>Azure Monitor automatically records and displays activity logs for Azure VMs. Activity logs include information like VM startup or modifications. You can create diagnostic settings to send activity logs to the following destinations:</p>
<ul>
<li><strong>Azure Monitor Logs:</strong> For more complex querying and alerting, and for longer retention up to two years.</li>
<li><strong>Azure Storage:</strong> For cheaper, long-term archiving.</li>
<li><strong>Azure Event Hubs:</strong> To forward outside of Azure.</li>
</ul>
<h4 id="boot-diagnostics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#boot-diagnostics">Boot diagnostics</a></h4>
<p>Boot diagnostics are host logs you can use to help troubleshoot boot issues with your VMs. You can enable boot diagnostics by default when you create a VM, or afterwards for existing VMs.</p>
<p>Once you enable boot diagnostics, you can see screenshots from the VM's hypervisor for both Windows and Linux machines, and view the serial console log output of the VM boot sequence for Linux machines. Boot diagnostics stores data in a managed storage account.</p>
<h3 id="guest-os-client-workload-and-application-monitoring"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#guest-os-client-workload-and-application-monitoring">Guest OS, client workload, and application monitoring</a></h3>
<p>VM client monitoring can include monitoring the operating system (OS), workloads, and applications that run on the VM. To collect metrics and logs from guest OS and client workloads and applications, you need to install Azure Monitor Agent and set up a DCR.</p>
<p>DCRs define what data to collect and where to send that data. You can use a DCR to send Azure Monitor metrics data, or <em>performance counters</em>, to Azure Monitor Logs or Azure Monitor Metrics. You can also send event log data to Azure Monitor Logs. In other words, Azure Monitor Metrics can store only metrics data, but Azure Monitor Logs can store both metrics and event logs.</p>
<h4 id="vm-insights"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#vm-insights">VM insights</a></h4>
<p>VM insights is an Azure Monitor feature that helps get you started monitoring your VM clients. VM insights is especially useful for exploring overall VM usage and performance when you don't yet know the metric of primary interest. VM insights provides:</p>
<ul>
<li>Simplified Azure Monitor Agent onboarding to enable monitoring a VM's guest OS and workloads.</li>
<li>A preconfigured DCR that monitors and collects the most common performance counters for Windows and Linux.</li>
<li>Predefined trending performance metrics charts and workbooks from the VM's guest OS.</li>
<li>A set of predefined workbooks that show collected VM client metrics over time.</li>
<li>Optionally, a collection of processes running on the VM, dependencies with other services, and a dependency map that displays interconnected components with other VMs and external sources.</li>
</ul>
<p>Predefined VM insights workbooks show performance, connections, active ports, traffic, and other collected data from one or several VMs. You can view VM insights data directly from a single VM, or see a combined view of multiple VMs to view and assess trends and patterns across VMs. You can edit the prebuilt workbook configurations, or create your own custom workbooks.</p>
<h4 id="client-event-log-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#client-event-log-data">Client event log data</a></h4>
<p>VM insights creates a DCR that collects a specific set of performance counters. To collect other data, such as event logs, you can create a separate DCR that specifies the data you want to collect from the VM and where to send it. Azure Monitor stores collected log data in a Log Analytics workspace. From there, you can access and analyze the data by using log queries written in Kusto Query Language (KQL).</p>
<h2 id="monitor-vm-host-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#monitor-vm-host-data">Monitor VM host data</a></h2>
<p>You want to monitor the VMs that host your website, so you decide to quickly create a VM in the Azure portal and evaluate its built-in monitoring capabilities. In this unit, you use the Azure portal to create a Linux VM with recommended alerts and boot diagnostics enabled. As soon as the VM starts up, Azure automatically begins collecting basic metrics and activity logs. You can then view built-in metrics graphs, activity logs, and boot diagnostics.</p>
<h3 id="create-a-vm-and-enable-recommended-alerts"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-vm-and-enable-recommended-alerts">Create a VM and enable recommended alerts</a></h3>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/">Azure portal</a>, and in the Search field, enter <em>virtual machines</em>.</p>
</li>
<li>
<p>On the <strong>Virtual machines</strong> page, select <strong>Create</strong>, and then select <strong>Azure virtual machine</strong>.</p>
</li>
<li>
<p>On the <strong>Basics</strong> tab of the <strong>Create a virtual machine</strong> page:</p>
<ul>
<li>In the <strong>Subscription</strong> field, select the correct subscription if not already selected.</li>
<li>Under <strong>Resource group</strong>:<ol>
<li>Select <strong>Create new</strong>.</li>
<li>Under <strong>Name</strong>, enter <em>learn-monitor-vm-rg</em>.</li>
<li>Select <strong>OK</strong>.</li>
</ol>
</li>
<li>For <strong>Virtual machine name</strong>, enter <em>monitored-linux-vm</em>.</li>
<li>For <strong>Image</strong>, select <strong>Ubuntu Server 20.04 LTS - x64 Gen2</strong>.</li>
<li>Leave the other settings at their current values, and select the <strong>Monitoring</strong> tab.</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-vm-basic.png#lightbox"><img alt="Screenshot that shows the Basics tab of the Create a virtual machine page." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-vm-basic.png" /></a></p>
</li>
<li>
<p>On the <strong>Monitoring</strong> tab, select the checkbox next to <strong>Enable recommended alert rules</strong>.</p>
</li>
<li>
<p>On the <strong>Set up recommended alert rules</strong> screen:</p>
<ol>
<li>Select all the listed alert rules if not already selected, and adjust the values if desired.</li>
<li>Under <strong>Notify me by</strong>, select the checkbox next to <strong>Email</strong>, and enter an email address to receive alert notifications.</li>
<li>Select <strong>Save</strong>.</li>
<li>Under <strong>Diagnostics</strong>, for <strong>Boot diagnostics</strong>, ensure that <strong>Enable with managed storage account (recommended)</strong> is selected.</li>
</ol>
<p>Note</p>
<p>Don't select <strong>Enable OS guest diagnostics</strong>. The Linux Diagnostics Agent (LAD) is deprecated, and you can enable OS guest and client monitoring later.</p>
</li>
<li>
<p>Select <strong>Review + create</strong> at the bottom of the page, and when validation passes, select <strong>Create</strong>.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-vm-monitoring.png#lightbox"><img alt="Screenshot that shows the Monitoring tab and alert rule configuration screen of the Create a virtual machine page." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-vm-monitoring.png" /></a></p>
</li>
<li>
<p>On the <strong>Generate new key pair</strong> popup dialog box, select <strong>Download private key and create resource</strong>.</p>
</li>
</ol>
<p>It can take a few minutes to create the VM. When you get the notification that the VM is created, select <strong>Go to resource</strong> to see basic metrics data.</p>
<h3 id="view-built-in-metrics-graphs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-built-in-metrics-graphs">View built-in metrics graphs</a></h3>
<p>Once your VM is created, Azure starts collecting basic metrics data automatically. Built-in metrics graphs, along with the recommended alerts you enabled, can help you monitor whether and when your VM encounters health or performance issues. You can then use more advanced monitoring and analytics capabilities to investigate issue causes and remediation.</p>
<ol>
<li>
<p>To view basic metrics graphs, on the VMs <strong>Overview</strong> page, select the <strong>Monitoring</strong> tab.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/select-monitoring.png#lightbox"><img alt="Screenshot that shows Monitoring tab on a VMs Overview screen." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/select-monitoring.png" /></a></p>
</li>
<li>
<p>Under <strong>Performance and utilization</strong> &gt; <strong>Platform metrics</strong>, review the following metrics graphs related to the VMs performance and utilization. Select <strong>Show more metrics</strong> if all the graphs don't appear immediately.</p>
<ul>
<li><strong>VM Availability</strong></li>
<li><strong>CPU (average)</strong></li>
<li><strong>Disk bytes (total)</strong></li>
<li><strong>Network (total)</strong></li>
<li><strong>Disk operations/sec (average)</strong></li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/platform-metrics.png#lightbox"><img alt="Screenshot that shows the platform metrics graphics on the VM Overview page." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/platform-metrics.png" /></a></p>
</li>
<li>
<p>Under <strong>Guest OS metrics</strong>, notice that guest OS metrics aren't being collected yet. In the next units, you configure VM insights and data collection rules to collect guest OS metrics.</p>
</li>
</ol>
<h3 id="view-the-activity-log"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-the-activity-log">View the activity log</a></h3>
<p>You can view the VMs activity log by selecting <strong>Activity log</strong> from the VMs left navigation menu. You can also retrieve entries by using PowerShell or the Azure CLI.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/activity-log.png#lightbox"><img alt="Screenshot of the activity log for a VM." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/activity-log.png" /></a></p>
<h3 id="view-boot-diagnostics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-boot-diagnostics">View boot diagnostics</a></h3>
<p>You enabled boot diagnostics when you created the VM. You can view boot diagnostics to view boot data and troubleshoot startup issues.</p>
<ol>
<li>
<p>In the left navigation menu for the VM, select <strong>Boot diagnostics</strong> under <strong>Help</strong>.</p>
</li>
<li>
<p>On the <strong>Boot diagnostics</strong> page, select <strong>Screenshot</strong> to see a startup screenshot from the VMs hypervisor. Select <strong>Serial log</strong> to view log messages created when the VM started.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-boot-diagnostics.png#lightbox"><img alt="Screenshot that shows the boot diagnostic image captured." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-boot-diagnostics.png" /></a></p>
</li>
</ol>
<h2 id="use-metrics-explorer-to-view-detailed-host-metrics"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-metrics-explorer-to-view-detailed-host-metrics">Use Metrics Explorer to view detailed host metrics</a></h2>
<p>You want to investigate how traffic flowing into your VM affects its CPU capability. If the built-in metrics charts for a VM don't already show the data you need, you can use Metrics Explorer to create customized metrics charts. In this unit, you plot a graph that displays your VM's maximum percentage CPU and average inbound flow data together.</p>
<p>Azure Monitor Metrics Explorer offers a UI for exploring and analyzing VM metrics. You can use Metrics Explorer to view and create custom charts for many VM host metrics in addition to the metrics shown on the built-in graphs.</p>
<h3 id="understand-metrics-explorer"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#understand-metrics-explorer">Understand Metrics Explorer</a></h3>
<p>To open Metrics Explorer, you can:</p>
<ul>
<li>Select <strong>Metrics</strong> from the VM's left navigation menu under <strong>Monitoring</strong>.</li>
<li>Select the <strong>See all Metrics</strong> link next to <strong>Platform metrics</strong> on the <strong>Monitoring</strong> tab of the VM's <strong>Overview</strong> page.</li>
<li>Select <strong>Metrics</strong> from the left navigation menu on the Azure Monitor <strong>Overview</strong> page.</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/metrics-explorer.png#lightbox"><img alt="Screenshot that shows Metrics Explorer." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/metrics-explorer.png" /></a></p>
<p>In Metrics Explorer, you can select the following values from the dropdown fields:</p>
<ul>
<li><strong>Scope:</strong> If you open Metrics Explorer from a VM, this field is prepopulated with the VM name. You can add more items with the same resource type (VMs) and location.</li>
<li><strong>Metric Namespace</strong>: Most resource types have only one namespace, but for some types, you must pick a namespace. For example, storage accounts have separate namespaces for files, tables, blobs, and queues.</li>
<li><strong>Metric</strong>: Each metrics namespace has many metrics available to choose from.</li>
<li><strong>Aggregation</strong>: For each metric, Metrics Explorer applies a default aggregation. You can use a different aggregation to get different information about the metric.</li>
</ul>
<p>You can apply the following aggregation functions to metrics:</p>
<ul>
<li><strong>Count</strong>: Counts the number of data points.</li>
<li><strong>Average (Avg)</strong>: Calculates the arithmetic mean of values.</li>
<li><strong>Maximum (Max)</strong>: Identifies the highest value.</li>
<li><strong>Minimum (Min)</strong>: Identifies the lowest value.</li>
<li><strong>Sum</strong>: Adds up all the values.</li>
</ul>
<p>You can select flexible time ranges for graphs from the past 30 minutes to the last 30 days, or custom ranges. You can specify time interval granularity from one minute to one month.</p>
<h3 id="create-a-metrics-graph"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-metrics-graph">Create a metrics graph</a></h3>
<p>To create a Metrics Explorer graph that shows host VM maximum percentage CPU and inbound flows together for the past 30 minutes:</p>
<ol>
<li>
<p>Open <strong>Metrics Explorer</strong> by selecting <strong>See all Metrics</strong> on the VM's <strong>Monitoring</strong> tab or selecting <strong>Metrics</strong> from the VM's left navigation menu.</p>
</li>
<li>
<p><strong>Scope</strong> and <strong>Metric Namespace</strong> are already populated for the host VM. Select <strong>Percentage CPU</strong> from the <strong>Metrics</strong> dropdown list.</p>
</li>
<li>
<p><strong>Aggregation</strong> is automatically populated with <strong>Avg</strong>, but change it to <strong>Max</strong>.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-view-host-level-metrics.png#lightbox"><img alt="Screenshot of the Percentage CPU metrics graph for a VM." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-view-host-level-metrics.png" /></a></p>
</li>
<li>
<p>Select <strong>Add metric</strong> at upper left.</p>
</li>
<li>
<p>Under <strong>Metric</strong>, select <strong>Inbound Flows</strong>. Leave <strong>Aggregation</strong> at <strong>Avg</strong>.</p>
</li>
<li>
<p>At upper right, select <strong>Local Time: Last 24 hours (Automatic - 15 minutes)</strong>, change it to <strong>Last 30 minutes</strong>, and select <strong>Apply</strong>.</p>
</li>
</ol>
<p>Your graph should look similar to the following screenshot:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-metric-graph.png#lightbox"><img alt="Screenshot that shows a graph of CPU usage and inbound traffic." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-metric-graph.png" /></a></p>
<h2 id="collect-client-performance-counters-by-using-vm-insights"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#collect-client-performance-counters-by-using-vm-insights">Collect client performance counters by using VM insights</a></h2>
<p>Besides monitoring your VM host's health, utilization, and performance, you need to monitor the software and processes running on your VM. These are called the VM guest or client. In this unit, you enable the Azure Monitor VM insights feature, which offers a quick way to start monitoring the VM client.</p>
<p>The VM client includes the operating system and other workloads and applications. To monitor the software running on your VM, you install the Azure Monitor Agent, which collects data from inside the VM. VM insights:</p>
<ul>
<li>Installs Azure Monitor Agent on your VM.</li>
<li>Creates a DCR that collects and sends a predefined set of client performance data to a Log Analytics workspace.</li>
<li>Presents the data in curated workbooks.</li>
</ul>
<p>Although you don't need to use VM insights to install Azure Monitor Agent, create DCRs, or set up workbooks, VM insights makes setting up VM client monitoring easy. VM insights provides you with a basis for monitoring the performance of your VM client and mapping the processes running on your machine.</p>
<h3 id="enable-vm-insights"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#enable-vm-insights">Enable VM insights</a></h3>
<ol>
<li>
<p>In the Azure portal, on your VM's <strong>Overview</strong> page, select <strong>Insights</strong> from the left navigation menu under <strong>Monitoring</strong>.</p>
</li>
<li>
<p>On the <strong>Insights</strong> page, select <strong>Enable</strong>.</p>
</li>
<li>
<p>Under <strong>Data collection rule</strong>, note the properties of the DCR that VM insights creates. In the DCR description, <strong>Processes and dependencies (Map)</strong> is set to <strong>Disabled</strong>, which you can change to <strong>Enabled</strong> or review <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/vm/vminsights-maps">this article on how-to</a> if greyed out. Also a default <strong>Log Analytics workspace</strong> is created or assigned.</p>
</li>
<li>
<p>Select <strong>Configure</strong>.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/enable-insights.png#lightbox"><img alt="Screenshot that shows enabling and configuring VM insights." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/enable-insights.png" /></a></p>
<p>Configuration of the workspace and the agent installation typically takes 5 to 10 minutes. It can take another 5 to 10 minutes for data to become available to view in the portal.</p>
</li>
<li>
<p>When the deployment finishes, confirm that the Azure Monitor Agent is installed by looking on the <strong>Properties</strong> tab of the VM's <strong>Overview</strong> page under <strong>Extensions + applications</strong>.</p>
<p>On the <strong>Monitoring</strong> tab of the <strong>Overview</strong> page, under <strong>Performance and utilization</strong>, you can see that <strong>Guest OS metrics</strong> are now being collected.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/guest-os-metrics.png#lightbox"><img alt="Screenshot that shows Guest OS metrics on the VM's Monitoring tab." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/guest-os-metrics.png" /></a></p>
</li>
</ol>
<h3 id="view-vm-insights"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-vm-insights">View VM insights</a></h3>
<p>VM insights creates a DCR that sends client VM performance counters to Azure Monitor Logs. Because the DCR sends its metrics to Azure Monitor Logs, you don't use Metrics Explorer to view the metrics data that VM insights collects.</p>
<p>To view the VM insights performance graphs and maps:</p>
<ol>
<li>
<p>Select <strong>Insights</strong> from the VM's left navigation menu under <strong>Monitoring</strong>.</p>
</li>
<li>
<p>Near the top of the <strong>Insights</strong> page, select the <strong>Performance</strong> tab. The prebuilt VM insights Performance workbook shows charts and graphs with performance-related data for the current VM.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/vm-insights-performance.png#lightbox"><img alt="Screenshot that shows the prebuilt VM insights Performance workbook." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/vm-insights-performance.png" /></a></p>
<ul>
<li>
<p>You can customize the view by specifying a different <strong>Time range</strong> at the top of the page and different aggregations at the top of each graph.</p>
</li>
<li>
<p>Select <strong>View Workbooks</strong> to select from other available prebuilt VM insights workbooks. Select <strong>Go To Gallery</strong> to select from a gallery of other VM insights workbooks and workbook templates, or to edit and create your own workbooks.</p>
</li>
</ul>
</li>
<li>
<p>If enabled earlier, select the <strong>Map</strong> tab on the <strong>Insights</strong> page to see the workbook for the Map feature. The map visualizes the VM's dependencies by discovering running process groups and processes that have active network connections over a specified time range.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dependency-map.png#lightbox"><img alt="Screenshot that shows a dependency map on the Map tab of VM insights." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dependency-map.png" /></a></p>
</li>
</ol>
<h2 id="collect-vm-client-event-logs"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#collect-vm-client-event-logs">Collect VM client event logs</a></h2>
<p>Azure Monitor Metrics and VM insights performance counters help you identify performance anomalies, and alert when thresholds are reached. But to analyze the root causes of issues you detect, you need to analyze log data to see which system events caused or contributed to the issues. In this unit, you set up a DCR to collect Linux VM Syslog data, and view the log data in Azure Monitor Log Analytics by using a simple Kusto Query Language (KQL) query.</p>
<p>VM insights installs the Azure Monitor Agent, and creates a DCR that collects predefined performance counters, maps process dependencies, and presents the data in prebuilt workbooks. You can create your own DCRs to collect VM performance counters that the VM insights DCR doesn't collect, or to collect log data.</p>
<p>When you create DCRs in the Azure portal, you can select from a range of performance counters and sampling rates or add custom performance counters. Alternatively, you can select from a predefined set of log types and severity levels or define custom log schemas. You can associate a single DCR to any or all VMs in your subscription, but you might need multiple DCRs to collect different types of data from different VMs.</p>
<h3 id="create-a-dcr-to-collect-log-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-dcr-to-collect-log-data">Create a DCR to collect log data</a></h3>
<p>In the Azure portal, search for and select <em>monitor</em> to go to the Azure Monitor <strong>Overview</strong> page.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/monitor-overview.png#lightbox"><img alt="Screenshot that shows the Azure Monitor Overview page." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/monitor-overview.png" /></a></p>
<h4 id="create-a-data-collection-endpoint"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-data-collection-endpoint">Create a Data Collection Endpoint</a></h4>
<p>You must have a data collection endpoint to send log data to. To create an endpoint:</p>
<ol>
<li>In the Azure Monitor left navigation menu under <strong>Settings</strong>, select <strong>Data Collection Endpoints</strong>.</li>
<li>On the <strong>Data Collection Endpoints</strong> page, select <strong>Create</strong>.</li>
<li>On the <strong>Create data collection endpoint</strong> page, for <strong>Name</strong>, enter <em>linux-logs-endpoint</em>.</li>
<li>Select the same <strong>Subscription</strong>, <strong>Resource group</strong>, and <strong>Region</strong> as your VM uses.</li>
<li>Select <strong>Review + create</strong>, and when validation passes, select <strong>Create</strong>.</li>
</ol>
<h4 id="create-the-data-collection-rule"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-the-data-collection-rule">Create the Data Collection Rule</a></h4>
<p>To create the DCR to collect the event logs:</p>
<ol>
<li>
<p>In the Monitor left navigation menu under <strong>Settings</strong>, select <strong>Data Collection Rules</strong>.</p>
</li>
<li>
<p>On the <strong>Data Collection Rules</strong> page, you can see the DCR that VM insights created. Select <strong>Create</strong> to create a new data collection rule.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dcr-create.png#lightbox"><img alt="Screenshot of the Data Collection Rules screen with Create highlighted." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dcr-create.png" /></a></p>
</li>
<li>
<p>On the <strong>Basics</strong> tab of the <strong>Create Data Collection Rule</strong> screen, provide the following information:</p>
<ul>
<li><strong>Rule name</strong>: Enter <em>collect-events-linux</em>.</li>
<li><strong>Subscription</strong>, <strong>Resource Group</strong>, and <strong>Region</strong>: Select the same as for your VM.</li>
<li><strong>Platform Type</strong>: Select <strong>Linux</strong>.</li>
<li>Select <strong>Next: Resources</strong> or the <strong>Resources</strong> tab.</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-basics.png#lightbox"><img alt="Screenshot of the Basics tab of the Create Data Collection Rule screen." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-basics.png" /></a></p>
</li>
<li>
<p>On the <strong>Resources</strong> screen, select <strong>Add resources</strong>.</p>
</li>
<li>
<p>On the <strong>Select a scope</strong> screen, select the <strong>monitored-linux-vm</strong> VM, and then select <strong>Apply</strong>.</p>
</li>
<li>
<p>On the <strong>Resources</strong> screen, select <strong>Enable Data Collection Endpoints</strong>.</p>
</li>
<li>
<p>Under <strong>Data collection endpoint</strong> for the <strong>monitored-linux-vm</strong>, select the <strong>linux-logs-endpoint</strong> you created.</p>
</li>
<li>
<p>Select <strong>Next: Collect and deliver</strong>, or the <strong>Collect and deliver</strong> tab.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-resources.png#lightbox"><img alt="Screenshot of the Resources tab of the Create Data Collection Rule screen." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-resources.png" /></a></p>
</li>
<li>
<p>On the <strong>Collect and deliver</strong> tab, select <strong>Add data source</strong>.</p>
</li>
<li>
<p>On the <strong>Add data source</strong> screen, under <strong>Data source type</strong>, select <strong>Linux Syslog</strong>.</p>
</li>
<li>
<p>On the <strong>Add data source</strong> screen, select <strong>Next: Destination</strong> or the <strong>Destination</strong> tab, and make sure the <strong>Account or namespace</strong> matches the Log Analytics workspace that you want to use. You can use the default Log Analytics workspace that VM insights set up, or create or use another Log Analytics workspace.</p>
</li>
<li>
<p>On the <strong>Add data source</strong> screen, select <strong>Add data source</strong>.</p>
</li>
<li>
<p>On the <strong>Create Data Collection Rule</strong> screen, select <strong>Review + create</strong>, and when validation passes, select <strong>Create</strong>.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-finish.png#lightbox"><img alt="Screenshot of Review + create highlighted on the Create Data Collection Rule screen." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-finish.png" /></a></p>
</li>
</ol>
<h3 id="view-log-data"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-log-data">View log data</a></h3>
<p>You can view and analyze the log data collected by your DCR by using KQL log queries. A set of sample KQL queries is available for VMs, but you can write a query to look at the events your DCR is collecting.</p>
<ol>
<li>
<p>On your VM's <strong>Overview</strong> page, select <strong>Logs</strong> from the left navigation menu under <strong>Monitoring</strong>. Log Analytics opens an empty query window with the scope set to your VM.</p>
<p>You can also access log data by selecting <strong>Logs</strong> from the left navigation of the Azure Monitor <strong>Overview</strong> page. If necessary, select <strong>Select scope</strong> at the top of the query window to scope the query to the desired Log Analytics workspace and VM.</p>
<p>Note</p>
<p>The <strong>Queries</strong> window with sample queries might open when you open Log Analytics. For now, close this window, because you're going to manually create a simple query.</p>
</li>
<li>
<p>In the empty query window, type <em>Syslog</em>, and then select <strong>Run</strong>. All the system log events the DCR collected within the <strong>Time range</strong> are displayed.</p>
</li>
<li>
<p>You can refine your query to identify events of interest. For example, you can display only the events that had a <strong>SeverityLevel</strong> of <strong>warning</strong>.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dcr-log.png#lightbox"><img alt="Screenshot that shows the events returned from the Syslog by the DCR." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dcr-log.png" /></a></p>
</li>
</ol>
<h2 id="summary"><a class="toclink" href="2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#summary">Summary</a></h2>
<p>Azure Monitor helps you collect, analyze, and alert on various types of host and client monitoring data from your Azure VMs.</p>
<ul>
<li>Azure Monitor provides a set of VM host logs and performance and usage metrics for all Azure VMs.</li>
<li>You can enable recommended alert rules when you create VMs or afterwards to alert on important VM host metrics.</li>
<li>Azure Monitor Metrics Explorer lets you graph and analyze metrics for Azure VMs and other resources.</li>
<li>VM insights provides a simple way to monitor important VM client performance counters and processes running on your VM.</li>
<li>You can create data collection rules to collect other metrics and logs from your VM client.</li>
<li>You can use Log Analytics to query and analyze log data.</li>
</ul>
<p>Now that you understand these tools, you're confident that Azure Monitor can effectively monitor your Azure VMs and help you keep your website running effectively.</p>
<hr />
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-11-14 00:00:00">November 14, 2024</time></li>
        
        
          
          <li class="md-meta__item">
            
              25 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="introduction-to-azure-cloud-shell"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/">Introduction to Azure Cloud Shell</a></h2>
<p>Azure Cloud Shell is a command-line environment you can access through your web browser. You can use this environment to manage Azure resources, including VMs, storage, and networking. Just like you do when using the Azure CLI or Azure PowerShell.</p>
<p>Because Microsoft manages Cloud Shell, you always have access to the most recent versions of the Azure CLI and PowerShell modules right from any browser. You don't have to worry about keeping modules up to date. With Cloud Shell, you just open your browser and sign in. Just like that, you have access to a command-line environment fully connected with your account's permissions and the resources to which you have access. All that works in an infrastructure that's compliant with double encryption at rest by default. You don't need to take any further action!</p>
<p>Azure Cloud Shell also provides cloud storage to persist files such as SSH keys, scripts, and more. This functionality lets you access important files in between sessions and with different machines. Finally, you can use the Cloud Shell editor to make changes to files, such as scripts, that are saved into this cloud storage directly from the Cloud Shell interface.</p>
<hr />
<h2 id="how-does-azure-cloud-shell-work"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#how-does-azure-cloud-shell-work">How does Azure Cloud Shell work?</a></h2>
<p>As an IT admin for Contoso Corporation, you're frequently on-call to perform administrative tasks and resolve workload disruptions to resources in your organization's Azure subscriptions. When visiting a family member during a weekend that you're on call, the development team notifies you of a problem with an Azure virtual machine (VM). The VM became nonresponsive during scheduled maintenance for the upgrade of an application that runs on it. Because the developers weren't granted access to the underlying Azure virtual machine hosting infrastructure, they're only able to remotely access the VM when it's operating normally. So, you're being called to diagnose and remediate the problem.</p>
<p>Since you're visiting family, you don’t have access to your administrative workstation and diagnostic scripts. You do have access to a laptop with an internet browser. Using the laptop, you browse to the Azure portal, authenticate against your organization’s Azure subscription, open Azure Cloud Shell, mount an Azure File Share, access your diagnostic scripts, and diagnose and remediate the problems with the VM, returning it to operation.</p>
<h3 id="access-cloud-shell"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#access-cloud-shell">Access Cloud Shell</a></h3>
<p>You have a few different options for accessing Azure Cloud Shell:</p>
<ul>
<li>
<p>From a direct link: <a href="https://shell.azure.com/">https://shell.azure.com</a></p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-directly.png#lightbox"><img alt="A screenshot of Cloud Shell accessed directly from a link." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-directly.png" /></a></p>
</li>
<li>
<p>From the Azure portal</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-from-azure-portal.png#lightbox"><img alt="A screenshot of Cloud Shell accessed from Azure portal." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-from-azure-portal.png" /></a></p>
</li>
<li>
<p>From code snippets when accessing Microsoft Learn:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-from-code-snippets.png#lightbox"><img alt="A screenshot of Cloud Shell accessed from code snippets." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-from-code-snippets.png" /></a></p>
</li>
</ul>
<p>When you open a Cloud Shell session, a temporary host is allocated to your session. This VM is preconfigured with the latest versions of PowerShell and Bash. You can then select the command-line experience you want to use:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/select-cli-experience.png#lightbox"><img alt="A screenshot of how to choose a command-line experience in a Cloud Shell session." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/select-cli-experience.png" /></a></p>
<p>After you select the shell experience you want to use, you can start managing your Azure resources:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/manage-azure-resources-in-cloud-shell.png#lightbox"><img alt="A screenshot of how to use Cloud Shell to manage Azure resources." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/manage-azure-resources-in-cloud-shell.png" /></a></p>
<p>Cloud Shell sessions terminate after 20 minutes of inactivity. When a session terminates, files on your CloudDrive are persisted, but you need to start a new session to access the Cloud Shell environment.</p>
<h3 id="access-your-own-scripts-and-files"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#access-your-own-scripts-and-files">Access your own scripts and files</a></h3>
<p>When using Cloud Shell, you might also need to run scripts or use files for different actions. You can persist files on Cloud Shell by using the Azure CloudDrive:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/use-azure-cloud-drive.png#lightbox"><img alt="A screenshot of how to access CloudDrive in a Cloud Shell session." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/use-azure-cloud-drive.png" /></a></p>
<p>After uploading files, you can interact with them as you would in a regular PowerShell or Bash session:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/manage-files-in-cloud-drive.png#lightbox"><img alt="A screenshot of how to manage files in CloudDrive." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/manage-files-in-cloud-drive.png" /></a></p>
<p>Now that your file resides on CloudDrive, you can close the session and open another session on a different device and still access the same file. Cloud Shell also lets you map an Azure Storage File Share, which is tied to a specific region. Access to an Azure File Share lets you work with the contents of that share through Cloud Shell.</p>
<p>If you need to edit scripts hosted on the CloudDrive or File Share, you can use the Cloud Shell editor. Select the curly brackets {} icon on the browser and open the file you want to edit, or use the command <code>code</code> and specify the filename; for example:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>code temp.txt
</code></pre></div>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/cloud-shell-edit-scripts.png#lightbox"><img alt="A screenshot of how to access the Cloud Shell editor mode." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/cloud-shell-edit-scripts.png" /></a></p>
<p>Note</p>
<p>The <code>code</code> command only works in the Classic mode in Cloud Shell. To enable Classic mode, select the <strong>More</strong> icon (<strong>...</strong>), then select <strong>Settings</strong> &gt; <strong>Go to Classic version</strong>.</p>
<h3 id="cloud-shell-tools"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#cloud-shell-tools">Cloud Shell tools</a></h3>
<p>If you need to manage resources (such as Docker containers or Kubernetes Clusters) or want to use non-Microsoft tools (such as Ansible and Terraform) in Cloud Shell, the Cloud Shell session comes with these add-ons already preconfigured.</p>
<p>Here’s a list of all add-ons available to you within a Cloud Shell session:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Linux tools</strong></td>
<td>bash  <br>zsh  <br>sh  <br>tmux  <br>dig</td>
</tr>
<tr>
<td><strong>Azure tools</strong></td>
<td>Azure CLI and <a href="https://github.com/Azure/azure-xplat-cli">Azure classic CLI</a>  <br>AzCopy  <br>Azure Functions CLI  <br>Service Fabric CLI  <br>Batch Shipyard  <br>blobxfer</td>
</tr>
<tr>
<td><strong>Text editors</strong></td>
<td>code (Cloud Shell editor)  <br>vim  <br>nano  <br>emacs</td>
</tr>
<tr>
<td><strong>Source control</strong></td>
<td>git</td>
</tr>
<tr>
<td><strong>Build tools</strong></td>
<td>make  <br>maven  <br>npm  <br>pip</td>
</tr>
<tr>
<td><strong>Containers</strong></td>
<td>Docker Machine  <br>Kubectl  <br>Helm  <br>DC/OS CLI</td>
</tr>
<tr>
<td><strong>Databases</strong></td>
<td>MySQL client  <br>PostgreSql client  <br>sqlcmd Utility  <br>mssql-scripter</td>
</tr>
<tr>
<td><strong>Other</strong></td>
<td>iPython Client  <br>Cloud Foundry CLI  <br>Terraform  <br>Ansible  <br>Chef InSpec  <br>Puppet Bolt  <br>HashiCorp Packer  <br>Office 365 CLI</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="when-should-you-use-azure-cloud-shell"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#when-should-you-use-azure-cloud-shell">When should you use Azure Cloud Shell?</a></h2>
<p>As an IT Admin for Contoso Corporation, you need alternatives to interact with Azure resources from the command line even when not using your default administrative device.</p>
<p>You can use Azure Cloud Shell to:</p>
<ul>
<li>Open a secure command-line session from any browser-based device.</li>
<li>Interact with Azure resources without the need to install plug-ins or add-ons to your device.</li>
<li>Persist files between sessions for later use.</li>
<li>Use either Bash or PowerShell, whichever you prefer, to manage Azure resources.</li>
<li>Edit files (such as scripts) via the Cloud Shell editor.</li>
</ul>
<p>You shouldn't use Azure Cloud Shell if:</p>
<ul>
<li>You intend to leave a session open for more than 20 minutes for long running scripts or activities. In these cases, your session is disconnected without warning, and the current state is lost.</li>
<li>You need admin permissions, such as sudo access, from within the Azure CLI or PowerShell environment.</li>
<li>You need to install tools that aren't supported in the limited Cloud Shell environment, but instead require an environment such as a custom virtual machine or container.</li>
<li>You need storage from different regions. You might need to back up and synchronize this content since only one region can have the storage allocated to Azure Cloud Shell.</li>
<li>You need to open multiple sessions at the same time. Azure Cloud Shell allows only one instance at time and isn't suitable for concurrent work across multiple subscriptions or tenants.</li>
</ul>
<hr />
<h2 id="introduction-to-bash"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#introduction-to-bash">Introduction to Bash</a></h2>
<h2 id="introduction"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#introduction">Introduction</a></h2>
<p>Imagine you just started a new job as a system administrator (sysadmin) at Northwind, a high-frequency trading (HFT) firm that runs Windows on its client computers and Linux on its server computers. Computers are the lifeblood of the company, and you need to learn more about how to manage Linux boxes. It's time to skill up!</p>
<p>Bash is the standard shell scripting language for Linux. Let's learn the basics of Bash, starting with the syntax and commonly used commands, like <code>ls</code> and <code>cat</code>.</p>
<h2 id="what-is-bash"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#what-is-bash">What is Bash?</a></h2>
<p>Bash is a vital tool for managing Linux machines. The name is short for "<strong>B</strong>ourne <strong>A</strong>gain <strong>Sh</strong>ell."</p>
<p>A shell is a program that commands the operating system to perform actions. You can enter commands in a console on your computer and run the commands directly, or you can use scripts to run batches of commands. Shells like PowerShell and Bash give system administrators the power and precision they need for fine-tuned control of the computers they're responsible for.</p>
<p>There are other Linux shells, including csh and zsh, but Bash became the de facto Linux standard. That's because Bash is compatible with Unix's first serious shell, the Bourne shell, also known as sh. Bash incorporates the best features of its predecessors. But Bash also has some fine features of its own, including built-in commands and the ability to invoke external programs.</p>
<p>One reason for Bash's success is its simplicity. Bash, like the rest of Linux, is based on the Unix design philosophy. As Peter Salus summarized in his book <em>A Quarter Century of Unix</em>, three of the "big ideas" embodied in Unix are:</p>
<ul>
<li>Programs do one thing and do it well</li>
<li>Programs work together</li>
<li>Programs use text streams as the universal interface</li>
</ul>
<p>The last part is key to understanding how Bash works. In Unix and Linux, everything is a file. That means you can use the same commands without worrying about whether the I/O stream—the input and output—comes from a keyboard, a disk file, a socket, a pipe, or another I/O abstraction.</p>
<p>Let's learn the basics of Bash, starting with the syntax and commonly used commands, like <code>ls</code> and <code>cat</code>.</p>
<hr />
<h2 id="bash-fundamentals"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#bash-fundamentals">Bash fundamentals</a></h2>
<p>An understanding of Bash starts with an understanding of Bash syntax. After you know the syntax, you can apply it to every Bash command you run.</p>
<p>The full syntax for a Bash command is:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>command [options] [arguments]
</code></pre></div>
<p>Bash treats the first string it encounters as a command. The following command uses Bash's <code>ls</code> (for "list") command to display the contents of the current working directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls
</code></pre></div>
<p>Arguments often accompany Bash commands. For example, you can include a path name in an <code>ls</code> command to list the contents of another directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls /etc
</code></pre></div>
<p>Most Bash commands have options for modifying how they work. Options, also called <em>flags</em>, give a command more specific instructions. As an example, files and directories whose names begin with a period are hidden from the user and aren't displayed by <code>ls</code>. However, you can include the <code>-a</code> (for "all") flag in an <code>ls</code> command and see everything in the target directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls -a /etc
</code></pre></div>
<p>You can even combine flags for brevity. For example, rather than enter <code>ls -a -l /etc</code> to show all files and directories in Linux's <strong>/etc</strong> directory in long form, you can enter this instead:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls -al /etc
</code></pre></div>
<p>Bash is concise. It's sometimes remarkable (and a point of pride among Bash aficionados) how much you can accomplish with a single command.</p>
<h3 id="get-help"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#get-help">Get help</a></h3>
<p>Which options and arguments can be used, or must be used, varies from command to command. Fortunately, Bash documentation is built into the operating system. Help is never more than a command away. To learn about the options for a command, use the <code>man</code> (for "manual") command. For instance, to see all the options for the <code>mkdir</code> ("make directory") command, do this:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>man mkdir
</code></pre></div>
<p><code>man</code> is your best friend as you learn Bash. <code>man</code> is how you find the information you need to understand how any command works.</p>
<p>Most Bash and Linux commands support the <code>--help</code> option. This shows a description of the command's syntax and options. To demonstrate, enter <code>mkdir --help</code>. The output looks something like this:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Usage: mkdir [OPTION]... DIRECTORY...
Create the DIRECTORY(ies), if they do not already exist.

Mandatory arguments to long options are mandatory for short options too.
  -m, --mode=MODE   set file mode (as in chmod), not a=rwx - umask
  -p, --parents     no error if existing, make parent directories as needed
  -v, --verbose     print a message for each created directory
  -Z                   set SELinux security context of each created directory
                         to the default type
      --context[=CTX]  like -Z, or if CTX is specified then set the SELinux
                         or SMACK security context to CTX
      --help     display this help and exit
      --version  output version information and exit

GNU coreutils online help: &lt;http://www.gnu.org/software/coreutils/&gt;
Report mkdir translation bugs to &lt;http://translationproject.org/team/&gt;
Full documentation at: &lt;http://www.gnu.org/software/coreutils/mkdir&gt;
or available locally via: info &#39;(coreutils) mkdir invocation&#39;
</code></pre></div>
<p>Help obtained this way is typically more concise than help obtained with <code>man</code>.</p>
<h3 id="use-wildcards"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#use-wildcards">Use wildcards</a></h3>
<p>Wildcards are symbols that represent one or more characters in Bash commands. The most frequently used wildcard is the asterisk. It represents zero characters or a sequence of characters. Suppose your current directory contains hundreds of image files, but you only want to see the PNG files; the ones whose file names end with <strong>.png</strong>. Here's the command to list only those files:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls *.png
</code></pre></div>
<p>Note</p>
<p>Linux has no formal concept of a file-name extension as other operating systems do. This doesn't mean that PNG files won't have a <strong>.png</strong> extension. It simply means Linux attaches no special significance to the fact that the file names end with <strong>.png</strong>.</p>
<p>Now let's say the current directory also contains JPEG files. Some end in <strong>.jpg</strong>, while others end in <strong>.jpeg.</strong> Here's one way to list all the JPEG files:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls *.jpg *.jpeg
</code></pre></div>
<p>And here's another:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls *.jp*g
</code></pre></div>
<p>The <code>*</code> wildcard matches on zero or more characters, but the <code>?</code> wildcard represents a single character. If the current directory contains files named <strong>0001.jpg</strong>, <strong>0002.jpg</strong>, and so on through <strong>0009.jpg</strong>, the following command lists them all:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls 000?.jpg
</code></pre></div>
<p>Yet another way to use wildcards to filter output is to use square brackets, which denote groups of characters. The following command lists all the files in the current directory whose names contain a period immediately followed a lowercase J or P. It lists all the <strong>.jpg</strong>, <strong>.jpeg</strong>, and <strong>.png</strong> files, but not <strong>.gif</strong> files:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls *.[jp]*
</code></pre></div>
<p>In Linux, file names and the commands that operate upon them are case-sensitive. So to list all the files in the current directory whose names contain periods followed by an uppercase <em>or</em> lowercase J or P, you could enter this:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls *.[jpJP]*
</code></pre></div>
<p>Expressions in square brackets can represent ranges of characters. For example, the following command lists all the files in the current directory whose names begin with a lowercase letter:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls [a-z]*
</code></pre></div>
<p>This command, by contrast, lists all the files in the current directory whose names begin with an uppercase letter:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls [A-Z]*
</code></pre></div>
<p>And this one lists all the files in the current directory whose names begin with a lowercase <em>or</em> uppercase letter:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls [a-zA-Z]*
</code></pre></div>
<p>Based on all this, can you guess what the following commands do?</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls [0-9]*
ls *[0-9]*
ls *[0-9]
</code></pre></div>
<p>If you need to use one of the wildcard characters as an ordinary character, you make it literal or "escape it" by prefacing it with a backslash. So, if for some reason you had an asterisk as part of a file name—something you should never do intentionally—you could search for it by using a command such as:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>$ ls *\**
</code></pre></div>
<hr />
<h2 id="bash-commands-and-operators"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#bash-commands-and-operators">Bash commands and operators</a></h2>
<p>Every shell language has its most-used commands. Let's start building your Bash repertoire by examining the most commonly used commands.</p>
<h3 id="bash-commands"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#bash-commands">Bash commands</a></h3>
<p>Let's look at common Bash commands and how to use them.</p>
<h4 id="ls-command"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#ls-command"><code>ls</code> command</a></h4>
<p><code>ls</code> lists the contents of your current directory or the directory specified in an argument to the command. By itself, it lists the files and directories in the current directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls
</code></pre></div>
<p>Files and directories whose names begin with a period are hidden by default. To include these items in a directory listing, use an <code>-a</code> flag:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls -a
</code></pre></div>
<p>To get even more information about the files and directories in the current directory, use an <code>-l</code> flag:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls -l
</code></pre></div>
<p>Here's some sample output from a directory that contains a handful of JPEGs and PNGs and a subdirectory named <strong>gifs</strong>:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>-rw-rw-r-- 1 azureuser azureuser  473774 Jun 13 15:38 0001.png
-rw-rw-r-- 1 azureuser azureuser 1557965 Jun 13 14:43 0002.jpg
-rw-rw-r-- 1 azureuser azureuser  473774 Mar 26 09:21 0003.png
-rw-rw-r-- 1 azureuser azureuser 4193680 Jun 13 09:40 0004.jpg
-rw-rw-r-- 1 azureuser azureuser  423325 Jun 10 12:53 0005.jpg
-rw-rw-r-- 1 azureuser azureuser 2278001 Jun 12 04:21 0006.jpg
-rw-rw-r-- 1 azureuser azureuser 1220517 Jun 13 14:44 0007.jpg
drwxrwxr-x 2 azureuser azureuser    4096 Jun 13 20:16 gifs
</code></pre></div>
<p>Each line provides detailed information about the corresponding file or directory. That information includes the permissions assigned to it, its owner, its size in bytes, the last time it was modified, and the file or directory name.</p>
<h4 id="cat-command"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#cat-command"><code>cat</code> command</a></h4>
<p>Suppose you want to see what's inside a file. You can use the <code>cat</code> command for that. The output won't make much sense unless the file is a text file. The following command shows the contents of the <strong>os-release</strong> file stored in the <strong>/etc</strong> directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cat /etc/os-release
</code></pre></div>
<p>This is a useful command because it tells you which Linux distribution you're running:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>NAME=&quot;Ubuntu&quot;
VERSION=&quot;18.04.2 LTS (Bionic Beaver)&quot;
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME=&quot;Ubuntu 18.04.2 LTS&quot;
VERSION_ID=&quot;18.04&quot;
HOME_URL=&quot;https://www.ubuntu.com/&quot;
SUPPORT_URL=&quot;https://help.ubuntu.com/&quot;
BUG_REPORT_URL=&quot;https://bugs.launchpad.net/ubuntu/&quot;
PRIVACY_POLICY_URL=&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;
VERSION_CODENAME=bionic
UBUNTU_CODENAME=bionic
</code></pre></div>
<p>The <strong>/etc</strong> directory is a special one in Linux. It contains system-configuration files. You don't want to delete any files from this directory unless you know what you're doing.</p>
<h4 id="sudo-command"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#sudo-command"><code>sudo</code> command</a></h4>
<p>Some Bash commands can only be run by the root user; a system administrator or superuser. If you try one of these commands without sufficient privileges, it fails. For example, only users logged in as a superuser can use <code>cat</code> to display the contents of <strong>/etc/at.deny</strong>:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cat /etc/at.deny
</code></pre></div>
<p><strong>at.deny</strong> is a special file that determines who can use other Bash commands to submit jobs for later execution.</p>
<p>You don't want to run as root most of the time; it's too dangerous. To run commands that require admin privilege without logging in as a superuser, you'll preface the commands with <code>sudo</code>:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>sudo cat /etc/at.deny
</code></pre></div>
<p><code>sudo</code> stands for "superuser do." When you use it, you're telling the shell that for this one command, you're acting with the root-user level of permission.</p>
<h4 id="cd-mkdir-and-rmdir-commands"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#cd-mkdir-and-rmdir-commands"><code>cd</code>, <code>mkdir</code>, and <code>rmdir</code> commands</a></h4>
<p><code>cd</code> stands for "change directory," and it does exactly what the name suggests: it changes the current directory to another directory. It enables you to move from one directory to another just like its counterpart in Windows. The following command changes to a subdirectory of the current directory named <strong>orders</strong>:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cd orders
</code></pre></div>
<p>You can move up a directory by specifying <code>..</code> as the directory name:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cd ..
</code></pre></div>
<p>This command changes to your home directory; the one you land in when you first sign in:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cd ~
</code></pre></div>
<p>You can create directories by using the <code>mkdir</code> command. The following command creates a subdirectory named <strong>orders</strong> in the current working directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>mkdir orders
</code></pre></div>
<p>If you want to create a subdirectory and another subdirectory under it with one command, use the <code>--parents</code> flag:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>mkdir --parents orders/2019
</code></pre></div>
<p>The <code>rmdir</code> command deletes (removes) a directory, but only if it's empty. If it's not empty, you get a warning instead. Fortunately, you can use the <code>rm</code> command to delete directories that aren't empty in combination with the <code>-r</code> (recursive) flag. The command would then look like so, <code>rm -r</code>.</p>
<h4 id="rm-command"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#rm-command"><code>rm</code> command</a></h4>
<p>The <code>rm</code> command is short for "remove." As you'd expect, <code>rm</code> deletes files. So this command puts an end to <strong>0001.jpg</strong>:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>rm 0001.jpg
</code></pre></div>
<p>And this command deletes all the files in the current directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>rm *
</code></pre></div>
<p>Be wary of <code>rm</code>. It's a dangerous command.</p>
<p>Running <code>rm</code> with a <code>-i</code> flag lets you think before you delete:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>rm -i *
</code></pre></div>
<p>Make it a habit to include <code>-i</code> in every <code>rm</code> command, and you might avoid falling victim to one of Linux's biggest blunders. The dreaded <code>rm -rf /</code> command deletes every file on an entire drive. It works by recursively deleting all the subdirectories of root and their subdirectories. The <code>-f</code> (for "force") flag compounds the problem by suppressing prompts. <em>Don't do this.</em></p>
<p>If you want to delete a subdirectory named <strong>orders</strong> that isn't empty, you can use the <code>rm</code> command this way:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>rm -r orders
</code></pre></div>
<p>This deletes the <strong>orders</strong> subdirectory and everything in it, including other subdirectories.</p>
<h4 id="cp-command"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#cp-command"><code>cp</code> command</a></h4>
<p>The <code>cp</code> command copies not just files, but entire directories (and subdirectories) if you want. To make a copy of <strong>0001.jpg</strong> named <strong>0002.jpg</strong>, use this command:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cp 0001.jpg 0002.jpg
</code></pre></div>
<p>If <strong>0002.jpg</strong> already exists, Bash silently replaces it. That's great if it's what you intended, but not so wonderful if you didn't realize you were about to overwrite the old version.</p>
<p>Fortunately, if you use the <code>-i</code> (for "interactive") flag, Bash warns you before deleting existing files. This is safer:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cp -i 0001.jpg 0002.jpg
</code></pre></div>
<p>You can use wildcards to copy several files at once. To copy all the files in the current directory to a subdirectory named <strong>photos</strong>, do this:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cp * photos
</code></pre></div>
<p>To copy all the files in a subdirectory named <strong>photos</strong> into a subdirectory named <strong>images</strong>, do this:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cp photos/* images
</code></pre></div>
<p>This assumes that the <strong>images</strong> directory already exists. If it doesn't, you can create it <em>and</em> copy the contents of the <strong>photos</strong> directory by using this command:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cp -r photos images
</code></pre></div>
<p>The <code>-r</code> stands for "recursive." An added benefit of the <code>-r</code> flag is that if <strong>photos</strong> contains subdirectories of its own, they too are copied to the <strong>images</strong> directory.</p>
<h4 id="ps-command"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#ps-command"><code>ps</code> command</a></h4>
<p>The <code>ps</code> command gives you a snapshot of all the currently running processes. By itself, with no arguments, it shows all your shell processes; in other words, not much. But it's a different story when you include a <code>-e</code> flag:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps -e
</code></pre></div>
<p><code>-e</code> lists <em>all</em> running processes, and there are typically many of them.</p>
<p>For a more comprehensive look at what processes are running in the system, use the <code>-ef</code> flag:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps -ef 
</code></pre></div>
<p>This flag shows the names of all the running processes, their process identification numbers (PIDs), the PIDs of their parents (PPIDs), and when they began (STIME). It also shows what terminal, if any, they're attached to (TTY), how much CPU time they've racked up (TIME), and their full path names. Here's an abbreviated example:</p>
<p>Copy</p>
<div class="highlight"><pre><span></span><code>UID         PID   PPID  C STIME TTY          TIME CMD
root          1      0  0 13:35 ?        00:00:03 /sbin/init
root          2      0  0 13:35 ?        00:00:00 [kthreadd]
root          3      2  0 13:35 ?        00:00:00 [rcu_gp]
root          4      2  0 13:35 ?        00:00:00 [rcu_par_gp]
root          5      2  0 13:35 ?        00:00:00 [kworker/0:0-cgr]
root          6      2  0 13:35 ?        00:00:00 [kworker/0:0H-kb]
root          8      2  0 13:35 ?        00:00:00 [mm_percpu_wq]
root          9      2  0 13:35 ?        00:00:01 [ksoftirqd/0]
root         10      2  0 13:35 ?        00:00:02 [rcu_sched]
</code></pre></div>
<p>As an aside, you might find documentation that shows <code>ps</code> being used this way:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps aux
</code></pre></div>
<p><code>ps aux</code> and <code>ps -ef</code> are the same. This duality traces back to historical differences between POSIX Unix systems (of which Linux is one) and BSD Unix systems (the most common of which is macOS). In the beginning, POSIX used <code>-ef</code> while the BSD required <code>aux</code>. Today, both operating-system families accept either format.</p>
<p>This serves as an excellent reminder of why you should look closely at the manual for all Linux commands. Learning Bash is like learning English as a second language. There are many exceptions to the rules.</p>
<h4 id="w-command"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#w-command"><code>w</code> command</a></h4>
<p>Users come, users go, and sometimes you get users you don't want at all. When an employee leaves to pursue other opportunities, the sysadmin is called upon to ensure that the worker can no longer sign in to the company's computer systems. Sysadmins are also expected to know who's logged in, and who shouldn't be.</p>
<p>To find out who's on your servers, Linux provides the <code>w</code> (for "who") command. It displays information about the users currently on the computer system and those users' activities. <code>w</code> shows user names, their IP addresses, when they logged in, what processes they're currently running, and how much time those processes are consuming. It's a valuable tool for sysadmins.</p>
<h3 id="bash-io-operators"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#bash-io-operators">Bash I/O operators</a></h3>
<p>You can do a lot in Linux just by exercising Bash commands and their many options. But you can really get work done when you combine commands by using I/O operators:</p>
<ul>
<li><code>&lt;</code> for redirecting input to a source other than the keyboard</li>
<li><code>&gt;</code> for redirecting output to destination other than the screen</li>
<li><code>&gt;&gt;</code> for doing the same, but appending rather than overwriting</li>
<li><code>|</code> for piping output from one command to the input of another</li>
</ul>
<p>Suppose you want to list everything in the current directory but capture the output in a file named <strong>listing.txt</strong>. The following command does just that:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls &gt; listing.txt
</code></pre></div>
<p>If <strong>listing.txt</strong> already exists, it gets overwritten. If you use the <code>&gt;&gt;</code> operator instead, the output from <code>ls</code> is appended to what's already in <strong>listing.txt</strong>:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls &gt;&gt; listing.txt
</code></pre></div>
<p>The piping operator is powerful (and often used). It redirects the output of the first command to the input of the second command. Let's say you use <code>cat</code> to display the contents of a large file, but the content scrolls by too quickly for you to read. You can make the output more manageable by piping the results to another command such as <code>more</code>. The following command lists all the currently running processes. But once the screen is full, the output pauses until you select <strong>Enter</strong> to show the next line:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps -ef | more
</code></pre></div>
<p>You can also pipe output to <code>head</code> to see just the first several lines:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps -ef | head
</code></pre></div>
<p>Or suppose you want to filter the output to include only the lines that contain the word "daemon." One way to do that is by piping the output from <code>ps</code> to Linux's useful <code>grep</code> tool:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps -ef | grep daemon
</code></pre></div>
<p>The output might look like this:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>azureus+  52463  50702  0 23:28 pts/0    00:00:00 grep --color=auto deamon
azureuser@bash-vm:~$ ps -ef | grep daemon
root        449      1  0 13:35 ?        00:00:17 /usr/lib/linux-tools/4.18.0-1018-azure/hv_kvp_daemon -n
root        988      1  0 13:35 ?        00:00:00 /usr/lib/accountsservice/accounts-daemon
message+   1002      1  0 13:35 ?        00:00:00 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only
daemon     1035      1  0 13:35 ?        00:00:00 /usr/sbin/atd -f
root       1037      1  0 13:35 ?        00:00:00 /usr/bin/python3 -u /usr/sbin/waagent -daemon
root       1039      1  0 13:35 ?        00:00:00 /usr/lib/linux-tools/4.18.0-1018-azure/hv_vss_daemon -n
azureus+  52477  50702  0 23:28 pts/0    00:00:00 grep --color=auto daemon
</code></pre></div>
<p>You can also use files as input. By default, standard input comes from the keyboard, but it too can be redirected. To get input from a file instead of the keyboard, use the <code>&lt;</code> operator. One common sysadmin task is to sort the contents of a file. As the name suggests, <code>sort</code> sorts text in alphabetical order:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>sort &lt; file.txt
</code></pre></div>
<p>To save the sorted results to a new file, you can redirect input <em>and</em> output:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>sort &lt; file.txt &gt; sorted_file.txt
</code></pre></div>
<p>You can use I/O operators to chain Linux commands as needed. Consider the following command:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cat file.txt | fmt | pr | lpr
</code></pre></div>
<p>The output from <code>cat</code> goes to <code>fmt</code>, the output from <code>fmt</code> goes to <code>pr</code>, and so on. <code>fmt</code> formats the results into a tidy paragraph. <code>pr</code> paginates the results. And <code>lpr</code> sends the paginated output to the printer. All in a single line!</p>
<hr />
<h2 id="introduction-to-powershell"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#introduction-to-powershell">Introduction to PowerShell</a></h2>
<p>PowerShell is a command-line shell and a scripting language all in one. It was designed as a task engine that uses cmdlets to wrap tasks that people need to do. In PowerShell, you can run commands on local or remote machines. You can do tasks like managing users and automating workflows.</p>
<p>Whether you're part of an operations team or a development team that's adopting DevOps principles, PowerShell can help. You can use it to address various tasks, such as managing cloud resources and continuous integration and continuous delivery (CI/CD). PowerShell offers many helpful commands, but you can expand its capabilities at any time by installing modules.</p>
<p>When you install PowerShell, you can evaluate its features to see if it's a good fit for your team.</p>
<h2 id="what-is-powershell"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#what-is-powershell">What is PowerShell?</a></h2>
<p>PowerShell consists of two parts: a command-line shell and a scripting language. It started out as a framework to automate administrative tasks in Windows. PowerShell has grown into a cross-platform tool that's used for many kinds of tasks.</p>
<p>A command-line shell lacks a graphical interface, where you use a mouse to interact with graphical elements. Instead, you type text commands into a computer console. Here are some of the benefits of using a console:</p>
<ul>
<li>Interacting with a console is often faster than using a graphical interface.</li>
<li>In a console, you can run batches of commands, so it's ideal for task automation for continuous-integration pipelines.</li>
<li>You can use a console to interact with cloud resources and other resources.</li>
<li>You can store commands and scripts in a text file and use a source-control system. This capability is probably one of the biggest benefits, because your commands are repeatable and auditable. In many systems, especially government systems, everything must be traced and evaluated, or <em>audited</em>. Audits cover everything from database changes to changes done by a script.</li>
</ul>
<h3 id="features"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#features">Features</a></h3>
<p>PowerShell shares some features with traditional shells:</p>
<ul>
<li><strong>Built-in help system</strong>: Most shells have some kind of help system, in which you can learn more about a command. For example, you can learn what the command does and what parameters it supports. The help system in PowerShell provides information about commands and also integrates with online help articles.</li>
<li><strong>Pipeline</strong>: Traditional shells use a pipeline to run many commands sequentially. The output of one command is the input for the next command. PowerShell implements this concept like traditional shells, but it differs because it operates on objects over text. You learn more about this feature later in this module.</li>
<li><strong>Aliases</strong>: Aliases are alternate names that can be used to run commands. PowerShell supports the use of common aliases such as <code>cls</code> (clear the screen) and <code>ls</code> (list the files). Therefore, new users can use their knowledge of other frameworks and don't necessarily have to remember the PowerShell name for familiar commands.</li>
</ul>
<p>PowerShell differs from a traditional command-line shell in a few ways:</p>
<ul>
<li><strong>It operates on objects over text.</strong> In a command-line shell, you have to run scripts whose output and input might differ, so you end up spending time formatting the output and extracting the data you need. By contrast, in PowerShell you use objects as input and output. That means you spend less time formatting and extracting.</li>
<li><strong>It has cmdlets.</strong> Commands in PowerShell are called cmdlets (pronounced <em>commandlets</em>). In PowerShell, cmdlets are built on a common runtime rather than separate executables as they are in many other shell environments. This characteristic provides a consistent experience in parameter parsing and pipeline behavior. Cmdlets typically take object input and return objects. The core cmdlets in PowerShell are built in .NET Core, and are open source. You can extend PowerShell by using more cmdlets, scripts, and functions from the community and other sources, or you can build your own cmdlets in .NET Core or PowerShell.</li>
<li><strong>It has many types of commands.</strong> Commands in PowerShell can be native executables, cmdlets, functions, scripts, or aliases. Every command you run belongs to one of these types. The words <em>command</em> and <em>cmdlet</em> are often used interchangeably, because a cmdlet is a type of command.</li>
</ul>
<h3 id="installation"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#installation">Installation</a></h3>
<p>In this module, you practice using PowerShell on your computer. PowerShell is available across platforms. However, if you use a computer that runs Linux, macOS, or an older version of Windows, you need to install it.</p>
<p>Instructions for installing PowerShell are different for each OS. Before you continue, take a few minutes to install PowerShell or to verify your PowerShell installation. The next unit in this module shows you how to verify your installation.</p>
<h4 id="windows"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#windows">Windows</a></h4>
<p>If you're running Windows 8 or later, a version of PowerShell called <em>Windows PowerShell</em> should already be installed. This version differs slightly from the most up-to-date PowerShell release, but it works fine for learning purposes.</p>
<p>You can open Windows PowerShell from the Start menu.</p>
<h4 id="other-operating-systems"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#other-operating-systems">Other operating systems</a></h4>
<p>If your computer runs something other than Windows 8 or later, you need to install PowerShell. To find the installation instructions for your OS, see <a href="https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell">Install various versions of PowerShell</a>.</p>
<h4 id="powershell-extension-for-visual-studio-code"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#powershell-extension-for-visual-studio-code">PowerShell extension for Visual Studio Code</a></h4>
<p>We recommend that you use the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell">PowerShell extension for Visual Studio Code</a> to author your PowerShell scripts and to run the commands in this module. This extension lets you run commands, and also helps you with snippets, code completion, and syntax highlighting.</p>
<hr />
<h2 id="locate-commands"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#locate-commands">Locate commands</a></h2>
<p>A <em>cmdlet</em> (pronounced "command-let") is a compiled command. A cmdlet can be developed in .NET or .NET Core and invoked as a command within PowerShell. Thousands of cmdlets are available in your PowerShell installation. The challenge lies in discovering what the cmdlets are and what they can do for you.</p>
<p>Cmdlets are named according to a verb-noun naming standard. This pattern can help you to understand what they do and how to search for them. It also helps cmdlet developers create consistent names. You can see the list of approved verbs by using the <code>Get-Verb</code> cmdlet. Verbs are organized according to activity type and function.</p>
<p>Here's a part of the output from running <code>Get-Verb</code>:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Verb        AliasPrefix Group          Description
----        ----------- -----          -----------
Add         a           Common         Adds a resource to a container, or atta…
Clear       cl          Common         Removes all the resources from a contai…
</code></pre></div>
<p>This listing shows the verb and its description. Cmdlet developers should use an approved verb, and also ensure that the verb description fits their cmdlet's function.</p>
<p>Three core cmdlets allow you to delve into what cmdlets exist and what they do:</p>
<ul>
<li><strong>Get-Command</strong>: The <code>Get-Command</code> cmdlet lists all of the available cmdlets on your system. Filter the list to quickly find the command you need.</li>
<li><strong>Get-Help</strong>: Run the <code>Get-Help</code> core cmdlet to invoke a built-in help system. You can also run an alias <code>help</code> command to invoke <code>Get-Help</code> but improve the reading experience by paginating the response.</li>
<li><strong>Get-Member</strong>: When you call a command, the response is an object that contains many properties. Run the <code>Get-Member</code> core cmdlet to drill down into that response and learn more about it.</li>
</ul>
<h3 id="locate-commands-by-using-get-command"><a class="toclink" href="2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#locate-commands-by-using-get-command">Locate commands by using Get-Command</a></h3>
<p>When you run the <code>Get-Command</code> cmdlet in Cloud Shell, you get a list of every command that's installed in PowerShell. Because thousands of commands are installed, you need a way to filter the response so you can quickly locate the command that you need.</p>
<p>To filter the list, keep in mind the verb-noun naming standard for cmdlets. For example, in the <code>Get-Random</code> command, <code>Get</code> is the verb and <code>Random</code> is the noun. Use flags to target either the verb or the noun in the command you want. The flag you specify expects a value that's a string. You can add pattern-matching characters to that string to ensure you express that, for example, a flag's value should start or end with a certain string.</p>
<p>These examples show how to use flags to filter a command list:</p>
<ul>
<li>
<p><strong>-Noun</strong>: The <code>-Noun</code> flag targets the part of the command name that's related to the noun. Here's a typical search for a command name using <em>alias</em> as the noun for which we're searching:</p>
<p>PowerShellCopy</p>
<div class="highlight"><pre><span></span><code>Get-Command -Noun alias*
</code></pre></div>
<p>This command searches for all cmdlets whose noun part starts with <code>alias</code>.</p>
</li>
<li>
<p><strong>-Verb</strong>: The <code>-Verb</code> flag targets the part of the command name that's related to the verb. You can combine the <code>-Noun</code> flag and the <code>-Verb</code> flag to create an even more detailed search query and type. Here's an example:</p>
<p>PowerShellCopy</p>
<div class="highlight"><pre><span></span><code>Get-Command -Verb Get -Noun alias*
</code></pre></div>
<p>Now you've narrowed the search to specify that the verb part needs to match <code>Get</code>, and the noun part needs to match <code>alias</code>.</p>
</li>
</ul>
<hr />
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>