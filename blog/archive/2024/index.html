
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../">
      
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>2024 - Atoni Brain Washed</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2024" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Atoni Brain Washed" class="md-header__button md-logo" aria-label="Atoni Brain Washed" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Atoni Brain Washed
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2024
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Atoni Brain Washed" class="md-nav__button md-logo" aria-label="Atoni Brain Washed" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Atoni Brain Washed
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Obsidian Notes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Features/LaTeX%20Math%20Support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LaTeX Math Support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Features/Mermaid%20Diagrams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mermaid diagrams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Features/Text%20Formatting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text Formatting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Topic 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Topic 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Topic%201/Note%201/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Note 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Topic%201/Note%202/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Note 2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2024">2024<a class="headerlink" href="#2024" title="Permanent link">&para;</a></h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-11-14 00:00:00">November 14, 2024</time></li>
        
        
          
          <li class="md-meta__item">
            
              87 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="introduction-to-azure-backup"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/">Introduction to Azure Backup</a></h2>
<h2 id="introduction"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction">Introduction</a></h2>
<p>Information technology workers understand the importance of data to the organization. The need to protect that data drives decisions around storage, backups, and security. Many companies implement policies that dictate backup specifications for frequency, duration of backup storage, and restore policies.</p>
<p>For on-premises scenarios, backup solutions might have included local redundant storage solutions or off-site storage. Scenarios using backup to tape drives and storing offsite come with the resulting delay in restoring the data (because of the need to transport the tapes back to the server rooms and from performing the restore operation). This can result in significant downtime.</p>
<p>These backup solutions might not always address some of the most important considerations, such as security of the backups, the potential for the company to be impacted by a ransomware attack, or human error in the backup and restore operations. An ideal solution would be cost-effective, simple to use, and secure. This is where Azure Backup comes in.</p>
<p><img alt="Diagram of a backup scenario with a company's servers and workstations on the left, with files and folders, using the Backup Agent to back up the data to Microsoft Azure storage." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/architecture-on-premises-mars.png" /></p>
<p>Azure Backup can also address scenarios for your Azure environments, with support for:</p>
<ul>
<li>Azure VMs</li>
<li>Azure Managed Disks</li>
<li>Azure Files</li>
<li>SQL Server in Azure VMs</li>
<li>SAP HANA databases in Azure VMs</li>
<li>Azure Database for PostgreSQL servers</li>
<li>Azure Blobs</li>
<li>Azure Database for PostgreSQL - Flexible servers</li>
<li>Azure Database for MySQL - Flexible servers</li>
<li>Azure Kubernetes cluster</li>
</ul>
<h3 id="example-scenario"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#example-scenario">Example scenario</a></h3>
<p>You're running an application powered by SQL Server. The database is running in an always-on availability group across three Azure VMs. You want to back up the databases using an Azure native backup service. You're looking to store the backup for 10 years in cheaper storage for your audit and compliance needs. You'd like to monitor the backup jobs daily for all such databases.</p>
<p><img alt="Diagram of an application using a SQL Server backend database and Azure Backup for data backup scenarios." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/scenario.png" /></p>
<h3 id="what-will-we-be-doing"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#what-will-we-be-doing">What will we be doing?</a></h3>
<p>We'll evaluate the features and capabilities of Azure Backup to help decide if:</p>
<ul>
<li>Azure Backup can offer a solution for your backup needs.</li>
<li>You can back up and restore the data you need for your organization.</li>
<li>Azure Backup offers secure storage of your data.</li>
</ul>
<h3 id="what-is-the-main-goal"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#what-is-the-main-goal">What is the main goal?</a></h3>
<p>By the end of this session, you'll be able to decide if Azure Backup is the right solution to consider for your data-protection needs.</p>
<h2 id="what-is-azure-backup"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#what-is-azure-backup">What is Azure Backup?</a></h2>
<p>Let's start by defining Azure Backup and taking a quick tour of the core features. This overview should help you decide whether Azure Backup might be a good fit for your data-protection needs.</p>
<h3 id="what-is-azure-backup_1"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#what-is-azure-backup_1">What is Azure Backup?</a></h3>
<p>The Azure Backup service provides simple, secure, and cost-effective solutions to back up your data and recover it from the Microsoft Azure cloud.</p>
<p><img alt="Diagram of the Azure Backup service implementing backup agents in the on-premises environment to the cloud. Middle section displays the components of Azure Backup for security and scalability with an underlying bar indicating central management." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/azure-backup-overview.png" /></p>
<h3 id="azure-backup-definition"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#azure-backup-definition">Azure Backup definition</a></h3>
<p>Azure Backup is an Azure service that provides cost effective, secure, and zero-infrastructure backup solutions for all Azure-managed data assets.</p>
<p>The centralized management interface makes it easy to define backup policies and protect a wide range of enterprise workloads, including Azure Virtual Machines, Azure Disks, SQL and SAP databases, Azure file shares, and blobs.</p>
<p><img alt="Diagram of Azure Backup architecture displaying workloads at the bottom, feeding upwards into the data plane, and tying into the management plane. Management contains backup policies, Azure policies, Azure Monitor, and Azure Lighthouse services." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/azure-backup-architecture.png" /></p>
<h3 id="when-to-use-azure-backup"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#when-to-use-azure-backup">When to use Azure Backup</a></h3>
<p>As the IT admin of your organization, you're responsible for meeting the compliance needs for all the data assets of the firm, and backup is a critical aspect. There are also various application admins in your company who need to do self-service backup and restore to take care of issues like data corruption or rogue-admin scenarios. You're looking for an enterprise-class backup solution to protect all your workloads and manage them from a central place.</p>
<p>Azure Backup can provide backup services for the following data assets:</p>
<ul>
<li>On-premises files, folders, and system state</li>
<li>Azure Virtual Machines (VMs)</li>
<li>Azure Managed Disks</li>
<li>Azure Files Shares</li>
<li>SQL Server in Azure VMs</li>
<li>SAP HANA (High-performance Analytic Appliance) databases in Azure VMs</li>
<li>Azure Database for PostgreSQL servers</li>
<li>Azure Blobs</li>
<li>Azure Database for PostgreSQL - Flexible servers</li>
<li>Azure Database for MySQL - Flexible servers</li>
<li>Azure Kubernetes cluster</li>
</ul>
<p><img alt="Screenshot of Azure Backup center displaying a list of backup jobs. The list displays the backup instance, data source, operation type, and status." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/backup-center-jobs.png" /></p>
<h3 id="key-features"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#key-features">Key features</a></h3>
<p>Let's look at some key features of Azure Backup.</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zero-infrastructure backup solution</td>
<td>Unlike conventional backup solutions, no backup server or infrastructure is needed. Similarly, no backup storage needs to be deployed, because Azure Backup automatically manages and scales it.</td>
<td>Zero-infrastructure solution eliminates capital expenses and reduces operational expenses. It increases ease of use by automating storage management.</td>
</tr>
<tr>
<td>At-scale management</td>
<td>Natively manage your entire backup estate from a central console called Backup Center. Use APIs, PowerShell, and Azure CLI to automate Backup policy and security configurations.</td>
<td>Backup center simplifies data protection management at-scale by enabling you to discover, govern, monitor, operate, and optimize backup management from one unified console, which helps you to drive operational efficiency with Azure.</td>
</tr>
<tr>
<td>Security</td>
<td>Azure Backup provides built-in security to your backup environment, both when your data is in transit and at rest by using capabilities encryption, private endpoints, alerts, and so on.</td>
<td>Your backups are automatically secured against ransomware, malicious admins, and accidental deletions.</td>
</tr>
</tbody>
</table>
<h3 id="how-do-recovery-time-objective-and-recovery-point-objective-work"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#how-do-recovery-time-objective-and-recovery-point-objective-work">How do Recovery Time Objective and Recovery Point Objective work?</a></h3>
<p>Recovery Time Objective (RTO) is the target time within which a business process must be restored after a disaster occurs to avoid unacceptable consequences. For instance, if a critical application goes down due to a server failure and the business can only tolerate a maximum of four hours of downtime, then the RTO is four hours.</p>
<p>Recovery Point Objective (RPO) is the maximum amount of data loss, measured in time, that your organization can sustain during an event.</p>
<p>The following example scenario describes both the RPO and RTO concepts:</p>
<p>Your organization has an RPO of one hour for your customer database, which means you perform backups every hour. If a data-loss incident occurs, you lose not more than one hour of data. When you set RTO to three hours, then if a system failure occurs, you aim to restore access to the database within three hours to minimize the impact on operations.</p>
<h2 id="how-azure-backup-works"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#how-azure-backup-works">How Azure Backup works</a></h2>
<p>Let's take a look at how Azure Backup works to provide the data protection you need. Particularly, let's look at how the different aspects of the backup service make it easy to back up various types of data, and how it offers security for your backups as well. In this unit, we cover the following aspects of the Azure Backup Service:</p>
<ul>
<li><strong>Workload integration layer - Backup Extension</strong>: Integration with the actual workload, such as Azure virtual machines (VMs) or Azure Blobs, happens at this layer.</li>
<li><strong>Data Plane - Access Tiers</strong>: There are three access tiers where the backups could be stored:<ul>
<li>Snapshot tier</li>
<li>Standard tier</li>
<li>Archive tier</li>
</ul>
</li>
<li><strong>Data Plane - Availability and Security</strong>: The backup data is replicated across zones or regions, based on the redundancy the user specifies.</li>
<li><strong>Management Plane – Recovery Services vault/Backup vault and Backup center</strong>: The vault provides an interface for the user to interact with the backup service.</li>
</ul>
<h3 id="what-data-is-backed-up-and-how"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#what-data-is-backed-up-and-how">What data is backed up and how?</a></h3>
<p>The simplest explanation of Azure Backup is that it backs up data, machine state, and workloads running on on-premises machines and VM instances to the Azure cloud. Azure Backup stores the backed-up data in Recovery Services vaults and Backup vaults.</p>
<p>For <strong>on-premises</strong> Windows machines, you can back up directly to Azure with the <strong>Azure Backup Microsoft Azure Recovery Services (MARS) agent</strong>. Alternatively, you can back up these Windows machines to a backup server, perhaps a <strong>System Center Data Protection Manager (DPM) or Microsoft Azure Backup Server (MABS).</strong> You can then back that server up to a Recovery Services vault in Azure.</p>
<p>If you're using <strong>Azure VMs</strong>, you can back them up <strong>directly</strong>. <strong>Azure Backup</strong> installs a backup extension to the Azure VM agent that's running on the VM, which allows you to back up the entire VM. If you only want to back up the files and folders on the VM, you can do so by running the <strong>MARS agent.</strong></p>
<p>Azure Backup stores backed-up data in vaults: Recovery Services vaults and Backup vaults. A vault is an online-storage entity in Azure that's used to hold data such as backup copies, recovery points, and backup policies.</p>
<h4 id="supported-backup-types"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#supported-backup-types">Supported backup types</a></h4>
<p>Azure Backup supports full backups and incremental backups. Your initial backup is a full backup. The incremental backup is used by DPM/MABS use the incremental backup for disk backups, and used in all backups to Azure. As the name suggests, incremental backups only focus on the blocks of data that changed since the previous backup.</p>
<p>Azure Backup also supports SQL Server backup types. The following table outlines the support for SQL Server type backups:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Full</td>
<td>A full database backup backs up the entire database. It contains all the data in a specific database or in a set of filegroups or files. A full backup also contains enough logs to recover that data.</td>
<td>At most, you can trigger one full backup per day. You can choose to make a full backup on a daily or weekly interval.</td>
</tr>
<tr>
<td>Differential</td>
<td>A differential backup is based on the most recent full-data backup. It captures only the data that changed since the full backup.</td>
<td>At most, you can trigger one differential backup per day. You can't configure a full backup and a differential backup on the same day.</td>
</tr>
<tr>
<td>Multiple backups per day</td>
<td>Back up Azure VMs hourly with a minimum recovery point objective (RPO) of 4 hours and a maximum of 24 hours.</td>
<td>You can use Enhanced backup policy to set the backup schedule to 4, 6, 8, 12, and 24 hours (respectively) for new Azure offerings, such as Trusted Launch VM.</td>
</tr>
<tr>
<td>Selective disk backup</td>
<td>Selectively back up a subset of the data disks that are attached to your VM, then restore a subset of the disks that are available in a recovery point, both from instant restore and vault tier. Selective disk backup helps you manage critical data in a subset of the VM disks and use database backup solutions when you want to back up only their OS disk to reduce cost.</td>
<td>Azure Backup provides Selective Disk backup and restore capability using Enhanced backup policy.</td>
</tr>
<tr>
<td>Transaction Log</td>
<td>A log backup enables point-in-time restoration up to a specific second.</td>
<td>At most, you can configure transactional log backups every 15 minutes.</td>
</tr>
</tbody>
</table>
<h3 id="workload-integration-layer-backup-extension"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#workload-integration-layer-backup-extension">Workload integration layer - Backup Extension</a></h3>
<p>A backup extension specific to each workload is installed on the source VM or a worker VM. At the time of backup (as defined by the user in the Backup Policy) the backup extension generates the backup, which could be:</p>
<ul>
<li>
<p><strong>Storage</strong>: Snapshots when using an Azure VM or Azure Files.</p>
</li>
<li>
<p><strong>Stream backup</strong>: For databases like SQL or High-performance Analytic Appliance (HANA) running in VMs.</p>
</li>
</ul>
<p>The backup data is eventually transferred to Azure Backup managed storage in the data plane by using secure Azure networks Network Security Groups (NSG), Firewalls, or more sophisticated private endpoints.</p>
<h3 id="data-plane-access-tiers"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#data-plane-access-tiers">Data Plane - Access Tiers</a></h3>
<p>There are three access tiers where the backups can be stored:</p>
<ul>
<li>
<p><strong>Snapshot tier</strong>: (Workload-specific term) In the first phase of a virtual machine backup, the snapshot is taken and stored along with the disk. This form of storage is referred to as a snapshot tier. Restoring a snapshot tier is faster than restoring from a vault, because it eliminates the wait time for snapshots to be copied from the vault before triggering the restore operation. The snapshots of the VM/Azure Files/Azure Blobs/and so on are retained in the customer's subscription in a specified resource group. This container ensures that restores are quick, because the backup/snapshot is available locally to the customer.</p>
</li>
<li>
<p><strong>Vault-standard tier</strong>: Backup data for all workloads supported by Azure Backup is stored in vaults, which hold backup storage, an autoscaling set of storage accounts managed by Azure Backup. The Vault-standard tier is an online storage tier that allows you to store an isolated copy of backup data in a Microsoft-managed tenant, thus creating an extra layer of protection. For workloads where snapshot tier is supported, there's a copy of the backup data in both the snapshot tier and the Vault-standard tier. The Vault-standard tier ensures that backup data is available even if the data source being backed up is deleted or compromised.</p>
</li>
<li>
<p><strong>Archive tier</strong>: Customers rely on Azure Backup for storing backup data, including their Long-Term Retention (LTR) backup data, with retention needs defined in the organization's compliance rules. In most cases, the older backup data is rarely accessed and is only stored for compliance needs.</p>
<p>Azure Backup supports backup of long-term retention points in the archive tier.</p>
</li>
</ul>
<p>All tiers offer different recovery time objectives (RTO) and are priced differently.</p>
<p><img alt="Diagram of the various workloads such as on-premises server, Azure VMs, Azure files, etc. feeding into the data plane where the access tiers are located." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/data-plane.png" /></p>
<h3 id="data-plane-availability-and-security"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#data-plane-availability-and-security">Data Plane - Availability and Security</a></h3>
<p>The backup data is replicated across zones or regions, based on the redundancy you specify. You can choose from locally redundant storage (LRS), Geo-redundant storage (GRS), or zone-redundant storage (ZRS). These options provide you with highly available data storage capabilities.</p>
<p>The data is kept safe by encrypting it and implementing Azure role-based access control (RBAC). You choose who can perform backup and restore operations. Azure Backup also provides protection against malicious deletion of your backup by using soft-delete operations. A deleted backup is stored for 14 days, free of charge, which allows you to recover the backup if needed.</p>
<p>Azure Backup also supports a backup data lifecycle-management scenario that allows you to comply with retention policies.</p>
<p><img alt="Graphic displaying the three security options of Azure RBAC, encryption, and soft delete as icons." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/built-in-security.png" /></p>
<h3 id="management-plane-recovery-services-vaultbackup-vault-and-backup-center"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#management-plane-recovery-services-vaultbackup-vault-and-backup-center">Management Plane – Recovery Services vault/Backup vault and Backup center</a></h3>
<p>Azure Backup uses Recovery Services vaults and Backup vaults to orchestrate and manage backups. It also uses vaults to store backed-up data. The vault provides an interface for the user to interact with the backup service. Azure Backup Policies within each vault define when the backups should get triggered and how long they need to be retained.</p>
<p>You can use a single vault or multiple vaults to organize and manage your backup. If you manage your workloads with a single subscription and single resource, you can use a single vault to monitor and manage your backup estate. If your workloads are spread across multiple subscriptions, you can create multiple vaults with one or more vaults per subscription.</p>
<p><img alt="Diagram of the management plane. The recovery services vault shows the options for backup policies and management with the portal, SDK, or the Command-line interface (CLI)." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/backup-vaults.png" /></p>
<p>Backup center allows you to have a single pane of glass to manage all tasks related to backups. Backup center is designed to function well across a large and distributed Azure environment. You can use Backup center to efficiently manage backups spanning multiple workload types, vaults, subscriptions, regions, and Azure Lighthouse tenants.</p>
<p><img alt="Screenshot of the Backup center user interface in the Azure portal displaying backup information for Azure Virtual machines related to jobs and backup instances." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/backup-center.png" /></p>
<h2 id="when-to-use-azure-backup_1"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#when-to-use-azure-backup_1">When to use Azure Backup</a></h2>
<p>Here, we'll discuss how you can decide if Azure Backup is the right choice for your data-protection needs. We'll highlight common backup scenarios where Azure Backup provides benefits, such as:</p>
<ul>
<li>Ensuring availability of your data.</li>
<li>Protecting your Azure workloads.</li>
<li>Securing your data.</li>
</ul>
<h3 id="decision-criteria"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#decision-criteria">Decision criteria</a></h3>
<p>Azure Backup is an Azure service that provides secure and zero-infrastructure backup solutions for all Azure-managed data assets. It protects a wide range of enterprise workloads, including Azure Virtual Machines, Azure Disks, SQL and SAP databases, and Azure file shares and blobs.</p>
<p>The main criteria that we're evaluating are outlined in the following table. The table contains some key areas where Azure Backup can provide services to you for data protection.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Criteria</th>
<th>Consideration</th>
</tr>
</thead>
<tbody>
<tr>
<td>Azure workloads</td>
<td>Azure VMs, Azure Disks, SQL Server or SAP HANA databases running in Azure VMs, Azure Blobs, Azure Disks, Azure Database for PostgreSQL.</td>
</tr>
<tr>
<td>Compliance</td>
<td>Customer-defined backup policy with long-term retention across multiple zones or regions.</td>
</tr>
<tr>
<td>Operational recoveries</td>
<td>With self-service backup and restores, the application administrator can take care of issues that might arise such as accidental deletion or data corruption.</td>
</tr>
</tbody>
</table>
<h3 id="apply-the-criteria"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#apply-the-criteria">Apply the criteria</a></h3>
<p>In the introduction, we presented a scenario where your organization might have an application that relies on data from a back-end SQL Server installation. SQL Server is running on three Azure VMs. The data in the backup must be retained for up to 10 years to meet compliance requirements. You also want to be able to monitor the backups.</p>
<p>Before we dive into how Azure Backup can help meet these needs, it's important to understand what's not currently supported. If your three Azure VMs are deployed across multiple subscriptions or regions, you should be aware that Azure Backup doesn’t support cross-region backup for most workloads. However, it does support cross-region restore in a paired secondary region.</p>
<h4 id="can-azure-backup-protect-the-azure-vms-hosting-the-sql-server-instances"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#can-azure-backup-protect-the-azure-vms-hosting-the-sql-server-instances">Can Azure Backup protect the Azure VMs hosting the SQL Server instances?</a></h4>
<p>Azure Backup is able to back up entire Windows and Linux VMs using backup extensions. As a result, you can back up the entire VM that hosts SQL Server. If you only want to back up the files, folders, and system state on the Azure VMs, you can use the Microsoft Azure Recovery Services (MARS) agent.</p>
<p>If your main concern is to only back up the SQL Server data, Azure Backup provides support for that as well. Azure Backup offers a stream-based, specialized solution to back up SQL Servers running in Azure VMs. This solution aligns with Azure Backup's benefits of zero-infrastructure backup, long-term retention, and central management.</p>
<p>Additionally, Azure Backup provides the following advantages specifically for SQL Server:</p>
<ul>
<li>Workload aware backups that support all backup types: full, differential, and log</li>
<li>15-minute recovery point objective (RPO) with frequent log backups</li>
<li>Point-in-time recovery up to a second</li>
<li>Individual database-level backup and restore</li>
</ul>
<p><img alt="Diagram of SQL Server hosted on an Azure VM backed up to a Recovery Services Vaults in Azure Backup. Displayed are also a data path and controls arrow depicting two-way flow for the data path and control path flow from Azure Backup to the backup extension on the VM." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-backup/media/azure-backup-sql-overview.png" /></p>
<h4 id="does-azure-backup-help-with-compliance"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#does-azure-backup-help-with-compliance">Does Azure Backup help with compliance?</a></h4>
<p>You can implement required access-control mechanisms for your backups. Vaults (Recovery Services and Backup vaults) provide the management capabilities and are accessible via the Azure portal, Backup Center, Vault dashboards, SDK, CLI, and even REST APIs. It's also an Azure role-based access control (Azure RBAC) boundary, providing you with the option to restrict access to backups only to authorized Backup Admins.</p>
<p>Short-term retention can be <em>minutes</em> or <em>daily</em>. Retention for <em>weekly</em>, <em>monthly</em>, or <em>yearly</em> backup points is referred to as <em>Long-term retention</em>.</p>
<p>Long-term retention can be:</p>
<ul>
<li><strong>Planned (compliance requirements)</strong>: If you know in advance that data is required years from the current time, use Long-term retention.</li>
<li><strong>Unplanned (on-demand requirement)</strong>: If you don't know in advance, then you can use on-demand backup with specific custom retention settings (these custom retention settings aren't impacted by policy settings).</li>
<li><strong>On-demand backup with custom retention</strong>: If you need to take a backup not scheduled via backup policy, then you can use an on-demand backup. It can be useful for taking backups that don’t fit your scheduled backup or for taking granular backup (for example, multiple IaaS VM backups per day since scheduled backup permits only one backup per day). It's important to note that the retention policy defined in scheduled policy doesn't apply to on-demand backups.</li>
</ul>
<p>You can also implement policy management to help with compliance. Azure Backup Policies within each vault define when the backups should be triggered and how long they need to be retained. You can also manage these policies and apply them across multiple items.</p>
<h4 id="does-azure-backup-simplify-monitoring-and-administration"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#does-azure-backup-simplify-monitoring-and-administration">Does Azure Backup simplify monitoring and administration?</a></h4>
<p>For monitoring and reporting, Azure Backup integrates with Log Analytics and provides the ability to see reports via Workbooks.</p>
<p>Azure Backup provides in-built job monitoring for operations such as configuring backup, backing up, restoring, deleting backups, and so on. It's scoped to the vault and ideal for monitoring a single vault.</p>
<p>If you need to monitor operational activities at scale, Backup Explorer provides an aggregated view of your entire backup estate, enabling detailed drill-down analysis and troubleshooting. It's a built-in Azure Monitor workbook that provides a single, central location to help you monitor operational activities across the entire backup estate on Azure, spanning tenants, locations, subscriptions, resource groups, and vaults.</p>
<hr />
<h2 id="configure-azure-monitor"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#configure-azure-monitor">Configure Azure Monitor</a></h2>
<h2 id="introduction_1"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_1">Introduction</a></h2>
<p>Azure Monitor is a comprehensive solution that collects, analyzes, and responds to telemetry data from both on-premises and cloud environments.</p>
<p>Suppose you work for a large e-commerce company that relies heavily on its online platform to generate revenue. During a major sales event, your website experiences a sudden increase in traffic, causing performance issues and impacting customer experience. As a result, customers are unable to complete their purchases. Poor customer experience led to lost sales and had a negative impact on the company's reputation. To prevent this from happening again, you need a tool that can monitor the availability and performance of your applications and services in real-time. With this tool you can quickly identify and resolve issues. Azure Monitor is the solution that can help you achieve this.</p>
<p>In this module, you will learn about the features and usage cases of Azure Monitor. You learn how to configure and interpret metrics and logs. You review the different components and data types in Azure Monitor. You also learn how to access and query the activity log.</p>
<p>The goal of this module is to equip you with the knowledge and skills to effectively use Azure Monitor.</p>
<h3 id="learning-objectives"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify the features and usage cases for Azure Monitor.</li>
<li>Configure and interpret metrics and logs.</li>
<li>Identify the Azure Monitor components and data types.</li>
<li>Configure the Azure Monitor activity Log.</li>
</ul>
<h3 id="skills-measured"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#skills-measured">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#prerequisites">Prerequisites</a></h3>
<ul>
<li>Familiarity with basic monitoring, evaluation, and reporting concepts.</li>
<li>Knowledge of Azure resources and services that benefit from monitoring activities.</li>
<li>Knowledge of the Azure portal so you can implement monitoring techniques.</li>
</ul>
<h2 id="describe-azure-monitor-key-capabilities"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#describe-azure-monitor-key-capabilities">Describe Azure Monitor key capabilities</a></h2>
<p>Azure Monitor provides you with a comprehensive solution for collecting, analyzing, and responding to telemetry data from your on-premises and cloud environments. The service features help you understand how your applications are performing. You can use Azure Monitor to proactively identify issues that affect your apps and resources, and take action to maximize their availability and performance.</p>
<h4 id="things-to-know-about-azure-monitor"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-azure-monitor">Things to know about Azure Monitor</a></h4>
<p>Azure Monitor provides features and capabilities in three areas:</p>
<ul>
<li>
<p><strong>Monitor and visualize metrics</strong>: Azure Monitor gathers numerical metric values from your Azure resources according to your preferences. Azure Monitor offers different methods for viewing your metric data to help you understand the health, operation, and performance of your system.</p>
</li>
<li>
<p><strong>Query and analyze logs</strong>: Azure Monitor Logs (Log Analytics) generates activity logs, diagnostic logs, and telemetry information from your monitoring solutions. The service provides analytics queries that you can use to help with troubleshooting and visualizations of your log data.</p>
</li>
<li>
<p><strong>Set up alerts and actions</strong>: Azure Monitor lets you set up alerts for your gathered data to notify you when critical conditions arise. You can configure actions based on the alert conditions, and take automated corrective steps based on triggers from your metrics or logs.</p>
</li>
</ul>
<h2 id="describe-azure-monitor-components"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#describe-azure-monitor-components">Describe Azure Monitor components</a></h2>
<p>Monitoring is the act of collecting and analyzing data. The data can be used to determine the performance, health, and availability of your business applications and the resources they depend on.</p>
<p>An effective monitoring strategy helps you understand the detailed operation of the components of your applications. Monitoring also helps you increase your uptime by proactively notifying you of critical issues. You can then resolve the issues before they become severe.</p>
<p>Azure includes multiple services that individually perform a specific role or task in the monitoring space. Together, these services deliver a comprehensive solution for collecting, analyzing, and acting on data from your applications and the Azure resources that support them. The services also work to monitor critical on-premises resources to provide a hybrid monitoring environment. Understanding the tools and data that are available is the first step in developing a complete monitoring strategy for your application.</p>
<h4 id="things-to-know-about-monitoring-with-azure"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-monitoring-with-azure">Things to know about monitoring with Azure</a></h4>
<p>Let's take a look at the various Azure components that support Azure Monitor capabilities. The following diagram provides a high-level view of how Azure and Azure Monitor work together to provide you with a robust monitoring and diagnostics solution.</p>
<p><img alt="Diagram that shows the different monitoring and diagnostic services available in Azure as described in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/monitor-service-d0bdfd6d.png" /></p>
<ul>
<li>
<p>The monitoring and diagnostic services offered in Azure are divided into broad <strong>categories</strong> such as Core, Application, Infrastructure, and Shared Capabilities.</p>
</li>
<li>
<p><strong>Data stores</strong> in Azure Monitor hold your metrics and logs. <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/data-platform-metrics">Azure Monitor Metrics</a> and <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/data-platform-logs">Azure Monitor Logs</a> are the two base types of data used by the service.</p>
</li>
<li>
<p>Various <strong>monitoring sources</strong> provide Azure Monitor with the metrics and logs data to analyze. These sources can include your Azure subscription and tenant, your Azure service instances, your Azure resources, data from your applications, and more.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/azure-monitor/insights/insights-overview">Azure Monitor Insights</a> performs different functions with the collected data, including analysis, alerting, and streaming to external systems.</p>
<ul>
<li>
<p><strong>Get insights</strong>: Access the Azure Application Insights extension to Azure Monitor to use the Application Performance Monitoring (APM) features. You can use APM tools to monitor your application performance and gather trace logging data. Application Insights are available for many Azure services, such as Azure Virtual Machines and Azure Virtual Machine Scale Sets, Azure Container Instances, Azure Cosmos DB, and Azure IoT Edge.</p>
</li>
<li>
<p><strong>Visualize</strong>: Utilize the many options in Azure Monitor for viewing and interpreting your gathered metrics and logs. You can use Power BI with the Azure Workbooks feature of Azure Monitor and access configurable dashboards and views.</p>
</li>
<li>
<p><strong>Analyze</strong>: Work with Azure Monitor Logs (Log Analytics) in the Azure portal to write log queries for your data. You can interactively analyze your log data by using Azure Monitor Metrics and the powerful analysis engine.</p>
</li>
<li>
<p><strong>Respond</strong>: Set up log alert rules in Azure Monitor to receive notifications about your application performance. You can configure the service to take automated action when the results of your queries and alerts match certain conditions or results.</p>
</li>
<li>
<p><strong>Integrate</strong>: Ingest and export log query results from the Azure CLI, Azure PowerShell cmdlets, and various APIs. Set up automated export of your log data to your Azure Storage account or Azure Event Hubs. Build workflows to retrieve your log data and copy to external locations with Azure Logic Apps.</p>
</li>
</ul>
</li>
</ul>
<h2 id="define-metrics-and-logs"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#define-metrics-and-logs">Define metrics and logs</a></h2>
<p>All data collected by Azure Monitor fits into one of two fundamental types, <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/platform/data-collection">metrics and logs</a>:</p>
<p><strong>Metrics</strong> are numerical values that describe some aspect of a system at a particular point in time. Metrics are lightweight and capable of supporting near real-time scenarios.</p>
<p><strong>Logs</strong> contain different kinds of data organized into records with different sets of properties for each type. Data like events and traces are stored as logs along with performance data so all the data can be combined for analysis.</p>
<h4 id="things-to-know-about-azure-monitor-metrics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-azure-monitor-metrics">Things to know about Azure Monitor metrics</a></h4>
<p>Let's examine how to work with Azure Monitor metrics in the Azure portal.</p>
<ul>
<li>
<p>For many Azure resources, the metrics data collected by Azure Monitor is displayed on the <strong>Overview</strong> page for the resource in the Azure portal. Consider the overview for an Azure virtual machine that has several charts that show performance metrics.</p>
</li>
<li>
<p>You can use Azure Monitor <strong>metrics explorer</strong> to view the metrics for your Azure services and resources.</p>
</li>
<li>
<p>In the Azure portal, select any graph for a resource to open the associated metrics data in metrics explorer. The tool lets you chart the values of multiple metrics over time. You can work with the charts interactively or pin them to a dashboard to view them with other visualizations.</p>
</li>
</ul>
<p><img alt="Illustration that depicts Azure Monitor metrics data graphs providing information to Metric Analytics in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/monitor-data-platform-7dbebda9.png" /></p>
<h4 id="things-to-know-about-azure-monitor-logs"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-azure-monitor-logs">Things to know about Azure Monitor Logs</a></h4>
<p>You can also work with Azure Monitor Logs (Log Analytics) in the Azure portal. Let's review the details.</p>
<ul>
<li>
<p>In the Azure portal, log data collected by Azure Monitor is stored in Log Analytics.</p>
</li>
<li>
<p>Log Analytics includes a <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/log-query/log-query-overview">rich query language</a> to help you quickly retrieve, consolidate, and analyze your collected data.</p>
</li>
<li>
<p>You can work with Log Analytics to create and test queries. Use the query results to directly analyze the data, save your queries, visualize the data, and create alert rules.</p>
</li>
<li>
<p>Azure Monitor uses a version of the <a href="https://learn.microsoft.com/en-us/azure/kusto/query/">Data Explorer</a> query language. The language is suitable for simple log queries, but also includes advanced functionality like aggregations, joins, and smart analytics. You can quickly learn the query language by completing several available lessons. Particular guidance is provided for users familiar with SQL and Splunk.</p>
</li>
</ul>
<p><img alt="Illustration that depicts an Azure Monitor Logs database providing information to Log Analytics in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/log-data-32e50eae.png" /></p>
<h2 id="identify-monitoring-data-and-tiers"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#identify-monitoring-data-and-tiers">Identify monitoring data and tiers</a></h2>
<p>Azure Monitor can collect data from various sources. You can think of the collected data as being categorized by tier. Tiers can include data collected from many sources, such as:</p>
<ul>
<li>Your application</li>
<li>The operating system</li>
<li>Services and resources used by your application</li>
<li>The platform that supports your application</li>
</ul>
<h4 id="things-to-know-about-data-collection"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-data-collection">Things to know about data collection</a></h4>
<p>Review the following details about how Azure Monitor collects different categories of data.</p>
<ul>
<li>
<p>Azure Monitor begins collecting data as soon as you create your Azure subscription and add resources.</p>
</li>
<li>
<p>When you create or modify resources, this data is stored in Azure Monitor activity logs.</p>
</li>
<li>
<p>Performance data about resources, along with the amount of resources consumed, is stored as Azure Monitor metrics.</p>
</li>
<li>
<p>Extend the data you're collecting by enabling diagnostics and adding Azure Monitor Agent to compute resources. By extending your data sources, you can collect data for the internal operation of the resources.</p>
</li>
<li>
<p>Azure Monitor Agent also lets you configure different data sources to collect logs and metrics from Windows and Linux guest operating systems.</p>
</li>
<li>
<p>Azure Monitor can collect log data from any REST client by using the Data Collector API. The Data Collector API lets you create custom monitoring scenarios and extend monitoring to resources that don't expose data through other sources.</p>
</li>
</ul>
<h5 id="monitoring-data-tiers"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#monitoring-data-tiers">Monitoring data tiers</a></h5>
<p>The following table summarizes the tiers of monitoring data that are collected by Azure Monitor.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Data tier</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Application</strong></td>
<td>The Application tier contains monitoring data about the performance and functionality of your application code. This data is collected regardless of your platform.</td>
</tr>
<tr>
<td><strong>Guest OS</strong></td>
<td>Monitoring data about the operating system on which your application is running is organized into the Guest OS tier. Your application can run in Azure, another cloud, or on-premises.</td>
</tr>
<tr>
<td><strong>Azure resource</strong></td>
<td>The Azure resource tier holds monitoring data about the operation of any Azure resource you utilize, including consumption details for the resource.</td>
</tr>
<tr>
<td><strong>Azure subscription</strong></td>
<td>The Azure subscription tier contains monitoring data about the operation and management of your Azure subscription. The tier also contains data about the health and operation of Azure itself.</td>
</tr>
<tr>
<td><strong>Azure tenant</strong></td>
<td>Data about the operation of your tenant-level Azure services, such as Microsoft Entra ID, is organized into the Azure tenant tier.</td>
</tr>
</tbody>
</table>
<h2 id="describe-activity-log-events"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#describe-activity-log-events">Describe activity log events</a></h2>
<p>The Azure Monitor activity log is a subscription log that provides insight into subscription-level events that occur in Azure. Events can include a range of data from Azure Resource Manager operational data to updates on Azure service health events.</p>
<h4 id="how-to-use-the-azure-activity-log"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#how-to-use-the-azure-activity-log">How to use the Azure Activity Log</a></h4>
<p><img alt="" src="https://youtu.be/ACVpH6C_NL8" /></p>
<h4 id="things-to-know-about-activity-logs"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-activity-logs">Things to know about activity logs</a></h4>
<p>Let's examine some details about working with activity logs in Azure Monitor.</p>
<ul>
<li>
<p>You can use the information in activity logs to understand the status of resource operations and other relevant properties.</p>
</li>
<li>
<p>Activity logs can help you determine the "what, who, and when" for any write operation (PUT, POST, DELETE) performed on resources in your subscription.</p>
</li>
<li>
<p>Activity logs are kept for 90 days.</p>
</li>
<li>
<p>You can query for any range of dates in an activity log, as long as the starting date isn't more than 90 days in the past.</p>
</li>
<li>
<p>You can retrieve events from your activity logs by using the Azure portal, the Azure CLI, PowerShell cmdlets, and the Azure Monitor REST API.</p>
</li>
</ul>
<p><img alt="Diagram that shows how Azure Monitor activity logs gather information from compute and non-compute resources in Azure." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/activity-log-7d1913ad.png" /></p>
<h5 id="business-scenarios"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#business-scenarios">Business scenarios</a></h5>
<p>Activity logs can help you monitor your configuration and get details for many scenarios, such as:</p>
<p><em>What operations happened on resources in my subscription?</em></p>
<p><em>Who initiated the operations?</em></p>
<p><em>When did the operations occur?</em></p>
<p><em>What's the current status of the operations?</em></p>
<p><em>What are the values of other properties that can help with my analysis of the resources and operations?</em></p>
<h2 id="query-the-activity-log"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#query-the-activity-log">Query the activity log</a></h2>
<p>In the Azure portal, you can filter your Azure Monitor activity logs so you can view specific information. The filters enable you to review only the activity log data that meets your criteria. You might set filters to review monitoring data about critical events for your primary subscription and production virtual machine during peak business hours.</p>
<p><img alt="Screenshot that shows filter options for activity logs in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/query-activity-log-a92271d9.png" /></p>
<h4 id="things-to-know-about-activity-log-filters"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-activity-log-filters">Things to know about activity log filters</a></h4>
<p>Let's review some of the filters you can set to control what data to review in your activity log:</p>
<ul>
<li>
<p><strong>Subscription</strong>: Show the data for one or more specified Azure subscription names.</p>
</li>
<li>
<p><strong>Timespan</strong>: Show data for a specified time by choosing the start and end time for events, such as a six-hour period.</p>
</li>
<li>
<p><strong>Event Severity</strong>: Show events at the selected severity levels, including <em>Informational</em>, <em>Warning</em>, <em>Error</em>, or <em>Critical</em>.</p>
</li>
<li>
<p><strong>Resource group</strong>: Show data for one or more specified resource groups within your specified subscriptions.</p>
</li>
<li>
<p><strong>Resource (name)</strong>: Show data for the specified resources.</p>
</li>
<li>
<p><strong>Resource type</strong>: Show data for resources of a specified type, such as <code>Microsoft.Compute/virtualmachines</code>.</p>
</li>
<li>
<p><strong>Operation name</strong>: Show data for a selected Azure Resource Manager operation, such as <code>Microsoft.SQL/servers/Write</code>.</p>
</li>
<li>
<p><strong>Event initiated by</strong>: Show operation data for a specified user who performed the operation, referred to as the "caller."</p>
</li>
</ul>
<p>After you define a set of filters, you can pin the filter set to the Azure Monitor dashboard. You can also download your activity log search results as a CSV file.</p>
<p>In addition to the filters, you can enter a text string in the <strong>Search</strong> box. Azure Monitor tries to match your search string against data returned for all fields in all events that corresponds to your filter settings.</p>
<h4 id="things-to-know-about-event-categories"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-event-categories">Things to know about event categories</a></h4>
<p>The following table summarizes the categories of events that you can review in your activity logs. The information displayed for events is based on your other filter settings.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Event category</th>
<th>Event data</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Administrative</strong></td>
<td>All create, update, delete, and action operations performed through Azure Resource Manager, and any changes to role-based access control (RBAC) in your filtered subscriptions</td>
<td><code>create virtual machine</code>  <br>  <br><code>delete network security group</code></td>
</tr>
<tr>
<td><strong>Service Health</strong></td>
<td>All service health events for Azure services and resources connected with your filtered subscriptions, including <em>Action Required</em>, <em>Assisted Recovery</em>, <em>Incident</em>, <em>Maintenance</em>, <em>Information</em>, or <em>Security</em></td>
<td><code>SQL Azure in East US is experiencing downtime</code>  <br>  <br><code>Azure SQL Data Warehouse Scheduled Maintence Complete</code></td>
</tr>
<tr>
<td><strong>Resource Health</strong></td>
<td>All resource health events for your filtered Azure resources, including <em>Available</em>, <em>Unavailable</em>, <em>Degraded</em>, or <em>Unknown</em>, and identified as <em>Platform Initiated</em> or <em>User Initiate</em></td>
<td><code>Virtual Machine health status changed to unavailable</code>  <br>  <br><code>Web App health status changed to available</code></td>
</tr>
<tr>
<td><strong>Alert</strong></td>
<td>All activations of Azure alerts for your filtered subscriptions and resources</td>
<td><code>CPU % on devVM001 has been over 80 for the past 5 minutes</code>  <br>  <br><code>Disk read LessThan 100000 in the last 5 minutes</code></td>
</tr>
<tr>
<td><strong>Autoscale</strong></td>
<td>All events related to the operation of the autoscale engine based on any autoscale settings defined for your filtered subscriptions</td>
<td><code>Autoscale scale up action failed</code></td>
</tr>
<tr>
<td><strong>Recommendation</strong></td>
<td>Recommendation events for certain Azure resource types, such as web sites and SQL servers, based on your filtered subscriptions and resources</td>
<td><em>Recommendations for how to better utilize your resources</em></td>
</tr>
<tr>
<td><strong>Security</strong></td>
<td>All alerts generated by Microsoft Defender for Cloud affecting your filtered subscriptions and resources</td>
<td><code>Suspicious double extension file executed</code></td>
</tr>
<tr>
<td><strong>Policy</strong></td>
<td>All effect action operations performed by Azure Policy for your filtered subscriptions and resources, where every action taken by Azure Policy is modeled as an operation on a resource</td>
<td><code>Audit</code> and <code>Deny</code></td>
</tr>
</tbody>
</table>
<h2 id="interactive-lab-simulation"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#interactive-lab-simulation">Interactive lab simulation</a></h2>
<h3 id="lab-scenario"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#lab-scenario">Lab scenario</a></h3>
<p>Your organization wants insight into the performance and configuration of Azure resources. As the Azure Administrator you need to:</p>
<ul>
<li>Explore Azure virtual machine monitoring capabilities, including available metrics.</li>
<li>Explore alerts and notification features.</li>
<li>Review logs by using Azure Monitor Logs (Log Analytics) queries.</li>
</ul>
<h3 id="architecture-diagram"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#architecture-diagram">Architecture diagram</a></h3>
<p><img alt="Architecture diagram as explained in the text." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/lab-11.png" /></p>
<h3 id="objectives"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#objectives">Objectives</a></h3>
<ul>
<li><strong>Task 1</strong>: Provision the lab environment.<ul>
<li>Review an <a href="https://github.com/MicrosoftLearning/AZ-104-MicrosoftAzureAdministrator/blob/master/Allfiles/Labs/11/az104-11-vm-template.json">Azure Resource Manager (ARM) template</a>.</li>
<li>Use the ARM template to deploy a virtual machine to use to test monitoring scenarios.</li>
</ul>
</li>
<li><strong>Task 2</strong>: Register the Microsoft Insights and Microsoft Alerts Management resource providers.<ul>
<li>Create a Log Analytics workspace in the same region as the virtual machines.</li>
<li>Create an Azure Automation Account and associate it with the Azure Monitor Logs (Log Analytics) workspace.</li>
<li>Enable update management.</li>
</ul>
</li>
<li><strong>Task 3</strong>: Create and configure an Azure Monitor Logs (Log Analytics) workspace and Azure Automation-based solutions.<ul>
<li>Review Azure virtual machine monitoring options.</li>
<li>Review the list of available metrics.</li>
</ul>
</li>
<li><strong>Task 4</strong>: Review default monitoring settings of Azure virtual machines.</li>
<li><strong>Task 5</strong>: Configure Azure virtual machine diagnostic settings.<ul>
<li>Review the Azure virtual machine monitoring settings and enable guest-level monitoring.</li>
<li>Enable Azure Monitor Agent and available metrics.</li>
</ul>
</li>
<li><strong>Task 6</strong>: Review Azure Monitor functionality.<ul>
<li>Configure Azure Monitor metrics.</li>
<li>Create an alert rule based on average percentage CPU.</li>
<li>Configure notifications for an action group.</li>
<li>Trigger increased CPU utilization and review alert notifications.</li>
</ul>
</li>
<li><strong>Task 7</strong>: Review Azure Monitor Logs (Log Analytics) functionality.<ul>
<li>Create a log query to chart the virtual machine's available memory over the last hour.</li>
<li>Run the log query and preview the data.</li>
</ul>
</li>
</ul>
<p>Note</p>
<p>Select the thumbnail image to start the lab simulation. When you're done, be sure to return to this page so you can continue learning.</p>
<p><a href="https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2017"><img alt="Screenshot of the simulation page." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-azure-monitor/media/simulation-monitor-thumbnail.jpg" /></a></p>
<hr />
<h2 id="configure-log-analytics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#configure-log-analytics">Configure Log Analytics</a></h2>
<h2 id="introduction_2"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_2">Introduction</a></h2>
<p>Log Analytics is a tool in Azure Monitor that allows you to edit and run log queries for data collected in Azure Monitor Logs. It offers query features and tools, supports the Kusto Query Language (KQL), and allows for detailed analysis and problem-solving.</p>
<p>Imagine you're an Azure Administrator working for a large e-commerce company. Your company recently experienced a major security breach, and you need to investigate the root cause and prevent future incidents. You have access to logs from various Azure services, but manually analyzing them would be time-consuming and inefficient.</p>
<p>By using Log Analytics, you can easily query and analyze the logs to identify any suspicious activities, track changes, and ensure compliance with security standards. With Log Analytics, you can quickly assess update requirements and time-to-complete, track changes, and identify access issues in your systems. It helps meet strict SLAs for businesses and provides a single interface for analyzing data from multiple sources.</p>
<p>The goal of this module is to provide you with the knowledge and skills to effectively use Log Analytics in Azure Monitor.</p>
<h3 id="learning-objectives_1"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives_1">Learning objectives</a></h3>
<p>In this module, you learn how to:</p>
<ul>
<li>Identify the features and usage cases for Log Analytics in Azure Monitor.</li>
<li>Structure and create a Log Analytics workspace in the Azure portal.</li>
<li>Use KQL to query a Log Analytics workspace and review results.</li>
</ul>
<h3 id="skills-measured_1"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#skills-measured_1">Skills measured</a></h3>
<p>The content in the module helps you prepare for <a href="https://learn.microsoft.com/en-us/certifications/exams/az-104">Exam AZ-104: Microsoft Azure Administrator</a>.</p>
<h3 id="prerequisites_1"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#prerequisites_1">Prerequisites</a></h3>
<ul>
<li>Working knowledge of Azure Monitor including data sources and collected data.</li>
<li>Experience with the Azure portal including navigating and locating resources.</li>
<li>Familiarity with structuring and executing data queries.</li>
</ul>
<h2 id="determine-log-analytics-uses"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#determine-log-analytics-uses">Determine Log Analytics uses</a></h2>
<p>Log Analytics is a tool for Azure Monitor that's available in the Azure portal. You can use Log Analytics to edit and run log queries for the data collected in Azure Monitor Logs. Log queries help you to search for patterns and identify issues.</p>
<p><img alt="Screenshot that shows an example of Azure Monitor Logs in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-log-analytics/media/log-analytics-38112dc9.png" /></p>
<h4 id="things-to-know-about-log-analytics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-log-analytics">Things to know about Log Analytics</a></h4>
<p>Let's examine some characteristics of Log Analytics in Azure Monitor.</p>
<ul>
<li>
<p>Log Analytics in Azure Monitor offers query features and tools that help you answer virtually any question about your monitored configuration.</p>
</li>
<li>
<p>Log Analytics supports the Kusto Query Language (KQL). You can create simple or complex queries with KQL, including:</p>
<ul>
<li>Search and sort by value, time, property state, and more</li>
<li>Join data from multiple tables</li>
<li>Aggregate large sets of data</li>
<li>Perform intricate operations with minimal code</li>
<li>When your Azure Monitor Logs contain sufficient collected data, and you understand how to construct the appropriate query, you can use Log Analytics to complete detailed analysis and problem solving.</li>
</ul>
</li>
</ul>
<h4 id="things-to-consider-when-using-log-analytics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-consider-when-using-log-analytics">Things to consider when using Log Analytics</a></h4>
<p>Some features in Azure Monitor, such as insights and solutions, process log data without exposing you to the underlying queries. To use other Azure Monitor features, you need to understand how to construct queries and apply them to interactively analyze data in Azure Monitor Logs. The following business scenarios showcase the advantages of querying Azure Monitor Logs with Log Analytics.</p>
<h5 id="business-scenario-assess-update-requirements-and-time-to-complete"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#business-scenario-assess-update-requirements-and-time-to-complete">Business scenario: Assess update requirements and time-to-complete</a></h5>
<p>An important daily task for IT admins is to assess system update requirements and plan for configuration patches. Accurate scheduling is critical because the patching process relates to SLAs to the business and can negatively affect business functions.</p>
<p>In the past, administrators had to schedule a patch update with only limited knowledge of how long it might take to complete the process. With an Azure subscription, admins can access benefits of the Microsoft Azure platform. Azure collects data from all customers performing patches. Azure uses the gathered data to provide an average patching time for specific updates.</p>
<p>This use of "crowd-sourced" data is unique to cloud systems. It's a great example of how Log Analytics in Azure Monitor can you help meet strict SLAs for your business.</p>
<h5 id="business-scenario-track-changes-and-identify-access-issues"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#business-scenario-track-changes-and-identify-access-issues">Business scenario: Track changes and identify access issues</a></h5>
<p>Troubleshooting an operational incident is a complex process that requires access to multiple data streams. By monitoring your systems from the Azure platform, you can easily perform analysis from multiple angles. You have access to data from a wide variety of sources through a single interface for correlation of information.</p>
<p>By tracking changes across the Azure environment, Log Analytics in Azure Monitor can help you easily identify common issues, such as:</p>
<ul>
<li>Abnormal behavior from a specific account</li>
<li>Users installing unapproved software</li>
<li>Unexpected system reboots or shutdowns</li>
<li>Evidence of security breaches</li>
<li>Specific problems in loosely coupled applications</li>
</ul>
<h2 id="create-a-log-analytics-workspace"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-log-analytics-workspace">Create a Log Analytics workspace</a></h2>
<p>When you capture logs and data in Azure Monitor, Azure stores the collected information in a Log Analytics workspace. Your Log Analytics workspace is the basic management environment for Azure Monitor Logs.</p>
<h4 id="how-to-define-your-log-analytics-scope"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#how-to-define-your-log-analytics-scope">How to define your Log Analytics scope</a></h4>
<p><img alt="" src="https://youtu.be/34IrPO1Xh2o" /></p>
<h4 id="things-to-know-about-the-log-analytics-workspace"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-the-log-analytics-workspace">Things to know about the Log Analytics workspace</a></h4>
<p>To get started with Log Analytics in Azure Monitor, you need to create your workspace. Each workspace has a unique workspace ID and resource ID. After you create your workspace, you configure your data sources and solutions to store their data in your workspace.</p>
<p><img alt="Screenshot that shows how to create a Log Analytics workspace in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-log-analytics/media/create-workspace-f37a5b11.png" /></p>
<p>To create your Log Analytics workspace, configure the following parameters:</p>
<ul>
<li>
<p><strong>Name</strong>: Provide a name for your new Log Analytics workspace. The name for your workspace must be unique within your resource group.</p>
</li>
<li>
<p><strong>Subscription</strong>: Specify the Azure Subscription to associate with your workspace.</p>
</li>
<li>
<p><strong>Resource Group</strong>: Specify the resource group to associate with your workspace. You can choose an existing resource group or create a new one. The resource group must contain at least one Azure Virtual Machines instance.</p>
</li>
<li>
<p><strong>Region</strong>: Select the region where you deploy your virtual machines.</p>
<p>Note</p>
<p>The region must support Log Analytics. You can review the <a href="https://azure.microsoft.com/explore/global-infrastructure/products-by-region/">regions that support Log Analytics</a>. In the <strong>Search for a product</strong> box, enter "Azure Monitor."</p>
</li>
<li>
<p><strong>Pricing</strong>: The default pricing tier for a new workspace is <em>pay-as-you-go</em>. Charges incur only after you start collecting data.</p>
<p>Each Log Analytics workspace in Azure Monitor can have a different pricing tier. You can change the pricing tier for a workspace and also track the changes.</p>
</li>
</ul>
<h2 id="create-kusto-queries"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-kusto-queries">Create Kusto queries</a></h2>
<p>Log Analytics in Azure Monitor supports the Kusto Query Language (KQL). The KQL syntax helps you quickly and easily create simple or complex queries to retrieve and consolidate your monitoring data in the repository.</p>
<h3 id="write-kusto-query-language-log-queries-for-azure-monitor"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#write-kusto-query-language-log-queries-for-azure-monitor">Write Kusto Query Language log queries for Azure Monitor</a></h3>
<p>Watch the following video to learn how to write log queries with Log Analytics in Azure Monitor. The video covers the following concepts:</p>
<ul>
<li>View table data in the Azure Monitor Logs repository</li>
<li>Create simple and complex queries</li>
<li>Filter and summarize search results</li>
<li>Add visualizations for search results</li>
</ul>
<p>In the next unit, we take a closer look at how to structure a log query.</p>
<h4 id="things-to-consider-when-using-log-queries"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-consider-when-using-log-queries">Things to consider when using log queries</a></h4>
<p>Here are some of the many things you can accomplish with log queries in Log Analytics:</p>
<ul>
<li>
<p>Create and save searches of your data stored in the Azure Monitor Logs repository.</p>
</li>
<li>
<p>Use your saved log searches to directly analyze your data in the Azure portal.</p>
</li>
<li>
<p>Configure your saved log searches to run automatically.</p>
</li>
<li>
<p>Configure your saved log searches to produce notification alerts.</p>
</li>
<li>
<p>Add visualizations for your saved log searches to see graphical views of your environment health.</p>
</li>
<li>
<p>Export your data from the repository into analytical tools like Power BI or Excel.</p>
</li>
</ul>
<h2 id="structure-log-analytics-queries"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#structure-log-analytics-queries">Structure Log Analytics queries</a></h2>
<p>Administrators build Log Analytics queries from data stored in dedicated tables in a Log Analytics workspace. Some common dedicated tables include Event, Syslog, Heartbeat, and Alert. When you build a Kusto Query Language (KQL) query, you begin by determining which tables in the Azure Monitor Logs repository have the data you're looking for.</p>
<p>The following illustration highlights how KQL queries use the dedicated table data for your monitored services and resources.</p>
<p><img alt="Illustration that shows how to build Log Analytics queries from data in dedicated tables in a Log Analytics workspace." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-log-analytics/media/query-tables-f3872e3a.png" /></p>
<h4 id="things-to-know-about-kql-query-structure"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-kql-query-structure">Things to know about KQL query structure</a></h4>
<p>Let's take a closer look at dedicated table data and how to structure a KQL log query.</p>
<ul>
<li>
<p>Each of your selected data sources and solution stores its data in dedicated tables in your Log Analytics workspace.</p>
</li>
<li>
<p>Documentation for each data source and solution includes the name of the data type that it creates and a description of each of its properties.</p>
</li>
<li>
<p>The basic structure of a query is a source table followed by a series of commands (referred to as <em>operators</em>).</p>
</li>
<li>
<p>A query can have a chain of multiple operators to refine your data and perform advanced functions.</p>
</li>
<li>
<p>Each operator in a query chain begins with a pipe character <code>|</code>.</p>
</li>
<li>
<p>Many queries require data from a single table only, but other queries can use various options and include data from multiple tables.</p>
</li>
</ul>
<h4 id="kql-log-query-examples"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#kql-log-query-examples">KQL log query examples</a></h4>
<p>Let's review some common KQL log query operators and example syntax.</p>
<p>We can build queries to search for data in the <code>StormEvent</code> table that has five entries:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>type</th>
<th>event</th>
<th>severity</th>
<th>start</th>
<th>duration</th>
<th>region</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Water</code></td>
<td><code>Freezing rain</code></td>
<td><code>1</code></td>
<td><code>6:00 AM 01-27-2023</code></td>
<td><code>3 hours</code></td>
<td><code>1, 2</code></td>
</tr>
<tr>
<td><code>Wind</code></td>
<td><code>High winds</code></td>
<td><code>1</code></td>
<td><code>8:00 AM 01-27-2023</code></td>
<td><code>12 hours</code></td>
<td><code>1, 2, 4, 5</code></td>
</tr>
<tr>
<td><code>Temperature</code></td>
<td><code>Below freezing</code></td>
<td><code>2</code></td>
<td><code>11:00 PM 01-26-2023</code></td>
<td><code>10 hours</code></td>
<td><code>1, 2, 4, 5</code></td>
</tr>
<tr>
<td><code>Water</code></td>
<td><code>Snow</code></td>
<td><code>3</code></td>
<td><code>4:00 PM 01-26-2023</code></td>
<td><code>10 hours</code></td>
<td><code>1, 2, 4, 5</code></td>
</tr>
<tr>
<td><code>Water</code></td>
<td><code>Flood warning</code></td>
<td><code>2</code></td>
<td><code>9:00 AM 01-26-2023</code></td>
<td><code>10 hours</code></td>
<td><code>3</code></td>
</tr>
</tbody>
</table>
<p>To find other operators and examples, review: <a href="https://learn.microsoft.com/en-us/training/paths/analyze-monitoring-data-with-kql/">Analyze monitoring data with Kusto Query Language - Training | Microsoft Learn</a>.</p>
<h5 id="count-number-of-items"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#count-number-of-items">Count number of items</a></h5>
<p>Use the <code>count</code> operator to discover the number of records in an input record set.</p>
<p>The following example returns the number of records in the <code>StormEvent</code> table. The query results reveal the <code>StormEvent</code> table has five entries.</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>StormEvent | count
</code></pre></div>
<p>Query results:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>count</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>5</code></td>
</tr>
</tbody>
</table>
<h5 id="return-first-number-of-items"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#return-first-number-of-items">Return first number of items</a></h5>
<p>Use the <code>top</code> operator to see the first N records of your input record set, sorted by your specified columns. The columns correspond to data properties defined in the dedicated table.</p>
<p>The following example returns the first three data records for <code>StormEvent</code>. The results table shows the storm <code>event</code> name, the severity, and the forecasted duration.</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>StormEvent | top 3 by event severity duration
</code></pre></div>
<p>Query results:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>event</th>
<th>severity</th>
<th>duration</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Freezing rain</code></td>
<td><code>1</code></td>
<td><code>3 hours</code></td>
</tr>
<tr>
<td><code>High winds</code></td>
<td><code>1</code></td>
<td><code>12 hours</code></td>
</tr>
<tr>
<td><code>Below freezing</code></td>
<td><code>2</code></td>
<td><code>10 hours</code></td>
</tr>
</tbody>
</table>
<h5 id="find-matching-items"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#find-matching-items">Find matching items</a></h5>
<p>Use the <code>where</code> operator to filter your table to the subset of rows that match the supplied predicate value. The predicate value indicates what to search for in the table, as in <code>where=="find-this"</code>.</p>
<p>The following example filters the data records for <code>StormEvent</code> to use only records that match "snow."</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>StormEvent | where event==&quot;snow&quot;
</code></pre></div>
<p>Your query filters to one row in the <code>StormEvent</code> table:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>type</th>
<th>event</th>
<th>severity</th>
<th>start</th>
<th>duration</th>
<th>region</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Water</code></td>
<td><code>Snow</code></td>
<td><code>3</code></td>
<td><code>4:00 PM 01-26-2023</code></td>
<td><code>10 hours</code></td>
<td><code>1, 2, 4, 5</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="configure-network-watcher"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#configure-network-watcher">Configure Network Watcher</a></h2>
<h2 id="introduction_3"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_3">Introduction</a></h2>
<p>Azure Network Watcher is a powerful tool that allows you to monitor, diagnose, and manage resources in an Azure virtual network.</p>
<p>Imagine you're an IT administrator for a large e-commerce company. Your company relies heavily on its Azure virtual network to host its website and handle customer transactions. One day, you receive reports from customers that they're unable to access the website or complete their purchases. You need to quickly identify the cause of the connectivity issues and resolve them to minimize the impact on your business.</p>
<p>Your organization plans to use Network Watcher. Network Watcher's monitoring and diagnostic capabilities let you easily pinpoint the root cause of the problem and take appropriate actions. By using features such as <strong>IP flow verification, next hop analysis, and connection troubleshooting</strong>, you can ensure that your virtual network is functioning optimally.</p>
<p>In this module, you learn about the various features and use cases of Azure Network Watcher. The topics covered include IP flow verification, next hop analysis, and the topology tool. The module guides you on how to diagnose network configuration issues, such as broken security rules.</p>
<p>The goal of this module is to provide you with a comprehensive understanding of Azure Network Watcher and its capabilities. By the end of this module, you effectively monitor, diagnose, and manage your Azure virtual network using Network Watcher.</p>
<h2 id="describe-azure-network-watcher-features"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#describe-azure-network-watcher-features">Describe Azure Network Watcher features</a></h2>
<p>Azure Network Watcher provides tools to monitor, diagnose, view metrics, and enable or disable logs for resources in an Azure virtual network. Network Watcher is a regional service that enables you to monitor and diagnose conditions at a network scenario level.</p>
<p><img alt="Screenshot of the Network Watcher Get Started page in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-watcher/media/network-watcher-861659e0.png" /></p>
<h4 id="things-to-know-about-network-watcher"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-network-watcher">Things to know about Network Watcher</a></h4>
<p>Let's review some of the prominent features of Network Watcher.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
<th>Scenarios</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>IP flow verify</strong></td>
<td>Quickly diagnose connectivity issues from or to the internet, and from or to your on-premises environment.</td>
<td><em>Identify if a security rule blocks ingress or egress traffic to or from a virtual machine</em>  <br>  <br><em>Troubleshoot issues to determine if other exploration is required</em></td>
</tr>
<tr>
<td><strong>Next hop</strong></td>
<td>View the next connection point (or <em>next hop</em>) in your network route, and analyze your network routing configuration.</td>
<td><em>Determine if there's a next hop, and view the next hop target, type, and route table</em>  <br>  <br><em>Confirm traffic reaches an intended target destination</em></td>
</tr>
<tr>
<td><strong>VPN troubleshoot</strong></td>
<td>Diagnose and troubleshoot the health of your virtual network gateway or connection with gathered data. View connection statistics, CPU and memory information, IKE security errors, packet drops, and buffers and events.</td>
<td><em>View summary diagnostics in the Azure portal</em>  <br>  <br><em>Review detailed diagnostics in generated log files stored in your Azure storage account</em>  <br>  <br><em>Simultaneously troubleshoot multiple gateways or connections</em></td>
</tr>
<tr>
<td><strong>NSG diagnostics</strong></td>
<td>Use flow logs to map IP traffic through a network security group (NSG). A common implementation for NSG flow logs is to meet security compliance regulations and auditing requirements.</td>
<td><em>Define prescriptive NSG rules for your organization, and conduct periodic compliance audits</em>  <br>  <br><em>Compare your prescriptive NSG rules against the effective rules for each virtual machine in your network</em></td>
</tr>
<tr>
<td><strong>Connection troubleshoot</strong></td>
<td>Azure Network Watcher Connection Troubleshoot is a more recent addition to the Network Watcher suite of networking tools and capabilities. Check a direct TCP or ICMP connection from a virtual machine, application gateway, or Azure Bastion host to a virtual machine.</td>
<td><em>Troubleshoot your network performance and connectivity issues in Azure</em>  <br>  <br><em>Troubleshoot connection issues for a virtual machine, application gateway, or Azure Bastion host</em></td>
</tr>
</tbody>
</table>
<p>Note</p>
<p>To use Network Watcher, you must be an Owner, Contributor, or Network Contributor. If you create a custom role, the role must be able to read, write, and delete the Network Watcher service.</p>
<h4 id="things-to-consider-when-using-network-watcher"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-consider-when-using-network-watcher">Things to consider when using Network Watcher</a></h4>
<p>Azure Network Watcher supports many Azure monitoring tasks and scenarios. As you review these features, think about how Network Watcher can support your Azure monitoring requirements.</p>
<ul>
<li>
<p><strong>Consider remote monitoring</strong>. Automate remote network monitoring with packet capture. You can monitor and diagnose networking issues without logging in to your virtual machines.</p>
</li>
<li>
<p><strong>Consider alert notifications</strong>. Set alerts to trigger packet capture, and access real-time performance information at the packet level. When you observe an issue, you can investigate in detail for better diagnoses.</p>
</li>
<li>
<p><strong>Consider NSG flow log diagnosis</strong>. Use NSG flow logs to gain insight into your network traffic. Build a deeper understanding of your network traffic pattern by using NSG flow logs. Information provided by flow logs helps you gather data for compliance, auditing, and monitoring your network security profile.</p>
</li>
<li>
<p><strong>Consider log analysis</strong>. Diagnose your most common Azure VPN Gateway and connections issues. You can identify issues and use the generated detailed logs to assist your analysis.</p>
</li>
</ul>
<h2 id="review-ip-flow-verify-diagnostics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#review-ip-flow-verify-diagnostics">Review IP flow verify diagnostics</a></h2>
<p>The <strong>IP flow verify</strong> feature in Azure Network Watcher checks connectivity from or to the internet, and from or to your on-premises environment. This feature helps you identify if a security rule is blocking traffic to or from your virtual machine or the internet.</p>
<p><img alt="Screenshot of the IP flow verify feature in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-watcher/media/flow-verify-d136d78d.png" /></p>
<h4 id="things-to-know-about-ip-flow-verify"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-ip-flow-verify">Things to know about IP flow verify</a></h4>
<p>Let's examine the configuration details and functionality of the IP flow verify feature in Azure Network Watcher.</p>
<ul>
<li>
<p>You configure the IP flow verify feature with the following properties in the Azure portal:</p>
<ul>
<li>Virtual machine and network interface</li>
<li>Local (source) port number</li>
<li>Remote (destination) IP address, and remote port number</li>
<li>Communication protocol (TCP or UDP)</li>
<li>Traffic direction (Inbound or Outbound)</li>
<li>The feature tests communication for a target virtual machine with associated network security group (NSG) rules by running inbound and outbound packets to and from the machine.</li>
</ul>
</li>
<li>
<p>After the test runs complete, the feature informs you whether communication with the machine succeeds (allows access) or fails (denies access).</p>
</li>
<li>
<p>If the target machine denies the packet because of an NSG, the feature returns the name of the controlling security rule.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-ip-flow-verify"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-consider-when-using-ip-flow-verify">Things to consider when using IP flow verify</a></h4>
<p>The IP flow verify feature is ideal for helping to ensure correct application of your security rules.</p>
<p>When you deploy a virtual machine, Azure applies several default security rules to your machine. The security rules allow or deny traffic to or from your virtual machine. You can override Azure's default rules or create other rules.</p>
<p>At some point, your virtual machine might be unable to communicate with other resources because of a security rule. You can use the IP flow verify feature to troubleshoot your NSG rules.</p>
<p>If test runs fail, but the IP flow verify feature doesn't indicate the issue is related to your NSG rules, you need to explore other areas, such as firewall restrictions.</p>
<h2 id="review-next-hop-diagnostics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#review-next-hop-diagnostics">Review next hop diagnostics</a></h2>
<p>The <strong>next hop</strong> feature in Azure Network Watcher checks if traffic is being directed to the intended destination. This feature lets you view the next connection point (or <em>next hop</em>) in your network route, and helps you verify a correct network configuration.</p>
<p><img alt="Screenshot of the next hop feature in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-watcher/media/next-hop-d7dde5f6.png" /></p>
<h4 id="things-to-know-about-next-hop"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-next-hop">Things to know about next hop</a></h4>
<p>Let's review the configuration properties and summary of the next hop feature in Azure Network Watcher.</p>
<ul>
<li>
<p>You configure the next hop feature with the following properties in the Azure portal:</p>
<ul>
<li>Your subscription and resource group</li>
<li>Virtual machine and network interface</li>
<li>Source IP address</li>
<li>Destination IP address (If you want to confirm a specified target is reachable)</li>
<li>The feature tests the next connection point in your network route configuration.</li>
</ul>
</li>
<li>
<p>The next hop test returns three items:</p>
<ul>
<li>Next hop type</li>
<li>IP address of the next hop (If available)</li>
<li>Route table for the next hop (If available)</li>
<li>Examples of a next hop are <em>Internet</em>, <em>Virtual Network</em>, and <em>Virtual Network Service Endpoint</em>.</li>
</ul>
</li>
<li>
<p>If the next hop is a user-defined route (UDR), the process returns the UDR route. Otherwise, next hop returns the system route.</p>
</li>
<li>
<p>If the next hop is of type <em>None</em>, there might be a valid system route to the destination IP address, but no next hop exists to route the traffic to the target.</p>
</li>
</ul>
<h4 id="things-to-consider-when-using-next-hop"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-consider-when-using-next-hop">Things to consider when using next hop</a></h4>
<p>The next hop feature is ideal for identifying unresponsive virtual machines or broken routes in your network.</p>
<p>When you create a virtual network, Azure creates several default outbound routes for network traffic. Outbound traffic from all resources (such as virtual machines) deployed in the virtual network is routed based on Azure's default routes. You can override Azure's default routes or create other routes.</p>
<p>You might find that a virtual machine can no longer communicate with other resources connected by a specific route. You can use the next hop feature to examine a specific source and destination IP address in your configuration.</p>
<p>Next hop tests the communication between the source and destination, and reports the type of next hop in the traffic route. You can then remove, change, or add a route, to resolve routing issues.</p>
<h2 id="visualize-the-network-topology"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#visualize-the-network-topology">Visualize the network topology</a></h2>
<p>Administrators sometimes need to troubleshoot virtual networks that they didn't help to create. They might not be fully aware of all the aspects of the infrastructure and configuration.</p>
<p>Azure Network Watcher provides a network monitoring <strong>topology</strong> tool to help administrators visualize and understand infrastructure. The following image shows an example topology diagram for a virtual network in Network Watcher.</p>
<p><img alt="Screenshot of the Network Watcher Topology page in the Azure portal." src="https://learn.microsoft.com/en-us/training/wwl-azure/configure-network-watcher/media/monitor-visualization-1fb7bd5c.png" /></p>
<h4 id="things-to-know-about-the-topology-tool"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#things-to-know-about-the-topology-tool">Things to know about the topology tool</a></h4>
<p>Review the following characteristics of the network topology capability in Azure Network Watcher.</p>
<ul>
<li>
<p>The Network Watcher Topology tool generates a visual diagram of the resources in a virtual network.</p>
</li>
<li>
<p>The graphical display shows the resources in the network, their interconnections, and their relationships with each other.</p>
</li>
<li>
<p>You can view subnets, virtual machines, network interfaces, public IP addresses, network security groups, route tables, and more.</p>
</li>
<li>
<p>To generate a topology, you need an Azure Network Watcher instance in the same region as the virtual network.</p>
</li>
</ul>
<hr />
<h2 id="improve-incident-response-with-azure-monitor-alerts"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#improve-incident-response-with-azure-monitor-alerts">Improve incident response with Azure Monitor alerts</a></h2>
<h2 id="introduction_4"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_4">Introduction</a></h2>
<p>Microsoft Azure provides a robust alerting and monitoring solution called Azure Monitor. You can use Azure Monitor to configure notifications and alerts for your key systems and applications. These alerts ensure that the correct team knows when a problem arises.</p>
<p>You work for a large shipping company that recently deployed several web applications to the Azure platform. Due to a configuration error, the customer-facing order tracker was offline. The issue wasn't identified until customers started complaining that they couldn't track their orders. As a consequence, customer satisfaction with your service dropped.</p>
<p>As your company's Azure solution architect, you need to find a solution that detects problems in your environments in real time. The solution should notify the correct team so it can resolve any problems before your customers notice.</p>
<h3 id="learning-objectives_2"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives_2">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Explore alerts by using Azure Monitor.</li>
<li>Understand when to use metric, log, and activity log events.</li>
<li>Create and use metric alerts, log search alerts, and activity log alerts.</li>
<li>Use action groups to determine what kind of notifications are sent and to whom.</li>
<li>Learn how to use alert-processing rules to override the normal behavior of action groups when needed.</li>
</ul>
<h3 id="prerequisites_2"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#prerequisites_2">Prerequisites</a></h3>
<ul>
<li>Knowledge of Azure Monitor</li>
</ul>
<h2 id="explore-the-different-alert-types-that-azure-monitor-supports"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#explore-the-different-alert-types-that-azure-monitor-supports">Explore the different alert types that Azure Monitor supports</a></h2>
<p>Azure Monitor is a powerful reporting and analytics tool. You can use it for insights into the behavior and running of your environment and applications. You can then respond proactively to faults in your system.</p>
<p>After the downtime that your customers faced, you set up monitoring on your key resources in Azure. With the monitoring in place, you want to make sure the right people are being alerted at the right level.</p>
<p>In this unit, you learn how Azure Monitor receives resource data, what makes up an alert, and how and when to use an alert. Finally, you learn how to create and manage your own alerts.</p>
<h3 id="data-types-in-azure-monitor"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#data-types-in-azure-monitor">Data types in Azure Monitor</a></h3>
<p>Azure Monitor receives data from target resources like applications, operating systems, Azure resources, Azure subscriptions, and Azure tenants. The nature of the resource defines which data types are available. A data type can be a <em>metric</em>, a <em>log</em>, or both a metric and a log:</p>
<ul>
<li>The focus for <em>metric</em>-based data types is the numerical time-sensitive values that represent some aspect of the target resource.</li>
<li>The focus for <em>log</em>-based data types is the querying of content data held in structured, record-based log files that are relevant to the target resource.</li>
</ul>
<p><img alt="Diagram that represents the target resources feeding into Azure Monitor and the two principal signal types: metrics and logs." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/2-azure-resource-signal-types.svg" /></p>
<p>There are three signal types that you can use to monitor your environment:</p>
<ul>
<li><strong>Metric</strong> alerts provide an alert trigger when a specified threshold is exceeded. For example, a metric alert can notify you when CPU usage is greater than 95 percent.</li>
<li><strong>Activity log</strong> alerts notify you when Azure resources change state. For example, an activity log alert can notify you when a resource is deleted.</li>
<li><strong>Log</strong> alerts are based on things written to log files. For example, a log search alert can notify you when a web server returns a particular number of 404 or 500 responses.</li>
</ul>
<h3 id="composition-of-an-alert-rule"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#composition-of-an-alert-rule">Composition of an alert rule</a></h3>
<p>Every alert or notification available in Azure Monitor is the product of a rule. Some of these rules are built into the Azure platform. You can use alert rules to create custom alerts and notifications. No matter which target resource or data source you use, the composition of an alert rule remains the same.</p>
<ul>
<li><strong>RESOURCE</strong><ul>
<li>The <em>target resource</em> for the alert rule. You can assign multiple target resources to a single alert rule. The type of resource defines the available signal types.</li>
</ul>
</li>
<li><strong>CONDITION</strong><ul>
<li>The <em>signal type</em> used to assess the rule. The signal type can be a metric, an activity log, or logs. There are others, but this module doesn't cover them.</li>
<li>The <em>alert logic</em> applied to the data that's being supplied via the signal type. The structure of the alert logic changes depending on the signal type.</li>
</ul>
</li>
<li><strong>ACTIONS</strong><ul>
<li>The <em>action</em>, like sending an email, sending a Short Message Service (SMS) message, or using a webhook.</li>
<li>An <em>action group</em>, which typically contains a unique set of recipients for the action.</li>
</ul>
</li>
<li><strong>ALERT DETAILS</strong><ul>
<li>An <em>alert name</em> and an <em>alert description</em> that specify the alert's purpose.</li>
<li>The <em>severity</em> of the alert if the criteria or logic test evaluates <code>true</code>. The five severity levels are:<ul>
<li><strong>0</strong>: Critical</li>
<li><strong>1</strong>: Error</li>
<li><strong>2</strong>: Warning</li>
<li><strong>3</strong>: Informational</li>
<li><strong>4</strong>: Verbose</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img alt="Screenshot of the Create rule page in the Azure Monitor portal." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/2-creating-an-alert.png" /></p>
<h3 id="scope-of-alert-rules"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#scope-of-alert-rules">Scope of alert rules</a></h3>
<p>You can get monitoring data from across most of the Azure services and report on it by using the Azure Monitor pipeline. In the Azure Monitor pipeline, you can create alert rules for these items and more:</p>
<ul>
<li>Metric values</li>
<li>Log search queries</li>
<li>Activity log events</li>
<li>Health of the underlying Azure platform</li>
<li>Tests for website availability</li>
</ul>
<h3 id="manage-alert-rules"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#manage-alert-rules">Manage alert rules</a></h3>
<p>Not every alert rule that you create needs to run forever. With Azure Monitor, you can specify one or more alert rules and enable or disable them, as needed.</p>
<p>As an Azure solution architect, you want to use Azure Monitor to enable tightly focused and specific alerts before any application change. Then, disable the alerts after a successful deployment.</p>
<h3 id="alert-summary-view"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#alert-summary-view">Alert summary view</a></h3>
<p>The alert page shows a summary of all alerts. You can apply filters to the view by using one or more of the following categories: subscriptions, alert condition, severity, or time ranges. The view includes only alerts that match these criteria.</p>
<p><img alt="Screenshot of Azure Monitor alerts page in the Azure Monitor portal." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/2-alerts-page.png" /></p>
<h4 id="alert-condition"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#alert-condition">Alert condition</a></h4>
<p>The system sets the alert condition.</p>
<ul>
<li>When an alert fires, the alert's monitor condition is set to <strong>Fired</strong>.</li>
<li>After the underlying condition that caused the alert to fire clears, the monitor condition is set to <strong>Resolved</strong>.</li>
</ul>
<h2 id="use-metric-alerts-for-alerts-about-performance-issues-in-your-azure-environment"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-metric-alerts-for-alerts-about-performance-issues-in-your-azure-environment">Use metric alerts for alerts about performance issues in your Azure environment</a></h2>
<p>Azure Monitor can use thresholds to monitor specific resources. In an organization, it's far more useful to be notified when the free disk space on a server is less than five percent, instead of being alerted every time a file is saved.</p>
<p>As a solution architect, you want to implement regular threshold monitoring for many of your target resources and instances. Monitoring helps to head off potential issues before they can affect your customers.</p>
<p>In this unit, you investigate the different kinds of metric alerts that Azure Monitor supports.</p>
<h3 id="when-would-you-use-metric-alerts"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#when-would-you-use-metric-alerts">When would you use metric alerts?</a></h3>
<p>In Azure Monitor, you can use metric alerts to achieve regular threshold monitoring of Azure resources. Azure Monitor runs metric alert trigger conditions at regular intervals. When the evaluation is true, Azure Monitor sends a notification. Metric alerts are stateful, and Azure Monitor sends a notification only when the prerequisite conditions are met.</p>
<p>Metric alerts can be useful if, for instance, you need to know when your server CPU utilization is reaching a critical threshold of 90 percent. You can receive alerts when your database storage is getting too low, or when network latency is about to reach unacceptable levels.</p>
<h3 id="composition-of-a-metric-alert"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#composition-of-a-metric-alert">Composition of a metric alert</a></h3>
<p>As you learned in the previous unit, all alerts are the product of the rules that govern them. For metric alerts, there's another factor to define: the condition type. It can be static or dynamic.</p>
<p>You must define the type of statistical analysis to be used with either static or dynamic metric alerts. Example types are minimum, maximum, average, and total. In this example, you define the period of data to be assessed: the last 10 minutes. Finally, you set the frequency by which the alert conditions are checked: every two minutes.</p>
<h4 id="use-static-threshold-metric-alerts"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-static-threshold-metric-alerts">Use static threshold metric alerts</a></h4>
<p>Static metric alerts are based on simple static conditions and thresholds that you define. With static metrics, you specify the threshold used to trigger the alert or notification.</p>
<p>In the previously defined scenario, a static alert with a threshold of 85 percent CPU utilization checks the rule every two minutes. It evaluates the last 10 minutes of CPU utilization data to assess if it rises above the threshold. If the evaluation is true, the alert triggers the actions associated with the action group.</p>
<h4 id="use-dynamic-threshold-metric-alerts"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-dynamic-threshold-metric-alerts">Use dynamic threshold metric alerts</a></h4>
<p>Dynamic metric alerts use machine-learning tools that Azure provides to automatically improve the accuracy of the thresholds defined by the initial rule.</p>
<p>There's no hard threshold in dynamic metrics. However, you need to define two more parameters:</p>
<ul>
<li>
<p>The <em>look-back period</em> defines how many previous periods need to be evaluated. For example, if you set the look-back period to three, then in the example used here, the assessed data range would be 30 minutes (three sets of 10 minutes).</p>
</li>
<li>
<p>The <em>number of violations</em> expresses how many times the logic condition has to deviate from the expected behavior before the alert rule fires a notification. In this example, if you set the number of violations to two, the alert would be triggered after two deviations from the calculated threshold.</p>
</li>
</ul>
<h3 id="understand-dimensions"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#understand-dimensions">Understand dimensions</a></h3>
<p>Until now, the assessed metric alerts we discussed, focused on a single target instance. Azure Monitor supports dimensions, which enable monitoring data to be supplied from multiple target instances.</p>
<p>You can use dimensions to define one metric alert rule and apply it to multiple related instances. For example, you can monitor CPU utilization across all the servers running your app. You can then receive an individual notification for each server instance when the rule conditions are triggered.</p>
<p>You can define the dimensions by naming each target instance specifically, or you can define the dimensions by using the asterisk (*) wildcard, which uses all available instances.</p>
<h3 id="scale-metric-alerts"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#scale-metric-alerts">Scale metric alerts</a></h3>
<p>Azure Monitor supports creating metric alerts that, like dimensions, monitor multiple resources. Scaling is currently limited to Azure virtual machines. However, a single metric alert can monitor resources in one Azure region.</p>
<p>Creating scaling metric alert rules to monitor multiple resources is no different than creating any other metric alert rule; you just select all the resources that you want to monitor.</p>
<p>Like dimensions, a scaling metric alert is individual to the resource that triggered it.</p>
<h2 id="exercise-use-metric-alerts-to-alert-on-performance-issues-in-your-azure-environment"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#exercise-use-metric-alerts-to-alert-on-performance-issues-in-your-azure-environment">Exercise - Use metric alerts to alert on performance issues in your Azure environment</a></h2>
<p>The shipping company you work for wants to avoid any future issues with updates to its applications on the Azure platform. To improve the alert capabilities in Azure, you made the choice to use Azure metric alerts.</p>
<p>In this exercise, you create a Linux virtual machine (VM). This VM runs an app that runs the CPU at 100 percent utilization. You create monitoring rules in the Azure portal and in the Azure CLI to alert you about high CPU usage.</p>
<h3 id="create-the-vm"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-the-vm">Create the VM</a></h3>
<p>This VM runs a specific configuration that stresses the CPU and generates the metric monitoring data needed to trigger an alert.</p>
<ol>
<li>
<p>Start by creating the configuration script. To create the <code>cloud-init.txt</code> file with the configuration for the VM, run the following command in Azure Cloud Shell:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cat &lt;&lt;EOF &gt; cloud-init.txt
#cloud-config
package_upgrade: true
packages:
- stress
runcmd:
- sudo stress --cpu 1
EOF
</code></pre></div>
</li>
<li>
<p>To set up an Ubuntu Linux VM, run the following <code>az vm create</code> command. This command uses the <code>cloud-init.txt</code> file that you created in the previous step to configure the newly created Ubuntu Linux VM.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az vm create \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --name vm1 \
    --location eastUS \
    --image Ubuntu2204 \
    --custom-data cloud-init.txt \
    --generate-ssh-keys
</code></pre></div>
</li>
</ol>
<h3 id="create-the-metric-alert-using-the-azure-portal"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-the-metric-alert-using-the-azure-portal">Create the metric alert using the Azure portal</a></h3>
<p>Note</p>
<p>Wait until the VM is successfully created before proceeding with the exercise. The VM creation process is complete when you get the completed JSON output in the Azure Cloud Shell window.</p>
<p>You can use either the Azure portal or the CLI to create a metric alert. In this exercise, we cover both, starting with the Azure portal.</p>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> using the same account that you used to activate the sandbox.</p>
</li>
<li>
<p>On the Azure portal menu, search for and select <strong>Monitor</strong>. On the <strong>Monitor Overview</strong> page, select <strong>Alerts</strong>.</p>
</li>
<li>
<p>Open the <strong>+ Create</strong> menu, and select <strong>Alert rule</strong></p>
</li>
<li>
<p>On the <strong>Select a resource</strong> pane, set the scope for your alert rule. You can filter by subscription, resource type, or resource location.</p>
</li>
<li>
<p>In the <strong>Resource types</strong> drop-down, start to type "virtual machines", and select <strong>Virtual machines</strong>.</p>
</li>
<li>
<p>Check the box next to <strong>vm1</strong>, then select <strong>Apply</strong> at the bottom of the pane.</p>
<p><img alt="Screenshot that shows the 'Select a resource' pane, with vm1 selected." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/4-select-resource-scope.png" /></p>
</li>
<li>
<p>Select <strong>Next:Condition</strong> at the bottom of the page.</p>
</li>
<li>
<p>In the <strong>Signal name</strong> drop-down, select <strong>Percentage CPU</strong>.</p>
</li>
<li>
<p>In the <strong>Alert logic</strong> section, enter (or confirm) the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Alert logic</strong></td>
<td></td>
</tr>
<tr>
<td>Threshold</td>
<td>Static</td>
</tr>
<tr>
<td>Aggregation type</td>
<td>Maximum</td>
</tr>
<tr>
<td>Operator</td>
<td>Greater than</td>
</tr>
<tr>
<td>Threshold value</td>
<td>90</td>
</tr>
<tr>
<td><strong>When to evaluate</strong></td>
<td></td>
</tr>
<tr>
<td>Check every</td>
<td>1 minute</td>
</tr>
<tr>
<td>Lookback period</td>
<td>1 minute</td>
</tr>
</tbody>
</table>
<pre><code>![Screenshot that shows the settings for metric condition logic.](https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/4-metric-alert-logic.png)
</code></pre>
<ol>
<li>Select the <strong>Details</strong> tab at the top of the page. In the <strong>Alert rule details</strong> section, enter the following values for each setting.</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Severity</td>
<td>2 - Warning</td>
</tr>
<tr>
<td>Alert rule name</td>
<td>Cpu90PercentAlert</td>
</tr>
<tr>
<td>Description</td>
<td>Virtual machine is running at or greater than 90% CPU utilization</td>
</tr>
</tbody>
</table>
<ol>
<li>Expand the <strong>Advanced options</strong> section and confirm the following values for each setting.</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enable upon creation</td>
<td>Yes (checked)</td>
</tr>
<tr>
<td>Automatically resolve alerts</td>
<td>Yes (checked)</td>
</tr>
</tbody>
</table>
<pre><code>[![Screenshot that shows the completed settings for the Alert rule details section.](https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/4-metric-alert-details.png)](https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/4-metric-alert-details.png#lightbox)
</code></pre>
<ol>
<li>Select <strong>Review + create</strong> to validate your input, and then select <strong>Create</strong>.</li>
</ol>
<p>You successfully created a metric alert rule that triggers an alert when the CPU percentage on the VM exceeds 90 percent. The rule checks every minute and reviews one minute of data. It can take up to 10 minutes for a metric alert rule to become active.</p>
<h3 id="create-the-metric-alert-through-the-cli"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-the-metric-alert-through-the-cli">Create the metric alert through the CLI</a></h3>
<p>You can also set up metric alerts by using the CLI. This process can be quicker than using the portal, especially if you're planning to set up more than one alert.</p>
<p>Let's create a new metric alert similar to the one you set up in the Azure portal.</p>
<ol>
<li>
<p>Run the following command in Cloud Shell to obtain the resource ID of the virtual machine you previously created:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>VMID=$(az vm show \
        --resource-group &quot;[sandbox resource group name]&quot; \
        --name vm1 \
        --query id \
        --output tsv)
</code></pre></div>
</li>
<li>
<p>Run the following command to create a new metric alert. The alert is triggered when the VM CPU is greater than 80 percent.</p>
<p>Azure CLICopy</p>
<div class="highlight"><pre><span></span><code>az monitor metrics alert create \
    -n &quot;Cpu80PercentAlert&quot; \
    --resource-group &quot;[sandbox resource group name]&quot; \
    --scopes $VMID \
    --condition &quot;max percentage CPU &gt; 80&quot; \
    --description &quot;Virtual machine is running at or greater than 80% CPU utilization&quot; \
    --evaluation-frequency 1m \
    --window-size 1m \
    --severity 3
</code></pre></div>
</li>
</ol>
<h3 id="view-your-metric-alerts-in-azure-monitor"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-your-metric-alerts-in-azure-monitor">View your metric alerts in Azure Monitor</a></h3>
<p>In this exercise, you set up an Ubuntu VM and configured it to stress test the CPU. You also created a metric rule to detect when the maximum CPU percentage exceeds 80 percent and 90 percent.</p>
<p>Note</p>
<p>It might take 10 minutes before you see the alerts show up in the Azure portal.</p>
<ol>
<li>
<p>Return to the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a>.</p>
</li>
<li>
<p>On the Azure portal menu, select <strong>Monitor</strong>, and then select <strong>Alerts</strong> in the left menu pane.</p>
<p>This step presents the Alert summary pane, where you can see the count of the number of alerts. If you don't see your alerts listed, wait a few minutes and select <strong>Refresh</strong>.</p>
<p><img alt="Screenshot that shows the alert summary pane.' pane." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/4-alert-summary-pane.png" /></p>
</li>
<li>
<p>You configured your metric alerts with severities of 2 and 3. Select one of the alerts to view the severity level.</p>
</li>
<li>
<p>Select one of the alerts to show the alert details.</p>
</li>
</ol>
<h2 id="use-log-search-alerts-to-alert-on-events-in-your-application"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-log-search-alerts-to-alert-on-events-in-your-application">Use log search alerts to alert on events in your application</a></h2>
<p>You can use Azure Monitor to capture important information from log files. Applications, operating systems, other hardware, or Azure services can create these log files.</p>
<p>As a solution architect, you want to explore ways that monitoring log data can detect issues before they become issues for your customers. You know that Azure Monitor supports the use of log data.</p>
<p>In this unit, you understand how using log data can improve resilience in your system.</p>
<h3 id="when-to-use-log-search-alerts"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#when-to-use-log-search-alerts">When to use log search alerts</a></h3>
<p>Log search alerts use log data to assess the rule logic and, if necessary, trigger an alert. This data can come from any Azure resource: server logs, application server logs, or application logs.</p>
<p>By its nature, log data is historical, so usage is focused on analytics and trends.</p>
<p>You can use these types of logs to assess if any of your servers exceeded their CPU utilization by a given threshold during the last 30 minutes. Or, you could evaluate response codes issued on your web application server in the last hour.</p>
<h3 id="how-log-search-alerts-work"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#how-log-search-alerts-work">How log search alerts work</a></h3>
<p>Log search alerts behave in a slightly different way than other alert mechanisms. The first part of a log search alert defines the log search rule. The rule defines how often it should run, the time period under evaluation, and the query to be run.</p>
<p>When a log search evaluates as positive, it creates an alert record and triggers any associated actions.</p>
<h3 id="composition-of-log-search-rules"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#composition-of-log-search-rules">Composition of log search rules</a></h3>
<p>Every log search alert has an associated search rule with the following composition:</p>
<ul>
<li><strong>Log query</strong>: Query that runs every time the alert rule fires.</li>
<li><strong>Time period</strong>: Time range for the query.</li>
<li><strong>Frequency</strong>: How often the query should run.</li>
<li><strong>Threshold</strong>: Trigger point for an alert to be created.</li>
</ul>
<p>Log search results are one of two types: <em>number of records</em> or <em>metric measurement</em>.</p>
<h4 id="number-of-records"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#number-of-records">Number of records</a></h4>
<p>Consider using the number-of-records type of log search when you're working with an event or event-driven data. Examples are syslog and web-app responses.</p>
<p>This type of log search returns a single alert when the number of records in a search result reaches or exceeds the value for the number of records (threshold). For example, when the threshold for the search rule is greater or equal to five, the query results have to return five or more rows of data before the alert is triggered.</p>
<h4 id="metric-measurement"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#metric-measurement">Metric measurement</a></h4>
<p>Metric measurement logs offer the same basic functionality as metric alert logs.</p>
<p>Unlike number-of-records search logs, metric measurement logs require further criteria to be set:</p>
<ul>
<li><strong>Aggregate function</strong>: The calculation to be made against the result data. An example is count or average. The result of the function is called <strong>AggregatedValue</strong>.</li>
<li><strong>Group field</strong>: Indicates how the result should be grouped. This criterion is used with the aggregated value. For example, you might specify that you want the average grouped by computer.</li>
<li><strong>Interval</strong>: The time interval by which data is aggregated. For example, if you specify 10 minutes, an alert record is created for each aggregated block of 10 minutes.</li>
<li><strong>Threshold</strong>: A point defined by an aggregated value and the total number of breaches.</li>
</ul>
<p>Consider using this type of alert when you need to add a level of tolerance to the results found. One use for this type of alert is to respond if a particular trend or pattern is found. For example, if the number of breaches is five, and any server in your group exceeds 85 percent CPU utilization more than five times within the given time period, an alert fires.</p>
<p>As you can see, metric measurements greatly reduce the volume of alerts that are produced. Still, give careful consideration when you're setting the threshold parameters to avoid missing critical alerts.</p>
<h3 id="stateless-nature-of-log-search-alerts"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#stateless-nature-of-log-search-alerts">Stateless nature of log search alerts</a></h3>
<p>One of the primary considerations when you're evaluating the use of log search alerts is that they're stateless (stateful log search alerts are <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-types#log-alerts">currently in preview</a>). A stateless log search alert generates new alerts every time the rule criteria are triggered, regardless of whether the alert was previously recorded.</p>
<h2 id="use-activity-log-alerts-to-alert-on-events-within-your-azure-infrastructure"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-activity-log-alerts-to-alert-on-events-within-your-azure-infrastructure">Use activity log alerts to alert on events within your Azure infrastructure</a></h2>
<p>Activity log alerts allow you to be notified when a specific event happens on some Azure resource. For example, you can be notified when someone creates a new virtual machine (VM) in a subscription.</p>
<p>An activity log can also include alerts for Azure service health. A company can get notifications when service issues or planned maintenance happens on the Azure platform.</p>
<p>As an Azure solution architect, you want to explore the capability to monitor selected Azure resources within your subscription. You want to understand how you can use the resources to improve your team's responsiveness and the stability of your systems.</p>
<p>In this unit, you explore the two different kinds of activity log alerts. Now that you're aware of the different kinds of alerts you can use in Azure Monitor, you want to know how you can trigger actions for your alerts. Actions might include sending an email or creating an IT Service Management (ITSM) support ticket.</p>
<h3 id="when-to-use-activity-log-alerts"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#when-to-use-activity-log-alerts">When to use activity log alerts</a></h3>
<p>So far, you learned about two different types of alerts supported in Azure Monitor. <em>Metric alerts</em> are ideally suited to monitoring for threshold breaches or spotting trends; <em>Log search alerts</em> allow for greater analytical monitoring of historical data.</p>
<p><em>Activity log alerts</em> are designed to work with Azure resources. Typically, you create this type of log to receive notifications when specific changes occur on a resource within your Azure subscription.</p>
<p>There are two types of activity log alerts:</p>
<ul>
<li><strong>Specific operations</strong>: Applies to resources within your Azure subscription, and often has a scope with specific resources or a resource group. You use this type when you need to receive an alert that reports a change to an aspect of your subscription. For example, you can receive an alert if a VM is deleted or new roles are assigned to a user.</li>
<li><strong>Service health events</strong>: Include notice of incidents and maintenance of target resources.</li>
</ul>
<h3 id="composition-of-an-activity-log-alert"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#composition-of-an-activity-log-alert">Composition of an activity log alert</a></h3>
<p>It's important to note that activity log alerts monitor events only in the subscription where the alert was created.</p>
<p>Activity log alerts are based on events. The best approach for defining them is to use Azure Monitor to filter all the events in your subscription until you find the one that you want. To begin the creation process, you then select <strong>Add activity log alert</strong>.</p>
<p>Like the previous alerts, activity log alerts have their own attributes:</p>
<ul>
<li><strong>Category</strong>: Administrative, service health, autoscale, policy, or recommendation</li>
<li><strong>Scope</strong>: Resource level, resource group level, or subscription level</li>
<li><strong>Resource group</strong>: Where the alert rule is saved</li>
<li><strong>Resource type</strong>: Namespace for the target of the alert</li>
<li><strong>Operation name</strong>: Operation name</li>
<li><strong>Level</strong>: Verbose, informational, warning, error, or critical</li>
<li><strong>Status</strong>: Started, failed, or succeeded</li>
<li><strong>Event initiated by</strong>: Email address or Microsoft Entra identifier (known as the "caller") for the user</li>
</ul>
<h4 id="create-a-resource-specific-log-alert"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-resource-specific-log-alert">Create a resource-specific log alert</a></h4>
<p>When you create your activity log alert, you select <strong>Activity Log</strong> for the signal type. You then see all the available alerts for the resource you select. The following image shows all the administrative alerts for Azure VMs. In this example, an alert is triggered when a VM is powered off.</p>
<p>Changing the monitor service enables you to reduce the list of options. Selecting <strong>Administrative</strong> filters all the signals to show only admin-related signals.</p>
<p><img alt="Screenshot of the signal logic for activity log alerts related to VMs." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/6-example-activity-log-alert.png" /></p>
<h4 id="create-a-service-health-alert"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-service-health-alert">Create a service health alert</a></h4>
<p>Service health alerts aren't like all the other alert types you learned about in this module so far. To create a new alert, search for and select <strong>Service Health</strong> in the Azure portal. Next, select <strong>Health alerts</strong>. After you select <strong>Create service health alert</strong>, the steps to create the alert are similar to the steps used to create other alerts.</p>
<p><img alt="Screenshot that shows how to create a new service health alert." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/6-service-health-alerts.png" /></p>
<p>The only difference is that you no longer need to select a resource, because the alert is for a whole region in Azure. What you can select is the kind of health event on which you want to be alerted. You can select service issues, planned maintenance, health advisories, or choose all of the events. The remaining steps of performing actions and naming the alerts are the same.</p>
<h2 id="use-action-groups-and-alert-processing-rules-to-send-notifications-when-an-alert-is-fired"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-action-groups-and-alert-processing-rules-to-send-notifications-when-an-alert-is-fired">Use action groups and alert processing rules to send notifications when an alert is fired</a></h2>
<p>Azure Monitor, Azure Service Health, and Azure Advisor use <em>action groups</em> to notify users about the alert, and to take an action when an alert is fired. An action group is a collection of notification preferences and actions that are executed when the alert is fired. You can run one or more actions for each triggered alert.</p>
<p>Azure Monitor can perform any of the following actions:</p>
<ul>
<li>Send an email</li>
<li>Send a Short Message Service (SMS) message</li>
<li>Create an Azure app push notification</li>
<li>Make a voice call to a number</li>
<li>Call an Azure function</li>
<li>Trigger a logic app</li>
<li>Send a notification to a webhook</li>
<li>Create an IT Service Management (ITSM) ticket</li>
<li>Use a runbook (to restart a virtual machine (VM) or scale a VM up or down)</li>
</ul>
<p>Once you create an action group, you can reuse that action group as often as you want. For example, after you create an action to email your company's operations team, you can add that action group to all service-health events.</p>
<p>While you're creating the alert rule, you can either create a new action group or add an existing action group to the alert rule. You can also edit an existing alert to add an action group.</p>
<h3 id="alert-processing-rules"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#alert-processing-rules">Alert processing rules</a></h3>
<p>Use alert processing rules to override the normal behavior of a fired alert by adding or suppressing an action group. You can use alert processing rules to add action groups or remove (suppress) action groups from your fired alerts. Alert processing rules are different from alert rules. Alert rules trigger alerts when a condition is met in your monitored resources. Alert processing rules modify the alerts as they're being fired.</p>
<p>You can use alert processing rules to:</p>
<ul>
<li>Suppress notifications during planned maintenance windows.</li>
<li>Implement management at scale, by specifying commonly used logic in a single rule, instead of having to set it consistently in all your alert rules.</li>
<li>Add an action group to all alert types.</li>
</ul>
<p>You can apply alert processing rules to different resource scopes, from a single resource, or to an entire subscription. You can also use them to apply various filters or have the rule work on a predefined schedule.</p>
<p>You can control when the alert processing rule applies. By default the rule is always active. But, you can select a one-time window for this rule to apply, or you can set a recurrence such as a weekly recurrence.</p>
<h2 id="exercise-use-an-activity-log-alert-and-an-action-group-to-notify-users-about-events-in-your-azure-infrastructure"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#exercise-use-an-activity-log-alert-and-an-action-group-to-notify-users-about-events-in-your-azure-infrastructure">Exercise -Use an activity log alert and an action group to notify users about events in your Azure infrastructure</a></h2>
<p>The shipping company for which you work wants to avoid any future issues with updates to its applications on the Azure platform. To improve the alerting capabilities within Azure, you can create activity log alerts.</p>
<p>Your goal is to set up a Linux virtual machine (VM) and create an activity log monitoring rule to detect when a VM is deleted. Then, delete the VM to trigger this alert.</p>
<h3 id="create-the-azure-activity-log-monitor"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-the-azure-activity-log-monitor">Create the Azure activity log monitor</a></h3>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> with the same account you used to activate the sandbox.</p>
</li>
<li>
<p>On the Azure portal resource menu or under <strong>Azure services</strong>, select <strong>Monitor</strong>. The <strong>Overview</strong> pane for Monitor appears.</p>
</li>
<li>
<p>In the Monitor menu, select <strong>Alerts</strong>. The <strong>Monitor | Alerts</strong> pane appears.</p>
</li>
<li>
<p>On the command bar, select <strong>Create +</strong> and select <strong>Alert rule</strong>. The <strong>Create an alert rule</strong> pane appears with the <strong>Scope</strong> section open and the <strong>Select a resource</strong> pane open on the right-hand side of your screen.</p>
</li>
<li>
<p>In the <strong>Resource type</strong> dropdown list, search for and select <strong>Virtual machines</strong>.</p>
</li>
<li>
<p>You want an alert when any virtual machine in your resource group is deleted. Select the box for the <strong>[sandbox resource group name]</strong> resource group, then select <strong>Apply</strong>.</p>
<p><img alt="Screenshot that shows the Select a scope pane with the sandbox resource group selected." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/7-alert-select-resource.png" /></p>
</li>
<li>
<p>The <strong>Create an alert rule</strong> pane reappears with the Scope target resource showing <strong>All Virtual machines</strong>. Select the <strong>Condition</strong> tab. The <strong>Select a signal</strong> pane appears.</p>
</li>
<li>
<p>Select the <strong>See all signals</strong> link, then search for and select <strong>Delete Virtual Machine (Virtual Machines)</strong>. Select <strong>Apply</strong></p>
</li>
<li>
<p>The <strong>Create an alert rule</strong> pane reappears. You want to receive alerts of all types, so leave <strong>Alert logic</strong> settings at their default of <strong>All selected</strong>. Leave the <strong>Create an alert rule</strong> pane open for the next section.</p>
</li>
</ol>
<h3 id="add-an-email-alert-action"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#add-an-email-alert-action">Add an email alert action</a></h3>
<p>For the previous Azure Monitor alert, you didn't add any actions. You just viewed triggered alerts in the Azure portal. Actions let you send an email for notifications, to trigger an Azure function, or to call a webhook. In this exercise, we're adding an email alert when VMs are deleted.</p>
<ol>
<li>
<p>On the <strong>Create an alert rule</strong> pane, select the <strong>Next: Actions</strong> button, and select <strong>Use action groups</strong>.</p>
</li>
<li>
<p>Select <strong>Create action group</strong> in the <strong>Select action group</strong> pane. The <strong>Create an action group</strong> pane appears.</p>
</li>
<li>
<p>On the <strong>Basics</strong> tab, enter the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Project details</strong></td>
<td></td>
</tr>
<tr>
<td>Subscription</td>
<td><strong>Concierge Subscription</strong></td>
</tr>
<tr>
<td>Resource group</td>
<td>From the dropdown list, select your sandbox resource group</td>
</tr>
<tr>
<td>Region</td>
<td><strong>Global</strong> (default)</td>
</tr>
<tr>
<td><strong>Instance details</strong></td>
<td></td>
</tr>
<tr>
<td>Action group name</td>
<td><strong>Alert the operations team</strong></td>
</tr>
<tr>
<td>Display name</td>
<td><strong>AlertOps</strong></td>
</tr>
</tbody>
</table>
<ol>
<li>Select <strong>Next: Notifications</strong>, and enter the following values for each setting.</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Notification type</td>
<td>Select <strong>Email/SMS message/Push/Voice</strong></td>
</tr>
<tr>
<td>Name</td>
<td><strong>VM was deleted</strong></td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>The <strong>Email/SMS message/Push/Voice</strong> pane appears automatically. If it didn't, select the <strong>Edit</strong> pencil icon.</p>
</li>
<li>
<p>Select <strong>Email</strong>, and in the <strong>Email</strong> box, enter your email address, and then select <strong>OK</strong>.</p>
</li>
<li>
<p>Select <strong>Review + create</strong> to validate your input.</p>
</li>
<li>
<p>Select <strong>Create</strong>.</p>
</li>
<li>
<p>The <strong>Create an alert rule</strong> pane reappears. Select <strong>Next: Details</strong> and enter the following values for each setting.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alert rule name</td>
<td><strong>VM was deleted</strong></td>
</tr>
<tr>
<td>Description</td>
<td><strong>A VM in your resource group was deleted</strong></td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>Expand the <strong>Advanced options</strong> section and confirm that <strong>Enable alert rule upon creation</strong> is selected.</p>
<p><img alt="Screenshot that shows a completed alert details section." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/7-all-vm-alert-details.png" /></p>
</li>
<li>
<p>Select <strong>Review + create</strong> to validate your input, then select <strong>Create</strong>.</p>
</li>
</ol>
<p>Recipients added to the configured action group (operations team) receive a notification:</p>
<ul>
<li>When they're added to the action group</li>
<li>When the alert is activated</li>
<li>When the alert is triggered</li>
</ul>
<p>It can take up to five minutes for an activity log alert rule to become active. In this exercise, if you delete the virtual machine before the rule deploys, the alert rule might not be triggered. Because of this delay, you might not see the same results in the following steps after you delete the VM.</p>
<h3 id="delete-your-virtual-machine"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#delete-your-virtual-machine">Delete your virtual machine</a></h3>
<p>To trigger an alert, you need to delete the Linux VM that you created in the previous exercise.</p>
<ol>
<li>
<p>On the Azure portal menu or from the <strong>Home</strong> page, select <strong>Virtual machines</strong>.</p>
</li>
<li>
<p>Check the box for the <strong>vm1</strong> virtual machine.</p>
</li>
<li>
<p>Select <strong>Delete</strong> from the menu bar.</p>
</li>
<li>
<p>Enter <em>delete</em> to confirm deletion and select <strong>Delete</strong>.</p>
</li>
<li>
<p>In the title bar, select the <strong>Notifications</strong> icon and wait until <strong>vm1</strong> is successfully deleted.</p>
</li>
</ol>
<h3 id="view-your-activity-log-alerts-in-azure-monitor"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-your-activity-log-alerts-in-azure-monitor">View your activity log alerts in Azure Monitor</a></h3>
<p>In the exercise, you set up an Ubuntu VM and created an activity log rule to detect when the VM was deleted. You then deleted a VM from your resource group. Let's check whether an alert was triggered.</p>
<ol>
<li>
<p>You should receive a notification email that reads, <strong>Important notice: Azure Monitor alert VM was deleted was activated...</strong> If not, open your email program and look for an email from azure-noreply@microsoft.com.</p>
<p><img alt="Screenshot of alert email." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/7-alert-email.png" /></p>
</li>
<li>
<p>On the Azure portal resource menu, select <strong>Monitor</strong>, and then select <strong>Alerts</strong> in the menu on the left.</p>
</li>
<li>
<p>You should have three verbose alerts that were generated by deleting <strong>vm1</strong>.</p>
<p><img alt="Screenshot that shows all alerts with Name, Severity, Alert condition, User response and Fired time." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/7-vm-rg-deleted-alert.png" /></p>
</li>
<li>
<p>Select the name of one of the alerts (For example, <strong>VM was deleted</strong>). An <strong>Alert details</strong> pane appears that shows more details about the event.</p>
</li>
</ol>
<h3 id="add-an-alert-processing-rule-to-the-alert"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#add-an-alert-processing-rule-to-the-alert">Add an alert processing rule to the alert</a></h3>
<p>We're going to schedule a one-time, overnight, planned maintenance. It starts in the evening and continues until the next morning.</p>
<ol>
<li>
<p>In the Azure portal resource menu, select <strong>Monitor</strong>, select <strong>Alerts</strong> in the menu on the left, and select <strong>Alert processing rules</strong> in the menu bar.</p>
</li>
<li>
<p>Select <strong>+ Create</strong>.</p>
</li>
<li>
<p>Check the box for your sandbox resource group as the scope of the alert processing rule, then select <strong>Apply</strong>.</p>
</li>
<li>
<p>Select <strong>Next: Rule settings</strong>, then select <strong>Suppress notifications</strong>.</p>
</li>
<li>
<p>Select <strong>Next: Scheduling</strong>.</p>
</li>
<li>
<p>By default, the rule works all the time, unless you disable it. We're going to define the rule to suppress notifications for a one-time overnight planned maintenance. Enter these settings for the scheduling of the alert processing rule:</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Apply the rule</td>
<td>At a specific time</td>
</tr>
<tr>
<td>Start</td>
<td>Enter today's date at 10pm.</td>
</tr>
<tr>
<td>End</td>
<td>Enter tomorrow's date at 7am.</td>
</tr>
<tr>
<td>Time zone</td>
<td>Select the local timezone.</td>
</tr>
</tbody>
</table>
<p><img alt="Screenshot of the scheduling section of an alert processing rule." src="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/8-alert-processing-rule-schedule.png" /><a href="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/8-alert-processing-rule-schedule.png#lightbox">https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/media/8-alert-processing-rule-schedule.png#lightbox</a></p>
<ol>
<li>Select <strong>Next: Details</strong> and enter these settings:</li>
</ol>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Resource group</td>
<td>Select your sandbox resource group.</td>
</tr>
<tr>
<td>Rule name</td>
<td><strong>Planned Maintenance</strong></td>
</tr>
<tr>
<td>Description</td>
<td><strong>Suppress notifications during planned maintenance.</strong></td>
</tr>
</tbody>
</table>
<ol>
<li>Select <strong>Review + create</strong> to validate your input, then select <strong>Create</strong>.</li>
</ol>
<hr />
<h2 id="analyze-your-azure-infrastructure-by-using-azure-monitor-logs"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#analyze-your-azure-infrastructure-by-using-azure-monitor-logs">Analyze your Azure infrastructure by using Azure Monitor logs</a></h2>
<h2 id="introduction_5"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_5">Introduction</a></h2>
<p>Logging and monitoring the health of your services is a vital component of production applications. You need to be able to determine the causes of failures. You also need to identify any problems before they occur.</p>
<p>Azure Monitor is an important tool to help you in this process. It allows you to gather monitoring and diagnostic information about the health of your services. You can use this information to visualize and analyze the causes of problems that might occur in your app.</p>
<p>Suppose that you work for a large organization's operations team. The organization is running large-scale production apps in the cloud. The team wants to consolidate its log data in a single service to improve visibility across services and simplify its logging strategy.</p>
<p>The team began implementing Azure Monitor logs. It wants to fully understand how the logs work. It also wants to know the service's capabilities to query and evaluate the log data that's fed into it.</p>
<h3 id="learning-objectives_3"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives_3">Learning objectives</a></h3>
<p>In this module, you'll:</p>
<ul>
<li>Identify the features and capabilities of Azure Monitor logs.</li>
<li>Create basic Azure Monitor log queries to extract information from log data.</li>
</ul>
<h2 id="features-of-azure-monitor-logs"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#features-of-azure-monitor-logs">Features of Azure Monitor logs</a></h2>
<p>Azure Monitor is a service for collecting and analyzing telemetry. It helps you get maximum performance and availability for your cloud applications and for your on-premises resources and applications. It shows how your applications are performing and identifies any issues with them.</p>
<h3 id="data-collection-in-azure-monitor"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#data-collection-in-azure-monitor">Data collection in Azure Monitor</a></h3>
<p>Azure Monitor collects two fundamental types of data: metrics and logs. Metrics tell you how a resource is performing and the other resources that it's consuming. Logs contain records that show when resources are created or modified.</p>
<p>The following diagram gives a high-level view of Azure Monitor. On the left are the data-monitoring sources: Azure, operating systems, and custom sources. At the center of the diagram are the data stores for metrics and logs. On the right are the functions that Azure Monitor performs with this collected data, such as analysis, alerting, and streaming to external systems.</p>
<p><img alt="Diagram of Azure Monitor's architecture, displaying the sources of monitoring data, the data stores, and functions performed on the data." src="https://learn.microsoft.com/en-us/training/modules/analyze-infrastructure-with-azure-monitor-logs/media/2-azure-monitor.svg" /></p>
<p>Azure Monitor collects data automatically from a range of components. For example:</p>
<ul>
<li><strong>Application data</strong>: Data that relates to your custom application code.</li>
<li><strong>Operating-system data</strong>: Data from the Windows or Linux virtual machines that host your application.</li>
<li><strong>Azure resource data</strong>: Data that relates to the operations of an Azure resource, such as a web app or a load balancer.</li>
<li><strong>Azure subscription data</strong>: Data that relates to your subscription, including data about Azure health and availability.</li>
<li><strong>Azure tenant data</strong>: Data about your Azure organization-level services, such as Microsoft Entra ID.</li>
</ul>
<p>Because Azure Monitor is an automatic system, it begins to collect data from these sources as soon as you create Azure resources like virtual machines and web apps. You can extend the data that Azure Monitor collects by:</p>
<ul>
<li><strong>Enabling diagnostics</strong>: For some resources, such as Azure SQL Databases, you'll receive full information about a resource only after you've enabled diagnostic logging for it. You can use the Azure portal, the Azure CLI, or PowerShell to enable diagnostics.</li>
<li><strong>Adding an agent</strong>: For virtual machines, you can install the Log Analytics agent and configure it to send data to a Log Analytics workspace. This agent increases the amount of information that's sent to Azure Monitor.</li>
</ul>
<p>Your developers might also want to send data to Azure Monitor from custom code such as a web app, an Azure function, or a mobile app. They send data by calling the Data Collector API. You can communicate with this REST interface through HTTP. This interface is compatible with various development frameworks such as .NET Framework, Node.js, and Python. Developers can choose their favorite language and framework to log data in Azure Monitor.</p>
<h4 id="logs"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#logs">Logs</a></h4>
<p>Logs contain time-stamped information about resource changes. The type of information recorded varies by log source. The log data is organized into records, with different sets of properties for each type of record. The logs can include numeric values like Azure Monitor metrics, but most include text data rather than numeric values.</p>
<p>The most common type of log entry records an event. Events can occur sporadically rather than at fixed intervals or according to a schedule. Applications and services create events and provide the event context. You can store metric data in logs to combine them with other monitoring data for analysis.</p>
<p>You can log data from Azure Monitor in a Log Analytics workspace. Azure provides an analysis engine and a rich query language. The logs show the context of any problems, and they're useful for identifying root causes.</p>
<p><img alt="Screenshot of an example query against Azure logs with the query text on top and a graph displaying the results below." src="https://learn.microsoft.com/en-us/training/modules/analyze-infrastructure-with-azure-monitor-logs/media/2-azure-logs-query-example.png" /></p>
<h4 id="metrics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#metrics">Metrics</a></h4>
<p>Metrics are numerical values that describe some aspect of a system at a point in time. Azure Monitor can capture metrics in near-real time. The metrics are collected at regular intervals, and they're useful for alerting because of their frequent sampling. You can use various algorithms to compare a metric to other metrics and observe trends over time.</p>
<p>Metrics are stored in a time-series database. This data store is most effective for analyzing time-stamped data. Metrics are suited for alerting and fast detection of issues. They can tell you about system performance. If needed, you can combine them with logs to identify the root cause of issues.</p>
<p><img alt="Screenshot of an example chart in Azure Metrics displaying average CPU percentage." src="https://learn.microsoft.com/en-us/training/modules/analyze-infrastructure-with-azure-monitor-logs/media/2-azure-monitor-metrics.png" /></p>
<h3 id="analyzing-logs-by-using-kusto"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#analyzing-logs-by-using-kusto">Analyzing logs by using Kusto</a></h3>
<p>To retrieve, consolidate, and analyze data, you can specify a query to run in Azure Monitor logs. You can write a log query with the Kusto query language, which Azure Data Explorer also uses.</p>
<p>You can test log queries in the Azure portal so you can work with them interactively. You'll typically start with basic queries, then progress to more advanced functions as your requirements become more complex.</p>
<p>In the Azure portal, you can create custom dashboards, which are targeted displays of resources and data. You can build each dashboard from a set of tiles. Each tile might show a set of resources, a chart, a data table, or some custom text. Azure Monitor provides tiles that you can add to dashboards; for example, you might use a tile to display a Kusto query's results in a dashboard.</p>
<p>In the example scenario, the operations team can consolidate its monitoring data by visualizing it in charts and tables. These tools are effective for summarizing data and presenting it to different audiences.</p>
<p>By using Azure dashboards, you can combine various kinds of data—including both logs and metrics—into a single pane in the Azure portal. For example, you might want to create a dashboard that combines tiles that show a graph of metrics, a table of activity logs, charts from Azure Monitor, and a log query's output.</p>
<h2 id="create-basic-azure-monitor-log-queries-to-extract-information-from-log-data"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-basic-azure-monitor-log-queries-to-extract-information-from-log-data">Create basic Azure Monitor log queries to extract information from log data</a></h2>
<p>You can use Azure Monitor log queries to extract information from log data. Querying is an important part of examining the log data that Azure Monitor captures.</p>
<p>In the example scenario, the operations team uses Azure Monitor log queries to examine the health of its system.</p>
<h3 id="write-azure-monitor-log-queries-by-using-log-analytics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#write-azure-monitor-log-queries-by-using-log-analytics">Write Azure Monitor log queries by using Log Analytics</a></h3>
<p>You can find the Log Analytics tool in the Azure portal and use it to run sample queries or to create your own queries:</p>
<ol>
<li>
<p>In the Azure portal, in the left menu pane, select <strong>Monitor</strong>.</p>
<p>The Azure Monitor page appears along with more options, including <strong>Activity Log</strong>, <strong>Alerts</strong>, <strong>Metrics</strong>, and <strong>Logs</strong>.</p>
</li>
<li>
<p>Select <strong>Logs</strong>.</p>
<p>Here, you can enter your query and see the output.</p>
<p><img alt="Screenshot of Azure Monitor with a new query tab opened." src="https://learn.microsoft.com/en-us/training/modules/analyze-infrastructure-with-azure-monitor-logs/media/3-azure-monitor-portal-query-pane.png" /></p>
</li>
</ol>
<h3 id="write-queries-by-using-the-kusto-language"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#write-queries-by-using-the-kusto-language">Write queries by using the Kusto language</a></h3>
<p>You can use the Kusto Query Language to query log information for your services running in Azure. A Kusto query is a read-only request to process data and return results. You'll state the query in plain text by using a data-flow model that's designed to make the syntax easy to read, write, and automate. The query uses schema entities that are organized in a hierarchy similar to that of Azure SQL Database: databases, tables, and columns.</p>
<p>A Kusto query consists of a sequence of query statements delimited by a semicolon (<code>;</code>). At least one statement is a tabular expression statement. A tabular expression statement formats the data arranged as a table of columns and rows.</p>
<p>A tabular expression statement's syntax has a tabular data flow from one tabular query operator to another, starting with a data source. A data source might be a table in a database or an operator that produces data. The data then flows through a set of data-transformation operators that are bound together with the pipe (<code>|</code>) delimiter.</p>
<p>For example, the following Kusto query has a single tabular expression statement. The statement starts with a reference to a table called <code>Events</code>. The database that hosts this table is implicit here, and is part of the connection information. The data for that table, stored in rows, is filtered by the value of the <code>StartTime</code> column. The data is filtered further by the value of the <code>State</code> column. The query then returns the count of the resulting rows.</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>Events
| where StartTime &gt;= datetime(2018-11-01) and StartTime &lt; datetime(2018-12-01)
| where State == &quot;FLORIDA&quot;  
| count
</code></pre></div>
<p>Note</p>
<p>The Kusto query language that Azure Monitor uses is case-sensitive. Language keywords are typically written in lowercase. When you're using names of tables or columns in a query, make sure to use the correct case.</p>
<p>Events captured from the event logs of monitored computers are just one type of data source. Azure Monitor provides many other types of data sources. For example, the <code>Heartbeat</code> data source reports the health of all computers that report to your Log Analytics workspace. You can also capture data from performance counters and update management records.</p>
<p>The following example retrieves the most recent heartbeat record for each computer. The computer is identified by its IP address. In this example, the <code>summarize</code> aggregation with the <code>arg_max</code> function returns the record with the most recent value for each IP address.</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>Heartbeat
| summarize arg_max(TimeGenerated, *) by ComputerIP
</code></pre></div>
<h2 id="exercise-create-basic-azure-monitor-log-queries-to-extract-information-from-log-data"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#exercise-create-basic-azure-monitor-log-queries-to-extract-information-from-log-data">Exercise - Create basic Azure Monitor log queries to extract information from log data</a></h2>
<p>The operations team doesn't currently have enough information about its system behavior to diagnose and resolve problems effectively. To address this issue, the team has configured an Azure Monitor workspace with the company's Azure services. It runs Kusto queries to get the system's status and attempts to identify the causes of any problems that might occur.</p>
<p>In particular, the team is interested in monitoring security events to check for possible attempts to break into the system. An attacker might try to manipulate the applications running on the system, so the team also wants to gather application data for further analysis. An attacker might also try to halt the computers that compose the system, so the team wants to examine how and when machines are stopped and restarted.</p>
<p>In this exercise, you'll practice performing Azure log queries against a demo project that contains sample data in tables, logs, and queries.</p>
<h3 id="create-basic-azure-monitor-log-queries-to-extract-information-from-log-data_1"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-basic-azure-monitor-log-queries-to-extract-information-from-log-data_1">Create basic Azure Monitor log queries to extract information from log data</a></h3>
<p>Let's use the <strong>Azure Demo Logs pane</strong> to practice writing queries. The demo project workspace is prepopulated with sample data. Azure offers an optimized SQL-like query with visualization options of its data in a language called KQL (Kusto Query Language.)</p>
<ol>
<li>
<p>Open the <a href="https://portal.azure.com/learn.docs.microsoft.com/#blade/Microsoft_Azure_Monitoring_Logs/DemoLogsBlade?azure-portal=true">Logs demo environment</a>. In the top-left corner, under <strong>New Query 1</strong>, you'll find <strong>Demo</strong>, which identifies the query's workspace (or scope). The left side of this pane contains several tabs: <strong>Tables</strong>, <strong>Queries</strong>, and <strong>Functions</strong>. The right side has a scratchpad for creating or editing queries.</p>
</li>
<li>
<p>On the <strong>New Query 1</strong> tab, enter a basic query on the first line of the scratchpad. This query retrieves the details of the 10 most recent security events.</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>SecurityEvent
    | take 10
</code></pre></div>
</li>
<li>
<p>In the command bar, select <strong>Run</strong> to execute the query and view the results. You can expand each row in the results pane for more information.</p>
</li>
<li>
<p>Sort the data by time by adding a filter to your query:</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>SecurityEvent
    | top 10 by TimeGenerated
</code></pre></div>
</li>
<li>
<p>Add a filter clause and a time range. Run this query to fetch records that are more than 30 minutes old and that have a level of 10 or more:</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>SecurityEvent
    | where TimeGenerated &lt; ago(30m)
    | where toint(Level) &gt;= 10
</code></pre></div>
</li>
<li>
<p>Run the following query to search the <code>AppEvents</code> table for records of the <code>Clicked Schedule Button</code> event being invoked in the last 24 hours:</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>AppEvents 
    | where TimeGenerated &gt; ago(24h)
    | where Name == &quot;Clicked Schedule Button&quot;
</code></pre></div>
</li>
<li>
<p>Run the following query to display the number of different computers that generated heartbeat events each week for the last three weeks. The results appear as a bar chart:</p>
<p>KustoCopy</p>
<div class="highlight"><pre><span></span><code>Heartbeat
    | where TimeGenerated &gt;= startofweek(ago(21d))
    | summarize dcount(Computer) by endofweek(TimeGenerated) | render barchart kind=default
</code></pre></div>
</li>
</ol>
<h3 id="use-predefined-azure-log-queries-to-extract-information-from-log-data"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-predefined-azure-log-queries-to-extract-information-from-log-data">Use predefined Azure log queries to extract information from log data</a></h3>
<p>In addition to writing queries from scratch, the operations team can also take advantage of predefined queries in Azure Logs that answer common questions related to their resources' health, availability, usage, and performance.</p>
<ol>
<li>
<p>Use the <strong>Time Range</strong> parameter in the command bar to set a custom range. Select the month, year, and day to a range from January to today. You can set and apply a custom time to any query.</p>
</li>
<li>
<p>On the left toolbar, select <strong>Queries</strong>. In the drop-down list in the left menu, you can view a list of the sample queries grouped by <em>Category</em>, <em>Query type</em>, <em>Resource type</em>, <em>Solution</em>, or <em>Topic</em>.</p>
<p><img alt="Screenshot of Group By dropdown options under Queries tab in side pane." src="https://learn.microsoft.com/en-us/training/modules/analyze-infrastructure-with-azure-monitor-logs/media/4-azure-queries-category-groupby.png" /></p>
</li>
<li>
<p>Select <strong>Category</strong> in the drop-down list, then select <strong>IT &amp; Management Tools</strong>.</p>
</li>
<li>
<p>In the search box, enter <em>Distinct missing updates cross computers</em>. Double-click the query in the left pane, then select <strong>Run</strong>. The <strong>Logs</strong> pane reappears, with the query returning a list of Windows updates missing from virtual machines that are sending logs to the workspace.</p>
<p>Note</p>
<p>You can also run this same query from the <strong>Logs</strong> pane. In the left pane, select the <strong>Queries</strong> tab, then select <strong>Category</strong> in the <strong>Group by</strong> dropdown list. Now scroll down the list, expand <strong>IT &amp; Management Tools</strong>, and double-click <strong>Distinct missing updates cross computers</strong>. Select <strong>Run</strong> to run the query. When you select a predefined query in the left pane, the query code is appended to whatever query exists in the scratchpad. Remember to clear the scratchpad before opening or adding a new query to run.</p>
</li>
<li>
<p>In the left pane, clear the search box. Select <strong>Queries</strong>, then select <strong>Category</strong> in the <strong>Group by</strong> dropdown list. Expand <strong>Azure Monitor</strong> and double-click <strong>Computers availability today</strong>. Select <strong>Run</strong>. This query creates a time series chart with the number of unique IP addresses sending logs into the workspace each hour for the last day.</p>
</li>
<li>
<p>Select <strong>Topic</strong> in the <strong>Group by</strong> dropdown list, scroll down to expand <strong>Function App</strong>, and then double-click <strong>Show application logs from Function Apps</strong>. Select <strong>Run</strong>. This query returns a list of application logs, sorted by time with the latest logs shown first.</p>
</li>
</ol>
<p>You'll notice that from the Kusto queries you used here, it's easy to target a query to a specific time window, event level, or event log type. The security team can easily examine heartbeats to identify when servers are unavailable, which might indicate a denial-of-service attack. If the team spots the time when a server was unavailable, it can query for events in the security log around that time to diagnose whether an attack caused the interruption. Additionally, predefined queries can also evaluate VM availability, identify missing Windows updates, and review firewall logs to view denied network flows intended for the VMs of interest.</p>
<hr />
<h2 id="monitor-your-azure-virtual-machines-with-azure-monitor"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#monitor-your-azure-virtual-machines-with-azure-monitor">Monitor your Azure virtual machines with Azure Monitor</a></h2>
<h2 id="introduction_6"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_6">Introduction</a></h2>
<p>Suppose you're the IT administrator for a musical group's website hosted on Azure virtual machines (VMs). The website runs mission-critical services for the group, including ticket booking, venue information, and tour updates. The website must respond quickly and remain accessible during frequent updates and spikes in traffic.</p>
<p>You need to maintain sufficient VM size and memory to effectively host the website without incurring unnecessary costs. You also need to proactively prevent and quickly respond to any access, security, and performance issues. To help achieve these objectives, you want to quickly and easily monitor your VMs' traffic, health, performance, and events.</p>
<p>Azure Monitor provides built-in and customizable monitoring abilities. You can use these to track the health, performance, and behavior of the VM host and the operating system, workloads, and applications running on your VM. This learning module shows you how to view VM host monitoring data, set up recommended alert rules, and use VM insights and custom data collection rules (DCRs) to collect and analyze monitoring data from inside your VMs.</p>
<h3 id="prerequisites_3"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#prerequisites_3">Prerequisites</a></h3>
<p>To complete this module, you need the following prerequisites:</p>
<ul>
<li>Familiarity with virtualization, Azure portal navigation, and Azure VMs.</li>
<li>Access to an Azure subscription with at least <strong>Contributor</strong> role. If you don't have an Azure subscription, create a <a href="https://azure.microsoft.com/free/">free account</a> and add a subscription before you begin. If you're a student, you can take advantage of the <a href="https://azure.microsoft.com/free/students/">Azure for students</a> offer.</li>
</ul>
<h3 id="learning-objectives_4"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives_4">Learning objectives</a></h3>
<ul>
<li>Understand which monitoring data you need to collect from your VM.</li>
<li>Enable and view recommended alerts and diagnostics.</li>
<li>Use Azure Monitor to collect and analyze VM host data.</li>
<li>Use Azure Monitor Agent to collect VM client performance metrics and event logs.</li>
</ul>
<h2 id="introduction_7"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#introduction_7">Introduction</a></h2>
<p>Suppose you're the IT administrator for a musical group's website hosted on Azure virtual machines (VMs). The website runs mission-critical services for the group, including ticket booking, venue information, and tour updates. The website must respond quickly and remain accessible during frequent updates and spikes in traffic.</p>
<p>You need to maintain sufficient VM size and memory to effectively host the website without incurring unnecessary costs. You also need to proactively prevent and quickly respond to any access, security, and performance issues. To help achieve these objectives, you want to quickly and easily monitor your VMs' traffic, health, performance, and events.</p>
<p>Azure Monitor provides built-in and customizable monitoring abilities. You can use these to track the health, performance, and behavior of the VM host and the operating system, workloads, and applications running on your VM. This learning module shows you how to view VM host monitoring data, set up recommended alert rules, and use VM insights and custom data collection rules (DCRs) to collect and analyze monitoring data from inside your VMs.</p>
<h3 id="prerequisites_4"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#prerequisites_4">Prerequisites</a></h3>
<p>To complete this module, you need the following prerequisites:</p>
<ul>
<li>Familiarity with virtualization, Azure portal navigation, and Azure VMs.</li>
<li>Access to an Azure subscription with at least <strong>Contributor</strong> role. If you don't have an Azure subscription, create a <a href="https://azure.microsoft.com/free/">free account</a> and add a subscription before you begin. If you're a student, you can take advantage of the <a href="https://azure.microsoft.com/free/students/">Azure for students</a> offer.</li>
</ul>
<h3 id="learning-objectives_5"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#learning-objectives_5">Learning objectives</a></h3>
<ul>
<li>Understand which monitoring data you need to collect from your VM.</li>
<li>Enable and view recommended alerts and diagnostics.</li>
<li>Use Azure Monitor to collect and analyze VM host data.</li>
<li>Use Azure Monitor Agent to collect VM client performance metrics and event logs.</li>
</ul>
<h2 id="monitoring-for-azure-vms"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#monitoring-for-azure-vms">Monitoring for Azure VMs</a></h2>
<p>In this unit, you explore Azure monitoring capabilities for VMs, and the types of monitoring data you can collect and analyze with Azure Monitor. Azure Monitor is a comprehensive monitoring solution for collecting, analyzing, and responding to monitoring data from Azure and non-Azure resources, including VMs. Azure Monitor has two main monitoring features: Azure Monitor Metrics and Azure Monitor Logs.</p>
<p>Metrics are numerical values collected at predetermined intervals to describe some aspect of a system. Metrics can measure VM performance, resource utilization, error counts, user responses, or any other aspect of the system that you can quantify. Azure Monitor Metrics automatically monitors a predefined set of metrics for every Azure VM, and retains the data for 93 days with some exceptions.</p>
<p>Logs are recorded system events that contain a timestamp and different types of structured or free-form data. Azure automatically records activity logs for all Azure resources. This data is available at the resource level. Azure Monitor doesn't collect logs by default, but you can configure Azure Monitor Logs to collect from any Azure resource. Azure Monitor Logs stores log data in a Log Analytics workspace for querying and analysis.</p>
<h3 id="vm-monitoring-layers"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#vm-monitoring-layers">VM monitoring layers</a></h3>
<p>Azure VMs have several layers that require monitoring. Each of the following layers has a distinct set of telemetry and monitoring requirements.</p>
<ul>
<li>Host VM</li>
<li>Guest operating system (OS)</li>
<li>Client workloads</li>
<li>Applications that run on the VM</li>
</ul>
<p><img alt="Diagram that shows fundamental VM architecture." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/monitoring-layers.png" /></p>
<h3 id="host-vm-monitoring"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#host-vm-monitoring">Host VM monitoring</a></h3>
<p>The VM host represents the compute, storage, and network resources that Azure allocates to the VM.</p>
<h4 id="vm-host-metrics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#vm-host-metrics">VM host metrics</a></h4>
<p>VM host metrics measure technical aspects of the VM such as processor utilization and whether the machine is running. You can use VM host metrics to:</p>
<ul>
<li>Trigger an alert when your VM is reaching its disk or CPU limits.</li>
<li>Identify trends or patterns.</li>
<li>Control your operational costs by sizing VMs according to usage and demand.</li>
</ul>
<p>Azure automatically collects basic metrics for VM hosts. On the VM's <strong>Overview</strong> page in the Azure portal, you can see built-in graphs for the following important VM host metrics.</p>
<ul>
<li>VM availability</li>
<li>CPU usage percentage (average)</li>
<li>OS disk usage (total)</li>
<li>Network operations (total)</li>
<li>Disk operations per second (average)</li>
</ul>
<p>You can use Azure Monitor Metrics Explorer to plot more metrics graphs, investigate changes, and visually correlate metrics trends for your VMs. With Metrics Explorer you can:</p>
<ul>
<li>Plot multiple metrics on a graph to see how much traffic hits your VM and how the VM performs.</li>
<li>Track the same metric over multiple VMs in a resource group or other scope, and use splitting to show each VM on the graph.</li>
<li>Select flexible time ranges and granularity.</li>
<li>Specify many other settings such as chart type and value ranges.</li>
<li>Send graphs to workbooks or pin them to dashboards for quickly viewing health and performance.</li>
<li>Group metrics by time intervals, geographic regions, server clusters, or application components.</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/2-vm-metrics-screenshot.png#lightbox"><img alt="Screenshot showing CPU percentage usage and inbound flow chart." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/2-vm-metrics-screenshot.png" /></a></p>
<h4 id="recommended-alert-rules"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#recommended-alert-rules">Recommended alert rules</a></h4>
<p>Alerts proactively notify you of specified occurrences and patterns in your VM host metrics. <em>Recommended alert rules</em> are a predefined set of alert rules based on commonly monitored host metrics. These rules define recommended CPU, memory, disk, and network usage levels to alert on. The rules also include VM availability, which alerts you when the VM stops running.</p>
<p>You can quickly enable and configure recommended alert rules when you create an Azure VM, or afterwards from the VM's portal page. You can also view, configure, and create custom alerts by using Azure Monitor Alerts.</p>
<h4 id="activity-logs"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#activity-logs">Activity logs</a></h4>
<p>Azure Monitor automatically records and displays activity logs for Azure VMs. Activity logs include information like VM startup or modifications. You can create diagnostic settings to send activity logs to the following destinations:</p>
<ul>
<li><strong>Azure Monitor Logs:</strong> For more complex querying and alerting, and for longer retention up to two years.</li>
<li><strong>Azure Storage:</strong> For cheaper, long-term archiving.</li>
<li><strong>Azure Event Hubs:</strong> To forward outside of Azure.</li>
</ul>
<h4 id="boot-diagnostics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#boot-diagnostics">Boot diagnostics</a></h4>
<p>Boot diagnostics are host logs you can use to help troubleshoot boot issues with your VMs. You can enable boot diagnostics by default when you create a VM, or afterwards for existing VMs.</p>
<p>Once you enable boot diagnostics, you can see screenshots from the VM's hypervisor for both Windows and Linux machines, and view the serial console log output of the VM boot sequence for Linux machines. Boot diagnostics stores data in a managed storage account.</p>
<h3 id="guest-os-client-workload-and-application-monitoring"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#guest-os-client-workload-and-application-monitoring">Guest OS, client workload, and application monitoring</a></h3>
<p>VM client monitoring can include monitoring the operating system (OS), workloads, and applications that run on the VM. To collect metrics and logs from guest OS and client workloads and applications, you need to install Azure Monitor Agent and set up a DCR.</p>
<p>DCRs define what data to collect and where to send that data. You can use a DCR to send Azure Monitor metrics data, or <em>performance counters</em>, to Azure Monitor Logs or Azure Monitor Metrics. You can also send event log data to Azure Monitor Logs. In other words, Azure Monitor Metrics can store only metrics data, but Azure Monitor Logs can store both metrics and event logs.</p>
<h4 id="vm-insights"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#vm-insights">VM insights</a></h4>
<p>VM insights is an Azure Monitor feature that helps get you started monitoring your VM clients. VM insights is especially useful for exploring overall VM usage and performance when you don't yet know the metric of primary interest. VM insights provides:</p>
<ul>
<li>Simplified Azure Monitor Agent onboarding to enable monitoring a VM's guest OS and workloads.</li>
<li>A preconfigured DCR that monitors and collects the most common performance counters for Windows and Linux.</li>
<li>Predefined trending performance metrics charts and workbooks from the VM's guest OS.</li>
<li>A set of predefined workbooks that show collected VM client metrics over time.</li>
<li>Optionally, a collection of processes running on the VM, dependencies with other services, and a dependency map that displays interconnected components with other VMs and external sources.</li>
</ul>
<p>Predefined VM insights workbooks show performance, connections, active ports, traffic, and other collected data from one or several VMs. You can view VM insights data directly from a single VM, or see a combined view of multiple VMs to view and assess trends and patterns across VMs. You can edit the prebuilt workbook configurations, or create your own custom workbooks.</p>
<h4 id="client-event-log-data"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#client-event-log-data">Client event log data</a></h4>
<p>VM insights creates a DCR that collects a specific set of performance counters. To collect other data, such as event logs, you can create a separate DCR that specifies the data you want to collect from the VM and where to send it. Azure Monitor stores collected log data in a Log Analytics workspace. From there, you can access and analyze the data by using log queries written in Kusto Query Language (KQL).</p>
<h2 id="monitor-vm-host-data"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#monitor-vm-host-data">Monitor VM host data</a></h2>
<p>You want to monitor the VMs that host your website, so you decide to quickly create a VM in the Azure portal and evaluate its built-in monitoring capabilities. In this unit, you use the Azure portal to create a Linux VM with recommended alerts and boot diagnostics enabled. As soon as the VM starts up, Azure automatically begins collecting basic metrics and activity logs. You can then view built-in metrics graphs, activity logs, and boot diagnostics.</p>
<h3 id="create-a-vm-and-enable-recommended-alerts"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-vm-and-enable-recommended-alerts">Create a VM and enable recommended alerts</a></h3>
<ol>
<li>
<p>Sign in to the <a href="https://portal.azure.com/">Azure portal</a>, and in the Search field, enter <em>virtual machines</em>.</p>
</li>
<li>
<p>On the <strong>Virtual machines</strong> page, select <strong>Create</strong>, and then select <strong>Azure virtual machine</strong>.</p>
</li>
<li>
<p>On the <strong>Basics</strong> tab of the <strong>Create a virtual machine</strong> page:</p>
<ul>
<li>In the <strong>Subscription</strong> field, select the correct subscription if not already selected.</li>
<li>Under <strong>Resource group</strong>:<ol>
<li>Select <strong>Create new</strong>.</li>
<li>Under <strong>Name</strong>, enter <em>learn-monitor-vm-rg</em>.</li>
<li>Select <strong>OK</strong>.</li>
</ol>
</li>
<li>For <strong>Virtual machine name</strong>, enter <em>monitored-linux-vm</em>.</li>
<li>For <strong>Image</strong>, select <strong>Ubuntu Server 20.04 LTS - x64 Gen2</strong>.</li>
<li>Leave the other settings at their current values, and select the <strong>Monitoring</strong> tab.</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-vm-basic.png#lightbox"><img alt="Screenshot that shows the Basics tab of the Create a virtual machine page." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-vm-basic.png" /></a></p>
</li>
<li>
<p>On the <strong>Monitoring</strong> tab, select the checkbox next to <strong>Enable recommended alert rules</strong>.</p>
</li>
<li>
<p>On the <strong>Set up recommended alert rules</strong> screen:</p>
<ol>
<li>Select all the listed alert rules if not already selected, and adjust the values if desired.</li>
<li>Under <strong>Notify me by</strong>, select the checkbox next to <strong>Email</strong>, and enter an email address to receive alert notifications.</li>
<li>Select <strong>Save</strong>.</li>
<li>Under <strong>Diagnostics</strong>, for <strong>Boot diagnostics</strong>, ensure that <strong>Enable with managed storage account (recommended)</strong> is selected.</li>
</ol>
<p>Note</p>
<p>Don't select <strong>Enable OS guest diagnostics</strong>. The Linux Diagnostics Agent (LAD) is deprecated, and you can enable OS guest and client monitoring later.</p>
</li>
<li>
<p>Select <strong>Review + create</strong> at the bottom of the page, and when validation passes, select <strong>Create</strong>.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-vm-monitoring.png#lightbox"><img alt="Screenshot that shows the Monitoring tab and alert rule configuration screen of the Create a virtual machine page." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-vm-monitoring.png" /></a></p>
</li>
<li>
<p>On the <strong>Generate new key pair</strong> popup dialog box, select <strong>Download private key and create resource</strong>.</p>
</li>
</ol>
<p>It can take a few minutes to create the VM. When you get the notification that the VM is created, select <strong>Go to resource</strong> to see basic metrics data.</p>
<h3 id="view-built-in-metrics-graphs"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-built-in-metrics-graphs">View built-in metrics graphs</a></h3>
<p>Once your VM is created, Azure starts collecting basic metrics data automatically. Built-in metrics graphs, along with the recommended alerts you enabled, can help you monitor whether and when your VM encounters health or performance issues. You can then use more advanced monitoring and analytics capabilities to investigate issue causes and remediation.</p>
<ol>
<li>
<p>To view basic metrics graphs, on the VMs <strong>Overview</strong> page, select the <strong>Monitoring</strong> tab.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/select-monitoring.png#lightbox"><img alt="Screenshot that shows Monitoring tab on a VMs Overview screen." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/select-monitoring.png" /></a></p>
</li>
<li>
<p>Under <strong>Performance and utilization</strong> &gt; <strong>Platform metrics</strong>, review the following metrics graphs related to the VMs performance and utilization. Select <strong>Show more metrics</strong> if all the graphs don't appear immediately.</p>
<ul>
<li><strong>VM Availability</strong></li>
<li><strong>CPU (average)</strong></li>
<li><strong>Disk bytes (total)</strong></li>
<li><strong>Network (total)</strong></li>
<li><strong>Disk operations/sec (average)</strong></li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/platform-metrics.png#lightbox"><img alt="Screenshot that shows the platform metrics graphics on the VM Overview page." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/platform-metrics.png" /></a></p>
</li>
<li>
<p>Under <strong>Guest OS metrics</strong>, notice that guest OS metrics aren't being collected yet. In the next units, you configure VM insights and data collection rules to collect guest OS metrics.</p>
</li>
</ol>
<h3 id="view-the-activity-log"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-the-activity-log">View the activity log</a></h3>
<p>You can view the VMs activity log by selecting <strong>Activity log</strong> from the VMs left navigation menu. You can also retrieve entries by using PowerShell or the Azure CLI.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/activity-log.png#lightbox"><img alt="Screenshot of the activity log for a VM." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/activity-log.png" /></a></p>
<h3 id="view-boot-diagnostics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-boot-diagnostics">View boot diagnostics</a></h3>
<p>You enabled boot diagnostics when you created the VM. You can view boot diagnostics to view boot data and troubleshoot startup issues.</p>
<ol>
<li>
<p>In the left navigation menu for the VM, select <strong>Boot diagnostics</strong> under <strong>Help</strong>.</p>
</li>
<li>
<p>On the <strong>Boot diagnostics</strong> page, select <strong>Screenshot</strong> to see a startup screenshot from the VMs hypervisor. Select <strong>Serial log</strong> to view log messages created when the VM started.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-boot-diagnostics.png#lightbox"><img alt="Screenshot that shows the boot diagnostic image captured." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-boot-diagnostics.png" /></a></p>
</li>
</ol>
<h2 id="use-metrics-explorer-to-view-detailed-host-metrics"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#use-metrics-explorer-to-view-detailed-host-metrics">Use Metrics Explorer to view detailed host metrics</a></h2>
<p>You want to investigate how traffic flowing into your VM affects its CPU capability. If the built-in metrics charts for a VM don't already show the data you need, you can use Metrics Explorer to create customized metrics charts. In this unit, you plot a graph that displays your VM's maximum percentage CPU and average inbound flow data together.</p>
<p>Azure Monitor Metrics Explorer offers a UI for exploring and analyzing VM metrics. You can use Metrics Explorer to view and create custom charts for many VM host metrics in addition to the metrics shown on the built-in graphs.</p>
<h3 id="understand-metrics-explorer"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#understand-metrics-explorer">Understand Metrics Explorer</a></h3>
<p>To open Metrics Explorer, you can:</p>
<ul>
<li>Select <strong>Metrics</strong> from the VM's left navigation menu under <strong>Monitoring</strong>.</li>
<li>Select the <strong>See all Metrics</strong> link next to <strong>Platform metrics</strong> on the <strong>Monitoring</strong> tab of the VM's <strong>Overview</strong> page.</li>
<li>Select <strong>Metrics</strong> from the left navigation menu on the Azure Monitor <strong>Overview</strong> page.</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/metrics-explorer.png#lightbox"><img alt="Screenshot that shows Metrics Explorer." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/metrics-explorer.png" /></a></p>
<p>In Metrics Explorer, you can select the following values from the dropdown fields:</p>
<ul>
<li><strong>Scope:</strong> If you open Metrics Explorer from a VM, this field is prepopulated with the VM name. You can add more items with the same resource type (VMs) and location.</li>
<li><strong>Metric Namespace</strong>: Most resource types have only one namespace, but for some types, you must pick a namespace. For example, storage accounts have separate namespaces for files, tables, blobs, and queues.</li>
<li><strong>Metric</strong>: Each metrics namespace has many metrics available to choose from.</li>
<li><strong>Aggregation</strong>: For each metric, Metrics Explorer applies a default aggregation. You can use a different aggregation to get different information about the metric.</li>
</ul>
<p>You can apply the following aggregation functions to metrics:</p>
<ul>
<li><strong>Count</strong>: Counts the number of data points.</li>
<li><strong>Average (Avg)</strong>: Calculates the arithmetic mean of values.</li>
<li><strong>Maximum (Max)</strong>: Identifies the highest value.</li>
<li><strong>Minimum (Min)</strong>: Identifies the lowest value.</li>
<li><strong>Sum</strong>: Adds up all the values.</li>
</ul>
<p>You can select flexible time ranges for graphs from the past 30 minutes to the last 30 days, or custom ranges. You can specify time interval granularity from one minute to one month.</p>
<h3 id="create-a-metrics-graph"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-metrics-graph">Create a metrics graph</a></h3>
<p>To create a Metrics Explorer graph that shows host VM maximum percentage CPU and inbound flows together for the past 30 minutes:</p>
<ol>
<li>
<p>Open <strong>Metrics Explorer</strong> by selecting <strong>See all Metrics</strong> on the VM's <strong>Monitoring</strong> tab or selecting <strong>Metrics</strong> from the VM's left navigation menu.</p>
</li>
<li>
<p><strong>Scope</strong> and <strong>Metric Namespace</strong> are already populated for the host VM. Select <strong>Percentage CPU</strong> from the <strong>Metrics</strong> dropdown list.</p>
</li>
<li>
<p><strong>Aggregation</strong> is automatically populated with <strong>Avg</strong>, but change it to <strong>Max</strong>.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-view-host-level-metrics.png#lightbox"><img alt="Screenshot of the Percentage CPU metrics graph for a VM." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-view-host-level-metrics.png" /></a></p>
</li>
<li>
<p>Select <strong>Add metric</strong> at upper left.</p>
</li>
<li>
<p>Under <strong>Metric</strong>, select <strong>Inbound Flows</strong>. Leave <strong>Aggregation</strong> at <strong>Avg</strong>.</p>
</li>
<li>
<p>At upper right, select <strong>Local Time: Last 24 hours (Automatic - 15 minutes)</strong>, change it to <strong>Last 30 minutes</strong>, and select <strong>Apply</strong>.</p>
</li>
</ol>
<p>Your graph should look similar to the following screenshot:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-metric-graph.png#lightbox"><img alt="Screenshot that shows a graph of CPU usage and inbound traffic." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/3-metric-graph.png" /></a></p>
<h2 id="collect-client-performance-counters-by-using-vm-insights"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#collect-client-performance-counters-by-using-vm-insights">Collect client performance counters by using VM insights</a></h2>
<p>Besides monitoring your VM host's health, utilization, and performance, you need to monitor the software and processes running on your VM. These are called the VM guest or client. In this unit, you enable the Azure Monitor VM insights feature, which offers a quick way to start monitoring the VM client.</p>
<p>The VM client includes the operating system and other workloads and applications. To monitor the software running on your VM, you install the Azure Monitor Agent, which collects data from inside the VM. VM insights:</p>
<ul>
<li>Installs Azure Monitor Agent on your VM.</li>
<li>Creates a DCR that collects and sends a predefined set of client performance data to a Log Analytics workspace.</li>
<li>Presents the data in curated workbooks.</li>
</ul>
<p>Although you don't need to use VM insights to install Azure Monitor Agent, create DCRs, or set up workbooks, VM insights makes setting up VM client monitoring easy. VM insights provides you with a basis for monitoring the performance of your VM client and mapping the processes running on your machine.</p>
<h3 id="enable-vm-insights"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#enable-vm-insights">Enable VM insights</a></h3>
<ol>
<li>
<p>In the Azure portal, on your VM's <strong>Overview</strong> page, select <strong>Insights</strong> from the left navigation menu under <strong>Monitoring</strong>.</p>
</li>
<li>
<p>On the <strong>Insights</strong> page, select <strong>Enable</strong>.</p>
</li>
<li>
<p>Under <strong>Data collection rule</strong>, note the properties of the DCR that VM insights creates. In the DCR description, <strong>Processes and dependencies (Map)</strong> is set to <strong>Disabled</strong>, which you can change to <strong>Enabled</strong> or review <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/vm/vminsights-maps">this article on how-to</a> if greyed out. Also a default <strong>Log Analytics workspace</strong> is created or assigned.</p>
</li>
<li>
<p>Select <strong>Configure</strong>.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/enable-insights.png#lightbox"><img alt="Screenshot that shows enabling and configuring VM insights." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/enable-insights.png" /></a></p>
<p>Configuration of the workspace and the agent installation typically takes 5 to 10 minutes. It can take another 5 to 10 minutes for data to become available to view in the portal.</p>
</li>
<li>
<p>When the deployment finishes, confirm that the Azure Monitor Agent is installed by looking on the <strong>Properties</strong> tab of the VM's <strong>Overview</strong> page under <strong>Extensions + applications</strong>.</p>
<p>On the <strong>Monitoring</strong> tab of the <strong>Overview</strong> page, under <strong>Performance and utilization</strong>, you can see that <strong>Guest OS metrics</strong> are now being collected.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/guest-os-metrics.png#lightbox"><img alt="Screenshot that shows Guest OS metrics on the VM's Monitoring tab." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/guest-os-metrics.png" /></a></p>
</li>
</ol>
<h3 id="view-vm-insights"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-vm-insights">View VM insights</a></h3>
<p>VM insights creates a DCR that sends client VM performance counters to Azure Monitor Logs. Because the DCR sends its metrics to Azure Monitor Logs, you don't use Metrics Explorer to view the metrics data that VM insights collects.</p>
<p>To view the VM insights performance graphs and maps:</p>
<ol>
<li>
<p>Select <strong>Insights</strong> from the VM's left navigation menu under <strong>Monitoring</strong>.</p>
</li>
<li>
<p>Near the top of the <strong>Insights</strong> page, select the <strong>Performance</strong> tab. The prebuilt VM insights Performance workbook shows charts and graphs with performance-related data for the current VM.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/vm-insights-performance.png#lightbox"><img alt="Screenshot that shows the prebuilt VM insights Performance workbook." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/vm-insights-performance.png" /></a></p>
<ul>
<li>
<p>You can customize the view by specifying a different <strong>Time range</strong> at the top of the page and different aggregations at the top of each graph.</p>
</li>
<li>
<p>Select <strong>View Workbooks</strong> to select from other available prebuilt VM insights workbooks. Select <strong>Go To Gallery</strong> to select from a gallery of other VM insights workbooks and workbook templates, or to edit and create your own workbooks.</p>
</li>
</ul>
</li>
<li>
<p>If enabled earlier, select the <strong>Map</strong> tab on the <strong>Insights</strong> page to see the workbook for the Map feature. The map visualizes the VM's dependencies by discovering running process groups and processes that have active network connections over a specified time range.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dependency-map.png#lightbox"><img alt="Screenshot that shows a dependency map on the Map tab of VM insights." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dependency-map.png" /></a></p>
</li>
</ol>
<h2 id="collect-vm-client-event-logs"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#collect-vm-client-event-logs">Collect VM client event logs</a></h2>
<p>Azure Monitor Metrics and VM insights performance counters help you identify performance anomalies, and alert when thresholds are reached. But to analyze the root causes of issues you detect, you need to analyze log data to see which system events caused or contributed to the issues. In this unit, you set up a DCR to collect Linux VM Syslog data, and view the log data in Azure Monitor Log Analytics by using a simple Kusto Query Language (KQL) query.</p>
<p>VM insights installs the Azure Monitor Agent, and creates a DCR that collects predefined performance counters, maps process dependencies, and presents the data in prebuilt workbooks. You can create your own DCRs to collect VM performance counters that the VM insights DCR doesn't collect, or to collect log data.</p>
<p>When you create DCRs in the Azure portal, you can select from a range of performance counters and sampling rates or add custom performance counters. Alternatively, you can select from a predefined set of log types and severity levels or define custom log schemas. You can associate a single DCR to any or all VMs in your subscription, but you might need multiple DCRs to collect different types of data from different VMs.</p>
<h3 id="create-a-dcr-to-collect-log-data"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-dcr-to-collect-log-data">Create a DCR to collect log data</a></h3>
<p>In the Azure portal, search for and select <em>monitor</em> to go to the Azure Monitor <strong>Overview</strong> page.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/monitor-overview.png#lightbox"><img alt="Screenshot that shows the Azure Monitor Overview page." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/monitor-overview.png" /></a></p>
<h4 id="create-a-data-collection-endpoint"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-a-data-collection-endpoint">Create a Data Collection Endpoint</a></h4>
<p>You must have a data collection endpoint to send log data to. To create an endpoint:</p>
<ol>
<li>In the Azure Monitor left navigation menu under <strong>Settings</strong>, select <strong>Data Collection Endpoints</strong>.</li>
<li>On the <strong>Data Collection Endpoints</strong> page, select <strong>Create</strong>.</li>
<li>On the <strong>Create data collection endpoint</strong> page, for <strong>Name</strong>, enter <em>linux-logs-endpoint</em>.</li>
<li>Select the same <strong>Subscription</strong>, <strong>Resource group</strong>, and <strong>Region</strong> as your VM uses.</li>
<li>Select <strong>Review + create</strong>, and when validation passes, select <strong>Create</strong>.</li>
</ol>
<h4 id="create-the-data-collection-rule"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#create-the-data-collection-rule">Create the Data Collection Rule</a></h4>
<p>To create the DCR to collect the event logs:</p>
<ol>
<li>
<p>In the Monitor left navigation menu under <strong>Settings</strong>, select <strong>Data Collection Rules</strong>.</p>
</li>
<li>
<p>On the <strong>Data Collection Rules</strong> page, you can see the DCR that VM insights created. Select <strong>Create</strong> to create a new data collection rule.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dcr-create.png#lightbox"><img alt="Screenshot of the Data Collection Rules screen with Create highlighted." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dcr-create.png" /></a></p>
</li>
<li>
<p>On the <strong>Basics</strong> tab of the <strong>Create Data Collection Rule</strong> screen, provide the following information:</p>
<ul>
<li><strong>Rule name</strong>: Enter <em>collect-events-linux</em>.</li>
<li><strong>Subscription</strong>, <strong>Resource Group</strong>, and <strong>Region</strong>: Select the same as for your VM.</li>
<li><strong>Platform Type</strong>: Select <strong>Linux</strong>.</li>
<li>Select <strong>Next: Resources</strong> or the <strong>Resources</strong> tab.</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-basics.png#lightbox"><img alt="Screenshot of the Basics tab of the Create Data Collection Rule screen." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-basics.png" /></a></p>
</li>
<li>
<p>On the <strong>Resources</strong> screen, select <strong>Add resources</strong>.</p>
</li>
<li>
<p>On the <strong>Select a scope</strong> screen, select the <strong>monitored-linux-vm</strong> VM, and then select <strong>Apply</strong>.</p>
</li>
<li>
<p>On the <strong>Resources</strong> screen, select <strong>Enable Data Collection Endpoints</strong>.</p>
</li>
<li>
<p>Under <strong>Data collection endpoint</strong> for the <strong>monitored-linux-vm</strong>, select the <strong>linux-logs-endpoint</strong> you created.</p>
</li>
<li>
<p>Select <strong>Next: Collect and deliver</strong>, or the <strong>Collect and deliver</strong> tab.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-resources.png#lightbox"><img alt="Screenshot of the Resources tab of the Create Data Collection Rule screen." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-resources.png" /></a></p>
</li>
<li>
<p>On the <strong>Collect and deliver</strong> tab, select <strong>Add data source</strong>.</p>
</li>
<li>
<p>On the <strong>Add data source</strong> screen, under <strong>Data source type</strong>, select <strong>Linux Syslog</strong>.</p>
</li>
<li>
<p>On the <strong>Add data source</strong> screen, select <strong>Next: Destination</strong> or the <strong>Destination</strong> tab, and make sure the <strong>Account or namespace</strong> matches the Log Analytics workspace that you want to use. You can use the default Log Analytics workspace that VM insights set up, or create or use another Log Analytics workspace.</p>
</li>
<li>
<p>On the <strong>Add data source</strong> screen, select <strong>Add data source</strong>.</p>
</li>
<li>
<p>On the <strong>Create Data Collection Rule</strong> screen, select <strong>Review + create</strong>, and when validation passes, select <strong>Create</strong>.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-finish.png#lightbox"><img alt="Screenshot of Review + create highlighted on the Create Data Collection Rule screen." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/create-dcr-finish.png" /></a></p>
</li>
</ol>
<h3 id="view-log-data"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#view-log-data">View log data</a></h3>
<p>You can view and analyze the log data collected by your DCR by using KQL log queries. A set of sample KQL queries is available for VMs, but you can write a query to look at the events your DCR is collecting.</p>
<ol>
<li>
<p>On your VM's <strong>Overview</strong> page, select <strong>Logs</strong> from the left navigation menu under <strong>Monitoring</strong>. Log Analytics opens an empty query window with the scope set to your VM.</p>
<p>You can also access log data by selecting <strong>Logs</strong> from the left navigation of the Azure Monitor <strong>Overview</strong> page. If necessary, select <strong>Select scope</strong> at the top of the query window to scope the query to the desired Log Analytics workspace and VM.</p>
<p>Note</p>
<p>The <strong>Queries</strong> window with sample queries might open when you open Log Analytics. For now, close this window, because you're going to manually create a simple query.</p>
</li>
<li>
<p>In the empty query window, type <em>Syslog</em>, and then select <strong>Run</strong>. All the system log events the DCR collected within the <strong>Time range</strong> are displayed.</p>
</li>
<li>
<p>You can refine your query to identify events of interest. For example, you can display only the events that had a <strong>SeverityLevel</strong> of <strong>warning</strong>.</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dcr-log.png#lightbox"><img alt="Screenshot that shows the events returned from the Syslog by the DCR." src="https://learn.microsoft.com/en-us/training/modules/monitor-azure-vm-using-diagnostic-data/media/dcr-log.png" /></a></p>
</li>
</ol>
<h2 id="summary"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Monitor%20and%20backup%20azure%20resources/#summary">Summary</a></h2>
<p>Azure Monitor helps you collect, analyze, and alert on various types of host and client monitoring data from your Azure VMs.</p>
<ul>
<li>Azure Monitor provides a set of VM host logs and performance and usage metrics for all Azure VMs.</li>
<li>You can enable recommended alert rules when you create VMs or afterwards to alert on important VM host metrics.</li>
<li>Azure Monitor Metrics Explorer lets you graph and analyze metrics for Azure VMs and other resources.</li>
<li>VM insights provides a simple way to monitor important VM client performance counters and processes running on your VM.</li>
<li>You can create data collection rules to collect other metrics and logs from your VM client.</li>
<li>You can use Log Analytics to query and analyze log data.</li>
</ul>
<p>Now that you understand these tools, you're confident that Azure Monitor can effectively monitor your Azure VMs and help you keep your website running effectively.</p>
<hr />
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-11-14 00:00:00">November 14, 2024</time></li>
        
        
          
          <li class="md-meta__item">
            
              25 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="introduction-to-azure-cloud-shell"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/">Introduction to Azure Cloud Shell</a></h2>
<p>Azure Cloud Shell is a command-line environment you can access through your web browser. You can use this environment to manage Azure resources, including VMs, storage, and networking. Just like you do when using the Azure CLI or Azure PowerShell.</p>
<p>Because Microsoft manages Cloud Shell, you always have access to the most recent versions of the Azure CLI and PowerShell modules right from any browser. You don't have to worry about keeping modules up to date. With Cloud Shell, you just open your browser and sign in. Just like that, you have access to a command-line environment fully connected with your account's permissions and the resources to which you have access. All that works in an infrastructure that's compliant with double encryption at rest by default. You don't need to take any further action!</p>
<p>Azure Cloud Shell also provides cloud storage to persist files such as SSH keys, scripts, and more. This functionality lets you access important files in between sessions and with different machines. Finally, you can use the Cloud Shell editor to make changes to files, such as scripts, that are saved into this cloud storage directly from the Cloud Shell interface.</p>
<hr />
<h2 id="how-does-azure-cloud-shell-work"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#how-does-azure-cloud-shell-work">How does Azure Cloud Shell work?</a></h2>
<p>As an IT admin for Contoso Corporation, you're frequently on-call to perform administrative tasks and resolve workload disruptions to resources in your organization's Azure subscriptions. When visiting a family member during a weekend that you're on call, the development team notifies you of a problem with an Azure virtual machine (VM). The VM became nonresponsive during scheduled maintenance for the upgrade of an application that runs on it. Because the developers weren't granted access to the underlying Azure virtual machine hosting infrastructure, they're only able to remotely access the VM when it's operating normally. So, you're being called to diagnose and remediate the problem.</p>
<p>Since you're visiting family, you don’t have access to your administrative workstation and diagnostic scripts. You do have access to a laptop with an internet browser. Using the laptop, you browse to the Azure portal, authenticate against your organization’s Azure subscription, open Azure Cloud Shell, mount an Azure File Share, access your diagnostic scripts, and diagnose and remediate the problems with the VM, returning it to operation.</p>
<h3 id="access-cloud-shell"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#access-cloud-shell">Access Cloud Shell</a></h3>
<p>You have a few different options for accessing Azure Cloud Shell:</p>
<ul>
<li>
<p>From a direct link: <a href="https://shell.azure.com/">https://shell.azure.com</a></p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-directly.png#lightbox"><img alt="A screenshot of Cloud Shell accessed directly from a link." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-directly.png" /></a></p>
</li>
<li>
<p>From the Azure portal</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-from-azure-portal.png#lightbox"><img alt="A screenshot of Cloud Shell accessed from Azure portal." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-from-azure-portal.png" /></a></p>
</li>
<li>
<p>From code snippets when accessing Microsoft Learn:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-from-code-snippets.png#lightbox"><img alt="A screenshot of Cloud Shell accessed from code snippets." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/access-cloud-shell-from-code-snippets.png" /></a></p>
</li>
</ul>
<p>When you open a Cloud Shell session, a temporary host is allocated to your session. This VM is preconfigured with the latest versions of PowerShell and Bash. You can then select the command-line experience you want to use:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/select-cli-experience.png#lightbox"><img alt="A screenshot of how to choose a command-line experience in a Cloud Shell session." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/select-cli-experience.png" /></a></p>
<p>After you select the shell experience you want to use, you can start managing your Azure resources:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/manage-azure-resources-in-cloud-shell.png#lightbox"><img alt="A screenshot of how to use Cloud Shell to manage Azure resources." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/manage-azure-resources-in-cloud-shell.png" /></a></p>
<p>Cloud Shell sessions terminate after 20 minutes of inactivity. When a session terminates, files on your CloudDrive are persisted, but you need to start a new session to access the Cloud Shell environment.</p>
<h3 id="access-your-own-scripts-and-files"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#access-your-own-scripts-and-files">Access your own scripts and files</a></h3>
<p>When using Cloud Shell, you might also need to run scripts or use files for different actions. You can persist files on Cloud Shell by using the Azure CloudDrive:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/use-azure-cloud-drive.png#lightbox"><img alt="A screenshot of how to access CloudDrive in a Cloud Shell session." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/use-azure-cloud-drive.png" /></a></p>
<p>After uploading files, you can interact with them as you would in a regular PowerShell or Bash session:</p>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/manage-files-in-cloud-drive.png#lightbox"><img alt="A screenshot of how to manage files in CloudDrive." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/manage-files-in-cloud-drive.png" /></a></p>
<p>Now that your file resides on CloudDrive, you can close the session and open another session on a different device and still access the same file. Cloud Shell also lets you map an Azure Storage File Share, which is tied to a specific region. Access to an Azure File Share lets you work with the contents of that share through Cloud Shell.</p>
<p>If you need to edit scripts hosted on the CloudDrive or File Share, you can use the Cloud Shell editor. Select the curly brackets {} icon on the browser and open the file you want to edit, or use the command <code>code</code> and specify the filename; for example:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>code temp.txt
</code></pre></div>
<p><a href="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/cloud-shell-edit-scripts.png#lightbox"><img alt="A screenshot of how to access the Cloud Shell editor mode." src="https://learn.microsoft.com/en-us/training/modules/intro-to-azure-cloud-shell/media/cloud-shell-edit-scripts.png" /></a></p>
<p>Note</p>
<p>The <code>code</code> command only works in the Classic mode in Cloud Shell. To enable Classic mode, select the <strong>More</strong> icon (<strong>...</strong>), then select <strong>Settings</strong> &gt; <strong>Go to Classic version</strong>.</p>
<h3 id="cloud-shell-tools"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#cloud-shell-tools">Cloud Shell tools</a></h3>
<p>If you need to manage resources (such as Docker containers or Kubernetes Clusters) or want to use non-Microsoft tools (such as Ansible and Terraform) in Cloud Shell, the Cloud Shell session comes with these add-ons already preconfigured.</p>
<p>Here’s a list of all add-ons available to you within a Cloud Shell session:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Linux tools</strong></td>
<td>bash  <br>zsh  <br>sh  <br>tmux  <br>dig</td>
</tr>
<tr>
<td><strong>Azure tools</strong></td>
<td>Azure CLI and <a href="https://github.com/Azure/azure-xplat-cli">Azure classic CLI</a>  <br>AzCopy  <br>Azure Functions CLI  <br>Service Fabric CLI  <br>Batch Shipyard  <br>blobxfer</td>
</tr>
<tr>
<td><strong>Text editors</strong></td>
<td>code (Cloud Shell editor)  <br>vim  <br>nano  <br>emacs</td>
</tr>
<tr>
<td><strong>Source control</strong></td>
<td>git</td>
</tr>
<tr>
<td><strong>Build tools</strong></td>
<td>make  <br>maven  <br>npm  <br>pip</td>
</tr>
<tr>
<td><strong>Containers</strong></td>
<td>Docker Machine  <br>Kubectl  <br>Helm  <br>DC/OS CLI</td>
</tr>
<tr>
<td><strong>Databases</strong></td>
<td>MySQL client  <br>PostgreSql client  <br>sqlcmd Utility  <br>mssql-scripter</td>
</tr>
<tr>
<td><strong>Other</strong></td>
<td>iPython Client  <br>Cloud Foundry CLI  <br>Terraform  <br>Ansible  <br>Chef InSpec  <br>Puppet Bolt  <br>HashiCorp Packer  <br>Office 365 CLI</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="when-should-you-use-azure-cloud-shell"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#when-should-you-use-azure-cloud-shell">When should you use Azure Cloud Shell?</a></h2>
<p>As an IT Admin for Contoso Corporation, you need alternatives to interact with Azure resources from the command line even when not using your default administrative device.</p>
<p>You can use Azure Cloud Shell to:</p>
<ul>
<li>Open a secure command-line session from any browser-based device.</li>
<li>Interact with Azure resources without the need to install plug-ins or add-ons to your device.</li>
<li>Persist files between sessions for later use.</li>
<li>Use either Bash or PowerShell, whichever you prefer, to manage Azure resources.</li>
<li>Edit files (such as scripts) via the Cloud Shell editor.</li>
</ul>
<p>You shouldn't use Azure Cloud Shell if:</p>
<ul>
<li>You intend to leave a session open for more than 20 minutes for long running scripts or activities. In these cases, your session is disconnected without warning, and the current state is lost.</li>
<li>You need admin permissions, such as sudo access, from within the Azure CLI or PowerShell environment.</li>
<li>You need to install tools that aren't supported in the limited Cloud Shell environment, but instead require an environment such as a custom virtual machine or container.</li>
<li>You need storage from different regions. You might need to back up and synchronize this content since only one region can have the storage allocated to Azure Cloud Shell.</li>
<li>You need to open multiple sessions at the same time. Azure Cloud Shell allows only one instance at time and isn't suitable for concurrent work across multiple subscriptions or tenants.</li>
</ul>
<hr />
<h2 id="introduction-to-bash"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#introduction-to-bash">Introduction to Bash</a></h2>
<h2 id="introduction"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#introduction">Introduction</a></h2>
<p>Imagine you just started a new job as a system administrator (sysadmin) at Northwind, a high-frequency trading (HFT) firm that runs Windows on its client computers and Linux on its server computers. Computers are the lifeblood of the company, and you need to learn more about how to manage Linux boxes. It's time to skill up!</p>
<p>Bash is the standard shell scripting language for Linux. Let's learn the basics of Bash, starting with the syntax and commonly used commands, like <code>ls</code> and <code>cat</code>.</p>
<h2 id="what-is-bash"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#what-is-bash">What is Bash?</a></h2>
<p>Bash is a vital tool for managing Linux machines. The name is short for "<strong>B</strong>ourne <strong>A</strong>gain <strong>Sh</strong>ell."</p>
<p>A shell is a program that commands the operating system to perform actions. You can enter commands in a console on your computer and run the commands directly, or you can use scripts to run batches of commands. Shells like PowerShell and Bash give system administrators the power and precision they need for fine-tuned control of the computers they're responsible for.</p>
<p>There are other Linux shells, including csh and zsh, but Bash became the de facto Linux standard. That's because Bash is compatible with Unix's first serious shell, the Bourne shell, also known as sh. Bash incorporates the best features of its predecessors. But Bash also has some fine features of its own, including built-in commands and the ability to invoke external programs.</p>
<p>One reason for Bash's success is its simplicity. Bash, like the rest of Linux, is based on the Unix design philosophy. As Peter Salus summarized in his book <em>A Quarter Century of Unix</em>, three of the "big ideas" embodied in Unix are:</p>
<ul>
<li>Programs do one thing and do it well</li>
<li>Programs work together</li>
<li>Programs use text streams as the universal interface</li>
</ul>
<p>The last part is key to understanding how Bash works. In Unix and Linux, everything is a file. That means you can use the same commands without worrying about whether the I/O stream—the input and output—comes from a keyboard, a disk file, a socket, a pipe, or another I/O abstraction.</p>
<p>Let's learn the basics of Bash, starting with the syntax and commonly used commands, like <code>ls</code> and <code>cat</code>.</p>
<hr />
<h2 id="bash-fundamentals"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#bash-fundamentals">Bash fundamentals</a></h2>
<p>An understanding of Bash starts with an understanding of Bash syntax. After you know the syntax, you can apply it to every Bash command you run.</p>
<p>The full syntax for a Bash command is:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>command [options] [arguments]
</code></pre></div>
<p>Bash treats the first string it encounters as a command. The following command uses Bash's <code>ls</code> (for "list") command to display the contents of the current working directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls
</code></pre></div>
<p>Arguments often accompany Bash commands. For example, you can include a path name in an <code>ls</code> command to list the contents of another directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls /etc
</code></pre></div>
<p>Most Bash commands have options for modifying how they work. Options, also called <em>flags</em>, give a command more specific instructions. As an example, files and directories whose names begin with a period are hidden from the user and aren't displayed by <code>ls</code>. However, you can include the <code>-a</code> (for "all") flag in an <code>ls</code> command and see everything in the target directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls -a /etc
</code></pre></div>
<p>You can even combine flags for brevity. For example, rather than enter <code>ls -a -l /etc</code> to show all files and directories in Linux's <strong>/etc</strong> directory in long form, you can enter this instead:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls -al /etc
</code></pre></div>
<p>Bash is concise. It's sometimes remarkable (and a point of pride among Bash aficionados) how much you can accomplish with a single command.</p>
<h3 id="get-help"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#get-help">Get help</a></h3>
<p>Which options and arguments can be used, or must be used, varies from command to command. Fortunately, Bash documentation is built into the operating system. Help is never more than a command away. To learn about the options for a command, use the <code>man</code> (for "manual") command. For instance, to see all the options for the <code>mkdir</code> ("make directory") command, do this:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>man mkdir
</code></pre></div>
<p><code>man</code> is your best friend as you learn Bash. <code>man</code> is how you find the information you need to understand how any command works.</p>
<p>Most Bash and Linux commands support the <code>--help</code> option. This shows a description of the command's syntax and options. To demonstrate, enter <code>mkdir --help</code>. The output looks something like this:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Usage: mkdir [OPTION]... DIRECTORY...
Create the DIRECTORY(ies), if they do not already exist.

Mandatory arguments to long options are mandatory for short options too.
  -m, --mode=MODE   set file mode (as in chmod), not a=rwx - umask
  -p, --parents     no error if existing, make parent directories as needed
  -v, --verbose     print a message for each created directory
  -Z                   set SELinux security context of each created directory
                         to the default type
      --context[=CTX]  like -Z, or if CTX is specified then set the SELinux
                         or SMACK security context to CTX
      --help     display this help and exit
      --version  output version information and exit

GNU coreutils online help: &lt;http://www.gnu.org/software/coreutils/&gt;
Report mkdir translation bugs to &lt;http://translationproject.org/team/&gt;
Full documentation at: &lt;http://www.gnu.org/software/coreutils/mkdir&gt;
or available locally via: info &#39;(coreutils) mkdir invocation&#39;
</code></pre></div>
<p>Help obtained this way is typically more concise than help obtained with <code>man</code>.</p>
<h3 id="use-wildcards"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#use-wildcards">Use wildcards</a></h3>
<p>Wildcards are symbols that represent one or more characters in Bash commands. The most frequently used wildcard is the asterisk. It represents zero characters or a sequence of characters. Suppose your current directory contains hundreds of image files, but you only want to see the PNG files; the ones whose file names end with <strong>.png</strong>. Here's the command to list only those files:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls *.png
</code></pre></div>
<p>Note</p>
<p>Linux has no formal concept of a file-name extension as other operating systems do. This doesn't mean that PNG files won't have a <strong>.png</strong> extension. It simply means Linux attaches no special significance to the fact that the file names end with <strong>.png</strong>.</p>
<p>Now let's say the current directory also contains JPEG files. Some end in <strong>.jpg</strong>, while others end in <strong>.jpeg.</strong> Here's one way to list all the JPEG files:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls *.jpg *.jpeg
</code></pre></div>
<p>And here's another:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls *.jp*g
</code></pre></div>
<p>The <code>*</code> wildcard matches on zero or more characters, but the <code>?</code> wildcard represents a single character. If the current directory contains files named <strong>0001.jpg</strong>, <strong>0002.jpg</strong>, and so on through <strong>0009.jpg</strong>, the following command lists them all:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls 000?.jpg
</code></pre></div>
<p>Yet another way to use wildcards to filter output is to use square brackets, which denote groups of characters. The following command lists all the files in the current directory whose names contain a period immediately followed a lowercase J or P. It lists all the <strong>.jpg</strong>, <strong>.jpeg</strong>, and <strong>.png</strong> files, but not <strong>.gif</strong> files:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls *.[jp]*
</code></pre></div>
<p>In Linux, file names and the commands that operate upon them are case-sensitive. So to list all the files in the current directory whose names contain periods followed by an uppercase <em>or</em> lowercase J or P, you could enter this:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls *.[jpJP]*
</code></pre></div>
<p>Expressions in square brackets can represent ranges of characters. For example, the following command lists all the files in the current directory whose names begin with a lowercase letter:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls [a-z]*
</code></pre></div>
<p>This command, by contrast, lists all the files in the current directory whose names begin with an uppercase letter:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls [A-Z]*
</code></pre></div>
<p>And this one lists all the files in the current directory whose names begin with a lowercase <em>or</em> uppercase letter:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls [a-zA-Z]*
</code></pre></div>
<p>Based on all this, can you guess what the following commands do?</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls [0-9]*
ls *[0-9]*
ls *[0-9]
</code></pre></div>
<p>If you need to use one of the wildcard characters as an ordinary character, you make it literal or "escape it" by prefacing it with a backslash. So, if for some reason you had an asterisk as part of a file name—something you should never do intentionally—you could search for it by using a command such as:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>$ ls *\**
</code></pre></div>
<hr />
<h2 id="bash-commands-and-operators"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#bash-commands-and-operators">Bash commands and operators</a></h2>
<p>Every shell language has its most-used commands. Let's start building your Bash repertoire by examining the most commonly used commands.</p>
<h3 id="bash-commands"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#bash-commands">Bash commands</a></h3>
<p>Let's look at common Bash commands and how to use them.</p>
<h4 id="ls-command"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#ls-command"><code>ls</code> command</a></h4>
<p><code>ls</code> lists the contents of your current directory or the directory specified in an argument to the command. By itself, it lists the files and directories in the current directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls
</code></pre></div>
<p>Files and directories whose names begin with a period are hidden by default. To include these items in a directory listing, use an <code>-a</code> flag:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls -a
</code></pre></div>
<p>To get even more information about the files and directories in the current directory, use an <code>-l</code> flag:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls -l
</code></pre></div>
<p>Here's some sample output from a directory that contains a handful of JPEGs and PNGs and a subdirectory named <strong>gifs</strong>:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>-rw-rw-r-- 1 azureuser azureuser  473774 Jun 13 15:38 0001.png
-rw-rw-r-- 1 azureuser azureuser 1557965 Jun 13 14:43 0002.jpg
-rw-rw-r-- 1 azureuser azureuser  473774 Mar 26 09:21 0003.png
-rw-rw-r-- 1 azureuser azureuser 4193680 Jun 13 09:40 0004.jpg
-rw-rw-r-- 1 azureuser azureuser  423325 Jun 10 12:53 0005.jpg
-rw-rw-r-- 1 azureuser azureuser 2278001 Jun 12 04:21 0006.jpg
-rw-rw-r-- 1 azureuser azureuser 1220517 Jun 13 14:44 0007.jpg
drwxrwxr-x 2 azureuser azureuser    4096 Jun 13 20:16 gifs
</code></pre></div>
<p>Each line provides detailed information about the corresponding file or directory. That information includes the permissions assigned to it, its owner, its size in bytes, the last time it was modified, and the file or directory name.</p>
<h4 id="cat-command"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#cat-command"><code>cat</code> command</a></h4>
<p>Suppose you want to see what's inside a file. You can use the <code>cat</code> command for that. The output won't make much sense unless the file is a text file. The following command shows the contents of the <strong>os-release</strong> file stored in the <strong>/etc</strong> directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cat /etc/os-release
</code></pre></div>
<p>This is a useful command because it tells you which Linux distribution you're running:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>NAME=&quot;Ubuntu&quot;
VERSION=&quot;18.04.2 LTS (Bionic Beaver)&quot;
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME=&quot;Ubuntu 18.04.2 LTS&quot;
VERSION_ID=&quot;18.04&quot;
HOME_URL=&quot;https://www.ubuntu.com/&quot;
SUPPORT_URL=&quot;https://help.ubuntu.com/&quot;
BUG_REPORT_URL=&quot;https://bugs.launchpad.net/ubuntu/&quot;
PRIVACY_POLICY_URL=&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;
VERSION_CODENAME=bionic
UBUNTU_CODENAME=bionic
</code></pre></div>
<p>The <strong>/etc</strong> directory is a special one in Linux. It contains system-configuration files. You don't want to delete any files from this directory unless you know what you're doing.</p>
<h4 id="sudo-command"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#sudo-command"><code>sudo</code> command</a></h4>
<p>Some Bash commands can only be run by the root user; a system administrator or superuser. If you try one of these commands without sufficient privileges, it fails. For example, only users logged in as a superuser can use <code>cat</code> to display the contents of <strong>/etc/at.deny</strong>:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cat /etc/at.deny
</code></pre></div>
<p><strong>at.deny</strong> is a special file that determines who can use other Bash commands to submit jobs for later execution.</p>
<p>You don't want to run as root most of the time; it's too dangerous. To run commands that require admin privilege without logging in as a superuser, you'll preface the commands with <code>sudo</code>:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>sudo cat /etc/at.deny
</code></pre></div>
<p><code>sudo</code> stands for "superuser do." When you use it, you're telling the shell that for this one command, you're acting with the root-user level of permission.</p>
<h4 id="cd-mkdir-and-rmdir-commands"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#cd-mkdir-and-rmdir-commands"><code>cd</code>, <code>mkdir</code>, and <code>rmdir</code> commands</a></h4>
<p><code>cd</code> stands for "change directory," and it does exactly what the name suggests: it changes the current directory to another directory. It enables you to move from one directory to another just like its counterpart in Windows. The following command changes to a subdirectory of the current directory named <strong>orders</strong>:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cd orders
</code></pre></div>
<p>You can move up a directory by specifying <code>..</code> as the directory name:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cd ..
</code></pre></div>
<p>This command changes to your home directory; the one you land in when you first sign in:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cd ~
</code></pre></div>
<p>You can create directories by using the <code>mkdir</code> command. The following command creates a subdirectory named <strong>orders</strong> in the current working directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>mkdir orders
</code></pre></div>
<p>If you want to create a subdirectory and another subdirectory under it with one command, use the <code>--parents</code> flag:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>mkdir --parents orders/2019
</code></pre></div>
<p>The <code>rmdir</code> command deletes (removes) a directory, but only if it's empty. If it's not empty, you get a warning instead. Fortunately, you can use the <code>rm</code> command to delete directories that aren't empty in combination with the <code>-r</code> (recursive) flag. The command would then look like so, <code>rm -r</code>.</p>
<h4 id="rm-command"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#rm-command"><code>rm</code> command</a></h4>
<p>The <code>rm</code> command is short for "remove." As you'd expect, <code>rm</code> deletes files. So this command puts an end to <strong>0001.jpg</strong>:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>rm 0001.jpg
</code></pre></div>
<p>And this command deletes all the files in the current directory:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>rm *
</code></pre></div>
<p>Be wary of <code>rm</code>. It's a dangerous command.</p>
<p>Running <code>rm</code> with a <code>-i</code> flag lets you think before you delete:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>rm -i *
</code></pre></div>
<p>Make it a habit to include <code>-i</code> in every <code>rm</code> command, and you might avoid falling victim to one of Linux's biggest blunders. The dreaded <code>rm -rf /</code> command deletes every file on an entire drive. It works by recursively deleting all the subdirectories of root and their subdirectories. The <code>-f</code> (for "force") flag compounds the problem by suppressing prompts. <em>Don't do this.</em></p>
<p>If you want to delete a subdirectory named <strong>orders</strong> that isn't empty, you can use the <code>rm</code> command this way:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>rm -r orders
</code></pre></div>
<p>This deletes the <strong>orders</strong> subdirectory and everything in it, including other subdirectories.</p>
<h4 id="cp-command"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#cp-command"><code>cp</code> command</a></h4>
<p>The <code>cp</code> command copies not just files, but entire directories (and subdirectories) if you want. To make a copy of <strong>0001.jpg</strong> named <strong>0002.jpg</strong>, use this command:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cp 0001.jpg 0002.jpg
</code></pre></div>
<p>If <strong>0002.jpg</strong> already exists, Bash silently replaces it. That's great if it's what you intended, but not so wonderful if you didn't realize you were about to overwrite the old version.</p>
<p>Fortunately, if you use the <code>-i</code> (for "interactive") flag, Bash warns you before deleting existing files. This is safer:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cp -i 0001.jpg 0002.jpg
</code></pre></div>
<p>You can use wildcards to copy several files at once. To copy all the files in the current directory to a subdirectory named <strong>photos</strong>, do this:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cp * photos
</code></pre></div>
<p>To copy all the files in a subdirectory named <strong>photos</strong> into a subdirectory named <strong>images</strong>, do this:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cp photos/* images
</code></pre></div>
<p>This assumes that the <strong>images</strong> directory already exists. If it doesn't, you can create it <em>and</em> copy the contents of the <strong>photos</strong> directory by using this command:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cp -r photos images
</code></pre></div>
<p>The <code>-r</code> stands for "recursive." An added benefit of the <code>-r</code> flag is that if <strong>photos</strong> contains subdirectories of its own, they too are copied to the <strong>images</strong> directory.</p>
<h4 id="ps-command"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#ps-command"><code>ps</code> command</a></h4>
<p>The <code>ps</code> command gives you a snapshot of all the currently running processes. By itself, with no arguments, it shows all your shell processes; in other words, not much. But it's a different story when you include a <code>-e</code> flag:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps -e
</code></pre></div>
<p><code>-e</code> lists <em>all</em> running processes, and there are typically many of them.</p>
<p>For a more comprehensive look at what processes are running in the system, use the <code>-ef</code> flag:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps -ef 
</code></pre></div>
<p>This flag shows the names of all the running processes, their process identification numbers (PIDs), the PIDs of their parents (PPIDs), and when they began (STIME). It also shows what terminal, if any, they're attached to (TTY), how much CPU time they've racked up (TIME), and their full path names. Here's an abbreviated example:</p>
<p>Copy</p>
<div class="highlight"><pre><span></span><code>UID         PID   PPID  C STIME TTY          TIME CMD
root          1      0  0 13:35 ?        00:00:03 /sbin/init
root          2      0  0 13:35 ?        00:00:00 [kthreadd]
root          3      2  0 13:35 ?        00:00:00 [rcu_gp]
root          4      2  0 13:35 ?        00:00:00 [rcu_par_gp]
root          5      2  0 13:35 ?        00:00:00 [kworker/0:0-cgr]
root          6      2  0 13:35 ?        00:00:00 [kworker/0:0H-kb]
root          8      2  0 13:35 ?        00:00:00 [mm_percpu_wq]
root          9      2  0 13:35 ?        00:00:01 [ksoftirqd/0]
root         10      2  0 13:35 ?        00:00:02 [rcu_sched]
</code></pre></div>
<p>As an aside, you might find documentation that shows <code>ps</code> being used this way:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps aux
</code></pre></div>
<p><code>ps aux</code> and <code>ps -ef</code> are the same. This duality traces back to historical differences between POSIX Unix systems (of which Linux is one) and BSD Unix systems (the most common of which is macOS). In the beginning, POSIX used <code>-ef</code> while the BSD required <code>aux</code>. Today, both operating-system families accept either format.</p>
<p>This serves as an excellent reminder of why you should look closely at the manual for all Linux commands. Learning Bash is like learning English as a second language. There are many exceptions to the rules.</p>
<h4 id="w-command"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#w-command"><code>w</code> command</a></h4>
<p>Users come, users go, and sometimes you get users you don't want at all. When an employee leaves to pursue other opportunities, the sysadmin is called upon to ensure that the worker can no longer sign in to the company's computer systems. Sysadmins are also expected to know who's logged in, and who shouldn't be.</p>
<p>To find out who's on your servers, Linux provides the <code>w</code> (for "who") command. It displays information about the users currently on the computer system and those users' activities. <code>w</code> shows user names, their IP addresses, when they logged in, what processes they're currently running, and how much time those processes are consuming. It's a valuable tool for sysadmins.</p>
<h3 id="bash-io-operators"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#bash-io-operators">Bash I/O operators</a></h3>
<p>You can do a lot in Linux just by exercising Bash commands and their many options. But you can really get work done when you combine commands by using I/O operators:</p>
<ul>
<li><code>&lt;</code> for redirecting input to a source other than the keyboard</li>
<li><code>&gt;</code> for redirecting output to destination other than the screen</li>
<li><code>&gt;&gt;</code> for doing the same, but appending rather than overwriting</li>
<li><code>|</code> for piping output from one command to the input of another</li>
</ul>
<p>Suppose you want to list everything in the current directory but capture the output in a file named <strong>listing.txt</strong>. The following command does just that:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls &gt; listing.txt
</code></pre></div>
<p>If <strong>listing.txt</strong> already exists, it gets overwritten. If you use the <code>&gt;&gt;</code> operator instead, the output from <code>ls</code> is appended to what's already in <strong>listing.txt</strong>:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ls &gt;&gt; listing.txt
</code></pre></div>
<p>The piping operator is powerful (and often used). It redirects the output of the first command to the input of the second command. Let's say you use <code>cat</code> to display the contents of a large file, but the content scrolls by too quickly for you to read. You can make the output more manageable by piping the results to another command such as <code>more</code>. The following command lists all the currently running processes. But once the screen is full, the output pauses until you select <strong>Enter</strong> to show the next line:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps -ef | more
</code></pre></div>
<p>You can also pipe output to <code>head</code> to see just the first several lines:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps -ef | head
</code></pre></div>
<p>Or suppose you want to filter the output to include only the lines that contain the word "daemon." One way to do that is by piping the output from <code>ps</code> to Linux's useful <code>grep</code> tool:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>ps -ef | grep daemon
</code></pre></div>
<p>The output might look like this:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>azureus+  52463  50702  0 23:28 pts/0    00:00:00 grep --color=auto deamon
azureuser@bash-vm:~$ ps -ef | grep daemon
root        449      1  0 13:35 ?        00:00:17 /usr/lib/linux-tools/4.18.0-1018-azure/hv_kvp_daemon -n
root        988      1  0 13:35 ?        00:00:00 /usr/lib/accountsservice/accounts-daemon
message+   1002      1  0 13:35 ?        00:00:00 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only
daemon     1035      1  0 13:35 ?        00:00:00 /usr/sbin/atd -f
root       1037      1  0 13:35 ?        00:00:00 /usr/bin/python3 -u /usr/sbin/waagent -daemon
root       1039      1  0 13:35 ?        00:00:00 /usr/lib/linux-tools/4.18.0-1018-azure/hv_vss_daemon -n
azureus+  52477  50702  0 23:28 pts/0    00:00:00 grep --color=auto daemon
</code></pre></div>
<p>You can also use files as input. By default, standard input comes from the keyboard, but it too can be redirected. To get input from a file instead of the keyboard, use the <code>&lt;</code> operator. One common sysadmin task is to sort the contents of a file. As the name suggests, <code>sort</code> sorts text in alphabetical order:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>sort &lt; file.txt
</code></pre></div>
<p>To save the sorted results to a new file, you can redirect input <em>and</em> output:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>sort &lt; file.txt &gt; sorted_file.txt
</code></pre></div>
<p>You can use I/O operators to chain Linux commands as needed. Consider the following command:</p>
<p>BashCopy</p>
<div class="highlight"><pre><span></span><code>cat file.txt | fmt | pr | lpr
</code></pre></div>
<p>The output from <code>cat</code> goes to <code>fmt</code>, the output from <code>fmt</code> goes to <code>pr</code>, and so on. <code>fmt</code> formats the results into a tidy paragraph. <code>pr</code> paginates the results. And <code>lpr</code> sends the paginated output to the printer. All in a single line!</p>
<hr />
<h2 id="introduction-to-powershell"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#introduction-to-powershell">Introduction to PowerShell</a></h2>
<p>PowerShell is a command-line shell and a scripting language all in one. It was designed as a task engine that uses cmdlets to wrap tasks that people need to do. In PowerShell, you can run commands on local or remote machines. You can do tasks like managing users and automating workflows.</p>
<p>Whether you're part of an operations team or a development team that's adopting DevOps principles, PowerShell can help. You can use it to address various tasks, such as managing cloud resources and continuous integration and continuous delivery (CI/CD). PowerShell offers many helpful commands, but you can expand its capabilities at any time by installing modules.</p>
<p>When you install PowerShell, you can evaluate its features to see if it's a good fit for your team.</p>
<h2 id="what-is-powershell"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#what-is-powershell">What is PowerShell?</a></h2>
<p>PowerShell consists of two parts: a command-line shell and a scripting language. It started out as a framework to automate administrative tasks in Windows. PowerShell has grown into a cross-platform tool that's used for many kinds of tasks.</p>
<p>A command-line shell lacks a graphical interface, where you use a mouse to interact with graphical elements. Instead, you type text commands into a computer console. Here are some of the benefits of using a console:</p>
<ul>
<li>Interacting with a console is often faster than using a graphical interface.</li>
<li>In a console, you can run batches of commands, so it's ideal for task automation for continuous-integration pipelines.</li>
<li>You can use a console to interact with cloud resources and other resources.</li>
<li>You can store commands and scripts in a text file and use a source-control system. This capability is probably one of the biggest benefits, because your commands are repeatable and auditable. In many systems, especially government systems, everything must be traced and evaluated, or <em>audited</em>. Audits cover everything from database changes to changes done by a script.</li>
</ul>
<h3 id="features"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#features">Features</a></h3>
<p>PowerShell shares some features with traditional shells:</p>
<ul>
<li><strong>Built-in help system</strong>: Most shells have some kind of help system, in which you can learn more about a command. For example, you can learn what the command does and what parameters it supports. The help system in PowerShell provides information about commands and also integrates with online help articles.</li>
<li><strong>Pipeline</strong>: Traditional shells use a pipeline to run many commands sequentially. The output of one command is the input for the next command. PowerShell implements this concept like traditional shells, but it differs because it operates on objects over text. You learn more about this feature later in this module.</li>
<li><strong>Aliases</strong>: Aliases are alternate names that can be used to run commands. PowerShell supports the use of common aliases such as <code>cls</code> (clear the screen) and <code>ls</code> (list the files). Therefore, new users can use their knowledge of other frameworks and don't necessarily have to remember the PowerShell name for familiar commands.</li>
</ul>
<p>PowerShell differs from a traditional command-line shell in a few ways:</p>
<ul>
<li><strong>It operates on objects over text.</strong> In a command-line shell, you have to run scripts whose output and input might differ, so you end up spending time formatting the output and extracting the data you need. By contrast, in PowerShell you use objects as input and output. That means you spend less time formatting and extracting.</li>
<li><strong>It has cmdlets.</strong> Commands in PowerShell are called cmdlets (pronounced <em>commandlets</em>). In PowerShell, cmdlets are built on a common runtime rather than separate executables as they are in many other shell environments. This characteristic provides a consistent experience in parameter parsing and pipeline behavior. Cmdlets typically take object input and return objects. The core cmdlets in PowerShell are built in .NET Core, and are open source. You can extend PowerShell by using more cmdlets, scripts, and functions from the community and other sources, or you can build your own cmdlets in .NET Core or PowerShell.</li>
<li><strong>It has many types of commands.</strong> Commands in PowerShell can be native executables, cmdlets, functions, scripts, or aliases. Every command you run belongs to one of these types. The words <em>command</em> and <em>cmdlet</em> are often used interchangeably, because a cmdlet is a type of command.</li>
</ul>
<h3 id="installation"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#installation">Installation</a></h3>
<p>In this module, you practice using PowerShell on your computer. PowerShell is available across platforms. However, if you use a computer that runs Linux, macOS, or an older version of Windows, you need to install it.</p>
<p>Instructions for installing PowerShell are different for each OS. Before you continue, take a few minutes to install PowerShell or to verify your PowerShell installation. The next unit in this module shows you how to verify your installation.</p>
<h4 id="windows"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#windows">Windows</a></h4>
<p>If you're running Windows 8 or later, a version of PowerShell called <em>Windows PowerShell</em> should already be installed. This version differs slightly from the most up-to-date PowerShell release, but it works fine for learning purposes.</p>
<p>You can open Windows PowerShell from the Start menu.</p>
<h4 id="other-operating-systems"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#other-operating-systems">Other operating systems</a></h4>
<p>If your computer runs something other than Windows 8 or later, you need to install PowerShell. To find the installation instructions for your OS, see <a href="https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell">Install various versions of PowerShell</a>.</p>
<h4 id="powershell-extension-for-visual-studio-code"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#powershell-extension-for-visual-studio-code">PowerShell extension for Visual Studio Code</a></h4>
<p>We recommend that you use the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell">PowerShell extension for Visual Studio Code</a> to author your PowerShell scripts and to run the commands in this module. This extension lets you run commands, and also helps you with snippets, code completion, and syntax highlighting.</p>
<hr />
<h2 id="locate-commands"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#locate-commands">Locate commands</a></h2>
<p>A <em>cmdlet</em> (pronounced "command-let") is a compiled command. A cmdlet can be developed in .NET or .NET Core and invoked as a command within PowerShell. Thousands of cmdlets are available in your PowerShell installation. The challenge lies in discovering what the cmdlets are and what they can do for you.</p>
<p>Cmdlets are named according to a verb-noun naming standard. This pattern can help you to understand what they do and how to search for them. It also helps cmdlet developers create consistent names. You can see the list of approved verbs by using the <code>Get-Verb</code> cmdlet. Verbs are organized according to activity type and function.</p>
<p>Here's a part of the output from running <code>Get-Verb</code>:</p>
<p>OutputCopy</p>
<div class="highlight"><pre><span></span><code>Verb        AliasPrefix Group          Description
----        ----------- -----          -----------
Add         a           Common         Adds a resource to a container, or atta…
Clear       cl          Common         Removes all the resources from a contai…
</code></pre></div>
<p>This listing shows the verb and its description. Cmdlet developers should use an approved verb, and also ensure that the verb description fits their cmdlet's function.</p>
<p>Three core cmdlets allow you to delve into what cmdlets exist and what they do:</p>
<ul>
<li><strong>Get-Command</strong>: The <code>Get-Command</code> cmdlet lists all of the available cmdlets on your system. Filter the list to quickly find the command you need.</li>
<li><strong>Get-Help</strong>: Run the <code>Get-Help</code> core cmdlet to invoke a built-in help system. You can also run an alias <code>help</code> command to invoke <code>Get-Help</code> but improve the reading experience by paginating the response.</li>
<li><strong>Get-Member</strong>: When you call a command, the response is an object that contains many properties. Run the <code>Get-Member</code> core cmdlet to drill down into that response and learn more about it.</li>
</ul>
<h3 id="locate-commands-by-using-get-command"><a class="toclink" href="../../2024/11/14/Az%20104%20-%20Prerequisites%20Azure%20Administrator/#locate-commands-by-using-get-command">Locate commands by using Get-Command</a></h3>
<p>When you run the <code>Get-Command</code> cmdlet in Cloud Shell, you get a list of every command that's installed in PowerShell. Because thousands of commands are installed, you need a way to filter the response so you can quickly locate the command that you need.</p>
<p>To filter the list, keep in mind the verb-noun naming standard for cmdlets. For example, in the <code>Get-Random</code> command, <code>Get</code> is the verb and <code>Random</code> is the noun. Use flags to target either the verb or the noun in the command you want. The flag you specify expects a value that's a string. You can add pattern-matching characters to that string to ensure you express that, for example, a flag's value should start or end with a certain string.</p>
<p>These examples show how to use flags to filter a command list:</p>
<ul>
<li>
<p><strong>-Noun</strong>: The <code>-Noun</code> flag targets the part of the command name that's related to the noun. Here's a typical search for a command name using <em>alias</em> as the noun for which we're searching:</p>
<p>PowerShellCopy</p>
<div class="highlight"><pre><span></span><code>Get-Command -Noun alias*
</code></pre></div>
<p>This command searches for all cmdlets whose noun part starts with <code>alias</code>.</p>
</li>
<li>
<p><strong>-Verb</strong>: The <code>-Verb</code> flag targets the part of the command name that's related to the verb. You can combine the <code>-Noun</code> flag and the <code>-Verb</code> flag to create an even more detailed search query and type. Here's an example:</p>
<p>PowerShellCopy</p>
<div class="highlight"><pre><span></span><code>Get-Command -Verb Get -Noun alias*
</code></pre></div>
<p>Now you've narrowed the search to specify that the verb part needs to match <code>Get</code>, and the noun part needs to match <code>alias</code>.</p>
</li>
</ul>
<hr />
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>